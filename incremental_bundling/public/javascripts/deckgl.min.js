!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=69)}([function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function i(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";var i=n(45),r=n(54);var a=n(3),o={};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";o[e]=o[e]||1;var t=o[e]++;return"".concat(e,"-").concat(t)}function c(e){return Object(a.a)("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function u(e){var t=!0;for(var n in e){t=!1;break}return t}var l=n(28);function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isInteger,i=void 0!==n&&n;if(Array.isArray(e)||ArrayBuffer.isView(e))return function(e,t){for(var n=t.maxElts,i=void 0===n?16:n,r=t.size,a=void 0===r?1:r,o="[",s=0;s<e.length&&s<i;++s)s>0&&(o+=",".concat(s%a==0?" ":"")),o+=h(e[s],t);var c=e.length>i?"...":"]";return"".concat(o).concat(c)}(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return i?"0":"0.";if(i)return e.toFixed(0);if(Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);var r=e.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}var d=n(55);n.d(t,"c",function(){return i.a}),n.d(t,"e",function(){return r.a}),n.d(t,"i",function(){return s}),n.d(t,"f",function(){return c}),n.d(t,"d",function(){return u}),n.d(t,"g",function(){return l.a}),n.d(t,"b",function(){return h}),n.d(t,"a",function(){return a.a}),n.d(t,"h",function(){return d.a})},function(e,t,n){"use strict";n.r(t);var i=n(44),r=n(53),a=n(25),o=n(6),s=n(24),c="Failed to create WebGL context in Node.js, headless gl not available",u="Failed to create WebGL context in Node.js, headless gl returned null";var l,h=n(4),d=h.c&&"undefined"!=typeof document,f=d&&"complete"===document.readyState;function g(){return l||(l=d?new Promise(function(e,t){if(d&&"complete"===document.readyState)return f=!0,void e(document);window.onload=function(){f=!0,e(document)}}):Promise.resolve({})),l}function p(e){var t,n=e.canvas,i=e.width,r=e.height,a=e.onError,o=void 0===a?function(){}:a;return"string"==typeof n?(f||o("createGLContext called on canvas '".concat(n,"' before page was loaded")),t=document.getElementById(n)):t=n||function(e){var t=e.width,n=void 0===t?800:t,i=e.height,r=void 0===i?600:i,a=e.id,o=void 0===a?"gl-canvas":a,s=e.insert,c=void 0===s||s,u=document.createElement("canvas");if(u.id=o,u.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",u.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",c){var l=document.body;l.insertBefore(u,l.firstChild)}return u}({id:"lumagl-canvas",width:i,height:r,onError:o}),t}var v=n(46),m=n(1),_=n(18);function b(e){return e.luma=e.luma||{},e.luma}function y(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).debug;return null===e?null:void 0===t||t?function(e){if(null===e)return null;if(!_.b.WebGLDebug)return h.g.warn('WebGL debug mode not activated. import "luma.gl/debug" to enable.')(),e;var t=b(e);if(t.realContext)return e;if(t.debugContext)return t.debugContext;var n=_.b.WebGLDebug.makeDebugContext(e,E,w);return Object.assign(function e(){Object(m.a)(this,e)}.prototype,n),t.debugContext=n,n.debug=!0,n.gl=e,h.g.info("debug context actived."),n}(e):function(e){if(null===e)return null;var t=b(e);return t.realContext?t.realContext:e}(e)}function x(e,t){var n=_.b.WebGLDebug.glFunctionArgsToString(e,t);return n="".concat(n.slice(0,100)).concat(n.length>100?"...":""),"gl.".concat(e,"(").concat(n,")")}function E(e,t,n){var i=_.b.WebGLDebug.glEnumToString(e),r=_.b.WebGLDebug.glFunctionArgsToString(t,n),a="".concat(i," in gl.").concat(t,"(").concat(r,")");if(h.g.throw)throw new Error(a);h.g.error(a)()}function w(e,t){var n;if(h.g.priority>=4&&(n=x(e,t),h.g.log(4,n)()),h.g.break){n=n||x(e,t);h.g.break&&h.g.break.every(function(e){return-1!==n.indexOf(e)})}var i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){if(void 0===o.value){if(n=n||x(e,t),h.g.throw)throw new Error("Undefined argument: ".concat(n));h.g.error("Undefined argument: ".concat(n))}}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}}var O,S=n(0),P=(O={},Object(S.a)(O,33902,{gl1:new Float32Array([1,1])}),Object(S.a)(O,33901,{gl1:new Float32Array([1,1])}),Object(S.a)(O,3379,{gl1:64,gl2:2048}),Object(S.a)(O,34076,{gl1:16}),Object(S.a)(O,34930,{gl1:8}),Object(S.a)(O,35661,{gl1:8}),Object(S.a)(O,35660,{gl1:0}),Object(S.a)(O,34024,{gl1:1}),Object(S.a)(O,36348,{gl1:8}),Object(S.a)(O,34921,{gl1:8}),Object(S.a)(O,36347,{gl1:128}),Object(S.a)(O,36349,{gl1:16}),Object(S.a)(O,3386,{gl1:new Int32Array([0,0])}),Object(S.a)(O,32883,{gl1:0,gl2:256}),Object(S.a)(O,35071,{gl1:0,gl2:256}),Object(S.a)(O,37447,{gl1:0,gl2:0}),Object(S.a)(O,36063,{gl1:0,gl2:4}),Object(S.a)(O,35379,{gl1:0,gl2:0}),Object(S.a)(O,35374,{gl1:0,gl2:0}),Object(S.a)(O,35377,{gl1:0,gl2:0}),Object(S.a)(O,34852,{gl1:0,gl2:4}),Object(S.a)(O,36203,{gl1:0,gl2:0}),Object(S.a)(O,33001,{gl1:0,gl2:0}),Object(S.a)(O,33e3,{gl1:0,gl2:0}),Object(S.a)(O,37157,{gl1:0,gl2:0}),Object(S.a)(O,35373,{gl1:0,gl2:0}),Object(S.a)(O,35657,{gl1:0,gl2:0}),Object(S.a)(O,36183,{gl1:0,gl2:0}),Object(S.a)(O,37137,{gl1:0,gl2:0}),Object(S.a)(O,34045,{gl1:0,gl2:0}),Object(S.a)(O,35978,{gl1:0,gl2:0}),Object(S.a)(O,35979,{gl1:0,gl2:0}),Object(S.a)(O,35968,{gl1:0,gl2:0}),Object(S.a)(O,35376,{gl1:0,gl2:0}),Object(S.a)(O,35375,{gl1:0,gl2:0}),Object(S.a)(O,35659,{gl1:0,gl2:0}),Object(S.a)(O,37154,{gl1:0,gl2:0}),Object(S.a)(O,35371,{gl1:0,gl2:0}),Object(S.a)(O,35658,{gl1:0,gl2:0}),Object(S.a)(O,35076,{gl1:0,gl2:-8,negative:!0}),Object(S.a)(O,35077,{gl1:0,gl2:7}),Object(S.a)(O,35380,{gl1:0,gl2:0}),O);function A(e){if(e.luma=e.luma||{},!e.luma.limits){e.luma.limits={},e.luma.webgl1MinLimits={},e.luma.webgl2MinLimits={};var t=Object(o.n)(e);for(var n in P){var i=P[n],r=i.gl1,a="gl2"in i?i.gl2:i.gl1,s=t?a:r,c="gl2"in i&&!t||"extension"in i&&!e.getExtension(i.extension)?s:e.getParameter(n);e.luma.limits[n]=c,e.luma.webgl1MinLimits[n]=r,e.luma.webgl2MinLimits[n]=a}}return e.luma.limits}function T(e){if(e.luma=e.luma||{},!e.luma.info){var t,n=e.getExtension("WEBGL_debug_renderer_info");e.luma.info=(t={},Object(S.a)(t,7936,e.getParameter(7936)),Object(S.a)(t,7937,e.getParameter(7937)),Object(S.a)(t,37445,e.getParameter(n&&n.UNMASKED_VENDOR_WEBGL||7936)),Object(S.a)(t,37446,e.getParameter(n&&n.UNMASKED_RENDERER_WEBGL||7937)),Object(S.a)(t,7938,e.getParameter(7938)),Object(S.a)(t,35724,e.getParameter(35724)),t)}return e.luma.info}var C=37445,j=37446;function M(e){var t=A(e),n=T(e);return{vendor:n[C]||n[7936],renderer:n[j]||n[7937],version:n[7938],shadingLanguageVersion:n[35724],info:n,limits:t,webgl1MinLimits:e.luma.webgl1MinLimits,webgl2MinLimits:e.luma.webgl2MinLimits}}function R(e){return function(e){var t=e.getParameter(7936),n=e.getParameter(7937),i=e.getExtension("WEBGL_debug_renderer_info"),r=i&&e.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),a=i&&e.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||t,renderer:a||n,vendorMasked:t,rendererMasked:n,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}(e)}var L=n(2),I=function(e){return e},F=new(function(){function e(){Object(m.a)(this,e),this.pendingQueries=new Set,this.invalidQueryType=null,this.invalidErrorMessage="",this.checkInvalid=function(){return!1}}return Object(L.a)(e,[{key:"poll",value:function(e){this.cancelInvalidQueries(e);var t=!0,n=!1,i=void 0;try{for(var r,a=this.pendingQueries.values()[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;if(o.isResultAvailable()){var s=o.getResult();this.resolveQuery(o,s)}}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"setInvalidator",value:function(e){var t=e.queryType,n=e.errorMessage,i=e.checkInvalid;this.invalidQueryType=t,this.invalidErrorMessage=n,this.checkInvalid=i}},{key:"beginQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;this.cancelInvalidQueries(e.gl),this.cancelQuery(e);var i={};return e.promise=new Promise(function(e,t){i.resolve=e,i.reject=t}),Object.assign(e.promise,i),this.pendingQueries.add(e),e.promise.then(t).catch(n)}},{key:"resolveQuery",value:function(e,t){this.pendingQueries.delete(e),e.promise.resolve(t)}},{key:"rejectQuery",value:function(e,t){this.pendingQueries.delete(e),e.promise&&e.promise.reject(new Error(t))}},{key:"deleteQuery",value:function(e){return this.rejectQuery(e,"Query was deleted before result was available")}},{key:"cancelQuery",value:function(e){return this.rejectQuery(e,"Query was canceled before result was available")}},{key:"invalidateQuery",value:function(e){e instanceof this.invalidQueryType&&this.rejectQuery(e,this.invalidErrorMessage)}},{key:"cancelInvalidQueries",value:function(e){if(this.checkInvalid(e)){var t=!0,n=!1,i=void 0;try{for(var r,a=this.pendingQueries.values()[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;this.invalidateQuery(o)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}}}]),e}()),k=n(3),N=34962,D=32874;function B(e){return Boolean(e&&(e instanceof o.c||e.ARRAY_BUFFER===N))}function U(e){return Boolean(e&&(e instanceof o.a||e.TEXTURE_BINDING_3D===D))}var z={webgl2:!0,webgl1:!0,throwOnFailure:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function G(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(z,{width:1,height:1},e)}function V(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t=Object.assign({},z,t),i=n.canvas,r=n.width,a=n.height,o=n.throwOnError,l=n.manageState,d=n.debug;function f(e){if(o)throw new Error(e);return null}h.c?e=function(e){var t=e.canvas,n=e.opts,i=void 0===n?{}:n,r=e.onError,a=void 0===r?function(e){return null}:r;function o(e){a("WebGL context: ".concat(e.statusMessage||"Unknown error"))}t.addEventListener("webglcontextcreationerror",o,!1);var s=i.webgl1,c=void 0===s||s,u=i.webgl2,l=void 0===u||u,h=null;return l&&(h=(h=h||t.getContext("webgl2",i))||t.getContext("experimental-webgl2",i)),c&&(h=(h=h||t.getContext("webgl",i))||t.getContext("experimental-webgl",i)),t.removeEventListener("webglcontextcreationerror",o,!1),h||a("Failed to create ".concat(l&&!c?"WebGL2":"WebGL"," context"))}({canvas:p({canvas:i,width:r,height:a,onError:f}),opts:t}):e=function(e){var t=e.width,n=e.height,i=e.opts,r=e.onError,a=i.webgl1;if(i.webgl2&&!a)return r("headless-gl does not support WebGL2");if(!s.d)return r(c);var o=Object(s.d)(t,n,i);return o||r(u)}({width:r,height:a,opts:t,onError:f});return e?(l&&Object(v.a)(e,{copyState:!1,log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.g.log.apply(h.g,[1].concat(t))()}}),h.c&&d&&(e=y(e,{debug:d}),h.g.priority=Math.max(h.g.priority,1)),function(e){var t=U(e)?"WebGL2":"WebGL1",n=R(e),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=e.debug?" debug":"";h.g.once(0,"".concat(t).concat(r," context ").concat(i))()}(e),e):null}function W(e){var t=e.getExtension("STACKGL_destroy_context");t&&t.destroy()}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.canvas){var n=t.useDevicePixels&&window.devicePixelRatio||1,i="width"in t?t.width:e.canvas.clientWidth,r="height"in t?t.height:e.canvas.clientHeight;return e.canvas.width=i*n,void(e.canvas.height=r*n)}var a=e.getExtension("STACKGL_resize_drawingbuffer");a&&"width"in t&&"height"in t&&a.resize(t.width,t.height)}function X(e){F.poll(e)}var Y=n(20),q={VERTEX_ARRAY_OBJECT:["OES_vertex_array_object",!0],TIMER_QUERY:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],INSTANCED_RENDERING:["ANGLE_instanced_arrays",!0],MULTIPLE_RENDER_TARGETS:["WEBGL_draw_buffers",!0],ELEMENT_INDEX_UINT32:["OES_element_index_uint",!0],BLEND_EQUATION_MINMAX:["EXT_blend_minmax",!0],COLOR_ENCODING_SRGB:["EXT_sRGB",!0],TEXTURE_DEPTH:["WEBGL_depth_texture",!0],TEXTURE_FLOAT:["OES_texture_float",!0],TEXTURE_HALF_FLOAT:["OES_texture_half_float",!0],TEXTURE_FILTER_LINEAR_FLOAT:["OES_texture_float_linear"],TEXTURE_FILTER_LINEAR_HALF_FLOAT:["OES_texture_half_float_linear"],TEXTURE_FILTER_ANISOTROPIC:["EXT_texture_filter_anisotropic"],COLOR_ATTACHMENT_RGBA32F:["WEBGL_color_buffer_float","EXT_color_buffer_float"],COLOR_ATTACHMENT_FLOAT:[!1,"EXT_color_buffer_float"],COLOR_ATTACHMENT_HALF_FLOAT:[!1,"EXT_color_buffer_half_float"],GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Z={};Object.keys(q).forEach(function(e){Z[e]=e});var K={};function $(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=q[t];if(Object(k.a)(i,t),!Object(h.e)(n))return!0;if(t in K)return K[t];var r=i[0],a="#extension GL_".concat(r," : enable\nvoid main(void) {}"),o=e.createShader(35633);e.shaderSource(o,a),e.compileShader(o);var s=e.getShaderParameter(o,35713);return e.deleteShader(o),K[t]=s,s}function Q(e,t){var n=q[t];Object(k.a)(n,t);var i=Object(o.n)(e)&&n[1]||n[0],r="string"==typeof i?Boolean(e.getExtension(i)):i;return Object(k.a)(!1===r||!0===r),r}function J(e,t){return ee(e,t)}function ee(e,t){return(t=Array.isArray(t)?t:[t]).every(function(t){return Q(e,t)})}function te(e){if(e.luma=e.luma||{},!e.luma.caps)for(var t in e.luma.caps={},e.luma.caps.webgl2=Object(o.n)(e),q)e.luma.caps[t]=Q(e,t);return e.luma.caps}var ne=n(16),ie=n(9),re=n(8),ae=n(10),oe=n(23),se="Shader: GLSL source code must be a JavaScript string",ce=35632,ue=35633,le=function(e){function t(e,n){var i;Object(m.a)(this,t),Object(o.e)(e),Object(k.a)("string"==typeof n.source,se);var r=Object(o.k)(n.source,null)||n.id||Object(h.i)("unnamed ".concat(t.getTypeName(n.shaderType)));return(i=Object(ie.a)(this,Object(re.a)(t).call(this,e,{id:r}))).shaderType=n.shaderType,i.source=n.source,i.initialize(n),i}return Object(ae.a)(t,e),Object(L.a)(t,null,[{key:"getTypeName",value:function(e){switch(e){case ue:return"vertex-shader";case ce:return"fragment-shader";default:return Object(k.a)(!1),"unknown"}}}]),Object(L.a)(t,[{key:"initialize",value:function(e){var t=e.source,n=Object(o.k)(t,null);n&&(this.id=Object(h.i)(n)),this._compile(t)}},{key:"getParameter",value:function(e){return this.gl.getShaderParameter(this.handle,e)}},{key:"toString",value:function(){return"".concat(this.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return Object(o.k)(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){if(this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var e=this.gl.getShaderInfoLog(this.handle),t=Object(o.o)(e,this.source,this.shaderType,this.id),n=t.shaderName,i=t.errors,r=t.warnings;throw h.g.error("GLSL compilation errors in ".concat(n,"\n").concat(i))(),h.g.warn("GLSL compilation warnings in ".concat(n,"\n").concat(r))(),new Error("GLSL compilation errors in ".concat(n))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}]),t}(oe.a),he=function(e){function t(e,n){return Object(m.a)(this,t),"string"==typeof n&&(h.g.deprecated("new FragmentShader(gl, source)","new FragmentShader(gl, {source})","6.1"),n={source:n}),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{shaderType:ue})))}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_createHandle",value:function(){return this.gl.createShader(ue)}}]),t}(le),de=function(e){function t(e,n){return Object(m.a)(this,t),"string"==typeof n&&(h.g.deprecated("new FragmentShader(gl, source)","new FragmentShader(gl, {source})","6.1"),n={source:n}),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{shaderType:ce})))}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_createHandle",value:function(){return this.gl.createShader(ce)}}]),t}(le);function fe(e,t,n){return(fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(re.a)(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}var ge,pe=n(15),ve=n(34),me=n(14),_e=n(38),be="EXT_color_buffer_float",ye=(ge={},Object(S.a)(ge,33189,{}),Object(S.a)(ge,33190,{gl2:!0}),Object(S.a)(ge,36012,{gl2:!0}),Object(S.a)(ge,36168,{}),Object(S.a)(ge,34041,{}),Object(S.a)(ge,35056,{gl2:!0}),Object(S.a)(ge,36013,{gl2:!0}),Object(S.a)(ge,32854,{}),Object(S.a)(ge,36194,{}),Object(S.a)(ge,32855,{}),Object(S.a)(ge,33321,{gl2:!0}),Object(S.a)(ge,33330,{gl2:!0}),Object(S.a)(ge,33329,{gl2:!0}),Object(S.a)(ge,33332,{gl2:!0}),Object(S.a)(ge,33331,{gl2:!0}),Object(S.a)(ge,33334,{gl2:!0}),Object(S.a)(ge,33333,{gl2:!0}),Object(S.a)(ge,33323,{gl2:!0}),Object(S.a)(ge,33336,{gl2:!0}),Object(S.a)(ge,33335,{gl2:!0}),Object(S.a)(ge,33338,{gl2:!0}),Object(S.a)(ge,33337,{gl2:!0}),Object(S.a)(ge,33340,{gl2:!0}),Object(S.a)(ge,33339,{gl2:!0}),Object(S.a)(ge,32849,{gl2:!0}),Object(S.a)(ge,32856,{gl2:!0}),Object(S.a)(ge,32857,{gl2:!0}),Object(S.a)(ge,36220,{gl2:!0}),Object(S.a)(ge,36238,{gl2:!0}),Object(S.a)(ge,36975,{gl2:!0}),Object(S.a)(ge,36214,{gl2:!0}),Object(S.a)(ge,36232,{gl2:!0}),Object(S.a)(ge,36226,{gl2:!0}),Object(S.a)(ge,36208,{gl2:!0}),Object(S.a)(ge,33325,{gl2:be}),Object(S.a)(ge,33327,{gl2:be}),Object(S.a)(ge,34842,{gl2:be}),Object(S.a)(ge,33326,{gl2:be}),Object(S.a)(ge,33328,{gl2:be}),Object(S.a)(ge,34836,{gl2:be}),Object(S.a)(ge,35898,{gl2:be}),ge);var xe=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),(n=Object(ie.a)(this,Object(re.a)(t).call(this,e,i))).initialize(i),Object.seal(Object(pe.a)(Object(pe.a)(n))),n}return Object(ae.a)(t,e),Object(L.a)(t,null,[{key:"isSupported",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).format;return!t||function(e,t,n){var i=n[t];if(!i)return!1;var r=Object(o.n)(e)&&i.gl2||i.gl1;return"string"==typeof r?e.getExtension(r):r}(e,t,ye)}},{key:"getSamplesForFormat",value:function(e,t){var n=t.format;return e.getInternalformatParameter(36161,n,32937)}}]),Object(L.a)(t,[{key:"initialize",value:function(e){var t=e.format,n=e.width,i=void 0===n?1:n,r=e.height,a=void 0===r?1:r,s=e.samples,c=void 0===s?0:s;return Object(k.a)(t,"Needs format"),this.gl.bindRenderbuffer(36161,this.handle),0!==c&&Object(o.n)(this.gl)?this.gl.renderbufferStorageMultisample(36161,c,t,i,a):this.gl.renderbufferStorage(36161,t,i,a),this.format=t,this.width=i,this.height=a,this.samples=c,this}},{key:"resize",value:function(e){var t=e.width,n=e.height;return t!==this.width||n!==this.height?this.initialize({width:t,height:n,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle)}},{key:"_bindHandle",value:function(e){this.gl.bindRenderbuffer(36161,e)}},{key:"_syncHandle",value:function(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}]),t}(oe.a),Ee=256,we=1024,Oe=16384,Se=6144,Pe=6145,Ae=6146,Te=34041,Ce="clear: bad arguments";function je(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.framebuffer,i=void 0===n?null:n,r=t.color,a=void 0===r?null:r,o=t.depth,s=void 0===o?null:o,c=t.stencil,u=void 0===c?null:c,l={};i&&(l.framebuffer=i);var h=0;a&&(h|=Oe,!0!==a&&(l.clearColor=a)),s&&(h|=Ee,!0!==s&&(l.clearDepth=s)),u&&(h|=we,!0!==s&&(l.clearStencil=s)),Object(k.a)(0!==h,Ce),Object(Y.g)(e,l,function(){e.clear(h)})}function Me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.framebuffer,i=void 0===n?null:n,r=t.buffer,a=void 0===r?Se:r,s=t.drawBuffer,c=void 0===s?0:s,u=t.value,l=void 0===u?[0,0,0,0]:u;Object(o.d)(e),Object(Y.g)(e,{framebuffer:i},function(){switch(a){case Se:switch(l.constructor){case Int32Array:e.clearBufferiv(a,c,l);break;case Uint32Array:e.clearBufferuiv(a,c,l);break;case Float32Array:default:e.clearBufferfv(a,c,l)}break;case Pe:e.clearBufferfv(Pe,0,[l]);break;case Ae:e.clearBufferiv(Ae,0,[l]);break;case Te:var t=Object(me.a)(l,2),n=t[0],i=t[1];e.clearBufferfi(Te,0,n,i);break;default:Object(k.a)(!1,Ce)}})}var Re=n(29);function Le(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Object(k.a)(!1),0}}var Ie=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),(n=Object(ie.a)(this,Object(re.a)(t).call(this,e,i))).width=null,n.height=null,n.attachments={},n.readBuffer=36064,n.drawBuffers=[36064],n.initialize(i),Object.seal(Object(pe.a)(Object(pe.a)(n))),n}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"MAX_COLOR_ATTACHMENTS",get:function(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}}],[{key:"isSupported",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.colorBufferFloat,i=t.colorBufferHalfFloat;return n&&e.getExtension(Object(o.n)(e)?"EXT_color_buffer_float":"WEBGL.color_buffer_float"),i&&e.getExtension(Object(o.n)(e)?"EXT_color_buffer_float":"EXT_color_buffer_half_float")}},{key:"getDefaultFramebuffer",value:function(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new t(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}}]),Object(L.a)(t,[{key:"initialize",value:function(e){var t=e.width,n=void 0===t?1:t,i=e.height,r=void 0===i?1:i,a=e.attachments,o=void 0===a?null:a,s=e.color,c=void 0===s||s,u=e.depth,l=void 0===u||u,h=e.stencil,d=void 0!==h&&h,f=e.check,g=void 0===f||f,p=e.readBuffer,v=e.drawBuffers;if(Object(k.a)(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,o)for(var m in o){var _=o[m];(Array.isArray(_)?_[0]:_).resize({width:n,height:r})}else o=this._createDefaultAttachments(c,l,d,n,r);this.update({clearAttachments:!0,attachments:o,readBuffer:p,drawBuffers:v}),o&&g&&this.checkStatus()}},{key:"update",value:function(e){var t=e.attachments,n=void 0===t?{}:t,i=e.readBuffer,r=e.drawBuffers,a=e.clearAttachments,o=void 0!==a&&a,s=e.resizeAttachments,c=void 0===s||s;this.attach(n,{clearAttachments:o,resizeAttachments:c});var u=this.gl,l=u.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),u.bindFramebuffer(36160,l||null),this}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width,n=e.height;if(null===this.handle)return Object(k.a)(void 0===t&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;for(var i in void 0===t&&(t=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),t!==this.width&&n!==this.height&&h.g.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(n)),this.attachments)this.attachments[i].resize({width:t,height:n});return this.width=t,this.height=n,this}},{key:"attach",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.clearAttachments,r=void 0!==i&&i,a=n.resizeAttachments,o=void 0===a||a,s={};r&&Object.keys(this.attachments).forEach(function(e){s[e]=null}),Object.assign(s,e);var c=this.gl.bindFramebuffer(36160,this.handle);for(var u in s){Object(k.a)(void 0!==u,"Misspelled framebuffer binding point?");var l=Number(u),h=s[l],d=h;if(d)if(d instanceof xe)this._attachRenderbuffer({attachment:l,renderbuffer:d});else if(Array.isArray(h)){var f=Object(me.a)(h,3),g=f[0],p=f[1],v=void 0===p?0:p,m=f[2],_=void 0===m?0:m;d=g,this._attachTexture({attachment:l,texture:g,layer:v,level:_})}else this._attachTexture({attachment:l,texture:d,layer:0,level:0});else this._unattach(l);o&&d&&d.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,c||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(function(e){return!t.attachments[e]}).forEach(function(e){delete t.attachments[e]})}},{key:"checkStatus",value:function(){var e=this.gl,t=e.bindFramebuffer(36160,this.handle),n=e.checkFramebufferStatus(36160);if(e.bindFramebuffer(36160,t||null),36053!==n)throw new Error(function(e){return(Ie.STATUS||{})[e]||"Framebuffer error ".concat(e)}(n));return this}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=e.depth,i=e.stencil,r=e.drawBuffers,a=void 0===r?[]:r,o=this.gl.bindFramebuffer(36160,this.handle);return(t||n||i)&&je(this.gl,{color:t,depth:n,stencil:i}),a.forEach(function(e,t){Me({drawBuffer:t,value:e})}),this.gl.bindFramebuffer(36160,o||null),this}},{key:"readPixels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,n=void 0===t?0:t,i=e.y,r=void 0===i?0:i,a=e.width,o=void 0===a?this.width:a,s=e.height,c=void 0===s?this.height:s,u=e.format,l=void 0===u?6408:u,h=e.type,d=e.pixelArray,f=void 0===d?null:d,g=e.attachment,p=void 0===g?36064:g;this.gl;if(36064===p&&null===this.handle&&(p=1028),Object(k.a)(this.attachments[p]),h=h||this.attachments[p].type,!f){h=h||5121;var v=Object(Re.c)(h,{clamped:!1}),m=Le(l);f=f||new v(o*c*m)}h=h||Object(Re.b)(f);var _=this.gl.bindFramebuffer(36160,this.handle);return this.gl.readPixels(n,r,o,c,l,h,f),this.gl.bindFramebuffer(36160,_||null),f}},{key:"readPixelsToBuffer",value:function(e){var t=e.x,n=void 0===t?0:t,i=e.y,r=void 0===i?0:i,a=e.width,s=void 0===a?this.width:a,c=e.height,u=void 0===c?this.height:c,l=e.format,h=void 0===l?6408:l,d=e.type,f=e.buffer,g=void 0===f?null:f,p=e.byteOffset,v=void 0===p?0:p,m=this.gl;if(Object(o.d)(m),d=d||(g?g.type:5121),!g){var _=Le(h),b=function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Object(k.a)(!1),0}}(d),y=v+s*u*_*b;g=new ne.a(m,{bytes:y,type:d,size:_})}return g.bind({target:35051}),Object(Y.g)(m,{framebuffer:this},function(){m.readPixels(n,r,s,u,h,d,v)}),g.unbind({target:35051}),g}},{key:"copyToDataUrl",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.attachment,n=void 0===t?36064:t,i=e.maxHeight,r=void 0===i?Number.MAX_SAFE_INTEGER:i,a=this.readPixels({attachment:n}),s=this.width,c=this.height;c>r;){var u=Object(o.q)({data:a,width:s,height:c});a=u.data,s=u.width,c=u.height}Object(o.h)({data:a,width:s,height:c});var l=document.createElement("canvas");l.width=s,l.height=c;var h=l.getContext("2d"),d=h.createImageData(s,c);return d.data.set(a),h.putImageData(d,0,0),l.toDataURL()}},{key:"copyToImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.image,n=void 0===t?null:t,i=e.attachment,r=void 0===i?36064:i,a=e.maxHeight,o=(void 0===a&&Number.MAX_SAFE_INTEGER,this.readDataUrl({attachment:r}));return(n=n||new Image).src=o,n}},{key:"copyToTexture",value:function(e){var t=e.texture,n=e.target,i=e.xoffset,r=void 0===i?0:i,a=e.yoffset,o=void 0===a?0:a,s=e.zoffset,c=void 0===s?0:s,u=e.mipmapLevel,l=void 0===u?0:u,h=(e.attachment,e.x),d=void 0===h?0:h,f=e.y,g=void 0===f?0:f,p=e.width,v=e.height,m=this.gl,_=m.bindFramebuffer(36160,this.handle);switch(Object(k.a)(n||t),t&&(p=Number.isFinite(p)?p:t.width,v=Number.isFinite(v)?v:t.height,t.bind(0)),t.target){case 3553:case 34067:m.copyTexSubImage2D(n||t.target,l,r,o,d,g,p,v);break;case 35866:case 32879:m.copyTexSubImage3D(n||t.target,l,r,o,c,d,g,p,v)}return t&&t.unbind(),m.bindFramebuffer(36160,_||null),t}},{key:"blit",value:function(e){var t=e.srcFramebuffer,n=e.attachment,i=void 0===n?36064:n,r=e.srcX0,a=void 0===r?0:r,s=e.srcY0,c=void 0===s?0:s,u=e.srcX1,l=e.srcY1,h=e.dstX0,d=void 0===h?0:h,f=e.dstY0,g=void 0===f?0:f,p=e.dstX1,v=e.dstY1,m=e.color,_=void 0===m||m,b=e.depth,y=void 0!==b&&b,x=e.stencil,E=void 0!==x&&x,w=e.mask,O=void 0===w?0:w,S=e.filter,P=void 0===S?9728:S,A=this.gl;Object(o.d)(A),t.handle||36064!==i||(i=1028),_&&(O|=16384),y&&(O|=256),E&&(O|=1024),Object(k.a)(O),u=void 0===u?t.width:u,l=void 0===l?t.height:l,p=void 0===p?this.width:p,v=void 0===v?this.height:v;var T=A.bindFramebuffer(36009,this.handle),C=A.bindFramebuffer(36008,t.handle);return A.readBuffer(i),A.blitFramebuffer(a,c,u,l,d,g,p,v,O,P),A.readBuffer(this.readBuffer),A.bindFramebuffer(36008,C||null),A.bindFramebuffer(36009,T||null),this}},{key:"invalidate",value:function(e){var t=e.attachments,n=void 0===t?[]:t,i=e.x,r=void 0===i?0:i,a=e.y,s=void 0===a?0:a,c=e.width,u=e.height,l=this.gl;Object(o.d)(l);var h=l.bindFramebuffer(36008,this.handle);return 0===r&&0===s&&void 0===c&&void 0===u?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,r,s,c,u),l.bindFramebuffer(36008,h),this}},{key:"getAttachmentParameter",value:function(e,t,n){var i=this._getAttachmentParameterFallback(t);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=Object(a.d)(this.gl,i)),i}},{key:"getAttachmentParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],i={},r=!0,o=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var l=c.value;i[t?Object(a.d)(this.gl,l):l]=this.getAttachmentParameter(e,l,t)}}catch(e){o=!0,s=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw s}}return i}},{key:"getParameters",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object.keys(this.attachments),n={},i=0;i<t.length;i++){var r=t[i],o=Number(r);n[e?Object(a.d)(this.gl,o):o]=this.getAttachmentParameters(o,e)}return n}},{key:"show",value:function(){return"undefined"!=typeof window&&window.open(this.copyToDataUrl(),"luma-debug-texture"),this}},{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e>h.g.priority||"undefined"==typeof window)return this;t=t||"Framebuffer ".concat(this.id);var n=this.copyToDataUrl({maxHeight:100});return h.g.image({priority:e,message:t,image:n},t)(),this}},{key:"bind",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,t=void 0===e?36160:e;return this.gl.bindFramebuffer(t,this.handle),this}},{key:"unbind",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,t=void 0===e?36160:e;return this.gl.bindFramebuffer(t,null),this}},{key:"_createDefaultAttachments",value:function(e,t,n,i,r){var a,o=null;e&&((o=o||{})[36064]=new _e.a(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:r,mipmaps:!1,parameters:(a={},Object(S.a)(a,10241,9728),Object(S.a)(a,10240,9728),Object(S.a)(a,10242,33071),Object(S.a)(a,10243,33071),a)}));return t&&n?(o=o||{})[33306]=new xe(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}):t?(o=o||{})[36096]=new xe(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:r}):n&&Object(k.a)(!1),o}},{key:"_unattach",value:function(e){var t=this.attachments[e];t&&(t instanceof xe?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}},{key:"_attachRenderbuffer",value:function(e){var t=e.attachment,n=void 0===t?36064:t,i=e.renderbuffer;this.gl.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}},{key:"_attachTexture",value:function(e){var t=e.attachment,n=void 0===t?36064:t,i=e.texture,r=e.layer,a=e.level,o=this.gl;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,i.target,a,r);break;case 34067:var s=function(e){return e<34069?e+34069:e}(r);o.framebufferTexture2D(36160,n,s,i.handle,a);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,a);break;default:Object(k.a)(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}},{key:"_setReadBuffer",value:function(e,t){Object(o.n)(e)?e.readBuffer(t):Object(k.a)(36064===t||1029===t,"Multiple render targets not supported"),this.readBuffer=t}},{key:"_setDrawBuffers",value:function(e,t){if(Object(o.n)(e))e.drawBuffers(t);else{var n=e.getExtension("WEBGL.draw_buffers");n?n.drawBuffersWEBGL(t):Object(k.a)(1===t.length&&(36064===t[0]||1029===t[0]),"Multiple render targets not supported")}this.drawBuffers=t}},{key:"_getAttachmentParameterFallback",value:function(e){var t=te(this.gl);switch(e){case 36052:return t.webgl2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.webgl2?null:8;case 33297:return t.webgl2?null:5125;case 33296:return t.webgl2||t.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(e){return this.gl.bindFramebuffer(36160,e)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}}]),t}(oe.a);Ie.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];var Fe,ke=function(e){function t(e,n){var i;return Object(m.a)(this,t),Object(o.d)(e),i=Object(ie.a)(this,Object(re.a)(t).call(this,e,n)),Object.seal(Object(pe.a)(Object(pe.a)(i))),i}return Object(ae.a)(t,e),Object(L.a)(t,null,[{key:"isSupported",value:function(e){return Object(o.n)(e)}}]),Object(L.a)(t,[{key:"bind",value:function(e){return this.gl.bindSampler(e,this.handle),this}},{key:"unbind",value:function(e){return this.gl.bindSampler(e,null),this}},{key:"_createHandle",value:function(){return this.gl.createSampler()}},{key:"_deleteHandle",value:function(){this.gl.deleteSampler(this.handle)}},{key:"_getParameter",value:function(e){return this.gl.getSamplerParameter(this.handle,e)}},{key:"_setParameter",value:function(e,t){switch(e){case 33082:case 33083:this.gl.samplerParameterf(this.handle,e,t);break;default:this.gl.samplerParameteri(this.handle,e,t)}return this}}]),t}(oe.a),Ne=(Fe={},Object(S.a)(Fe,5126,function(e,t,n){return e.uniform1fv(t,Ve(n,1))}),Object(S.a)(Fe,35664,function(e,t,n){return e.uniform2fv(t,Ve(n,2))}),Object(S.a)(Fe,35665,function(e,t,n){return e.uniform3fv(t,Ve(n,3))}),Object(S.a)(Fe,35666,function(e,t,n){return e.uniform4fv(t,Ve(n,4))}),Object(S.a)(Fe,5124,function(e,t,n){return e.uniform1iv(t,We(n,1))}),Object(S.a)(Fe,35667,function(e,t,n){return e.uniform2iv(t,We(n,2))}),Object(S.a)(Fe,35668,function(e,t,n){return e.uniform3iv(t,We(n,3))}),Object(S.a)(Fe,35669,function(e,t,n){return e.uniform4iv(t,We(n,4))}),Object(S.a)(Fe,35670,function(e,t,n){return e.uniform1iv(t,We(n,1))}),Object(S.a)(Fe,35671,function(e,t,n){return e.uniform2iv(t,We(n,2))}),Object(S.a)(Fe,35672,function(e,t,n){return e.uniform3iv(t,We(n,3))}),Object(S.a)(Fe,35673,function(e,t,n){return e.uniform4iv(t,We(n,4))}),Object(S.a)(Fe,35674,function(e,t,n){return e.uniformMatrix2fv(t,!1,Ve(n,4))}),Object(S.a)(Fe,35675,function(e,t,n){return e.uniformMatrix3fv(t,!1,Ve(n,9))}),Object(S.a)(Fe,35676,function(e,t,n){return e.uniformMatrix4fv(t,!1,Ve(n,16))}),Object(S.a)(Fe,35678,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,35680,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,5125,function(e,t,n){return e.uniform1uiv(t,He(n,1))}),Object(S.a)(Fe,36294,function(e,t,n){return e.uniform2uiv(t,He(n,2))}),Object(S.a)(Fe,36295,function(e,t,n){return e.uniform3uiv(t,He(n,3))}),Object(S.a)(Fe,36296,function(e,t,n){return e.uniform4uiv(t,He(n,4))}),Object(S.a)(Fe,35685,function(e,t,n){return e.uniformMatrix2x3fv(t,!1,Ve(n,6))}),Object(S.a)(Fe,35686,function(e,t,n){return e.uniformMatrix2x4fv(t,!1,Ve(n,8))}),Object(S.a)(Fe,35687,function(e,t,n){return e.uniformMatrix3x2fv(t,!1,Ve(n,6))}),Object(S.a)(Fe,35688,function(e,t,n){return e.uniformMatrix3x4fv(t,!1,Ve(n,12))}),Object(S.a)(Fe,35689,function(e,t,n){return e.uniformMatrix4x2fv(t,!1,Ve(n,8))}),Object(S.a)(Fe,35690,function(e,t,n){return e.uniformMatrix4x3fv(t,!1,Ve(n,12))}),Object(S.a)(Fe,35679,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,35682,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36289,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36292,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36293,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36298,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36299,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36300,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36303,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36306,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36307,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36308,function(e,t,n){return e.uniform1i(t,n)}),Object(S.a)(Fe,36311,function(e,t,n){return e.uniform1i(t,n)}),Fe),De={},Be={},Ue={},ze=[0];function Ge(e,t,n,i){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(ze[0]=e,e=ze);var r=e.length;if(r%t&&h.g.warn("Uniform size should be multiples of ".concat(t),e)(),e instanceof n)return e;var a=i[r];a||(a=new n(r),i[r]=a);for(var o=0;o<r;o++)a[o]=e[o];return a}function Ve(e,t){return Ge(e,t,Float32Array,De)}function We(e,t){return Ge(e,t,Int32Array,Be)}function He(e,t){return Ge(e,t,Uint32Array,Ue)}function Xe(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(/([^\[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function Ye(e,t,n){var i=Ne[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i.bind(null,e,t)}function qe(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;for(var t=Math.min(e.length,16),n=0;n<t;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof ve.a||e instanceof ke||(e instanceof xe||e instanceof Ie&&Boolean(e.texture))))}function Ze(e,t){if(Array.isArray(e)||ArrayBuffer.isView(e)){if(!t)return!1;var n=e.length;if(t.length!==n)return!1;for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return e===t}function Ke(e){return Array.isArray(e)||ArrayBuffer.isView(e)?e.slice():e}var $e,Qe=n(36),Je=5120,et=5121,tt=5122,nt=5123,it=0,rt=1,at=2,ot=3,st=4,ct=5,ut=6,lt=5126,ht=($e={},Object(S.a)($e,lt,[lt,1,"float"]),Object(S.a)($e,35664,[lt,2,"vec2"]),Object(S.a)($e,35665,[lt,3,"vec3"]),Object(S.a)($e,35666,[lt,4,"vec4"]),Object(S.a)($e,5124,[5124,1,"int"]),Object(S.a)($e,35667,[5124,2,"ivec2"]),Object(S.a)($e,35668,[5124,3,"ivec3"]),Object(S.a)($e,35669,[5124,4,"ivec4"]),Object(S.a)($e,5125,[5125,1,"uint"]),Object(S.a)($e,36294,[5125,2,"uvec2"]),Object(S.a)($e,36295,[5125,3,"uvec3"]),Object(S.a)($e,36296,[5125,4,"uvec4"]),Object(S.a)($e,35670,[lt,1,"bool"]),Object(S.a)($e,35671,[lt,2,"bvec2"]),Object(S.a)($e,35672,[lt,3,"bvec3"]),Object(S.a)($e,35673,[lt,4,"bvec4"]),Object(S.a)($e,35674,[lt,8,"mat2"]),Object(S.a)($e,35685,[lt,8,"mat2x3"]),Object(S.a)($e,35686,[lt,8,"mat2x4"]),Object(S.a)($e,35675,[lt,12,"mat3"]),Object(S.a)($e,35687,[lt,12,"mat3x2"]),Object(S.a)($e,35688,[lt,12,"mat3x4"]),Object(S.a)($e,35676,[lt,16,"mat4"]),Object(S.a)($e,35689,[lt,16,"mat4x2"]),Object(S.a)($e,35690,[lt,16,"mat4x3"]),$e);function dt(e){switch(e){case it:return it;case rt:case ot:case at:return rt;case st:case ct:case ut:return st;default:return Object(k.a)(!1),0}}function ft(e){var t=ht[e];if(!t)return null;var n=Object(me.a)(t,2);return{type:n[0],components:n[1]}}function gt(e,t){switch(e){case Je:case et:case tt:case nt:e=lt}for(var n in ht){var i=Object(me.a)(ht[n],3),r=i[0],a=i[1],o=i[2];if(r===e&&a===t)return{glType:n,name:o}}return null}var pt=function(){function e(t){Object(m.a)(this,e),this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}return Object(L.a)(e,[{key:"getAttributeInfo",value:function(e){var t=Number(e);return Number.isFinite(t)?this.attributeInfos[t]:this.attributeInfosByName[e]||null}},{key:"getAttributeLocation",value:function(e){var t=this.getAttributeInfo(e);return t?t.location:-1}},{key:"getAttributeAccessor",value:function(e){var t=this.getAttributeInfo(e);return t?t.accessor:null}},{key:"getVaryingInfo",value:function(e){var t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}},{key:"getVaryingIndex",value:function(e){var t=this.getVaryingInfo();return t?t.location:-1}},{key:"getVaryingAccessor",value:function(e){var t=this.getVaryingInfo();return t?t.accessor:null}},{key:"_readAttributesFromProgram",value:function(e){for(var t=e.gl,n=t.getProgramParameter(e.handle,35721),i=0;i<n;i++){var r=t.getActiveAttrib(e.handle,i),a=r.name,o=r.type,s=r.size,c=t.getAttribLocation(e.handle,a);c>=0&&this._addAttribute(c,a,o,s)}this.attributeInfos.sort(function(e,t){return e.location-t.location})}},{key:"_readVaryingsFromProgram",value:function(e){var t=e.gl;if(Object(o.n)(t)){for(var n=t.getProgramParameter(e.handle,35971),i=0;i<n;i++){var r=t.getTransformFeedbackVarying(e.handle,i),a=r.name,s=r.type,c=r.size;this._addVarying(i,a,s,c)}this.varyingInfos.sort(function(e,t){return e.location-t.location})}}},{key:"_addAttribute",value:function(e,t,n,i){var r=ft(n),a={type:r.type,size:i*r.components};this._inferProperties(e,t,a);var o={location:e,name:t,accessor:new Qe.a(a)};this.attributeInfos.push(o),this.attributeInfosByName[o.name]=o}},{key:"_inferProperties",value:function(e,t,n){/instance/i.test(t)&&(n.divisor=1)}},{key:"_addVarying",value:function(e,t,n,i){var r=ft(n),a=r.type,o=r.components,s={location:e,name:t,accessor:new Qe.a({type:a,size:i*o})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}]),e}(),vt=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),(n=Object(ie.a)(this,Object(re.a)(t).call(this,e,i))).stubRemovedMethods("Program","v6.0",["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"]),n._isCached=!1,n.initialize(i),Object.seal(Object(pe.a)(Object(pe.a)(n))),n._setId(i.id),n}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.vs,n=e.fs,i=e.varyings,r=e.bufferMode,a=void 0===r?35981:r;return this.vs="string"==typeof t?new he(this.gl,{id:"".concat(e.id,"-vs"),source:t}):t,this.fs="string"==typeof n?new de(this.gl,{id:"".concat(e.id,"-fs"),source:n}):n,Object(k.a)(this.vs instanceof he),Object(k.a)(this.fs instanceof de),this.uniforms={},this.samplers={},i&&(Object(o.d)(this.gl),this.varyings=i,this.gl.transformFeedbackVaryings(this.handle,i,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new pt(this),this.setProps(e)}},{key:"delete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:fe(Object(re.a)(t.prototype),"delete",this).call(this,e)}},{key:"setProps",value:function(e){return"uniforms"in e&&this.setUniforms(e.uniforms,e.samplers),this}},{key:"draw",value:function(e){var t=this,n=e.logPriority,i=e.drawMode,r=void 0===i?4:i,s=e.vertexCount,c=e.offset,u=void 0===c?0:c,l=e.start,d=e.end,f=e.isIndexed,g=void 0!==f&&f,p=e.indexType,v=void 0===p?5123:p,m=e.isInstanced,_=void 0!==m&&m,b=e.instanceCount,y=void 0===b?0:b,x=e.vertexArray,E=void 0===x?null:x,w=e.transformFeedback,O=e.framebuffer,S=e.parameters,P=void 0===S?{}:S,A=e.uniforms,T=void 0===A?{}:A,C=e.samplers,j=void 0===C?{}:C;if(void 0!==n){var M=O?O.id:"default",R="mode=".concat(Object(a.a)(this.gl,r)," verts=").concat(s," ")+"instances=".concat(y," indexType=").concat(Object(a.a)(this.gl,v)," ")+"isInstanced=".concat(_," isIndexed=").concat(g," ")+"Framebuffer=".concat(M);h.g.log(n,R)()}return this.gl.useProgram(this.handle),Object(k.a)(E),E.bindForDraw(s,y,function(){if(T&&(h.g.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)"),t.setUniforms(T,j)),t._bindTextures(),void 0!==O&&(P=Object.assign({},P,{framebuffer:O})),w){var e=dt(r);w.begin(e)}Object(Y.g)(t.gl,P,function(){g&&_?t.gl.drawElementsInstanced(r,s,v,u,y):g&&Object(o.n)(t.gl)&&!isNaN(l)&&!isNaN(d)?t.gl.drawRangeElements(r,l,d,s,v,u):g?t.gl.drawElements(r,s,v,u):_?t.gl.drawArraysInstanced(r,u,s,y):t.gl.drawArrays(r,u,s)}),w&&w.end()}),this}},{key:"setSamplers",value:function(e){Object.assign(this.samplers,e)}},{key:"setUniforms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=!1,r={};for(var a in e)Ze(this.uniforms[a],e[a])||(i=!0,r[a]=e[a],this.uniforms[a]=Ke(e[a]));return i&&(n(),function(e,t,n){for(var i in e){var r=e[i];if((!n||Boolean(n[i]))&&!qe(r))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(i),r),new Error("".concat(t," Bad uniform ").concat(i))}}(r,this.id,this._uniformSetters),Object.assign(this.samplers,t),this._setUniforms(r)),this}},{key:"_bindTextures",value:function(){for(var e in this.uniforms){var t=this._uniformSetters[e];if(t&&void 0!==t.textureIndex){var n=this.uniforms[e],i=this.samplers[e];n instanceof Ie&&(n=n.texture),n instanceof ve.a&&n.bind(t.textureIndex),i&&i.bind(t.textureIndex)}}}},{key:"_setUniforms",value:function(e){for(var t in this.gl.useProgram(this.handle),e){var n=e[t],i=this._uniformSetters[t];if(i)if(n instanceof Ie&&(n=n.texture),n instanceof ve.a){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);var r=n,a=i.textureIndex;r.bind(a),i(a)}else i(n)}return this}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(e){var t=this.gl.getAttachedShaders(e),n={},i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var c=o.value;switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new he({handle:c});break;case 35632:n.fs=new de({handle:c})}}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}},{key:"_getParameter",value:function(e){return this.gl.getProgramParameter(this.handle,e)}},{key:"_setId",value:function(e){if(!e){var t=this._getName();this.id=Object(h.i)(t)}}},{key:"_getName",value:function(){var e=this.vs.getName()||this.fs.getName();return e=(e=e.replace(/shader/i,""))?"".concat(e,"-program"):"program"}},{key:"_compileAndLink",value:function(){var e=this.gl;if((e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),h.g.time(4,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),h.g.timeEnd(4,"linkProgram for ".concat(this._getName()))(),e.debug||h.g.priority>0)&&(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35714)))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)))}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var e=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var t=0;t<this._uniformCount;t++){var n=this.gl.getActiveUniform(this.handle,t),i=Xe(n.name),r=i.name,a=(i.isArray,e.getUniformLocation(this.handle,r));this._uniformSetters[r]=Ye(e,a,n)}this._textureIndexCounter=0}},{key:"reset",value:function(){}},{key:"getActiveUniforms",value:function(e,t){return this.gl.getActiveUniforms(this.handle,e,t)}},{key:"getUniformBlockIndex",value:function(e){return this.gl.getUniformBlockIndex(this.handle,e)}},{key:"getActiveUniformBlockParameter",value:function(e,t){return this.gl.getActiveUniformBlockParameter(this.handle,e,t)}},{key:"uniformBlockBinding",value:function(e,t){this.gl.uniformBlockBinding(this.handle,e,t)}}]),t}(oe.a),mt=n(50),_t=function(e){function t(e,n){var i;return Object(m.a)(this,t),Object(o.d)(e),(i=Object(ie.a)(this,Object(re.a)(t).call(this,e,n))).promise=null,Object.seal(Object(pe.a)(Object(pe.a)(i))),i}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"wait",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.flags,n=void 0===t?0:t,i=e.timeout,r=void 0===i?-1:i;return this.gl.waitSync(this.handle,n,r),this}},{key:"clientWait",value:function(e){var t=e.flags,n=void 0===t?1:t,i=e.timeout,r=this.gl.clientWaitSync(this.handle,n,i);return r}},{key:"cancel",value:function(){F.cancelQuery(this)}},{key:"isSignaled",value:function(){return 37145===this.getParameter(37140)}},{key:"isResultAvailable",value:function(){return this.isSignaled()}},{key:"getResult",value:function(){return this.isSignaled()}},{key:"getParameter",value:function(e){return this.gl.getSyncParameter(this.handle,e)}},{key:"_createHandle",value:function(){return this.gl.fenceSync(37143,0)}},{key:"_deleteHandle",value:function(){F.deleteQuery(this),this.gl.deleteSync(this.handle)}}]),t}(oe.a),bt=function(e){return e},yt=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,t),n=Object(ie.a)(this,Object(re.a)(t).call(this,e,i));var r=i.onComplete,a=void 0===r?bt:r,o=i.onError,s=void 0===o?bt:o;return n.target=null,n.onComplete=a,n.onError=s,n.promise=null,Object.seal(Object(pe.a)(Object(pe.a)(n))),n}return Object(ae.a)(t,e),Object(L.a)(t,null,[{key:"isSupported",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object(o.n)(e),i=ee(e,Z.TIMER_QUERY),r=n||i,a=!0,s=!1,c=void 0;try{for(var u,l=t[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){switch(u.value){case"queries":r=r&&n;break;case"timers":r=r&&i;break;case"timestamps":var h=i?e.getQuery(36392,34916):0;r=r&&h>0;break;default:Object(k.a)(!1)}}}catch(e){s=!0,c=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}return r}}]),Object(L.a)(t,[{key:"beginTimeElapsedQuery",value:function(){return this.begin(35007)}},{key:"beginOcclusionQuery",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).conservative,t=void 0!==e&&e;return this.begin(t?36202:35887)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(35976)}},{key:"getTimestamp",value:function(){F.beginQuery(this,this.onComplete,this.onError);try{this.gl.queryCounter(this.handle,36392)}catch(e){F.rejectQuery(this,'Timer queries require "EXT_disjoint_timer_query" extension')}return this}},{key:"begin",value:function(e){F.beginQuery(this,this.onComplete,this.onError),this.target=e;try{this.gl.beginQuery(this.target,this.handle)}catch(e){F.rejectQuery(this,"Query not supported")}return this}},{key:"end",value:function(){return this.target&&(this.gl.endQuery(this.target),this.target=null),this}},{key:"cancel",value:function(){return this.end(),F.cancelQuery(this),this}},{key:"isResultAvailable",value:function(){return this.gl.getQueryParameter(this.handle,34919)}},{key:"getResult",value:function(){var e=this.gl.getQueryParameter(this.handle,34918);return Number.isFinite(e)?e/1e6:0}},{key:"_createHandle",value:function(){return t.isSupported(this.gl)?this.gl.createQuery():null}},{key:"_deleteHandle",value:function(){F.deleteQuery(this),this.gl.deleteQuery(this.handle)}}],[{key:"poll",value:function(e){F.poll(e)}}]),t}(oe.a);F.setInvalidator({queryType:yt,errorMessage:"Disjoint GPU operation invalidated timer queries",checkInvalid:function(e){return e.getParameter(36795)}});var xt=n(56),Et=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};throw Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,n)),new Error("Texture2DArray not yet implemented")}return Object(ae.a)(t,e),Object(L.a)(t,null,[{key:"isSupported",value:function(e){return Object(o.n)(e)}}]),t}(ve.a),wt=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(o.d)(e),(n=Object(ie.a)(this,Object(re.a)(t).call(this,e,i))).initialize(i),n.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(Object(pe.a)(Object(pe.a)(n))),n}return Object(ae.a)(t,e),Object(L.a)(t,null,[{key:"isSupported",value:function(e){return Object(o.n)(e)}}]),Object(L.a)(t,[{key:"initialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Object(h.d)(this.buffers)||this.bind(function(){return e._unbindBuffers()}),this.setProps(t),this}},{key:"setProps",value:function(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}},{key:"setBuffers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind(function(){for(var n in t)e.setBuffer(n,t[n])}),this}},{key:"setBuffer",value:function(e,t){var n=this,i=this._getVaryingIndex(e),r=this._getBufferParams(t),a=r.buffer,o=r.sizeInBytes,s=r.offsetInBytes;return i<0?(this.unused[e]=a,h.g.warn(function(){return"".concat(n.id," unused varying buffer ").concat(e)})(),this):(this.buffers[i]=t,this.bindOnUse||this._bindBuffer(i,a,s,o),this)}},{key:"begin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(e){var t,n,i;return e instanceof ne.a==!1?(i=e.buffer,n=e.sizeInBytes,t=e.offsetInBytes):i=e,void 0===t&&void 0===n||(t=t||0,n=n||i.byteLength-t),{buffer:i,offsetInBytes:t,sizeInBytes:n}}},{key:"_getVaryingInfo",value:function(e){return this.configuration&&this.configuration.getVaryingInfo(e)}},{key:"_getVaryingIndex",value:function(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;var t=Number(e);return Number.isFinite(t)?t:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var e in this.buffers){var t=this._getBufferParams(this.buffers[e]),n=t.buffer,i=t.sizeInBytes,r=t.offsetInBytes;this._bindBuffer(e,n,r,i)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var e in this.buffers)this._bindBuffer(e,null)}},{key:"_bindBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,r=t&&t.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(e){this.gl.bindTransformFeedback(36386,this.handle)}}]),t}(oe.a),Ot=null;function St(e,t){return new e(function(e){return(!Ot||Ot.byteLength<e)&&(Ot=new ArrayBuffer(e)),Ot}(e.BYTES_PER_ELEMENT*t),0,t)}var Pt=n(30),At=n(57),Tt=n(58);var Ct=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,t);var r=i.id||i.program&&i.program.id;return(n=Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},i,{id:r})))).hasVertexArrays=t.isSupported(e),n.buffer=null,n.bufferValue=null,n.initialize(i),Object.seal(Object(pe.a)(Object(pe.a)(n))),n}return Object(ae.a)(t,e),Object(L.a)(t,null,[{key:"isSupported",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero?Object(o.n)(e)||"Chrome"===function(e){if(!e&&!Object(At.a)())return"Node";if(Object(Tt.a)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},n=e||t.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";var i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r?"IE":Pt.b.chrome?"Chrome":Pt.b.safari?"Safari":Pt.b.mozInnerScreenX?"Firefox":"Unknown"}():Object(o.n)(e)||e.getExtension("OES_vertex_array_object")}},{key:"getDefaultArray",value:function(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new t(e,{handle:null})),e.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(e){return t.MAX_ATTRIBUTES=t.MAX_ATTRIBUTES||e.getParameter(34921),t.MAX_ATTRIBUTES}},{key:"setConstant",value:function(e,n,i){switch(i.constructor){case Float32Array:t._setConstantFloatArray(e,n,i);break;case Int32Array:t._setConstantIntArray(e,n,i);break;case Uint32Array:t._setConstantUintArray(e,n,i);break;default:Object(h.a)(!1)}}}]),Object(L.a)(t,[{key:"delete",value:function(){fe(Object(re.a)(t.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(e)}},{key:"setProps",value:function(e){return this}},{key:"setElementBuffer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(h.a)(!t||34963===t.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind(function(){e.gl.bindBuffer(34963,t?t.handle:null)}),this}},{key:"setBuffer",value:function(e,t,n){if(34963===t.target)return this.setElementBuffer(t,n);var i=n.size,r=n.type,a=n.stride,s=n.offset,c=n.normalized,u=n.integer,l=n.divisor,d=this.gl;return e=Number(e),this.bind(function(){d.bindBuffer(34962,t.handle),u?(Object(h.a)(Object(o.n)(d)),d.vertexAttribIPointer(e,i,r,a,s)):d.vertexAttribPointer(e,i,r,c,a,s),d.enableVertexAttribArray(e),d.vertexAttribDivisor(e,l||0)}),this}},{key:"enable",value:function(e){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!i&&0===e&&!t.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(function(){return i?n.gl.enableVertexAttribArray(e):n.gl.disableVertexAttribArray(e)})),this}},{key:"getConstantBuffer",value:function(e,t,n){var i=this._normalizeConstantArrayValue(t,n),r=i.byteLength*e,a=i.length*e,o=!this.buffer;if(this.buffer=this.buffer||new ne.a(this.gl,r),o=(o=o||this.buffer.setByteLength(r))||!this._compareConstantArrayValues(i,this.bufferValue)){var s=St(t.constructor,a);!function(e){for(var t=e.target,n=e.source,i=e.start,r=void 0===i?0:i,a=e.count,o=void 0===a?1:a,s=n.length,c=o*s,u=0,l=r;u<s;u++)t[l++]=n[u];for(;u<c;)u<c-u?(t.copyWithin(r+u,r,r+u),u*=2):(t.copyWithin(r+u,r,r+c-u),u=c)}({target:s,source:i,start:0,count:a}),this.buffer.subData(s),this.bufferValue=t}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(e,t){return Array.isArray(e)?new Float32Array(e):e}},{key:"_compareConstantArrayValues",value:function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}},{key:"_createHandle",value:function(){return this.hasVertexArrays=t.isSupported(this.gl),this.hasVertexArrays?this.gl.createVertexArray():null}},{key:"_deleteHandle",value:function(e){return this.hasVertexArrays&&this.gl.deleteVertexArray(e),[this.elements]}},{key:"_bindHandle",value:function(e){this.hasVertexArrays&&this.gl.bindVertexArray(e)}},{key:"_getParameter",value:function(e,t){var n=this,i=t.location;return Object(h.a)(Number.isFinite(i)),this.bind(function(){switch(e){case 34373:return n.gl.getVertexAttribOffset(i,e);default:return n.gl.getVertexAttrib(i,e)}})}},{key:"MAX_ATTRIBUTES",get:function(){return t.getMaxAttributes(this.gl)}}],[{key:"_setConstantFloatArray",value:function(e,t,n){switch(n.length){case 1:e.vertexAttrib1fv(t,n);break;case 2:e.vertexAttrib2fv(t,n);break;case 3:e.vertexAttrib3fv(t,n);break;case 4:e.vertexAttrib4fv(t,n);break;default:Object(h.a)(!1)}}},{key:"_setConstantIntArray",value:function(e,t,n){switch(Object(h.a)(Object(o.n)(e)),n.length){case 1:e.vertexAttribI1iv(t,n);break;case 2:e.vertexAttribI2iv(t,n);break;case 3:e.vertexAttribI3iv(t,n);break;case 4:e.vertexAttribI4iv(t,n);break;default:Object(h.a)(!1)}}},{key:"_setConstantUintArray",value:function(e,t,n){switch(Object(h.a)(Object(o.n)(e)),n.length){case 1:e.vertexAttribI1uiv(t,n);break;case 2:e.vertexAttribI2uiv(t,n);break;case 3:e.vertexAttribI3uiv(t,n);break;case 4:e.vertexAttribI4uiv(t,n);break;default:Object(h.a)(!1)}}}]),t}(oe.a),jt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,e);var i=n.id||n.program&&n.program.id;this.id=i,this.gl=t,this.configuration=null,this.elements=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.vertexArrayObject=Ct.isSupported(t)?new Ct(t):Ct.getDefaultArray(t),Object(h.h)(this,"VertexArray","v6.0",["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"]),this.initialize(n),Object.seal(this)}return Object(L.a)(e,[{key:"delete",value:function(){this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}},{key:"reset",value:function(){this.elements=null;var e=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(e){return this.drawParams=this.drawParams||this._updateDrawParams(),Object.assign({},this.drawParams,e)}},{key:"setAttributes",value:function(e){var t=this;return this.vertexArrayObject.bind(function(){for(var n in e){var i=e[n];if(i instanceof ne.a)t.setBuffer(n,i);else if(Array.isArray(i)&&i.length&&i[0]instanceof ne.a){var r=i[0],a=i[1];t.setBuffer(n,r,a)}else{if(!ArrayBuffer.isView(i)&&!Array.isArray(i))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");t.setConstant(n,i)}}t.gl.bindBuffer(34962,null)}),this}},{key:"setElementBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=e,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(e,t),this}},{key:"setBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===t.target)return this.setElementBuffer(t);var i=this._resolveLocationAndAccessor(e,t,t.accessor,n),r=i.location,a=i.accessor;return r>=0&&(this.values[r]=t,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setBuffer(r,t,a)),this}},{key:"setConstant",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this._resolveLocationAndAccessor(e,t,n),r=i.location,a=i.accessor;return r>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t,a),this.values[r]=t,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.enable(r,!1)),this}},{key:"unbindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.setElementBuffer(null),e.buffer=e.buffer||new ne.a(e.gl,{size:4});for(var t=0;t<e.vertexArrayObject.MAX_ATTRIBUTES;t++)e.values[t]instanceof ne.a&&(e.gl.disableVertexAttribArray(t),e.gl.bindBuffer(34962,e.buffer.handle),e.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}},{key:"bindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.setElementBuffer(e.elements);for(var t=0;t<e.vertexArrayObject.MAX_ATTRIBUTES;t++){var n=e.values[t];n instanceof ne.a&&e.setBuffer(t,n)}}),this}},{key:"bindForDraw",value:function(e,t,n){var i,r=this;return this.vertexArrayObject.bind(function(){r._setConstantAttributes(e,t),r.vertexArrayObject.hasVertexArrays||r.bindBuffers(),i=n(),r.vertexArrayObject.hasVertexArrays||r.unbindBuffers()}),i}},{key:"_resolveLocationAndAccessor",value:function(e,t,n,i){var r=this,a=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,h.g.once(3,function(){return"unused value ".concat(e," in ").concat(r.id)})(),this;var o=this._getAttributeInfo(e),s=Qe.a.resolve(o.accessor,n,i),c=s.size,u=s.type;return Object(h.a)(Number.isFinite(c)&&Number.isFinite(u)),{location:a,accessor:s}}},{key:"_getAttributeInfo",value:function(e){return this.configuration&&this.configuration.getAttributeInfo(e)}},{key:"_getAttributeIndex",value:function(e){if(this.configuration)return this.configuration.getAttributeLocation(e);var t=Number(e);return Number.isFinite(t)?t:-1}},{key:"_setConstantAttributes",value:function(e,t){var n=Math.max(0|e,0|t),i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(var r=1;r<this.vertexArrayObject.MAX_ATTRIBUTES;r++)i=this.values[r],ArrayBuffer.isView(i)&&this._setConstantAttribute(r,i)}},{key:"_setConstantAttributeZero",value:function(e,t){if(Ct.isSupported(this.gl,{constantAttributeZero:!0}))this._setConstantAttribute(0,e);else{var n=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}}},{key:"_setConstantAttribute",value:function(e,t){Ct.setConstant(this.gl,e,t),this.vertexArrayObject.isDefault&&this.vertexArrayObject.enable(e,!1)}},{key:"_updateDrawParams",value:function(){for(var e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elements.accessor.type),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}},{key:"_updateDrawParamsForLocation",value:function(e,t){var n=this.values[t],i=this.accessors[t];if(n){var r=i.divisor>0;if(e.isInstanced=e.isInstanced||r,n instanceof ne.a){var a=n;if(r){var o=a.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,o)}else{var s=a.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,s)}}}}},{key:"setElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h.g.deprecated("setElements","setElementBuffer"),this.setElementBuffer(e,t)}}]),e}(),Mt=5126,Rt=5124,Lt=5125,It=function(){function e(t){var n;for(var i in Object(m.a)(this,e),this.layout={},this.size=0,t)this._addUniform(i,t[i]);var r=new Float32Array(this.size);this.typedArray=(n={},Object(S.a)(n,Mt,r),Object(S.a)(n,Rt,new Int32Array(r.buffer)),Object(S.a)(n,Lt,new Uint32Array(r.buffer)),n)}return Object(L.a)(e,[{key:"getBytes",value:function(){return 4*this.size}},{key:"getData",value:function(){return this.typedArray[Mt]}},{key:"getSubData",value:function(e){var t,n;if(void 0===e)t=this.data,n=0;else{var i=this.offsets[e],r=i+this.sizes[e];t=this.data.subarray(i,r),n=4*i}return{data:t,offset:n}}},{key:"setUniforms",value:function(e){for(var t in e)this._setValue(t,e[t]);return this}},{key:"_setValue",value:function(e,t){var n=this.layout[e];Object(k.a)(n,"UniformLayoutStd140 illegal argument");var i=this.typedArray[n.type];1===n.size?i[n.offset]=t:i.set(t,n.offset)}},{key:"_addUniform",value:function(e,t){var n=ft(t);Object(k.a)(n,"UniformBufferLayout illegal argument");var i=n.type,r=n.components;this.size=this._alignTo(this.size,r);var a=this.size;this.size+=r,this.layout[e]={type:i,size:r,offset:a}}},{key:"_alignTo",value:function(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}}]),e}(),Ft=n(62),kt=n(91),Nt=function(){function e(t){var n=t.id;t.display;Object(m.a)(this,e),this.id=n||Object(h.i)(this.constructor.name),this.display=!0,this.position=new Ft.a,this.rotation=new Ft.a,this.scale=new Ft.a(1,1,1),this.matrix=new kt.a,this.userData={}}return Object(L.a)(e,[{key:"toString",value:function(){return"{id: ".concat(this.id,", children: ").concat(this.children,")}")}},{key:"setPosition",value:function(e){return Object(k.a)(3===e.length,"setPosition requires vector argument"),this.position=e,this}},{key:"setRotation",value:function(e){return Object(k.a)(3===e.length,"setRotation requires vector argument"),this.rotation=e,this}},{key:"setScale",value:function(e){return Object(k.a)(3===e.length,"setScale requires vector argument"),this.scale=e,this}},{key:"setMatrixComponents",value:function(e){var t=e.position,n=e.rotation,i=e.scale,r=e.update,a=void 0===r||r;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),a&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.position,n=e.rotation,i=e.scale;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(e,t){Object(k.a)(e),t=t||this.matrix;var n=new kt.a(e).multiplyRight(t),i=n.invert();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:i.transpose()}}},{key:"transform",value:function(){if(this.parent){var e=this.parent;this.endPosition.set(this.position.add(e.endPosition)),this.endRotation.set(this.rotation.add(e.endRotation)),this.endScale.set(this.scale.add(e.endScale))}else this.endPosition.set(this.position),this.endRotation.set(this.rotation),this.endScale.set(this.scale);for(var t=this.children,n=0;n<t.length;++n)t[n].transform();return this}}]),e}(),Dt=n(17),Bt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);var i=(n=Array.isArray(n)?{children:n}:n).children,r=void 0===i?[]:i;return r.every(function(e){return Object(k.a)(e instanceof Nt)}),(e=Object(ie.a)(this,Object(re.a)(t).call(this,n))).children=r,e}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<t.length;i++){var r=t[i];Array.isArray(r)?this.add.apply(this,Object(Dt.a)(r)):this.children.push(r)}return this}},{key:"remove",value:function(e){var t=this.children,n=t.indexOf(e);return n>-1&&t.splice(n,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"traverse",value:function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).modelMatrix,i=void 0===n?new kt.a:n,r=!0,a=!1,o=void 0;try{for(var s,c=this.children[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value,l=u.matrix;i=i.multiplyRight(l);var h=void 0;if(h=u instanceof t?u.traverse(e,{modelMatrix:i}):e(u,{}))return h}}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return null}},{key:"traverseReverse",value:function(e){for(var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).modelMatrix,i=void 0===n?new kt.a:n,r=this.children.length-1;r>=0;--r){var a=this.children[r],o=a.matrix;i=i.multiplyRight(o);var s=void 0;if(s=a instanceof t?a.traverseReverse(e,{modelMatrix:i}):e(a,{}))return s}return null}}]),t}(Nt),Ut=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,e);var i=n.id,r=void 0===i?Object(h.i)("attribute"):i,a=n.type,o=n.isIndexed,s=void 0!==o&&o;this.gl=t,this.id=r,this.isIndexed=s,this.target=s?34963:34962,this.type=a,s&&!a&&(this.type=t&&J(t,Z.ELEMENT_INDEX_UINT32)?5125:5123),this.value=null,this.externalBuffer=null,this.buffer=null,this.userData={},this.update(n),Object.seal(this),this._validateAttributeDefinition()}return Object(L.a)(e,[{key:"delete",value:function(){this.buffer&&(this.buffer.delete(),this.buffer=null)}},{key:"update",value:function(e){var t=e.value,n=e.buffer,i=e.constant,r=void 0===i?this.constant||!1:i;this.constant=r,n?(this.externalBuffer=n,this.constant=!1,this.type=n.accessor.type,void 0!==n.accessor.divisor&&(this.divisor=n.accessor.divisor)):t&&(this.externalBuffer=null,this.value=t,!r&&this.gl&&(this.buffer=this.buffer||new ne.a(this.gl,Object.assign({},e,{id:this.id,target:this.target,type:this.type})),this.buffer.setData({data:t}),this.type=this.buffer.accessor.type)),this._setAccessor(e)}},{key:"getBuffer",value:function(){return this.constant?null:this.externalBuffer||this.buffer}},{key:"getValue",value:function(){if(this.constant)return this.value;var e=this.externalBuffer||this.buffer;return e?[e,this]:null}},{key:"_setAccessor",value:function(e){var t=e.size,n=void 0===t?this.size:t,i=e.offset,r=void 0===i?this.offset||0:i,a=e.stride,o=void 0===a?this.stride||0:a,s=e.normalized,c=void 0===s?this.normalized||!1:s,u=e.integer,l=void 0===u?this.integer||!1:u,d=e.divisor,f=void 0===d?this.divisor||0:d,g=e.instanced,p=e.isInstanced;this.size=n,this.offset=r,this.stride=o,this.normalized=c,this.integer=l,this.divisor=f,void 0!==p&&(h.g.deprecated("Attribute.isInstanced"),this.divisor=p?1:0),void 0!==g&&(h.g.deprecated("Attribute.instanced"),this.divisor=g?1:0)}},{key:"_validateAttributeDefinition",value:function(){}}]),e}(),zt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};function Gt(e){var t="string"==typeof e?zt[e]||zt.TRIANGLES:e;return Object(k.a)(t>=0&&t<=zt.TRIANGLE_FAN,"Illegal drawMode"),t}var Vt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,e);var n=t.id,i=t.drawMode,r=void 0===i?zt.TRIANGLES:i,a=t.vertexCount,o=void 0===a?void 0:a,s=t.attributes;this.id=n||Object(h.i)(this.constructor.name),this.drawMode=Gt(r),this.vertexCount=o,this.attributes={},this.needsRedraw=!0,this.userData={},Object.seal(this),s&&this.setAttributes(s)}return Object(L.a)(e,[{key:"setNeedsRedraw",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=e,this}},{key:"getNeedsRedraw",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearRedrawFlags,t=void 0!==e&&e,n=!1;return n=n||this.needsRedraw,this.needsRedraw=this.needsRedraw&&!t,n}},{key:"setVertexCount",value:function(e){this.vertexCount=e}},{key:"getVertexCount",value:function(){return void 0!==this.vertexCount?this.vertexCount:this.attributes.indices?this.attributes.indices.value.length:this.attributes.vertices?this.attributes.vertices.value.length/3:!!this.attributes.positions&&this.attributes.positions.value.length/3}},{key:"hasAttribute",value:function(e){return Boolean(this.attributes[e])}},{key:"getAttribute",value:function(e){var t=this.attributes[e];return Object(k.a)(t),t.value}},{key:"getArray",value:function(e){var t=this.attributes[e];return Object(k.a)(t),t.value}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setAttributes",value:function(e){for(var t in e){var n=e[t];n=ArrayBuffer.isView(n)?{value:n}:n,Object(k.a)(ArrayBuffer.isView(n.value),"".concat(this._print(t),": must be typed array or object with value as typed array")),this._autoDetectAttribute(t,n),this.attributes[t]=n}return this.setNeedsRedraw(),this}},{key:"_autoDetectAttribute",value:function(e,t){var n;switch(e){case"indices":n=n||"indices";break;case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break;case"indices":t.size=t.size||1,t.isIndexed=void 0===t.isIndexed||t.isIndexed,Object(k.a)(t.value instanceof Uint16Array||t.value instanceof Uint32Array,'attribute array for "indices" must be of integer type')}Object(k.a)(t.size,"attribute ".concat(e," needs size"))}},{key:"_print",value:function(e){return"Geometry ".concat(this.id," attribute ").concat(e)}}]),e}(),Wt="#define SHADER_NAME luma_modular_vertex\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec2 texCoords;\nattribute vec3 pickingColors;\n\nvoid main(void) {\n\n  // Set up position\n#ifdef MODULE_GEOMETRY\n  geometry_setPosition(positions);\n  geometry_setNormal(normals);\n#endif\n\n#ifdef MODULE_PROJECT\n  project_setPositionAndNormal_Model(positions, normals);\n  gl_Position = project_model_to_clipspace(positions);\n#endif\n\n  // Set up depth\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n\n#ifdef MODULE_DIFFUSE\n  diffuse_setTextureCoordinate(texCoords);\n#endif\n\n  // Set up color calculations\n#ifdef MODULE_MATERIAL\n  material_setDiffuseColor(colors);\n  material_setDiffuseTextureCoordinates(texCoords);\n#endif\n\n#ifdef MODULE_LIGHTING\n  lighting_setPositionAndNormal(positions, normals);\n  lighting_apply_light(positions);\n  lighting_apply_reflection(positions);\n#endif\n\n#ifdef MODULE_PICKING\n  picking_setPickingColor(pickingColors);\n#endif\n\n}\n",Ht="#define SHADER_NAME luma-modular-fragment\n\nprecision highp float;\n\n// varyings\nvarying vec4 vColor;\n\nvoid main(){\n  gl_FragColor = vec4(1., 0., 1., 1.);\n\n#ifdef MODULE_DIFFUSE\n  gl_FragColor = diffuse_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth(gl_Position);\n#endif\n}\n",Xt="vs",Yt="fs";function qt(e,t,n){switch(t){case 300:return n?function(e){return e.replace(/attribute\s+/g,"in ").replace(/varying\s+/g,"out ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(+/g,"texture(")}(e):function(e){return e.replace(/varying\s+/g,"in ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(/g,"texture(")}(e);case 100:return n?function(e){return e.replace(/^in\s+/gm,"attribute ").replace(/^out\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(e):function(e){return e.replace(/^in\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(e);default:throw new Error("unknown GLSL version ".concat(t))}}function Zt(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}var Kt=function(){function e(t){var n=t.name,i=t.vs,r=t.fs,a=t.dependencies,o=void 0===a?[]:a,s=t.getUniforms,c=void 0===s?function(){return{}}:s,u=t.deprecations,l=void 0===u?[]:u,h=t.vertexShader,d=t.fragmentShader;Object(m.a)(this,e),Zt("string"==typeof n),this.name=n,this.vs=i||h,this.fs=r||d,this.getModuleUniforms=c,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(l)}return Object(L.a)(e,[{key:"getModuleSource",value:function(e,t){var n;switch(e){case"vs":n=qt(this.vs||"",t,!0);break;case"fs":n=qt(this.fs||"",t,!1);break;default:Zt(!1)}return"string"!=typeof n?"":"#define MODULE_".concat(this.name.toUpperCase(),"\n").concat(n,"// END MODULE_").concat(this.name,"\n\n")}},{key:"getUniforms",value:function(e,t){return this.getModuleUniforms(e,t)}},{key:"checkDeprecations",value:function(e,t){this.deprecations.forEach(function(n){n.regex.test(e)&&(n.deprecated&&t?t.deprecated(n.old,n.new)():t&&t.removed(n.old,n.new)())})}},{key:"_parseDeprecationDefinitions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.forEach(function(e){switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),e}}]),e}(),$t=new(function(){function e(){Object(m.a)(this,e),this.shaderModules={},this.defaultShaderModules=[]}return Object(L.a)(e,[{key:"setDefaultShaderModules",value:function(e){this.defaultShaderModules=this.resolveModules(e)}},{key:"registerShaderModules",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,n=void 0!==t&&t,i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var c=o.value;this._registerShaderModule(c,n)}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}}},{key:"getShaderModule",value:function(e){if(e instanceof Kt)return e;if("string"!=typeof e)return this._registerShaderModule(e,!0);var t=this.shaderModules[e];return t||Zt(!1,"Unknown shader module ".concat(e)),t}},{key:"resolveModules",value:function(e){var t=this;return e.map(function(e){return t.getShaderModule(e)})}},{key:"_registerShaderModule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof Kt)return e;if(Zt(e.name,"shader module has no name"),this.shaderModules[e.name]&&!t)throw new Error("shader module ".concat(e.name," already registered"));return(e=new Kt(e)).dependencies=this.resolveModules(e.dependencies),this.shaderModules[e.name]=e,this.shaderModules[e.name]}}]),e}());function Qt(e){$t.setDefaultShaderModules(e)}function Jt(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,n=void 0!==t&&t;$t.registerShaderModules(e,{ignoreMultipleRegistrations:n})}function en(e){return $t.getShaderModule(e)}function tn(e){var t={},n={};return nn({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort(function(e,t){return n[t]-n[e]}).map(function(e){return t[e]})}function nn(e){var t=e.modules,n=e.level,i=e.moduleMap,r=e.moduleDepth;if(n>=5)throw new Error("Possible loop in shader dependency graph");var a=!0,o=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;i[l.name]=l,(void 0===r[l.name]||r[l.name]<n)&&(r[l.name]=n)}}catch(e){o=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}var h=!0,d=!1,f=void 0;try{for(var g,p=t[Symbol.iterator]();!(h=(g=p.next()).done);h=!0){var v=g.value;v.dependencies&&nn({modules:v.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}}catch(e){d=!0,f=e}finally{try{h||null==p.return||p.return()}finally{if(d)throw f}}}var rn=32874,an=7936,on=7937,sn=7938,cn=35724,un={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},ln={};Object.keys(un).forEach(function(e){ln[e]=e});var hn={};function dn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=un[t];if(Zt(i,t),!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="undefined"!=typeof window&&window.navigator||{},n=e.userAgent||t.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(t in hn)return hn[t];var r=i[0],a=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(a,"\nvoid main(void) {}"),s=e.createShader(35633);e.shaderSource(s,o),e.compileShader(s);var c=e.getShaderParameter(s,35713);return e.deleteShader(s),hn[t]=c,c}function fn(e,t){var n=un[t];Zt(n,t);var i=function(e){return Boolean(e&&("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||32874===rn))}(e)&&n[1]||n[0],r="string"==typeof i?Boolean(e.getExtension(i)):i;return Zt(!1===r||!0===r),r}function gn(e,t){return(t=Array.isArray(t)?t:[t]).every(function(t){return fn(e,t)})}function pn(e){switch(function(e){var t=e.getExtension("WEBGL_debug_renderer_info"),n=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||an),i=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||on);return{gpuVendor:function(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,i),vendor:n,renderer:i,version:e.getParameter(sn),shadingLanguageVersion:e.getParameter(cn)}}(e).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}var vn,mn,_n=n(41),bn=n.n(_n),yn=(vn={},Object(S.a)(vn,Xt,"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"),Object(S.a)(vn,Yt,"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"),vn),xn=/void main\s*\([^\)]*\)\s*\{\n?/,En=/}\n?[^{}]*$/;function wn(e){var t={};return bn()(Array.isArray(e)&&e.length>1),e.forEach(function(e){for(var n in e)t[n]=t[n]?"".concat(t[n],"\n").concat(e[n]):e[n]}),t}var On=(mn={},Object(S.a)(mn,Xt,"vertex"),Object(S.a)(mn,Yt,"fragment"),mn),Sn="precision highp float;\n\n";function Pn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.vs,i=t.fs,r=function(e){return e=e.concat($t.defaultShaderModules),tn(e=$t.resolveModules(e))}(t.modules||[]);return{gl:e,vs:An(e,Object.assign({},t,{source:n,type:Xt,modules:r})),fs:An(e,Object.assign({},t,{source:i,type:Yt,modules:r})),getUniforms:function(e){return function(t){var n={},i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var c=o.value,u=c.getUniforms(t,n);Object.assign(n,u)}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}}(r),modules:function(e){var t={},n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,c=en(s);t[s]=c}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return t}(r)}}function An(e,t){var n=t.id,i=t.source,r=t.type,a=t.modules,o=void 0===a?[]:a,s=t.defines,c=void 0===s?{}:s,u=t.inject,l=void 0===u?{}:u,h=t.prologue,d=void 0===h||h,f=t.log;Zt("string"==typeof i,"shader source must be a string");var g=r===Xt,p=i.split("\n"),v=100,m="",_=i;0===p[0].indexOf("#version ")&&(v=300,m=p[0],_=p.slice(1).join("\n"));var b=d?"".concat(m,"\n").concat(function(e){var t=e.id,n=e.source,i=e.type;return t&&"string"==typeof t&&-1===n.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(t,"_").concat(On[i],"\n\n"):""}({id:n,source:i,type:r}),"\n").concat(pn(e),"\n").concat(function(e,t,n){var i="#if (__VERSION__ > 120)\n\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return gn(e,ln.GLSL_FRAG_DEPTH)&&(i+="// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),gn(e,ln.GLSL_DERIVATIVES)&&dn(e,ln.GLSL_DERIVATIVES)&&(i+="// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define DERIVATIVES\n#endif\n"),gn(e,ln.GLSL_FRAG_DATA)&&dn(e,ln.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define DRAW_BUFFERS\n#endif\n"),gn(e,ln.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n# define TEXTURE_LOD\n#define texture2DLod texture2DLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define textureCubeLod textureCubeLodEXT\n#define texture2DGrad texture2DGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define textureCubeGrad textureCubeGradEXT\n#endif\n"),i}(e),"\n").concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,n="";for(var i in e){0===t&&(n+="\n// APPLICATION DEFINES\n"),t++;var r=e[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(e[i],"\n"))}0===t&&(n+="\n");return n}(c),"\n").concat(g?"":Sn,"\n"):"".concat(m,"\n"),y=!1,x=!0,E=!1,w=void 0;try{for(var O,S=o[Symbol.iterator]();!(x=(O=S.next()).done);x=!0){var P=O.value;switch(P.name){case"inject":y=!0;break;default:P.checkDeprecations(_,f),b+=P.getModuleSource(r,v)}}}catch(e){E=!0,w=e}finally{try{x||null==S.return||S.return()}finally{if(E)throw w}}return b=function(e,t,n,i){var r=t===Xt,a=function(t){var i=n[t];switch(t){case"vs:#decl":r&&(e=e.replace(xn,function(e){return"".concat(i,"\n").concat(e)}));break;case"vs:#main-start":r&&(e=e.replace(xn,function(e){return e+i}));break;case"vs:#main-end":r&&(e=e.replace(En,function(e){return i+e}));break;case"fs:#decl":r||(e=e.replace(xn,function(e){return"".concat(i,"\n").concat(e)}));break;case"fs:#main-start":r||(e=e.replace(xn,function(e){return e+i}));break;case"fs:#main-end":r||(e=e.replace(En,function(e){return i+e}));break;default:e=e.replace(t,function(e){return e+i})}};for(var o in n)a(o);return i&&(e=e.replace("}s*$",function(e){return e+yn[t]})),e}(b+=_,r,l,y)}var Tn={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null};function Cn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.fround(e),r=e-i;return t[n]=i,t[n+1]=r,t}var jn="uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",Mn="".concat(jn,"\n").concat("const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\nvec2 exp_fp64(vec2 a) {\n\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n\n\n\n\n\n  s = sum_fp64(s, t);\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return mul_fp64(degree, PI_180_FP64);\n}\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = mul_fp64(a[0], b[0]);\n    out_val[1] = mul_fp64(a[1], b[1]);\n}\n\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = div_fp64(a[0], b[0]);\n    out_val[1] = div_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\n  vec2 length = vec2_length_fp64(x);\n  vec2 length_vec2[2];\n  length_vec2[0] = length;\n  length_vec2[1] = length;\n\n  vec2_div_fp64(x, length_vec2, out_val);\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\n  vec2 v[2];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n\n  return sum_fp64(v[0], v[1]);\n}\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\n    mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n"),Rn={ONE:1};var Ln={name:"fp64",vs:Mn,fs:null,fp64ify:Cn,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){for(var t=new Float32Array(32),n=0;n<4;++n)for(var i=0;i<4;++i){var r=4*n+i;Cn(e[4*i+n],t,2*r)}return t},getUniforms:function(){return Object.assign({},Rn)}},In=("".concat(jn),[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Fn={modelMatrix:In,viewMatrix:In,projectionMatrix:In,cameraPositionWorld:[0,0,0]};var kn="varying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n",Nn={name:"project",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fn,t=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],{});return void 0!==e.modelMatrix&&(t.modelMatrix=e.modelMatrix),void 0!==e.viewMatrix&&(t.viewMatrix=e.viewMatrix),void 0!==e.projectionMatrix&&(t.projectionMatrix=e.projectionMatrix),void 0!==e.cameraPositionWorld&&(t.cameraPositionWorld=e.cameraPositionWorld),void 0===e.projectionMatrix&&void 0===e.viewMatrix||(t.viewProjectionMatrix=new kt.a(e.projectionMatrix).multiplyRight(e.viewMatrix)),t},vs:"".concat(kn,"\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform vec3 cameraPositionWorld;\n\nstruct World {\n  vec3 position;\n  vec3 normal;\n};\n\nWorld world;\n\nvoid project_setPosition(vec4 position) {\n  project_vPositionWorld = position;\n}\n\nvoid project_setNormal(vec3 normal) {\n  project_vNormalWorld = normal;\n}\n\nvoid project_setPositionAndNormal_World(vec3 position, vec3 normal) {\n  world.position = position;\n  world.normal = normal;\n}\n\nvoid project_setPositionAndNormal_Model(vec3 position, vec3 normal) {\n  world.position = (modelMatrix * vec4(position, 1.)).xyz;\n  world.normal = mat3(modelMatrix) * normal;\n}\n\nvec4 project_model_to_clipspace(vec4 position) {\n  return viewProjectionMatrix * modelMatrix * position;\n}\n\nvec4 project_model_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);\n}\n\nvec4 project_world_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_view_to_clipspace(vec3 position) {\n  return projectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n"),fs:"\n".concat(kn)};var Dn={name:"lighting",vs:"".concat("\n","\n").concat("#define LIGHT_MAX 4\n\nuniform bool lighting_uEnableLights;\nuniform vec3 lighting_uAmbientColor;\nuniform vec3 lighting_uDirection;\nuniform vec3 lighting_uDirectionalColor;\nuniform int  lighting_uPointCount;\nuniform vec3 lighting_uPointLocation[LIGHT_MAX];\nuniform vec3 lighting_uPointColor[LIGHT_MAX];\nuniform bool lighting_uEnableReflections;\nvarying vec4 lighting_vPosition;\nvarying vec4 lighting_vNormal;\nvarying vec3 lighting_vColor;\nvarying vec3 lighting_vLightWeighting;\nvarying vec3 lighting_vReflection;\n\nvoid lighting_setPositionAndNormal(vec3 position, vec3 normal) {\n  lighting_vPosition = worldMatrix * vec4(position, 1.);\n  lighting_vNormal = worldInverseTransposeMatrix * vec4(normal, 1.);;\n}\n\nvoid lighting__getLightWeigting() {\n  float directionalLightWeighting = max(dot(lighting_vNormal.xyz, lighting_uDirection), 0.);\n  vec3 pointWeight = vec3(0., 0., 0.);\n  for (int i = 0; i < LIGHT_MAX; i++) {\n    if (i < numberPoints) {\n      vec4 mvLightPosition = viewMatrix * vec4(lighting_uPointLocation[i], 1.);\n      vec3 pointLightDirection = normalize(mvLightPosition.xyz - lighting_vPosition.xyz);\n      pointWeight += max(dot(lighting_vNormal.xyz, pointLightDirection), 0.) * pointColor[i];\n     } else {\n       break;\n     }\n   }\n   return ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\n\nvoid lighting_apply(vec3 position, vec3 normal) {\n  lighting_setPositionAndNormal(position, normal);\n  if(!lighting_uEnableLights) {\n    lighting_vLightWeighting = vec3(1., 1., 1.);\n  } else {\n    lighting_vLightWeighting = lighting__getLightWeighting();\n  }\n}\n\nvoid lighting_set_reflection(vec3 position) {\n  if (lighting_uEnableReflections) {\n    lighting_vReflection = (viewInverseMatrix[3] - (worldMatrix * vec4(position, 1.))).xyz;\n  } else {\n    lighting_vReflection = vec3(1., 1., 1.);\n  }\n}\n","\n"),fs:"".concat("\n","\n").concat("precision highp float;\n\n#define LIGHT_MAX 4\n\nvarying vec3 lighting_vLightWeighting;\n\nvec4 lighting_apply(vec4 color) {\n  return vec4(color.rgb * lighting_vLightWeighting, color.a);\n}\n\nuniform mat4 viewMatrix;\n\n\nvarying vec4 lighting_vColor;\nvarying vec4 lighting_vTransformedNormal;\nvarying vec4 lighting_vPosition;\n\nuniform float shininess;\nuniform bool enableSpecularMap;\nuniform bool enableLights;\n\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\n\nuniform vec3 lighting_uPointLocation[LIGHT_MAX];\nuniform vec3 lighting_uPointColor[LIGHT_MAX];\nuniform float lighting_uPointSpecularEnable[LIGHT_MAX];\nuniform vec3 lighting_uPointSpecularColor[LIGHT_MAX];\nuniform int numberPoints;\n\n\nvec3 lighting__calculate_light_weighting() {\n\treturn lighting__calculate_light_weighting(shininess);\n}\n\nvec3 lighting__calculate_light_weighting(shininess) {\n  vec3 normal = vTransformedNormal.xyz;\n  vec3 eyeDirection = normalize(-vPosition.xyz);\n\n  vec3 specularLight = vec3(0., 0., 0.);\n  vec3 diffuseLight = vec3(0., 0., 0.);\n\n  for (int i = 0; i < LIGHT_MAX; i++) {\n    if (i < numberPoints) {\n      vec3 transformedPointLocation = (viewMatrix * vec4(lighting_uPointLocation[i], 1.0)).xyz;\n      vec3 lightDirection = normalize(transformedPointLocation - vPosition.xyz);\n\n      if (lighting_uPointSpecularEnable > 0.) {\n        vec3 reflectionDirection = reflect(-lightDirection, normal);\n        float specularLightWeighting =\n          pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininessVal);\n        specularLight += specularLightWeighting * lighting_uPointSpecularColor[i];\n      }\n\n      float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\n      diffuseLight += diffuseLightWeighting * lighting_uPointColor[i];\n    } else {\n      break;\n    }\n  }\n\n  return ambientColor + diffuseLight + specularLight;\n}\n\nvoid lighting_filterColor(fragmentColor) {\n  if (!lighting_enable) {\n  \treturn fragmentColor;\n  } else {\n  \tvec3 lightWeighting = lighting__calculate_light_weighting();\n  \treturn vec4(fragmentColor.rgb * lightWeighting, fragmentColor.a);\n  }\n}\n\nuniform vec3 material_uAmbientColor;\nuniform vec3 material_uDiffuseColor;\nuniform vec3 material_uSpecularColor;\nuniform vec3 material_uEmissiveColor;\n\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\n\nuniform mat4 viewMatrix;\n\nvoid apply_lighting(color) {\n  vec3 ambientLightWeighting = ambientColor;\n\n  vec3 normal = vTransformedNormal.xyz;\n  vec3 eyeDirection = normalize(-vPosition.xyz);\n\n  vec3 specularLight = vec3(0.0, 0.0, 0.0);\n  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n\n  for (int i = 0; i < LIGHT_MAX; i++) {\n    if (i < numberPoints) {\n      vec3 transformedPointLocation = (viewMatrix * vec4(pointLocation[i], 1.0)).xyz;\n      vec3 lightDirection = normalize(transformedPointLocation - vPosition.xyz);\n\n      if (enableSpecularHighlights) {\n        vec3 reflectionDirection = reflect(-lightDirection, normal);\n        float specularLightWeighting =\n          pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);\n        specularLight += specularLightWeighting * pointSpecularColor[i];\n      }\n\n      float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\n      diffuseLight += diffuseLightWeighting * pointColor[i];\n    } else {\n        break;\n    }\n  }\n\n  vec3 matAmbientColor = material_uAmbientColor * color.rgb;\n  vec3 matDiffuseColor = material_uDiffuseColor * color.rgb;\n  vec3 matSpecularColor = material_uSpecularColor * color.rgb;\n  vec3 matEmissiveColor = material_uEmissiveColor * color.rgb;\n  gl_FragColor = vec4(\n    matAmbientColor * ambientLightWeighting\n    + matDiffuseColor * diffuseLightWeighting\n    + matSpecularColor * specularLightWeighting\n    + matEmissiveColor,\n    color.a\n  );\n}\n\n  vec3 lightWeighting;\n  if (!enableLights) {\n    lightWeighting = vec3(1.0, 1.0, 1.0);\n  } else {\n    vec3 lightDirection;\n    float specularLightWeighting = 0.0;\n    float diffuseLightWeighting = 0.0;\n    vec3  specularLight = vec3(0.0, 0.0, 0.0);\n    vec3  diffuseLight = vec3(0.0, 0.0, 0.0);\n\n    vec3 transformedPointLocation;\n    vec3 normal = vTransformedNormal.xyz;\n\n    vec3 eyeDirection = normalize(-vPosition.xyz);\n    vec3 reflectionDirection;\n\n    vec3 pointWeight = vec3(0.0, 0.0, 0.0);\n\n    for (int i = 0; i < LIGHT_MAX; i++) {\n      if (i < numberPoints) {\n        transformedPointLocation = (viewMatrix * vec4(pointLocation[i], 1.0)).xyz;\n        lightDirection = normalize(transformedPointLocation - vPosition.xyz);\n\n        if (enableSpecular[i] > 0.0) {\n          reflectionDirection = reflect(-lightDirection, normal);\n          specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);\n          specularLight += specularLightWeighting * pointSpecularColor[i];\n        }\n\n        diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\n        diffuseLight += diffuseLightWeighting * pointColor[i];\n      } else {\n        break;\n      }\n    }\n\n    lightWeighting = ambientColor + diffuseLight + specularLight;\n  }\nuniform float reflection;\nuniform float refraction;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","\n"),getUniforms:function(e){var t=e.lightingEnable,n=void 0!==t&&t,i=e.lightingAmbientColor,r=void 0===i?[.2,.2,.2]:i,a=e.lightingDirection,o=void 0===a?[1,1,1]:a,s=(e.lightingDirectionalColor,e.lightingPointLights),c=void 0===s?[]:s;return Object.assign({lightingEnable:n,lightingAmbientColor:r},function(e){var t=e.color,n=e.direction,i=new Ft.a(n.x,n.y,n.z).normalize().scale(-1,-1,-1);return{directionalColor:[t.r,t.g,t.b],lightingDirection:[i.x,i.y,i.z]}}(o),function(e){var t=(e=e instanceof Array?e:[e]).length,n=[],i=[],r=[],a=[],o=!0,s=!1,c=void 0;try{for(var u,l=e[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var h=u.value,d=h.position,f=h.color,g=h.diffuse,p=h.specular,v=f||g;n.push(d.x,d.y,d.z),i.push(v.r,v.g,v.b),r.push(Number(Boolean(p))),p?a.push(p.r,p.g,p.b):a.push(0,0,0)}}catch(e){s=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}return{numberPoints:t,pointLocation:n,pointColor:i,enableSpecular:r,pointSpecularColor:a}}(c))}},Bn={lightDirection:new Float32Array([1,1,2])};var Un={name:"dirlight",vs:null,fs:"uniform vec3 dirlight_uLightDirection;\nvec4 dirlight_filterColor(vec4 color) {\n  vec3 normal = project_getNormal_World();\n  float d = abs(dot(normalize(normal), normalize(dirlight_uLightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bn,t={};return e.lightDirection&&(t.dirlight_uLightDirection=e.lightDirection),t},dependencies:[Nn]},zn={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingThreshold:1,pickingActive:!1};var Gn={name:"picking",vs:"uniform vec3 picking_uSelectedColor;\nuniform float picking_uThreshold;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    abs(vertexColor.r - picking_uSelectedColor.r) < picking_uThreshold &&\n    abs(vertexColor.g - picking_uSelectedColor.g) < picking_uThreshold &&\n    abs(vertexColor.b - picking_uSelectedColor.b) < picking_uThreshold;\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  picking_vRGBcolor_Aselected.a =\n    float(isVertexPicked(pickingColor));\n  picking_vRGBcolor_Aselected.rgb = pickingColor * COLOR_SCALE;\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\nvec4 picking_filterHighlightColor(vec4 color) {\n  bool selected = bool(picking_vRGBcolor_Aselected.a);\n\n  if (selected) {\n    vec4 highLightColor = picking_uHighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  vec3 pickingColor = picking_vRGBcolor_Aselected.rgb;\n  if (picking_uActive && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return picking_uActive ? vec4(pickingColor, 1.0) : color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zn,t={};if(void 0!==e.pickingSelectedColor)if(null===e.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{var n=[e.pickingSelectedColor[0],e.pickingSelectedColor[1],e.pickingSelectedColor[2]];t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=n}return void 0!==e.pickingHighlightColor&&(t.picking_uHighlightColor=e.pickingHighlightColor),void 0!==e.pickingThreshold&&(t.picking_uThreshold=e.pickingThreshold),void 0!==e.pickingActive&&(t.picking_uActive=e.pickingActive?1:0),t}},Vn={diffuseTexture:null,diffuseColor:[.5,.5,.5,1]};var Wn={name:"diffuse",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vn,t={};return void 0!==e.diffuseTexture&&(t.diffuse_uHasTexture=Boolean(e.diffuseTexture),t.diffuse_uTexture=e.diffuseTexture),void 0!==e.diffuseColor&&(t.diffuse_uColor=e.diffuseColor),t},vs:"out vec2 diffuse_vTexCoord;\nvoid diffuse_setTextureCoordinate(vec2 uv) {\n  diffuse_vTexCoord = uv;\n}\n",fs:"uniform vec4 diffuse_uColor;\nuniform bool diffuse_uHasTexture;\nuniform sampler2D diffuse_uTexture;\n\nin vec2 diffuse_vTexCoord;\n\n\n\nvec4 diffuse_getColor() {\n  vec2 texCoord = diffuse_vTexCoord;\n  return diffuse_uHasTexture ?\n    texture2D(diffuse_uTexture, vec2(texCoord.s, texCoord.t)) :\n    diffuse_uColor;\n}\n\nvec4 diffuse_filterColor(vec4 color) {\n  return diffuse_getColor();\n}\n"},Hn="void main() {}",Xn="#version 300 es\n".concat(Hn);function Yn(e,t){t=Array.isArray(t)?t:[t];var n=e.replace(/^\s+/,"").split(/\s+/),i=Object(me.a)(n,3),r=i[0],a=i[1],o=i[2];return t.includes(r)&&a&&o?{qualifier:r,type:a,name:o.split(";")[0]}:null}function qn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.version,n=void 0===t?100:t,i=e.input,r=e.inputType,a=e.output;if(!i)return 300===n?Xn:Hn;var o=function(e,t){switch(t){case"float":return"vec4(".concat(e,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(e,", 0.0, 1.0)");case"vec3":return"vec4(".concat(e,", 1.0)");case"vec4":return e;default:return bn()(!1),null}}(i,r);return 300===n?"#version 300 es\nin ".concat(r," ").concat(i,";\nout vec4 ").concat(a,";\nvoid main() {\n  ").concat(a," = ").concat(o,";\n}"):"varying ".concat(r," ").concat(i,";\nvoid main() {\n  gl_FragColor = ").concat(o,";\n}")}var Zn={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},Kn=n(21),$n=n.n(Kn),Qn={},Jn=function e(t,n,i){t&&(n.length>1?e(t[n[0]],n.slice(1),i):t[n[0]]=i)},ei=new Map;function ti(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.header,n=void 0===t?"Uniforms":t,i=e.program,r=e.uniforms,a=e.undefinedOnly,o=void 0!==a&&a;Object(k.a)(i);var s=i._uniformSetters,c={},u=Object.keys(s).sort(),l=0,d=!0,f=!1,g=void 0;try{for(var p,v=u[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var m=p.value;m.match(".*_.*")||m.match(".*Matrix")||ni({table:c,header:n,uniforms:r,uniformName:m,undefinedOnly:o})&&l++}}catch(e){f=!0,g=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw g}}var _=!0,b=!1,y=void 0;try{for(var x,E=u[Symbol.iterator]();!(_=(x=E.next()).done);_=!0){var w=x.value;w.match(".*Matrix")&&ni({table:c,header:n,uniforms:r,uniformName:w,undefinedOnly:o})&&l++}}catch(e){b=!0,y=e}finally{try{_||null==E.return||E.return()}finally{if(b)throw y}}var O=!0,P=!1,A=void 0;try{for(var T,C=u[Symbol.iterator]();!(O=(T=C.next()).done);O=!0){var j=T.value;c[j]||ni({table:c,header:n,uniforms:r,uniformName:j,undefinedOnly:o})&&l++}}catch(e){P=!0,A=e}finally{try{O||null==C.return||C.return()}finally{if(P)throw A}}var M=0,R={};if(!o)for(var L in r){var I=r[L];c[L]||(M++,R[L]=Object(S.a)({Type:"NOT USED: ".concat(I)},n,Object(h.b)(I)))}return{table:c,count:l,unusedTable:R,unusedCount:M}}function ni(e){var t,n=e.table,i=e.header,r=e.uniforms,a=e.uniformName,o=e.undefinedOnly,s=r[a],c=function(e){return void 0!==e&&null!==e}(s);return(!o||!c)&&(n[a]=(t={},Object(S.a)(t,i,c?Object(h.b)(s):"N/A"),Object(S.a)(t,"Uniform Type",c?s:"NOT PROVIDED"),t),!0)}function ii(e,t,n,i){var r,o,s,c,u=e.gl,l="NOT PROVIDED",d="N/A",f="N/A",g="N/A";if(n&&(l=n.type,d=n.size,o=-1!==(l=String(l).replace("Array","")).indexOf("nt")),t instanceof ne.a){var p,v,m=t,_=m.getDebugData(),b=_.data;if(s=_.modified?"*":"",c=b,f=(g=m.byteLength)/b.BYTES_PER_ELEMENT/d,n){var y=n.divisor>0;v="".concat(y?"I ":"P "," ").concat(f," (x").concat(d,"=").concat(g," bytes ").concat(Object(a.d)(u,l),")")}else o=!0,v="".concat(g," bytes");return p={},Object(S.a)(p,i,"".concat(s).concat(Object(h.b)(c,{size:d,isInteger:o}))),Object(S.a)(p,"Format ",v),p}return c=t,d=t.length,o=-1!==(l=String(t.constructor.name).replace("Array","")).indexOf("nt"),r={},Object(S.a)(r,i,"".concat(Object(h.b)(c,{size:d,isInteger:o})," (constant)")),Object(S.a)(r,"Format ","".concat(d,"x").concat(l," (constant)")),r}function ri(e,t){var n=gt(t.type,t.size);return n?"".concat(e," (").concat(n.name,")"):e}function ai(e){var t=e.accessor,n=gt(t.type,t.size);return n?"".concat(n.name," ").concat(e.name):e.name}$n.a.listenFor("luma.gl",function(e){var t=Qn[e.itemKey];if(t&&"edit"===e.type&&"uniforms"===e.valuePath[0]){var n=e.valuePath.slice(1);!function(e,t,n){_.d.__SEER_INITIALIZED__&&(ei.has(e)||ei.set(e,new Map),ei.get(e).set(t,n))}(e.itemKey,n,e.value);var i=t.getUniforms();Jn(i,n,e.value),t.setUniforms(i)}});var oi=["renderPickingBuffer","pickingEnabled"],si=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),n=Object(ie.a)(this,Object(re.a)(t).call(this,i)),Object(k.a)(Object(o.m)(e)),n.gl=e,n.lastLogTime=0,n.initialize(i),n}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props={},this.program=this._createProgram(e),this.vertexArray=new jt(this.gl,{program:this.program}),this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.animatedUniforms={},this.animated=!1,this.animationLoop=null,this.timerQueryEnabled=!1,this.timeElapsedQuery=void 0,this.lastQueryReturned=!0,this.stats={accumulatedFrameTime:0,averageFrameTime:0,profileFrameCount:0},this.pickable=!0,this.setProps(e),this.setUniforms(Object.assign({},this.getModuleUniforms(),this.getModuleUniforms(e.moduleSettings))),this.isInstanced=e.isInstanced||e.instanced,this.onBeforeRender=e.onBeforeRender||function(){},this.onAfterRender=e.onAfterRender||function(){},Object(k.a)(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}},{key:"setProps",value:function(e){Object.assign(this.props,e),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"uniforms"in e&&this.setUniforms(e.uniforms,e.samplers),"pickable"in e&&(this.pickable=e.pickable),"timerQueryEnabled"in e&&(this.timerQueryEnabled=e.timerQueryEnabled&&yt.isSupported(this.gl,["timers"]),e.timerQueryEnabled&&!this.timerQueryEnabled&&h.g.warn("GPU timer not supported")()),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers),"_animationProps"in e&&this._setAnimationProps(e._animationProps),"_animationLoop"in e&&(this.animationLoop=e._animationLoop)}},{key:"delete",value:function(){for(var e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this.program.delete(),this.vertexArray.delete(),function(e){delete Qn[e],$n.a.deleteItem("luma.gl",e)}(this.id)}},{key:"destroy",value:function(){this.delete()}},{key:"getNeedsRedraw",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearRedrawFlags,t=void 0!==e&&e,n=!1;return n=n||this.needsRedraw,this.needsRedraw=this.needsRedraw&&!t,this.geometry&&(n=n||this.geometry.getNeedsRedraw({clearRedrawFlags:t})),this.animated&&(n=n||"animated model ".concat(this.id)),n}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getProgram",value:function(){return this.program}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getUniforms",value:function(){return this.program.getUniforms}},{key:"setNeedsRedraw",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=e,this}},{key:"setDrawMode",value:function(e){return this.props.drawMode=Gt(e),this}},{key:"setVertexCount",value:function(e){return Object(k.a)(Number.isFinite(e)),this.props.vertexCount=e,this}},{key:"setInstanceCount",value:function(e){return Object(k.a)(Number.isFinite(e)),this.instanceCount=e,this}},{key:"setGeometry",value:function(e){this.geometry=e;var t=this._createBuffersFromAttributeDescriptors(this.geometry.getAttributes());return this.vertexArray.setAttributes(t),this.setNeedsRedraw(),this}},{key:"setAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(h.d)(e))return this;Object.assign(this.attributes,e);var t=this._createBuffersFromAttributeDescriptors(e);return this.vertexArray.setAttributes(t),this.setNeedsRedraw(),this}},{key:"setUniforms",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({},t),function(e,t){if(_.d.__SEER_INITIALIZED__&&e){var n=ei.get(e);n&&n.forEach(function(e,n){Jn(t,n,e)})}}(this.id,t),t=this._extractAnimatedUniforms(t),this.program.setUniforms(t,n,function(){e._checkForDeprecatedUniforms(t),e.setNeedsRedraw()})}},{key:"_setAnimationProps",value:function(e){var t=this;if(this.animated){Object(k.a)(e,"Model.draw(): animated uniforms but no animationProps");var n=this._evaluateAnimateUniforms(e);this.program.setUniforms(n,{},function(){t._checkForDeprecatedUniforms(n),t.setNeedsRedraw()})}}},{key:"updateModuleSettings",value:function(e){var t=this.getModuleUniforms(e||{});return this.setUniforms(t)}},{key:"clear",value:function(e){return je(this.program.gl,e),this}},{key:"draw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.moduleSettings,n=void 0===t?null:t,i=e.framebuffer,r=e.uniforms,a=void 0===r?{}:r,o=e.attributes,s=void 0===o?{}:o,c=e.samplers,u=void 0===c?{}:c,l=e.transformFeedback,d=void 0===l?this.transformFeedback:l,f=e.parameters,g=void 0===f?{}:f,p=e.vertexArray,v=void 0===p?this.vertexArray:p,m=e.animationProps;!function(e){Qn[e.id]||(Qn[e.id]=e,$n.a.listItem("luma.gl",e.id))}(this),this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(a,u),this._refreshAnimationProps(m);var _=this._logDrawCallStart(2),b=this.vertexArray.getDrawParams(this.props);b.isInstanced&&!this.isInstanced&&h.g.warn("Found instanced attributes on non-instanced model",this.id)();var y=b.isIndexed,x=b.indexType,E=this.isInstanced,w=this.instanceCount;return this.onBeforeRender(),this._timerQueryStart(),this.program.draw(Object.assign({},e,{logPriority:_,uniforms:null,framebuffer:i,parameters:g,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:v,transformFeedback:d,isIndexed:y,indexType:x,isInstanced:E,instanceCount:w})),this._timerQueryEnd(),this.onAfterRender(),this.setNeedsRedraw(!1),this._logDrawCallEnd(_,v,i),this}},{key:"transform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.discard,n=void 0===t||t,i=e.feedbackBuffers,r=e.unbindModels,a=void 0===r?[]:r,o=e.parameters;i&&this._setFeedbackBuffers(i),n&&(o=Object.assign({},o,Object(S.a)({},35977,n))),a.forEach(function(e){return e.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},e,{parameters:o}))}finally{a.forEach(function(e){return e.vertexArray.bindBuffers()})}return this}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(k.a)(arguments.length<=1),this.draw({uniforms:e})}},{key:"_createProgram",value:function(e){var t=e.vs,n=void 0===t?null:t,i=e.fs,r=void 0===i?null:i,a=e.modules,o=void 0===a?null:a,s=e.defines,c=void 0===s?{}:s,u=e.inject,l=void 0===u?{}:u,d=e.shaderCache,f=void 0===d?null:d,g=e.varyings,p=void 0===g?null:g,v=e.bufferMode,m=void 0===v?35981:v,_=e.program,b=void 0===_?null:_;this.getModuleUniforms=function(e){};var y=this.id;if(!b){n=n||Wt,r=r||Ht;var x=Pn(this.gl,{vs:n,fs:r,modules:o,inject:l,defines:c,log:h.g});n=x.vs,r=x.fs,b=f?f.getProgram(this.gl,{id:y,vs:n,fs:r}):new vt(this.gl,{id:y,vs:n,fs:r,varyings:p,bufferMode:m}),this.getModuleUniforms=x.getUniforms||function(e){}}return Object(k.a)(b instanceof vt,"Model needs a program"),b}},{key:"_checkForDeprecatedUniforms",value:function(e){oi.forEach(function(t){t in e&&h.g.deprecated(t,"use picking shader module and Model class updateModuleSettings()")()})}},{key:"_refreshAnimationProps",value:function(e){(e=e||this.animationLoop&&this.animationLoop.animationProps)&&this._setAnimationProps(e)}},{key:"_evaluateAnimateUniforms",value:function(e){if(!this.animated)return{};var t={};for(var n in this.animatedUniforms){var i=this.animatedUniforms[n];t[n]=i(e)}return t}},{key:"_extractAnimatedUniforms",value:function(e){var t=!1;for(var n in e){var i=e[n];"function"==typeof i?(this.animatedUniforms[n]=i,t=!0):delete this.animatedUniforms[n]}if(this.animated=!Object(h.d)(this.animatedUniforms),!t)return e;var r={};for(var a in e)this.animatedUniforms[a]||(r[a]=e[a]);return r}},{key:"_setFeedbackBuffers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(h.d)(e))return this;var t=this.program.gl;return this.transformFeedback=this.transformFeedback||new wt(t,{program:this.program}),this.transformFeedback.setBuffers(e),this.setNeedsRedraw(),this}},{key:"_timerQueryStart",value:function(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new yt(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}},{key:"_timerQueryEnd",value:function(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;var e=this.timeElapsedQuery.getResult();this.stats.lastFrameTime=e,this.stats.accumulatedFrameTime+=e,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,h.g.log(2,"GPU time ".concat(this.program.id,": ").concat(this.stats.lastFrameTime,"ms average ").concat(this.stats.averageFrameTime,"ms accumulated: ").concat(this.stats.accumulatedFrameTime,"ms count: ").concat(this.stats.profileFrameCount))()}}},{key:"_createBuffersFromAttributeDescriptors",value:function(e){var t=this.program.gl,n={};for(var i in e){var r=e[i],a=this._attributes[i];r instanceof Ut?a=r:r instanceof ne.a?(a=a||new Ut(t,Object.assign({},r,r.layout,{id:i}))).update({buffer:r}):a?a.update(r):a=new Ut(t,Object.assign({},r,{id:i})),this._attributes[i]=a,n[i]=a.getValue()}return n}},{key:"_logDrawCallStart",value:function(e){var t=e>3?0:1e4;if(!(h.g.priority<e||Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),h.g.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:h.g.priority<=2})(),e}},{key:"_logDrawCallEnd",value:function(e,t,n,i){if(void 0!==e){var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.vertexArray,n=e.header,i=void 0===n?"Attributes":n;if(!t.configuration)return{};var r={};t.elements&&(r.ELEMENT_ARRAY_BUFFER=ii(t,t.elements,null,i));var a=t.values;for(var o in a){var s=t._getAttributeInfo(o);if(s){var c="".concat(o,": ").concat(s.name),u=t.accessors[s.location];u&&(c="".concat(o,": ").concat(ri(s.name,u))),r[c]=ii(t,a[o],u,i)}}return r}({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),a=ti({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),o=a.table,s=a.unusedTable,c=a.unusedCount,u=ti({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0}),l=u.table;u.count>0&&h.g.log("MISSING UNIFORMS",Object.keys(l))(),c>0&&h.g.log("UNUSED UNIFORMS",Object.keys(s))();var d=function(e){var t={},n="Accessors for ".concat(e.id),i=!0,r=!1,a=void 0;try{for(var o,s=e.attributeInfos[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var c=o.value;if(c){var u=ai(c);t["in ".concat(u)]=Object(S.a)({},n,JSON.stringify(c.accessor))}}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}var l=!0,h=!1,d=void 0;try{for(var f,g=e.varyingInfos[Symbol.iterator]();!(l=(f=g.next()).done);l=!0){var p=f.value;if(p){var v=ai(p);t["out ".concat(v)]=Object(S.a)({},n,JSON.stringify(p.accessor))}}}catch(e){h=!0,d=e}finally{try{l||null==g.return||g.return()}finally{if(h)throw d}}return t}(this.vertexArray.configuration);h.g.table(e,r)(),h.g.table(e,o)(),h.g.table(e+1,d)(),function(e,t){if($n.a.isReady()&&!$n.a.throttle("luma.gl:".concat(e.id),1e3)){var n=e.geometry?Object.assign({},e.geometry.attributes,e.attributes):e.attributes,i=Object.assign({},e.uniforms,t);$n.a.multiUpdate("luma.gl",e.id,[{path:"objects.uniforms",data:i},{path:"objects.attributes",data:n}])}}(this,n),i&&i.log({priority:2,message:"Rendered to ".concat(i.id)}),h.g.groupEnd(2,">>> DRAWING MODEL ".concat(this.id))()}}},{key:"vertexCount",get:function(){return Number.isFinite(this.props.vertexCount)?this.props.vertexCount:this.geometry&&this.geometry.getVertexCount()}},{key:"drawMode",get:function(){return Number.isFinite(this.props.drawMode)?this.props.drawMode:this.geometry&&this.geometry.drawMode}}]),t}(Nt),ci=n(19),ui={preserveDrawingBuffer:!0},li=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,e);var n=t.onCreateContext,i=void 0===n?function(e){return V(e)}:n,r=t.onAddHTML,a=void 0===r?null:r,o=t.onInitialize,s=void 0===o?function(){}:o,c=t.onRender,u=void 0===c?function(){}:c,l=t.onFinalize,d=void 0===l?function(){}:l,f=t.gl,g=void 0===f?null:f,p=t.glOptions,v=void 0===p?{}:p,_=t.debug,b=void 0!==_&&_,y=t.createFramebuffer,x=void 0!==y&&y,E=t.autoResizeViewport,w=void 0===E||E,O=t.autoResizeDrawingBuffer,S=void 0===O||O,P=t.useDevicePixels,A=void 0===P||P;return"useDevicePixelRatio"in t&&(h.g.deprecated("useDevicePixelRatio","useDevicePixels")(),A=t.useDevicePixelRatio),this.props={onCreateContext:i,onAddHTML:a,onInitialize:s,onRender:u,onFinalize:d,gl:g,glOptions:v,debug:b,createFramebuffer:x},this.gl=g,this.needsRedraw=null,this.setProps({autoResizeViewport:w,autoResizeDrawingBuffer:S,useDevicePixels:A}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._renderFrame=this._renderFrame.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this),this}return Object(L.a)(e,[{key:"setNeedsRedraw",value:function(e){return Object(k.a)("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}},{key:"setProps",value:function(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._stopped=!1,this._animationFrameId||(this._startPromise=g().then(function(){return e._stopped?null:(e._createWebGLContext(t),e._createFramebuffer(),e._startEventHandling(),e._initializeCallbackData(),e._updateCallbackData(),e._resizeCanvasDrawingBuffer(),e._resizeViewport(),e.onInitialize(e.animationProps))}).then(function(t){e._stopped||(e._addCallbackData(t||{}),!1===t||e._animationFrameId||(e._animationFrameId=Object(o.p)(e._renderFrame)))})),this}},{key:"redraw",value:function(){return this._setupFrame(),this._updateCallbackData(),this.onRender(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this}},{key:"stop",value:function(){return this._animationFrameId&&(this._finalizeCallbackData(),Object(o.f)(this._animationFrameId),this._animationFrameId=null,this._stopped=!0),this}},{key:"onCreateContext",value:function(){var e;return(e=this.props).onCreateContext.apply(e,arguments)}},{key:"onInitialize",value:function(){var e;return(e=this.props).onInitialize.apply(e,arguments)}},{key:"onRender",value:function(){var e;return(e=this.props).onRender.apply(e,arguments)}},{key:"onFinalize",value:function(){var e;return(e=this.props).onFinalize.apply(e,arguments)}},{key:"getHTMLControlValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=document.getElementById(e);return n?Number(n.value):t}},{key:"setViewParameters",value:function(){return h.g.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._onSetupFrame?this._onSetupFrame(this.animationProps):(this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer())}},{key:"_renderFrame",value:function(){this._stopped||(this.redraw(),this._animationFrameId=Object(o.p)(this._renderFrame))}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),time:0,tick:0,tock:0,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var e=this._getSizeAndAspect(),t=e.width,n=e.height,i=e.aspect;t===this.animationProps.width&&n===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.time=Date.now()-this.animationProps.startTime,this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(e){"object"===Object(ci.a)(e)&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}},{key:"_createWebGLContext",value:function(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,ui,this.props.glOptions),this.gl=this.props.gl||this.onCreateContext(e),!Object(o.m)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");this.props.debug&&(this.gl=y(this.gl)),Object(Y.d)(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";var t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);var n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}},{key:"_getSizeAndAspect",value:function(){var e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight,n=1,i=this.gl.canvas,r=i.clientWidth,a=i.clientHeight;return r>=0&&a>=0?n=t>0?r/a:1:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&H(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new Ie(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_startEventHandling",value:function(){this.gl.canvas.addEventListener("mousemove",this._onMousemove),this.gl.canvas.addEventListener("mouseleave",this._onMouseleave)}},{key:"_onMousemove",value:function(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}},{key:"_onMouseleave",value:function(e){this.animationProps._mousePosition=null}}]),e}();function hi(e,t){var n=t.models,i=t.position,r=t.uniforms,a=void 0===r?{}:r,o=t.parameters,s=void 0===o?{}:o,c=t.settings,u=t.useDevicePixels,l=void 0===u||u,h=t.framebuffer,d=t.context;Object(k.a)(B(e)&&h&&i);var f=Object(me.a)(i,2),g=f[0],p=f[1];h.resize({width:e.canvas.width,height:e.canvas.height});var v=l&&"undefined"!=typeof window?window.devicePixelRatio:1,m=g*v,_=e.canvas.height-p*v;return new Bt({children:n}).traverseReverse(function(n){if(n.pickable){je(e,{framebuffer:h,color:!0,depth:!0}),n.setUniforms({picking_uActive:1}),n.draw(Object.assign({},t,{uniforms:a,parameters:s,settings:c,framebuffer:h,context:d})),n.setUniforms({picking_uActive:0});var i=h.readPixels({x:m,y:_,width:1,height:1,format:6408,type:5121});if(0!==i[0]||0!==i[1]||0!==i[2])return{model:n,color:i,x:g,y:p,deviceX:m,deviceY:_}}return null})}var di=new Uint8Array([0,0,0]);function fi(e){return[e+1&255,e+1>>8&255,e+1>>16&255]}function gi(e){var t=Object(me.a)(e,3);return t[0]+256*t[1]+65536*t[2]-1}function pi(){return di}var vi,mi="transform_uSampler_",_i="transform_uSize_",bi="transform_position";function yi(e){var t=e.vs,n=e.sourceTextureMap,i=e.targetTextureVarying,r=e.targetTexture,a=Object.keys(n).length,o=null,s={},c=t,u={};if(a>0||i){var l=c.split("\n"),h=l.slice();if(l.forEach(function(e,t,r){if(a>0){var c=function(e,t){var n={},i=function(e){return Yn(e,["attribute","in"])}(e);if(!i)return null;var r=i.type,a=i.name;if(a&&t[a]){var o="// ".concat(e," => Replaced by Transform with a sampler"),s=function(e){var t="".concat(mi).concat(e),n="".concat(_i).concat(e),i="  uniform sampler2D ".concat(t,";\n  uniform vec2 ").concat(n,";");return{samplerName:t,sizeName:n,uniformDeclerations:i}}(a),c=s.samplerName,u=s.sizeName,l=s.uniformDeclerations,h=function(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return bn()(!1),null}}(r),d="  ".concat(r," ").concat(a," = transform_getInput(").concat(c,", ").concat(u,").").concat(h,";\n");n[c]=a;var f={"vs:#decl":l,"vs:#main-start":d};return{updatedLine:o,inject:f,samplerTextureMap:n}}return null}(e,n);if(c){var l=c.updatedLine,d=c.inject;h[t]=l,u=wn([u,d]),Object.assign(s,c.samplerTextureMap),a--}}i&&!o&&(o=function(e,t){var n=Yn(e,["varying","out"]);if(!n)return null;return n.name===t?n.type:null}(e,i))}),i){bn()(r);var d="".concat(_i).concat(i),f="uniform vec2 ".concat(d,";\n"),g="     vec2 ".concat(bi," = transform_getPos(").concat(d,");\n     gl_Position = vec4(").concat(bi,", 0, 1.);\n");u=wn([u,{"vs:#decl":f,"vs:#main-start":g}])}c=h.join("\n")}return{vs:c,targetTextureType:o,inject:u,samplerTextureMap:s}}var xi=(vi={},Object(S.a)(vi,10241,9728),Object(S.a)(vi,10240,9728),Object(S.a)(vi,10242,33071),Object(S.a)(vi,10243,33071),vi),Ei=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,e),Object(o.d)(t),this.gl=t,this.model=null,this.elementCount=0,this.currentIndex=0,this.sourceBuffers=new Array(2),this.sourceTextures=new Array(2),this.feedbackBuffers=new Array(2),this.targetTextures=new Array(2),this.transformFeedbacks=new Array(2),this.framebuffers=new Array(2),this._createdBuffers={},this.elementIDBuffer=null,this._targetRefTexName=null,this._initialize(n),Object.seal(this)}return Object(L.a)(e,null,[{key:"isSupported",value:function(e){return Object(o.n)(e)}}]),Object(L.a)(e,[{key:"delete",value:function(){for(var e in this._createdBuffers)this._createdBuffers[e].delete();this.model.delete()}},{key:"getBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e?this.feedbackBuffers[this.currentIndex][e]:null;return t?t instanceof ne.a?t:t.buffer:null}},{key:"_getTargetTexture",value:function(){return this.framebuffers[this.currentIndex]?this.framebuffers[this.currentIndex].attachments[36064]:null}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.varyingName,n=void 0===t?null:t,i=e.packed,r=void 0!==i&&i,a=this.getBuffer(n);if(a)return a.getData();Object(k.a)(!n||n===this.targetTextureVarying);var o=this.framebuffers[this.currentIndex].readPixels();if(!r)return o;for(var s=o.constructor,c=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return bn()(!1),null}}(this.targetTextureType),u=new s(o.length*c/4),l=0,h=0;h<o.length;h+=4)for(var d=0;d<c;d++)u[l++]=o[h+d];return u}},{key:"getFramebuffer",value:function(){return this.framebuffers[this.currentIndex]}},{key:"_getInputs",value:function(){var e={},t=this.currentIndex,n=Object.assign({},this.sourceBuffers[t]);if(this.hasSourceTextures||this.targetTextureVarying){for(var i in n.transform_elementID=this.elementIDBuffer,this.samplerTextureMap){var r=this.samplerTextureMap[i];e[i]=this.sourceTextures[t][r]}this._setSourceTextureParameters();var a=function(e){var t,n,i=e.sourceTextureMap,r=e.targetTextureVarying,a=e.targetTexture,o={};for(var s in r&&(t=a.width,n=a.height,o["".concat(_i).concat(r)]=[t,n]),i){var c=i[s];t=c.width,n=c.height,o["".concat(_i).concat(s)]=[t,n]}return o}({sourceTextureMap:this.sourceTextures[t],targetTextureVarying:this.targetTextureVarying,targetTexture:this.targetTextures[t]});Object.assign(e,a)}return{attributes:n,uniforms:e}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._getInputs(),n=t.attributes,i=t.uniforms;Object.assign(i,e.uniforms);var r=Object.assign({},e.parameters),a=e.clearRenderTarget,o=void 0===a||a,s=null,c=!0;this.renderingToTexture&&(c=!1,s=this.framebuffers[this.currentIndex],Object(k.a)(s),r.viewport=[0,0,s.width,s.height],o&&this.gl.clear(this.gl.COLOR_BUFFER_BIT)),this.model.setAttributes(n),this.model.transform(Object.assign({},e,{transformFeedback:this.transformFeedbacks[this.currentIndex],uniforms:i,discard:c,framebuffer:s,parameters:r}))}},{key:"swapBuffers",value:function(){h.g.deprecated("swapBuffers()","swap()"),this.swap()}},{key:"swap",value:function(){Object(k.a)(this.feedbackMap||this._swapTexture),this.currentIndex=(this.currentIndex+1)%2}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.elementCount&&this._setElementCount(e.elementCount);var t=e.sourceBuffers,n=void 0===t?null:t,i=e.feedbackBuffers,r=void 0===i?null:i,a=this.currentIndex;if(n||r){for(var o in r)Object(k.a)(r[o]instanceof ne.a||r[o].buffer instanceof ne.a);Object.assign(this.sourceBuffers[a],n),Object.assign(this.feedbackBuffers[a],r),this._createFeedbackBuffers({feedbackBuffers:r}),this.transformFeedbacks[a]&&this.transformFeedbacks[a].setBuffers(this.feedbackBuffers[a]),this._setupSwapBuffers()}var s=e._sourceTextures,c=e._targetTexture;(s||c)&&(Object.assign(this.sourceTextures[a],s),this._updateTargetTexture(c||this._targetRefTexName,a),this._setupSwapTextures())}},{key:"_setSourceTextureParameters",value:function(){var e=this.currentIndex;for(var t in this.sourceTextures[e])this.sourceTextures[e][t].setParameters(xi)}},{key:"_setElementCount",value:function(e){this.elementCount!==e&&(this.elementCount<e&&this._updateElementIDBuffer(e),this.model.setVertexCount(e),this.elementCount=e)}},{key:"_updateTargetTexture",value:function(e,t){var n=this._buildTargetTexture(e);n&&(this.targetTextures[t]=n,this.framebuffers[t]&&(this.framebuffers[t].update({attachments:Object(S.a)({},36064,this.targetTextures[t]),resizeAttachments:!1}),this.framebuffers[t].resize({width:n.width,height:n.height})))}},{key:"_initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._validateProps(e),n=t.feedbackBuffers,i=t.feedbackMap,r=e.sourceBuffers,a=e.varyings,o=e._targetTexture,s=e._targetTextureVarying,c=e._swapTexture,u=a;i&&!Array.isArray(a)&&(u=Object.values(i)),this.varyingsArray=u,this.feedbackMap=i,this._swapTexture=c,o&&(this.targetTextureVarying=s,this.renderingToTexture=!0,Object(k.a)(this.targetTextureVarying)),this._setupBuffers({sourceBuffers:r,feedbackBuffers:n}),this._setupTextures(e),this._setupSwapBuffers(),this._setupSwapTextures(),this._buildModel(Object.assign({},e,{id:e.id||"transform-model",drawMode:e.drawMode||0,varyings:u}))}},{key:"_validateProps",value:function(e){var t=e.feedbackBuffers,n=e.feedbackMap,i=e.destinationBuffers,r=e.sourceDestinationMap;i&&(h.g.deprecated("destinationBuffers","feedbackBuffers")(),t=t||i),r&&(h.g.deprecated("sourceDestinationMap","feedbackMap")(),n=n||r);var a=e.vs,o=e.elementCount,s=e.varyings,c=e._sourceTextures,u=e._targetTexture,l=e._targetTextureVarying,d=e._swapTexture;for(var f in Object(k.a)(a&&(s||n||u)&&o),t||{})Object(k.a)(t[f]instanceof ne.a||t[f].buffer instanceof ne.a);for(var g in c||{})Object(k.a)(c[g]instanceof _e.a);return Object(k.a)(!u||l),Object(k.a)(!d||c[d]),{feedbackBuffers:t,feedbackMap:n}}},{key:"_setupBuffers",value:function(e){var t=e.sourceBuffers,n=void 0===t?null:t,i=e.feedbackBuffers,r=void 0===i?null:i;this.sourceBuffers[0]=Object.assign({},n),this.feedbackBuffers[0]=Object.assign({},r),this._createFeedbackBuffers({feedbackBuffers:r}),this.sourceBuffers[1]={},this.feedbackBuffers[1]={}}},{key:"_setupTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e._sourceTextures,n=e._targetTexture;if(this.sourceTextures[0]=Object.assign({},t),this.sourceTextures[1]={},this.hasSourceTextures=Object.keys(this.sourceTextures[0]).length>0,this.targetTextureVarying){var i=this._buildTargetTexture(n);Object(k.a)(i),this.targetTextures[0]=i,this.targetTextures[1]=null}}},{key:"_buildTargetTexture",value:function(e){var t;if(e instanceof _e.a)return e;var n=this.sourceTextures[0][e];return n?(this._targetRefTexName=e,Object(o.g)(n,{parameters:(t={},Object(S.a)(t,10241,9728),Object(S.a)(t,10240,9728),Object(S.a)(t,10242,33071),Object(S.a)(t,10243,33071),t),pixelStore:Object(S.a)({},37440,!1)})):null}},{key:"_createFeedbackBuffers",value:function(e){var t=e.feedbackBuffers;if(this.feedbackMap){var n=this.currentIndex;for(var i in this.feedbackMap){var r=this.feedbackMap[i];if(!(r===this.targetTextureVarying||t&&t[r])){var a=this.sourceBuffers[n][i],o=a.bytes,s=a.type,c=a.usage,u=a.accessor,l=new ne.a(this.gl,{bytes:o,type:s,usage:c,accessor:u});this._createdBuffers[r]&&this._createdBuffers[r].delete(),this._createdBuffers[r]=l,this.feedbackBuffers[n][r]=l}}}}},{key:"_createNewBuffer",value:function(e,t){var n=new ne.a(this.gl,t);return this._createdBuffers[e]&&(this._createdBuffers[e].delete(),this._createdBuffers[e]=n),n}},{key:"_setupSwapBuffers",value:function(){if(this.feedbackMap){var e=this.currentIndex,t=(e+1)%2;for(var n in Object.assign(this.sourceBuffers[t],this.sourceBuffers[e]),Object.assign(this.feedbackBuffers[t],this.feedbackBuffers[e]),this.feedbackMap){var i=this.feedbackMap[n];i!==this.targetTextureVarying&&(this.sourceBuffers[t][n]=this.feedbackBuffers[e][i],this.feedbackBuffers[t][i]=this.sourceBuffers[e][n],Object(k.a)(this.feedbackBuffers[t][i]instanceof ne.a))}this.transformFeedbacks[t]&&this.transformFeedbacks[t].setBuffers(this.feedbackBuffers[t])}}},{key:"_setupSwapTextures",value:function(){if(this._swapTexture&&this.targetTextureVarying){var e=this.currentIndex,t=(e+1)%2;Object.assign(this.sourceTextures[t],this.sourceTextures[e]),this.sourceTextures[t][this._swapTexture]=this.targetTextures[e],this._updateTargetTexture(this.sourceTextures[e][this._swapTexture],t)}}},{key:"_buildModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._getShaders(e),n=t.vs,i=t.fs,r=t.modules,a=t.uniforms,o=t.inject,s=t.samplerTextureMap;this.model=new si(this.gl,Object.assign({},e,{vs:n,fs:i,vertexCount:e.elementCount,modules:r,uniforms:a,inject:o})),this.samplerTextureMap=s,this._setupTransformFeedback(),this._setupFramebuffers(),this._setElementCount(e.elementCount)}},{key:"_setupTransformFeedback",value:function(){Object(h.d)(this.feedbackBuffers[0])||(this.transformFeedbacks[0]=new wt(this.gl,{program:this.model.program,buffers:this.feedbackBuffers[0]}),this.feedbackMap&&(this.transformFeedbacks[1]=new wt(this.gl,{program:this.model.program,buffers:this.feedbackBuffers[1]})))}},{key:"_setupFramebuffers",value:function(){if(this.renderingToTexture){var e=this.targetTextures[0],t=e.width,n=e.height;if(this.framebuffers[0]=new Ie(this.gl,{id:"".concat(this.id||"transform","-framebuffer-0"),width:t,height:n,attachments:Object(S.a)({},36064,this.targetTextures[0])}),this._swapTexture){var i=this.targetTextures[1];t=i.width,n=i.height,this.framebuffers[1]=new Ie(this.gl,{id:"".concat(this.id||"transform","-framebuffer-1"),width:t,height:n,attachments:Object(S.a)({},36064,this.targetTextures[1])})}}}},{key:"_updateElementIDBuffer",value:function(e){if(this.hasSourceTextures||this.targetTextureVarying){var t=new Float32Array(e);t.forEach(function(e,t,n){n[t]=t}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new ne.a(this.gl,{data:t,size:1})}}},{key:"_getShaders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._processVertexShader(e.vs),n=t.vs,i=t.uniforms,r=t.targetTextureType,a=t.inject,s=t.samplerTextureMap,c=wn([e.inject||{},a]);return this.targetTextureType=r,{vs:n,fs:qn({version:Object(o.l)(n),input:this.targetTextureVarying,inputType:r,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[Zn].concat(e.modules||[]):e.modules,uniforms:i,inject:c,samplerTextureMap:s}}},{key:"_processVertexShader",value:function(e){return yi({vs:e,sourceTextureMap:this.sourceTextures[this.currentIndex],targetTextureVarying:this.targetTextureVarying,targetTexture:this.targetTextures[this.currentIndex]})}}]),e}(),wi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.gl,i=t._cachePrograms,r=void 0!==i&&i;Object(m.a)(this,e),Object(k.a)(n),this.gl=n,this.vertexShaders={},this.fragmentShaders={},this.programs={},this._cachePrograms=r}return Object(L.a)(e,[{key:"delete",value:function(){return this}},{key:"getVertexShader",value:function(e,t){Object(k.a)("string"==typeof t),Object(k.a)(this._compareContexts(e,this.gl));var n=this.vertexShaders[t];return n||(n=new he(e,t),this.vertexShaders[t]=n),n}},{key:"getFragmentShader",value:function(e,t){Object(k.a)("string"==typeof t),Object(k.a)(this._compareContexts(e,this.gl));var n=this.fragmentShaders[t];return n||(n=new de(e,t),this.fragmentShaders[t]=n),n}},{key:"getProgram",value:function(e,t){Object(k.a)(this._compareContexts(e,this.gl)),Object(k.a)("string"==typeof t.vs),Object(k.a)("string"==typeof t.fs),Object(k.a)("string"==typeof t.id);var n=this._getProgramKey(t),i=this.programs[n];return i?(this._resetProgram(i),i):(i=this._createNewProgram(e,t),this._cachePrograms&&this._checkProgramProp(i)&&(i._isCached=!0,this.programs[n]=i),i)}},{key:"_getProgramKey",value:function(e){return"".concat(e.id,"-").concat(e.vs,"-").concat(e.fs)}},{key:"_checkProgramProp",value:function(e){return!e.varyings}},{key:"_createNewProgram",value:function(e,t){var n=t.vs,i=t.fs,r=this.getVertexShader(e,n),a=this.getFragmentShader(e,i);return new vt(this.gl,Object.assign({},t,{vs:r,fs:a}))}},{key:"_resetProgram",value:function(e,t){e.reset()}},{key:"_compareContexts",value:function(e,t){return(e.gl||e)===(t.gl||t)}}]),e}(),Oi=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,e);var i=n.onInitialize,r=void 0===i?function(){}:i,a=n.onFinalize,o=void 0===a?function(){}:a,s=n.useDevicePixels,c=void 0===s||s,u=n.autoResizeDrawingBuffer,l=void 0===u||u;this.props={onInitialize:r,onFinalize:o},this.setProps({autoResizeDrawingBuffer:l,useDevicePixels:c}),Object(k.a)(t instanceof Worker),this.worker=t,this.canvas=null,this.width=null,this.height=null,this._stopped=!0,this._animationFrameId=null,this._startPromise=null,this._onMessage=this._onMessage.bind(this),this._onEvent=this._onEvent.bind(this),this._updateFrame=this._updateFrame.bind(this)}return Object(L.a)(e,null,[{key:"createWorker",value:function(e){return function(t){e.setProps({useDevicePixels:!1,autoResizeDrawingBuffer:!1}),t.canvas=null,t.addEventListener("message",function(n){switch(n.data.command){case"start":!function(e){var n=new Map;e.addEventListener=function(e,i){t.postMessage({command:"addEventListener",type:e}),n.has(e)||n.set(e,[]),n.get(e).push(i)},e.removeEventListener=function(e,i){t.postMessage({command:"removeEventListener",type:e});var r=n.get(e);r&&r.splice(r.indexOf(i),1)},e.dispatchEvent=function(e,t){var i=n.get(e);i&&i.forEach(function(e){return e(t)})},t.canvas=e}(n.data.opts.canvas),e.start(n.data.opts);break;case"stop":e.stop();break;case"resize":t.canvas.width=n.data.width,t.canvas.height=n.data.height;break;case"event":t.canvas.dispatchEvent(n.data.type,n.data.event)}})}}}]),Object(L.a)(e,[{key:"setProps",value:function(e){return"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._stopped=!1,this._animationFrameId||(this.worker.onmessage=this._onMessage,this._startPromise=g().then(function(){return e._createAndTransferCanvas(t),e.props.onInitialize(e)}).then(function(){e._stopped||(e._animationFrameId=Object(o.p)(e._updateFrame))})),this}},{key:"stop",value:function(){return this._animationFrameId&&(Object(o.f)(this._animationFrameId),this._animationFrameId=null,this._stopped=!0,this.props.onFinalize(this)),this.worker.postMessage({command:"stop"}),this}},{key:"_onMessage",value:function(e){switch(e.data.command){case"addEventListener":this.canvas.addEventListener(e.data.type,this._onEvent);break;case"removeEventListener":this.canvas.removeEventListener(e.data.type,this._onEvent)}}},{key:"_onEvent",value:function(e){var t=this.useDevicePixels&&window.devicePixelRatio||1,n=e.type,i={};for(var r in e){var a=e[r],o=Object(ci.a)(a);"offsetX"!==r&&"offsetY"!==r||(a*=t),"number"!==o&&"boolean"!==o&&"string"!==o||(i[r]=a)}this.worker.postMessage({command:"event",type:n,event:i})}},{key:"_updateFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._animationFrameId=Object(o.p)(this._updateFrame)}},{key:"_createAndTransferCanvas",value:function(e){var t=p(e);t.transferControlToOffscreen||h.g.error("OffscreenCanvas is not available in your browser.")();var n=t.transferControlToOffscreen();this.worker.postMessage({command:"start",opts:Object.assign({},e,{canvas:n})},[n]),this.canvas=t}},{key:"_resizeCanvasDrawingBuffer",value:function(){if(this.autoResizeDrawingBuffer){var e=this.useDevicePixels&&window.devicePixelRatio||1,t=this.canvas.clientWidth*e,n=this.canvas.clientHeight*e;this.width===t&&this.height===n||(this.width=t,this.height=n,this.worker.postMessage({command:"resize",width:t,height:n}))}}}]),e}(),Si=function(){function e(t,n){Object(m.a)(this,e);var i=n.id,r=void 0===i?"pass":i;this.id=r,this.gl=t,this.props={enabled:!0,screen:!1,swap:!1},Object.assign(this.props,n)}return Object(L.a)(e,[{key:"setProps",value:function(e){Object.assign(this.props,e)}},{key:"render",value:function(e,t){var n=this;if(this.props.enabled){var i=this.gl,r={gl:i,outputBuffer:e.writeBuffer,inputBuffer:e.readBuffer,animationProps:t,swapBuffers:function(){return e._swapFramebuffers()}};this.props.screen?(r.inputBuffer=r.outputBuffer,r.outputBuffer=Ie.getDefaultFramebuffer(i)):this.props.swap&&(r.inputBuffer=e.writeBuffer,r.outputBuffer=e.readBuffer),Object(Y.g)(i,{framebuffer:r.outputBuffer},function(){return n._renderPass(r)}),this.props.debug&&r.outputBuffer.log(0,this.id),this.props.swap&&e._swapFramebuffers()}}},{key:"_renderPass",value:function(e){e.gl,e.inputBuffer,e.outputBuffer,e.animationProps}}]),e}(),Pi=function(e){function t(e,n){return Object(m.a)(this,t),n=Array.isArray(n)?{passes:n}:n,Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:"composite-pass"},n)))}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"render",value:function(){var e=this.props.passes,t=void 0===e?[]:e,n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.render.apply(s,arguments)}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}}]),t}(Si),Ai=function(){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(m.a)(this,e),this.gl=t,this.framebuffer1=new Ie(t,{id:"multi-pass-1",stencil:!0}),this.framebuffer2=new Ie(t,{id:"multi-pass-2",stencil:!0}),this.reset()}return Object(L.a)(e,[{key:"reset",value:function(){this.framebuffer1.resize(),this.framebuffer2.resize(),this.writeBuffer=this.framebuffer1,this.readBuffer=this.framebuffer2,this.maskActive=!1}},{key:"_swapFramebuffers",value:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}}]),e}(),Ti=function(e){function t(e,n){var i;return Object(m.a)(this,t),n=Array.isArray(n)?{passes:n}:n,(i=Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:"multi-pass"},n)))).renderState=new Ai(e,n),i}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"render",value:function(e){this.renderState.reset();var t=this.props.passes,n=void 0===t?[]:t,i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.render(this.renderState,e)}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return this}}]),t}(Pi),Ci=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:"clear-pass"},n)))}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_renderPass",value:function(e){var t=e.gl,n=this.props.clearBits,i=void 0===n?16640:n;t.clear(i)}}]),t}(Si),ji=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:"render-pass"},n)))}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_renderPass",value:function(e){var t=e.animationProps,n=this.props,i=n.models,r=void 0===i?[]:i,a=n.drawParams,o=!0,s=!1,c=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){u.value.draw(Object.assign({},a,{animationProps:t}))}}catch(e){s=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}}}]),t}(Si),Mi={x:[2,0,1],y:[0,1,2],z:[1,2,0]},Ri=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);for(var n=e.bottomRadius,i=void 0===n?0:n,r=e.topRadius,a=void 0===r?0:r,o=e.height,s=void 0===o?1:o,c=e.nradial,u=void 0===c?10:c,l=e.nvertical,h=void 0===l?10:l,d=e.verticalAxis,f=void 0===d?"y":d,g=e.topCap,p=void 0!==g&&g,v=e.bottomCap,_=void 0!==v&&v,b=(p?2:0)+(_?2:0),y=(u+1)*(h+1+b),x=Math.atan2(i-a,s),E=Math.sin,w=Math.cos,O=Math.PI,S=w(x),P=E(x),A=p?-2:0,T=h+(_?2:0),C=u+1,j=new Float32Array(3*y),M=new Float32Array(3*y),R=new Float32Array(2*y),L=new Uint16Array(u*(h+b)*6),I=Mi[f],F=0,k=0,N=A;N<=T;N++){var D=N/h,B=s*D,U=void 0;N<0?(B=0,D=1,U=i):N>h?(B=s,D=1,U=a):U=i+N/h*(a-i),-2!==N&&N!==h+2||(U=0,D=0),B-=s/2;for(var z=0;z<C;z++){var G=E(z*O*2/u),V=w(z*O*2/u);j[F+I[0]]=G*U,j[F+I[1]]=B,j[F+I[2]]=V*U,M[F+I[0]]=N<0||N>h?0:G*S,M[F+I[1]]=N<0?-1:N>h?1:P,M[F+I[2]]=N<0||N>h?0:V*S,R[k+0]=z/u,R[k+1]=D,k+=2,F+=3}}for(var W=0;W<h+b;W++)for(var H=0;H<u;H++){var X=6*(W*u+H);L[X+0]=C*(W+0)+0+H,L[X+1]=C*(W+0)+1+H,L[X+2]=C*(W+1)+1+H,L[X+3]=C*(W+0)+0+H,L[X+4]=C*(W+1)+1+H,L[X+5]=C*(W+1)+0+H}return Object(ie.a)(this,Object(re.a)(t).call(this,Object.assign({},e,{attributes:{positions:j,normals:M,texCoords:R,indices:L}})))}return Object(ae.a)(t,e),t}(Vt),Li=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);var n=e.radius,i=void 0===n?1:n,r=e.cap,a=void 0===r||r;return Object(ie.a)(this,Object(re.a)(t).call(this,Object.assign({},e,{topRadius:0,topCap:Boolean(a),bottomCap:Boolean(a),bottomRadius:i})))}return Object(ae.a)(t,e),t}(Ri),Ii=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);var n=e.id,i=void 0===n?Object(h.i)("cube-geometry"):n;return Object(ie.a)(this,Object(re.a)(t).call(this,Object.assign({},e,{id:i,attributes:{indices:new Uint16Array(Fi),positions:new Float32Array(ki),normals:new Float32Array(Ni),texCoords:new Float32Array(Di)}})))}return Object(ae.a)(t,e),t}(Vt),Fi=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),ki=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Ni=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Di=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]);var Bi=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);var n=e.radius,i=void 0===n?1:n;return Object(ie.a)(this,Object(re.a)(t).call(this,Object.assign({},e,{bottomRadius:i,topRadius:i})))}return Object(ae.a)(t,e),t}(Ri),Ui=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],zi=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],Gi=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);var n=e.iterations,i=void 0===n?0:n,r=Math.PI,a=2*r,o=Ui.concat(),s=zi.concat();o.push(),s.push();for(var c=function(){var e={};return function(t,n){var i=(t*=3)>(n*=3)?t:n,r="".concat(t<n?t:n,"|").concat(i);if(r in e)return e[r];var a=o[t],s=o[t+1],c=o[t+2],u=(a+o[n])/2,l=(s+o[n+1])/2,h=(c+o[n+2])/2,d=Math.sqrt(u*u+l*l+h*h);return u/=d,l/=d,h/=d,o.push(u,l,h),e[r]=o.length/3-1}}(),u=0;u<i;u++){for(var l=[],h=0;h<s.length;h+=3){var d=c(s[h+0],s[h+1]),f=c(s[h+1],s[h+2]),g=c(s[h+2],s[h+0]);l.push(g,s[h+0],d,d,s[h+1],f,f,s[h+2],g,d,f,g)}s=l}for(var p=new Array(3*s.length),v=new Array(2*s.length),_=s.length-3;_>=0;_-=3){var b=s[_+0],y=s[_+1],x=s[_+2],E=3*b,w=3*y,O=3*x,S=2*b,P=2*y,A=2*x,T=o[E+0],C=o[E+1],j=o[E+2],M=Math.acos(j/Math.sqrt(T*T+C*C+j*j))/r,R=1-(Math.atan2(C,T)+r)/a,L=o[w+0],I=o[w+1],F=o[w+2],k=Math.acos(F/Math.sqrt(L*L+I*I+F*F))/r,N=1-(Math.atan2(I,L)+r)/a,D=o[O+0],B=o[O+1],U=o[O+2],z=Math.acos(U/Math.sqrt(D*D+B*B+U*U))/r,G=1-(Math.atan2(B,D)+r)/a,V=[D-L,B-I,U-F],W=[T-L,C-I,j-F],H=new Ft.a(V).cross(W).normalize(),X=void 0;(0===R||0===N||0===G)&&(0===R||R>.5)&&(0===N||N>.5)&&(0===G||G>.5)&&(o.push(o[E+0],o[E+1],o[E+2]),X=o.length/3-1,s.push(X),v[2*X+0]=1,v[2*X+1]=M,p[3*X+0]=H.x,p[3*X+1]=H.y,p[3*X+2]=H.z,o.push(o[w+0],o[w+1],o[w+2]),X=o.length/3-1,s.push(X),v[2*X+0]=1,v[2*X+1]=k,p[3*X+0]=H.x,p[3*X+1]=H.y,p[3*X+2]=H.z,o.push(o[O+0],o[O+1],o[O+2]),X=o.length/3-1,s.push(X),v[2*X+0]=1,v[2*X+1]=z,p[3*X+0]=H.x,p[3*X+1]=H.y,p[3*X+2]=H.z),p[E+0]=p[w+0]=p[O+0]=H.x,p[E+1]=p[w+1]=p[O+1]=H.y,p[E+2]=p[w+2]=p[O+2]=H.z,v[S+0]=R,v[S+1]=M,v[P+0]=N,v[P+1]=k,v[A+0]=G,v[A+1]=z}return Object(ie.a)(this,Object(re.a)(t).call(this,Object.assign({},e,{attributes:{positions:new Float32Array(o),normals:new Float32Array(p),texCoords:new Float32Array(v),indices:new Uint16Array(s)}})))}return Object(ae.a)(t,e),t}(Vt),Vi=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);var n=e.type,i=void 0===n?"x,y":n,r=e.offset,a=void 0===r?0:r,o=e.flipCull,s=void 0!==o&&o,c=e.unpack,u=void 0!==c&&c,l=e.id,d=void 0===l?Object(h.i)("plane-geometry"):l,f=i.split(","),g=e["".concat(f[0],"len")],p=e["".concat(f[1],"len")],v=e["n".concat(f[0])]||1,_=e["n".concat(f[1])]||1,b=(v+1)*(_+1),y=new Float32Array(3*b),x=new Float32Array(3*b),E=new Float32Array(2*b);s&&(g=-g);for(var w=0,O=0,S=0;S<=_;S++)for(var P=0;P<=v;P++){var A=P/v,T=S/_;switch(E[w+0]=s?1-A:A,E[w+1]=T,i){case"x,y":y[O+0]=g*A-.5*g,y[O+1]=p*T-.5*p,y[O+2]=a,x[O+0]=0,x[O+1]=0,x[O+2]=s?1:-1;break;case"x,z":y[O+0]=g*A-.5*g,y[O+1]=a,y[O+2]=p*T-.5*p,x[O+0]=0,x[O+1]=s?1:-1,x[O+2]=0;break;case"y,z":y[O+0]=a,y[O+1]=g*A-.5*g,y[O+2]=p*T-.5*p,x[O+0]=s?1:-1,x[O+1]=0,x[O+2]=0}w+=2,O+=3}for(var C=v+1,j=new Uint16Array(v*_*6),M=0;M<_;M++)for(var R=0;R<v;R++){var L=6*(M*v+R);j[L+0]=(M+0)*C+R,j[L+1]=(M+1)*C+R,j[L+2]=(M+0)*C+R+1,j[L+3]=(M+1)*C+R,j[L+4]=(M+1)*C+R+1,j[L+5]=(M+0)*C+R+1}if(u){for(var I=new Float32Array(3*j.length),F=new Float32Array(3*j.length),k=new Float32Array(2*j.length),N=0;N<j.length;++N){var D=j[N];I[3*N+0]=y[3*D+0],I[3*N+1]=y[3*D+1],I[3*N+2]=y[3*D+2],F[3*N+0]=x[3*D+0],F[3*N+1]=x[3*D+1],F[3*N+2]=x[3*D+2],k[2*N+0]=E[2*D+0],k[2*N+1]=E[2*D+1]}y=I,x=F,E=k,j=void 0}var B={positions:y,normals:x,texCoords:E};return j&&(B.indices=j),Object(ie.a)(this,Object(re.a)(t).call(this,Object.assign({},e,{attributes:B,id:d})))}return Object(ae.a)(t,e),t}(Vt),Wi=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(m.a)(this,t);var n=e.nlat,i=void 0===n?10:n,r=e.nlong,a=void 0===r?10:r,o=e.radius,s=void 0===o?1:o,c=e.id,u=void 0===c?Object(h.i)("sphere-geometry"):c;return Object(ie.a)(this,Object(re.a)(t).call(this,Object.assign({},e,{id:u,attributes:function(e,t,n){var i=Math.PI-0,r=2*Math.PI-0,a=(e+1)*(t+1);if("number"==typeof n){var o=n;n=function(e,t,n,i,r){return o}}for(var s=new Float32Array(3*a),c=new Float32Array(3*a),u=new Float32Array(2*a),l=new Uint16Array(e*t*6),h=0;h<=e;h++)for(var d=0;d<=t;d++){var f=d/t,g=h/e,p=d+h*(t+1),v=2*p,m=3*p,_=r*f,b=i*g,y=Math.sin(_),x=Math.cos(_),E=Math.sin(b),w=Math.cos(b),O=x*E,S=w,P=y*E,A=n(O,S,P,f,g);s[m+0]=A*O,s[m+1]=A*S,s[m+2]=A*P,c[m+0]=O,c[m+1]=S,c[m+2]=P,u[v+0]=f,u[v+1]=g}for(var T=e+1,C=0;C<e;C++)for(var j=0;j<t;j++){var M=6*(C*t+j);l[M+0]=j*T+C,l[M+1]=j*T+C+1,l[M+2]=(j+1)*T+C,l[M+3]=(j+1)*T+C,l[M+4]=j*T+C+1,l[M+5]=(j+1)*T+C+1}return{positions:s,indices:l,normals:c,texCoords:u}}(i,a,s)})))}return Object(ae.a)(t,e),t}(Vt);var Hi=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{geometry:new Li(n)})))}return Object(ae.a)(t,e),t}(si),Xi=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,t);var i=n.id,r=void 0===i?Object(h.i)("cube"):i;return Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{id:r,geometry:new Ii(n)})))}return Object(ae.a)(t,e),t}(si),Yi=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{geometry:new Bi(n)})))}return Object(ae.a)(t,e),t}(si),qi=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{geometry:new Gi(n)})))}return Object(ae.a)(t,e),t}(si),Zi=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,t);var i=n.id,r=void 0===i?Object(h.i)("plane"):i;return Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{id:r,geometry:new Vi(n)})))}return Object(ae.a)(t,e),t}(si),Ki=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,t);var i=n.id,r=void 0===i?Object(h.i)("sphere"):i;return Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{id:r,geometry:new Wi(n)})))}return Object(ae.a)(t,e),t}(si),$i=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{geometry:new Ri(n)})))}return Object(ae.a)(t,e),t}(si),Qi="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",Ji=[-1,-1,1,-1,-1,1,1,1],er=function(e){function t(e,n){var i;Object(m.a)(this,t);var r=Ji.map(function(e){return-1===e?0:e});return(i=Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({},n,{vs:Qi,geometry:new Vt({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(Ji)},aTexCoord:{size:2,value:new Float32Array(r)},aCoordinate:{size:2,value:new Float32Array(r)}}})})))).setVertexCount(4),i}return Object(ae.a)(t,e),t}(si),tr="uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\n\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n",nr=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),(n=Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:"copy-pass",swap:!0},i)))).clipspace=new er(e,{id:"copy-pass",fs:tr}),n}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_renderPass",value:function(e){var t=e.inputBuffer,n=this.props.opacity,i=void 0===n?1:n;this.clipspace.draw({uniforms:{uDiffuseSampler:t,uOpacity:i},parameters:{depthWrite:!1,depthTest:!1}})}}]),t}(Si),ir="uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n",rr=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(m.a)(this,t),n=Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:"texture-pass"},i)));var r=i.texture,a=i.opacity,o=void 0===a?1:a;return n.clipspace=new er(e,{id:"texture-pass",fs:ir,uniforms:{uDiffuseSampler:r,uOpacity:o}}),n}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_renderPass",value:function(){this.clipspace.draw({parameters:{depthWrite:!1,depthTest:!1}})}}]),t}(Si),ar=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:"picking-pass"},n)))}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_renderPass",value:function(e){var t=e.gl,n=e.inputBuffer,i=e.animationProps,r=this.props,a=i?i._mousePosition:r.mousePosition,o=i?i.useDevicePixels:r.useDevicePixels;if(a){var s=hi(t,{models:this.props.models,position:a,useDevicePixels:o,framebuffer:n}),c=!0,u=!1,l=void 0;try{for(var h,d=this.props.models[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var f=h.value;if(s&&s.model===f){var g=s&&s.color||null;f.updateModuleSettings({pickingSelectedColor:g})}}}catch(e){u=!0,l=e}finally{try{c||null==d.return||d.return()}finally{if(u)throw l}}}else{var p=!0,v=!1,m=void 0;try{for(var _,b=this.props.models[Symbol.iterator]();!(p=(_=b.next()).done);p=!0){_.value.updateModuleSettings({pickingSelectedColor:null})}}catch(e){v=!0,m=e}finally{try{p||null==b.return||b.return()}finally{if(v)throw m}}}}}]),t}(Si),or={boolean:{validate:function(e,t){return!0}},number:{validateType:function(e,t){return"value"in t&&(!("max"in t)||Number.isFinite(t.max))&&(!("min"in t)||Number.isFinite(t.min))},validate:function(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}}};function sr(e,t){switch(cr(t)){case"object":return function(e){var t=e.type;(or[t]||{}).typeValidator;return e}(t=function(e,t){if(!("type"in t))return"value"in t?Object.assign({name:e,type:cr(t.value)},t):{name:e,type:"object",value:t};return Object.assign({name:e},t)}(e,t));case"array":return function(e,t){if(/color/i.test(e)&&(3===t.length||4===t.length))return{name:e,type:"color",value:t};return{name:e,type:"array",value:t}}(e,t);case"boolean":return{name:e,type:"boolean",value:t};case"number":return function(e,t){var n=/radius|scale|width|height|pixel|size|miter/i.test(e)&&/^((?!scale).)*$/.test(e)?100:1;return{name:e,type:"number",max:Math.max(t,n),min:Math.min(t,0),value:t}}(e,t);case"function":return{name:e,type:"function",value:t};default:return{name:e,type:"unknown",value:t}}}function cr(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":null===e?"null":Object(ci.a)(e)}function ur(e){if(!e.normalized){if(e.normalized=!0,e.uniforms){var t=function(e){for(var t={},n={},i=Object.entries(e),r=0;r<i.length;r++){var a=Object(me.a)(i[r],2),o=a[0],s=sr(o,a[1]);t[o]=s,n[o]=s.value}return{propTypes:t,defaultProps:n}}(e.uniforms).propTypes;e.uniforms=t}e.uniforms&&!e.getUniforms&&(e.getUniforms=function(e,t){var n={};if(void 0===t){for(var i in e.uniforms)n[i]=e.uniforms[i].value;return n}for(var r in t)n[r]=t[r];return n}.bind(null,e))}return e}var lr=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.a)(this,t),Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({swap:!0},n)))}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_renderPass",value:function(e){var t=e.inputBuffer;e.swapBuffers;this.props.model.setUniforms(this.props),this.props.model.draw({uniforms:{texture:t,texSize:[t.width,t.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),t}(Si),hr=function(e){function t(e,n){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(m.a)(this,t);var a="".concat(n.name,"-pass");ur(n);var o=function(e,t,n,i){if(t.filter||t.sampler){var r=pr(t),a=new lr(e,{id:n,model:dr(e,t,r,n,i),uniforms:null});return[a]}var o=t.passes||[];return o.map(function(r){var a=pr(t,r),s="".concat(n,"-").concat(o.length+1);return new lr(e,Object.assign({id:s,model:dr(e,t,a,s,i),uniforms:r.uniforms},i))})}(e,n,a,r);return(i=Object(ie.a)(this,Object(re.a)(t).call(this,e,Object.assign({id:a,passes:o},r)))).module=n,i}return Object(ae.a)(t,e),Object(L.a)(t,[{key:"_renderPass",value:function(e){var t=e.inputBuffer,n=e.swapBuffers,i=!0,r=!0,a=!1,o=void 0;try{for(var s,c=this.module.passes[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value;i||n(),i=!1,u.uniforms&&u.model.setUniforms(u.uniforms),u.model.draw({uniforms:{texture:t,texSize:[t.width,t.height]},parameters:{depthWrite:!1,depthTest:!1}})}}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}}}]),t}(Pi);function dr(e,t,n,i,r){var a=new er(e,{id:i,fs:n,modules:[t]}),o=Object.assign(t.getUniforms(),t.getUniforms(r));return a.setUniforms(o),a}var fr=function(e){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(e,"(gl_FragColor, texSize, texCoord);\n}\n")},gr=function(e){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(e,"(texture, texSize, texCoord);\n}\n")};function pr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(t.filter){var n="string"==typeof t.filter?t.filter:"".concat(e.name,"_filterColor");return fr(n)}if(t.sampler){var i="string"==typeof t.sampler?t.sampler:"".concat(e.name,"_sampleColor");return gr(i)}return null}n(77);var vr=function(){function e(){if(Object(m.a)(this,e),this.canvas=document.createElement("canvas"),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.gl=V({canvas:this.canvas,opts:{premultipliedAlpha:!1}}),!this.gl)throw new Error("This browser does not support WebGL");this.texture=null,this.spareTexture=null,this.flippedModel=null}return Object(L.a)(e,[{key:"installFiltersAsMethods",value:function(e){var t=this,n=function(n){"canvas"!==n&&(t[n]=function(i){return t.filter(e[n],i).bind(t)})};for(var i in e)n(i)}},{key:"setTexture",value:function(e){return this.texture=new _e.a(this.gl,{pixels:e}),this.resize(this.gl,this.texture.width,this.texture.height),this}},{key:"resize",value:function(e,t,n){if(e.canvas.width!==t||e.canvas.height!==n){e.canvas.width=t,e.canvas.height=n;var i=Math.floor(t/1),r=Math.floor(n/1);e.canvas.style.width="".concat(i,"px"),e.canvas.style.height="".concat(r,"px"),e.viewport(0,0,t,n),this.width=i,this.height=r}}},{key:"replace",value:function(e){return e.parentNode.insertBefore(this.canvas,e),e.parentNode.removeChild(e),this}},{key:"draw",value:function(){return this.multiPassRenderer=new Ti(this.gl,[new Ci(this.gl),new rr(this.gl,{texture:this.texture}),new nr(this.gl,{screen:!0})]),this.multiPassRenderer.render(),this}},{key:"update",value:function(){return this.multiPassRenderer.render({}),this}},{key:"filter",value:function(e,t){return this.multiPassRenderer=new Ti(this.gl,[new Ci(this.gl),new rr(this.gl,{texture:this.texture}),new hr(this.gl,e,t),new nr(this.gl,{screen:!0})]),this.multiPassRenderer.render(),this}},{key:"getPixelArray",value:function(){var e=this.gl,t=this.texture.width,n=this.texture.height,i=new Uint8Array(t*n*4);return this.texture.drawTo(function(){return e.readPixels(0,0,t,n,6408,5121,i)}),i}},{key:"_initialize",value:function(e,t){var n=this.gl,i=5121;if(this.gl.getExtension("OES_texture_float")&&n.getExtension("OES_texture_float_linear")){var r=new _e.a(this.gl,{width:100,height:100,format:6408,type:5126});try{r.drawTo(function(){i=5126})}catch(e){}r.destroy()}this.spareTexture&&this.spareTexture.destroy(),this.width=e,this.height=t,this.texture=new _e.a(this.gl,{width:e,height:t,format:6408,type:i}),this.spareTexture=new _e.a(this.gl,{width:e,height:t,format:6408,type:i}),this.extraTexture=this.extraTexture||new _e.a(this.gl,{width:0,height:0,format:6408,type:i}),this.flippedModel=this.flippedModel||new si(this.gl,{vs:"attribute vec2 vertex;\nattribute vec2 _texCoord;\nvarying vec2 texCoord;\nvoid main() {\n  texCoord = _texCoord;\n  gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\n}\n",fs:"uniform sampler2D texture;\nvarying vec2 texCoord;\nvoid main() {\n  gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\n}\n"}),this.isInitialized=!0}}]),e}();function mr(){}var _r=4,br=function(){function e(t){var n=t.url,i=t.path,r=void 0===i?null:i,a=t.method,o=void 0===a?"GET":a,s=t.asynchronous,c=void 0===s||s,u=t.noCache,l=void 0!==u&&u,h=t.sendAsBinary,d=void 0!==h&&h,f=t.responseType,g=void 0!==f&&f,p=t.onProgress,v=void 0===p?mr:p,_=t.onError,b=void 0===_?mr:_,y=t.onAbort,x=void 0===y?mr:y,E=t.onComplete,w=void 0===E?mr:E;Object(m.a)(this,e),this.url=r?r.join(r,n):n,this.method=o,this.async=c,this.noCache=l,this.sendAsBinary=d,this.responseType=g,this.req=new XMLHttpRequest,this.req.onload=function(e){return w(e)},this.req.onerror=function(e){return b(e)},this.req.onabort=function(e){return x(e)},this.req.onprogress=function(e){e.lengthComputable?v(e,Math.round(e.loaded/e.total*100)):v(e,-1)}}return Object(L.a)(e,[{key:"setRequestHeader",value:function(e,t){return this.req.setRequestHeader(e,t),this}},{key:"sendAsync",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.body||null;return new Promise(function(n,i){try{var r=e.req,a=e.method,o=e.noCache,s=e.sendAsBinary,c=e.responseType,u=o?e.url+(e.url.indexOf("?")>=0?"&":"?")+Date.now():e.url;r.open(a,u,e.async),c&&(r.responseType=c),e.async&&(r.onreadystatechange=function(e){r.readyState===_r&&(200===r.status?n(r.responseType?r.response:r.responseText):i(new Error("".concat(r.status,": ").concat(u))))}),s?r.sendAsBinary(t):r.send(t),e.async||(200===r.status?n(r.responseType?r.response:r.responseText):i(new Error("".concat(r.status,": ").concat(u))))}catch(e){i(e)}})}}]),e}();function yr(e){return new br(e).sendAsync()}var xr="";function Er(e){xr=e}function wr(e,t){return"string"==typeof e||t||(e=(t=e).url),t.url=xr?xr+e:e,yr(t)}function Or(e,t){return e=xr?xr+e:e,"undefined"==typeof Image?yr({url:e=new URL(e,location.pathname).href,responseType:"arraybuffer"}).then(function(e){var t=new Blob([new Uint8Array(e)]);return createImageBitmap(t)}):new Promise(function(n,i){try{var r=new Image;r.onload=function(){return n(r)},r.onerror=function(){return i(new Error("Could not load image ".concat(e,".")))},r.crossOrigin=t&&t.crossOrigin||"anonymous",r.src=e}catch(e){i(e)}})}function Sr(){}function Pr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(k.a)("string"==typeof t,"loadTexture: url must be string"),Or(t,n).then(function(i){return new _e.a(e,Object.assign({id:t},n,{data:i}))})}function Ar(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.urls,n=e.onProgress,i=void 0===n?Sr:n;Object(k.a)(t.every(function(e){return"string"==typeof e}),"loadImages: {urls} must be array of strings");var r=0;return Promise.all(t.map(function(n){var a=wr(Object.assign({url:n},e));return a.then(function(e){return i({progress:++r/t.length,count:r,total:t.length,url:n})}),a}))}function Tr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.urls,n=e.onProgress,i=void 0===n?Sr:n;Object(k.a)(t.every(function(e){return"string"==typeof e}),"loadImages: {urls} must be array of strings");var r=0;return Promise.all(t.map(function(n){var a=Or(n,e);return a.then(function(e){return i({progress:++r/t.length,count:r,total:t.length,url:n})}),a}))}function Cr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.urls,i=t.onProgress,r=void 0===i?Sr:i;return Object(k.a)(n.every(function(e){return"string"==typeof e}),"loadTextures: {urls} must be array of strings"),Tr(Object.assign({urls:n,onProgress:r},t)).then(function(i){return i.map(function(i,r){return new _e.a(e,Object.assign({id:n[r]},t,{data:i}))})})}function jr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.vs,i=t.fs,r=t.onProgress,a=void 0===r?Sr:r;return Ar(Object.assign({urls:[n,i],onProgress:a},t)).then(function(n){var i=Object(me.a)(n,2),r=i[0],a=i[1];return new vt(e,Object.assign({vs:r,fs:a},t))})}function Mr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.url,i=t.onProgress,r=void 0===i?Sr:i;return Ar(Object.assign({urls:[n],onProgress:r},t)).then(function(n){var i=Object(me.a)(n,1)[0];return Rr(e,Object.assign({file:i},t))})}function Rr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.file,i=t.program,r=void 0===i?new vt(e):i,a="string"==typeof n?function(e){try{return JSON.parse(e)}catch(e){throw new Error("Failed to parse JSON: ".concat(e))}}(n):n,o={},s={};for(var c in a){var u=a[c];Array.isArray(u)?o[c]="indices"===c?new Uint16Array(u):new Float32Array(u):s[c]=u}return new si(e,Object.assign({program:r,geometry:new Vt({attributes:o})},s,t))}var Lr="uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n",Ir={name:"pbr",vs:"varying vec3 pbr_vPosition;\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n# else\nvarying vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = u_ModelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else\n  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"#extension GL_EXT_shader_texture_lod: enable\n#extension GL_OES_standard_derivatives : enable\n\nprecision highp float;\n\nuniform vec3 u_LightDirection;\nuniform vec3 u_LightColor;\n\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nuniform vec3 u_Camera;\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\nuniform vec4 u_ScaleIBLAmbient;\n\nvarying vec3 pbr_vPosition;\n\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n#else\nvarying vec3 pbr_vNormal;\n#endif\n#endif\n\n\nstruct PBRInfo\n{\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float LdotH;\n  float VdotH;\n  float perceptualRoughness;\n  float metalness;\n  vec3 reflectance0;\n  vec3 reflectance90;\n  float alphaRoughness;\n  vec3 diffuseColor;\n  vec3 specularColor;\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n  #ifdef MANUAL_SRGB\n  #ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n  #else\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n  #endif\n  return vec4(linOut,srgbIn.w);;\n  #else\n  return srgbIn;\n  #endif\n}\n\nvec3 getNormal()\n{\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0;\n  float lod = (pbrInputs.perceptualRoughness * mipCount);\n  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,\n    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(textureCubeLodEXT(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n  diffuse *= u_ScaleIBLAmbient.x;\n  specular *= u_ScaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n\nvec3 diffuse(PBRInfo pbrInputs)\n{\n  return pbrInputs.diffuseColor / M_PI;\n}\n\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n  return pbrInputs.reflectance0 +\n    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *\n    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\n\n\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n  float NdotL = pbrInputs.NdotL;\n  float NdotV = pbrInputs.NdotV;\n  float r = pbrInputs.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n\n\n\n\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n\n\n  float perceptualRoughness = u_MetallicRoughnessValues.y;\n  float metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n\n  vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);\n  perceptualRoughness = mrSample.g * perceptualRoughness;\n  metallic = mrSample.b * metallic;\n#endif\n  perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n  metallic = clamp(metallic, 0.0, 1.0);\n\n  float alphaRoughness = perceptualRoughness * perceptualRoughness;\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\n  vec4 baseColor = u_BaseColorFactor;\n#endif\n\n  vec3 f0 = vec3(0.04);\n  vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n  diffuseColor *= 1.0 - metallic;\n  vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n  float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n\n\n  float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n  vec3 specularEnvironmentR0 = specularColor.rgb;\n  vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n  vec3 n = getNormal();\n  vec3 v = normalize(u_Camera - pbr_vPosition);\n  vec3 l = normalize(u_LightDirection);\n  vec3 h = normalize(l+v);\n  vec3 reflection = -normalize(reflect(v, n));\n\n  float NdotL = clamp(dot(n, l), 0.001, 1.0);\n  float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n  float NdotH = clamp(dot(n, h), 0.0, 1.0);\n  float LdotH = clamp(dot(l, h), 0.0, 1.0);\n  float VdotH = clamp(dot(v, h), 0.0, 1.0);\n\n  PBRInfo pbrInputs = PBRInfo(\n    NdotL,\n    NdotV,\n    NdotH,\n    LdotH,\n    VdotH,\n    perceptualRoughness,\n    metallic,\n    specularEnvironmentR0,\n    specularEnvironmentR90,\n    alphaRoughness,\n    diffuseColor,\n    specularColor\n  );\n  vec3 F = specularReflection(pbrInputs);\n  float G = geometricOcclusion(pbrInputs);\n  float D = microfacetDistribution(pbrInputs);\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n  vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);\n  vec3 color = NdotL * u_LightColor * (diffuseContrib + specContrib);\n#ifdef USE_IBL\n  color += getIBLContribution(pbrInputs, n, reflection);\n#endif\n#ifdef HAS_OCCLUSIONMAP\n  float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;\n  color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n  vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\n  color += emissive;\n#endif\n\n  color = mix(color, F, u_ScaleFGDSpec.x);\n  color = mix(color, vec3(G), u_ScaleFGDSpec.y);\n  color = mix(color, vec3(D), u_ScaleFGDSpec.z);\n  color = mix(color, specContrib, u_ScaleFGDSpec.w);\n\n  color = mix(color, diffuseContrib, u_ScaleDiffBaseMR.x);\n  color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\n  color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\n  color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",dependencies:[{name:"project2",vs:Lr,fs:Lr}]},Fr=n(28),kr=n(45),Nr=n(54),Dr=n(55);n.d(t,"isWebGL",function(){return i.c}),n.d(t,"isWebGL2",function(){return i.d}),n.d(t,"cloneTextureFrom",function(){return r.a}),n.d(t,"getKeyValue",function(){return a.b}),n.d(t,"getKey",function(){return a.a}),n.d(t,"createGLContext",function(){return V}),n.d(t,"destroyGLContext",function(){return W}),n.d(t,"resizeGLContext",function(){return H}),n.d(t,"pollGLContext",function(){return X}),n.d(t,"setContextDefaults",function(){return G}),n.d(t,"trackContextState",function(){return v.a}),n.d(t,"resetParameters",function(){return Y.d}),n.d(t,"getParameter",function(){return Y.b}),n.d(t,"getParameters",function(){return Y.c}),n.d(t,"setParameter",function(){return Y.e}),n.d(t,"setParameters",function(){return Y.f}),n.d(t,"withParameters",function(){return Y.g}),n.d(t,"getModifiedParameters",function(){return Y.a}),n.d(t,"getContextInfo",function(){return M}),n.d(t,"getGLContextInfo",function(){return T}),n.d(t,"getContextLimits",function(){return A}),n.d(t,"glGetDebugInfo",function(){return R}),n.d(t,"FEATURES",function(){return Z}),n.d(t,"hasFeature",function(){return J}),n.d(t,"hasFeatures",function(){return ee}),n.d(t,"getFeatures",function(){return te}),n.d(t,"canCompileGLGSExtension",function(){return $}),n.d(t,"Buffer",function(){return ne.a}),n.d(t,"Shader",function(){return le}),n.d(t,"VertexShader",function(){return he}),n.d(t,"FragmentShader",function(){return de}),n.d(t,"Program",function(){return vt}),n.d(t,"Framebuffer",function(){return Ie}),n.d(t,"Renderbuffer",function(){return xe}),n.d(t,"Texture2D",function(){return _e.a}),n.d(t,"TextureCube",function(){return mt.a}),n.d(t,"clear",function(){return je}),n.d(t,"clearBuffer",function(){return Me}),n.d(t,"FenceSync",function(){return _t}),n.d(t,"Query",function(){return yt}),n.d(t,"Sampler",function(){return ke}),n.d(t,"Texture3D",function(){return xt.a}),n.d(t,"Texture2DArray",function(){return Et}),n.d(t,"TransformFeedback",function(){return wt}),n.d(t,"VertexArrayObject",function(){return Ct}),n.d(t,"VertexArray",function(){return jt}),n.d(t,"UniformBufferLayout",function(){return It}),n.d(t,"_Accessor",function(){return Qe.a}),n.d(t,"_clearBuffer",function(){return Me}),n.d(t,"Object3D",function(){return Nt}),n.d(t,"Group",function(){return Bt}),n.d(t,"Model",function(){return si}),n.d(t,"AnimationLoop",function(){return li}),n.d(t,"pickModels",function(){return hi}),n.d(t,"encodePickingColor",function(){return fi}),n.d(t,"decodePickingColor",function(){return gi}),n.d(t,"getNullPickingColor",function(){return pi}),n.d(t,"Transform",function(){return Ei}),n.d(t,"_Attribute",function(){return Ut}),n.d(t,"_ShaderCache",function(){return wi}),n.d(t,"_AnimationLoopProxy",function(){return Oi}),n.d(t,"_MultiPassRenderer",function(){return Ti}),n.d(t,"_RenderState",function(){return Ai}),n.d(t,"_Pass",function(){return Si}),n.d(t,"_CompositePass",function(){return Pi}),n.d(t,"_ClearPass",function(){return Ci}),n.d(t,"_RenderPass",function(){return ji}),n.d(t,"_CopyPass",function(){return nr}),n.d(t,"_TexturePass",function(){return rr}),n.d(t,"_PickingPass",function(){return ar}),n.d(t,"_ShaderModulePass",function(){return hr}),n.d(t,"_Canvas",function(){return vr}),n.d(t,"Geometry",function(){return Vt}),n.d(t,"ConeGeometry",function(){return Li}),n.d(t,"CubeGeometry",function(){return Ii}),n.d(t,"CylinderGeometry",function(){return Bi}),n.d(t,"IcoSphereGeometry",function(){return Gi}),n.d(t,"PlaneGeometry",function(){return Vi}),n.d(t,"SphereGeometry",function(){return Wi}),n.d(t,"TruncatedConeGeometry",function(){return Ri}),n.d(t,"Cone",function(){return Hi}),n.d(t,"Cube",function(){return Xi}),n.d(t,"Cylinder",function(){return Yi}),n.d(t,"IcoSphere",function(){return qi}),n.d(t,"Plane",function(){return Zi}),n.d(t,"Sphere",function(){return Ki}),n.d(t,"TruncatedCone",function(){return $i}),n.d(t,"ClipSpace",function(){return er}),n.d(t,"setPathPrefix",function(){return Er}),n.d(t,"loadFile",function(){return wr}),n.d(t,"loadImage",function(){return Or}),n.d(t,"loadTexture",function(){return Pr}),n.d(t,"loadFiles",function(){return Ar}),n.d(t,"loadImages",function(){return Tr}),n.d(t,"loadTextures",function(){return Cr}),n.d(t,"loadProgram",function(){return jr}),n.d(t,"loadModel",function(){return Mr}),n.d(t,"parseModel",function(){return Rr}),n.d(t,"setDefaultShaderModules",function(){return Qt}),n.d(t,"registerShaderModules",function(){return Jt}),n.d(t,"assembleShaders",function(){return Pn}),n.d(t,"normalizeShaderModule",function(){return ur}),n.d(t,"fp32",function(){return Tn}),n.d(t,"fp64",function(){return Ln}),n.d(t,"project",function(){return Nn}),n.d(t,"lighting",function(){return Dn}),n.d(t,"dirlight",function(){return Un}),n.d(t,"picking",function(){return Gn}),n.d(t,"diffuse",function(){return Wn}),n.d(t,"pbr",function(){return Ir}),n.d(t,"assert",function(){return k.a}),n.d(t,"log",function(){return Fr.a}),n.d(t,"global",function(){return _.b}),n.d(t,"window",function(){return _.d}),n.d(t,"document",function(){return _.a}),n.d(t,"self",function(){return _.c}),n.d(t,"isBrowser",function(){return kr.a}),n.d(t,"isOldIE",function(){return Nr.a}),n.d(t,"stubRemovedMethods",function(){return Dr.a}),n.d(t,"makeDebugContext",function(){return y}),n.d(t,"ClipSpaceQuad",function(){return er}),n.d(t,"glGet",function(){return a.c}),n.d(t,"glKey",function(){return a.d}),n.d(t,"glKeyType",function(){return a.e}),n(63)},function(e,t,n){"use strict";var i=n(24),r=n(44);function a(e){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function o(e){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}var s=35632,c=35633;function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",n=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:t}function l(e,t,n,i){for(var r=e.split(/\r?\n/),a={},o={},l=i||u(t)||"(unnamed)",f="".concat(function(e){switch(e){case s:return"fragment";case c:return"vertex";default:return"unknown type"}}(n)," shader ").concat(l),g=0;g<r.length;g++){var p=r[g];if(!(p.length<=1)){var v=p.split(":"),m=v[0],_=parseInt(v[2],10);if(isNaN(_))throw new Error("GLSL compilation error in ".concat(f,": ").concat(e));"WARNING"!==m?a[_]=p:o[_]=p}}var b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ",i=e.split(/\r?\n/),r=String(i.length+t-1).length;return i.map(function(e,i){var a=i+t,o=String(a).length,s=d(a,r-o);return s+n+e})}(t);return{shaderName:f,errors:h(a,b),warnings:h(o,b)}}function h(e,t){for(var n="",i=0;i<t.length;i++){var r=t[i];if((e[i+3]||e[i+2]||e[i+1])&&(n+="".concat(r,"\n"),e[i+1])){var a=e[i+1],o=a.split(":",3),s=o[0],c=parseInt(o[1],10)||0,u=a.substring(o.join(":").length+1).trim();n+=d("^^^ ".concat(s,": ").concat(u,"\n\n"),c)}}return n}function d(e,t){for(var n="",i=0;i<t;++i)n+=" ";return"".concat(n).concat(e)}var f=n(29),g=n(25);function p(e){var t=100,n=e.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){var i=parseInt(n[1],10);Number.isFinite(i)&&(t=i)}return t}var v=n(53);n.d(t,"c",function(){return i.c}),n.d(t,"a",function(){return i.a}),n.d(t,"b",function(){return i.b}),n.d(t,"m",function(){return r.c}),n.d(t,"n",function(){return r.d}),n.d(t,"e",function(){return r.b}),n.d(t,"d",function(){return r.a}),n.d(t,"p",function(){return a}),n.d(t,"f",function(){return o}),n.d(t,"o",function(){return l}),n.d(t,"k",function(){return u}),n.d(t,"h",function(){return f.a}),n.d(t,"q",function(){return f.d}),n.d(t,"j",function(){return g.b}),n.d(t,"i",function(){return g.a}),n.d(t,"l",function(){return p}),n.d(t,"g",function(){return v.a})},function(e,t,n){e.exports=n(83)},function(e,t,n){"use strict";function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(19),r=n(15);function a(e,t){return!t||"object"!==Object(i.a)(t)&&"function"!=typeof t?Object(r.a)(e):t}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(59);function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Object(i.a)(e,t)}},function(e,t,n){"use strict";n.d(t,"p",function(){return r}),n.d(t,"e",function(){return a}),n.d(t,"a",function(){return o}),n.d(t,"g",function(){return s}),n.d(t,"o",function(){return c}),n.d(t,"n",function(){return u}),n.d(t,"j",function(){return l}),n.d(t,"k",function(){return h}),n.d(t,"l",function(){return d}),n.d(t,"m",function(){return f}),n.d(t,"c",function(){return g}),n.d(t,"d",function(){return p}),n.d(t,"i",function(){return v}),n.d(t,"h",function(){return m}),n.d(t,"f",function(){return _}),n.d(t,"b",function(){return b});var i=n(13);function r(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=r,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function a(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],c=t[6],u=t[7],l=t[8],h=t[9],d=t[10],f=t[11],g=t[12],p=t[13],v=t[14],m=t[15],_=n*s-i*o,b=n*c-r*o,y=n*u-a*o,x=i*c-r*s,E=i*u-a*s,w=r*u-a*c,O=l*p-h*g,S=l*v-d*g,P=l*m-f*g,A=h*v-d*p,T=h*m-f*p,C=d*m-f*v,j=_*C-b*T+y*A+x*P-E*S+w*O;return j?(j=1/j,e[0]=(s*C-c*T+u*A)*j,e[1]=(r*T-i*C-a*A)*j,e[2]=(p*w-v*E+m*x)*j,e[3]=(d*E-h*w-f*x)*j,e[4]=(c*P-o*C-u*S)*j,e[5]=(n*C-r*P+a*S)*j,e[6]=(v*y-g*w-m*b)*j,e[7]=(l*w-d*y+f*b)*j,e[8]=(o*T-s*P+u*O)*j,e[9]=(i*P-n*T-a*O)*j,e[10]=(g*E-p*y+m*_)*j,e[11]=(h*y-l*E-f*_)*j,e[12]=(s*S-o*A-c*O)*j,e[13]=(n*A-i*S+r*O)*j,e[14]=(p*b-g*x-v*_)*j,e[15]=(l*x-h*b+d*_)*j,e):null}function o(e){var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],c=e[7],u=e[8],l=e[9],h=e[10],d=e[11],f=e[12],g=e[13],p=e[14],v=e[15];return(t*o-n*a)*(h*v-d*p)-(t*s-i*a)*(l*v-d*g)+(t*c-r*a)*(l*p-h*g)+(n*s-i*o)*(u*v-d*f)-(n*c-r*o)*(u*p-h*f)+(i*c-r*s)*(u*g-l*f)}function s(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],h=t[8],d=t[9],f=t[10],g=t[11],p=t[12],v=t[13],m=t[14],_=t[15],b=n[0],y=n[1],x=n[2],E=n[3];return e[0]=b*i+y*s+x*h+E*p,e[1]=b*r+y*c+x*d+E*v,e[2]=b*a+y*u+x*f+E*m,e[3]=b*o+y*l+x*g+E*_,b=n[4],y=n[5],x=n[6],E=n[7],e[4]=b*i+y*s+x*h+E*p,e[5]=b*r+y*c+x*d+E*v,e[6]=b*a+y*u+x*f+E*m,e[7]=b*o+y*l+x*g+E*_,b=n[8],y=n[9],x=n[10],E=n[11],e[8]=b*i+y*s+x*h+E*p,e[9]=b*r+y*c+x*d+E*v,e[10]=b*a+y*u+x*f+E*m,e[11]=b*o+y*l+x*g+E*_,b=n[12],y=n[13],x=n[14],E=n[15],e[12]=b*i+y*s+x*h+E*p,e[13]=b*r+y*c+x*d+E*v,e[14]=b*a+y*u+x*f+E*m,e[15]=b*o+y*l+x*g+E*_,e}function c(e,t,n){var i,r,a,o,s,c,u,l,h,d,f,g,p=n[0],v=n[1],m=n[2];return t===e?(e[12]=t[0]*p+t[4]*v+t[8]*m+t[12],e[13]=t[1]*p+t[5]*v+t[9]*m+t[13],e[14]=t[2]*p+t[6]*v+t[10]*m+t[14],e[15]=t[3]*p+t[7]*v+t[11]*m+t[15]):(i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],h=t[8],d=t[9],f=t[10],g=t[11],e[0]=i,e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=c,e[6]=u,e[7]=l,e[8]=h,e[9]=d,e[10]=f,e[11]=g,e[12]=i*p+s*v+h*m+t[12],e[13]=r*p+c*v+d*m+t[13],e[14]=a*p+u*v+f*m+t[14],e[15]=o*p+l*v+g*m+t[15]),e}function u(e,t,n){var i=n[0],r=n[1],a=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function l(e,t,n,r){var a,o,s,c,u,l,h,d,f,g,p,v,m,_,b,y,x,E,w,O,S,P,A,T,C=r[0],j=r[1],M=r[2],R=Math.sqrt(C*C+j*j+M*M);return R<i.b?null:(C*=R=1/R,j*=R,M*=R,a=Math.sin(n),s=1-(o=Math.cos(n)),c=t[0],u=t[1],l=t[2],h=t[3],d=t[4],f=t[5],g=t[6],p=t[7],v=t[8],m=t[9],_=t[10],b=t[11],y=C*C*s+o,x=j*C*s+M*a,E=M*C*s-j*a,w=C*j*s-M*a,O=j*j*s+o,S=M*j*s+C*a,P=C*M*s+j*a,A=j*M*s-C*a,T=M*M*s+o,e[0]=c*y+d*x+v*E,e[1]=u*y+f*x+m*E,e[2]=l*y+g*x+_*E,e[3]=h*y+p*x+b*E,e[4]=c*w+d*O+v*S,e[5]=u*w+f*O+m*S,e[6]=l*w+g*O+_*S,e[7]=h*w+p*O+b*S,e[8]=c*P+d*A+v*T,e[9]=u*P+f*A+m*T,e[10]=l*P+g*A+_*T,e[11]=h*P+p*A+b*T,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function h(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[4],o=t[5],s=t[6],c=t[7],u=t[8],l=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+u*i,e[5]=o*r+l*i,e[6]=s*r+h*i,e[7]=c*r+d*i,e[8]=u*r-a*i,e[9]=l*r-o*i,e[10]=h*r-s*i,e[11]=d*r-c*i,e}function d(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],u=t[8],l=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-u*i,e[1]=o*r-l*i,e[2]=s*r-h*i,e[3]=c*r-d*i,e[8]=a*i+u*r,e[9]=o*i+l*r,e[10]=s*i+h*r,e[11]=c*i+d*r,e}function f(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],u=t[4],l=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+u*i,e[1]=o*r+l*i,e[2]=s*r+h*i,e[3]=c*r+d*i,e[4]=u*r-a*i,e[5]=l*r-o*i,e[6]=h*r-s*i,e[7]=d*r-c*i,e}function g(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=n+n,s=i+i,c=r+r,u=n*o,l=i*o,h=i*s,d=r*o,f=r*s,g=r*c,p=a*o,v=a*s,m=a*c;return e[0]=1-h-g,e[1]=l+m,e[2]=d-v,e[3]=0,e[4]=l-m,e[5]=1-u-g,e[6]=f+p,e[7]=0,e[8]=d+v,e[9]=f-p,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function p(e,t,n,i,r,a,o){var s=1/(n-t),c=1/(r-i),u=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*c,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(r+i)*c,e[10]=(o+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*u,e[15]=0,e}function v(e,t,n,i,r){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(a=1/(i-r),e[10]=(r+i)*a,e[14]=2*r*i*a):(e[10]=-1,e[14]=-2*i),e}function m(e,t,n,i,r,a,o){var s=1/(t-n),c=1/(i-r),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*c,e[14]=(o+a)*u,e[15]=1,e}function _(e,t,n,r){var a,o,s,c,u,l,h,d,f,g,p=t[0],v=t[1],m=t[2],_=r[0],b=r[1],y=r[2],x=n[0],E=n[1],w=n[2];return Math.abs(p-x)<i.b&&Math.abs(v-E)<i.b&&Math.abs(m-w)<i.b?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(h=p-x,d=v-E,f=m-w,a=b*(f*=g=1/Math.sqrt(h*h+d*d+f*f))-y*(d*=g),o=y*(h*=g)-_*f,s=_*d-b*h,(g=Math.sqrt(a*a+o*o+s*s))?(a*=g=1/g,o*=g,s*=g):(a=0,o=0,s=0),c=d*s-f*o,u=f*a-h*s,l=h*o-d*a,(g=Math.sqrt(c*c+u*u+l*l))?(c*=g=1/g,u*=g,l*=g):(c=0,u=0,l=0),e[0]=a,e[1]=c,e[2]=h,e[3]=0,e[4]=o,e[5]=u,e[6]=d,e[7]=0,e[8]=s,e[9]=l,e[10]=f,e[11]=0,e[12]=-(a*p+o*v+s*m),e[13]=-(c*p+u*v+l*m),e[14]=-(h*p+d*v+f*m),e[15]=1,e)}function b(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],c=e[5],u=e[6],l=e[7],h=e[8],d=e[9],f=e[10],g=e[11],p=e[12],v=e[13],m=e[14],_=e[15],b=t[0],y=t[1],x=t[2],E=t[3],w=t[4],O=t[5],S=t[6],P=t[7],A=t[8],T=t[9],C=t[10],j=t[11],M=t[12],R=t[13],L=t[14],I=t[15];return Math.abs(n-b)<=i.b*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(r-y)<=i.b*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-x)<=i.b*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-E)<=i.b*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-w)<=i.b*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(c-O)<=i.b*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(u-S)<=i.b*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-P)<=i.b*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(h-A)<=i.b*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-T)<=i.b*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(f-C)<=i.b*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(g-j)<=i.b*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(p-M)<=i.b*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(v-R)<=i.b*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(m-L)<=i.b*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(_-I)<=i.b*Math.max(1,Math.abs(_),Math.abs(I))}},function(e,t,n){"use strict";n.r(t);var i=n(47),r=new(n(90).a)({id:"deck"}).enable();if(i.a.deck&&"6.4.10"!==i.a.deck.VERSION)throw new Error(`deck.gl - multiple versions detected: ${i.a.deck.VERSION} vs 6.4.10`);i.a.deck||(r.log(0,"deck.gl 6.4.10 - set deck.log.priority=1 (or higher) to trace attribute updates")(),i.a.deck=i.a.deck||{VERSION:"6.4.10",version:"6.4.10",log:r}),console.table||(console.table=(()=>{}));var a=n(5);const o={LNG_LAT:1,LNGLAT_AUTO_OFFSET:4,METER_OFFSETS:2,LNGLAT_OFFSETS:3,IDENTITY:0};var s=`${Object.keys(o).map(e=>`const float COORDINATE_SYSTEM_${e} = ${o[e]}.;`).join("")}\n\nuniform float project_uCoordinateSystem;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uPixelsPerMeter;\nuniform vec3 project_uPixelsPerDegree;\nuniform vec3 project_uPixelsPerUnit;\nuniform vec3 project_uPixelsPerUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec2 project_coordinate_origin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\n\n//\n// Scaling offsets - scales meters to "pixels"\n// Note the scalar version of project_scale is for scaling the z component only\n//\nfloat project_scale(float meters) {\n  return meters * project_uPixelsPerMeter.z;\n}\n\nvec2 project_scale(vec2 meters) {\n  return meters * project_uPixelsPerMeter.xy;\n}\n\nvec3 project_scale(vec3 meters) {\n  return meters * project_uPixelsPerMeter;\n}\n\nvec4 project_scale(vec4 meters) {\n  return vec4(meters.xyz * project_uPixelsPerMeter, meters.w);\n}\n\n//\n// Projecting normal - transform deltas from current coordinate system to\n// normals in the worldspace\n//\nvec3 project_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uPixelsPerDegree);\n  }\n  // Apply model matrix\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uPixelsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 pixelsPerUnit = project_uPixelsPerUnit + project_uPixelsPerUnit2 * dy;\n  return vec4(offset.xyz * pixelsPerUnit, offset.w);\n}\n\n//\n// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]\n//\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\n//\n// Projects lnglats (or meter offsets, depending on mode) to pixels\n//\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  // TODO - why not simply subtract center and fall through?\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT) {\n    return project_uModelMatrix * vec4(\n      project_mercator_(position.xy) * WORLD_SCALE * project_uScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.\n    float X = position.x - project_coordinate_origin.x;\n    float Y = position.y - project_coordinate_origin.y;\n    return project_offset_(vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w));\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return project_offset_(position);\n  }\n\n  // METER_OFFSETS or IDENTITY\n  // Apply model matrix\n  vec4 position_modelspace = project_uModelMatrix * position;\n  return project_offset_(position_modelspace);\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec3 project_position(vec3 position, vec2 position64xyLow) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64xyLow);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xy;\n}\n\n//\n// Projects from "world" coordinates to clip space.\n// Uses project_uViewProjectionMatrix\n//\nvec4 project_to_clipspace(vec4 position) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_METER_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    // Needs to be divided with project_uPixelsPerMeter\n    position.w *= project_uPixelsPerMeter.z;\n  }\n  return project_uViewProjectionMatrix * position + project_uCenter;\n}\n\n// Returns a clip space offset that corresponds to a given number of **non-device** pixels\nvec4 project_pixel_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return vec4(offset * project_uFocalDistance, 0.0, 0.0);\n}\n`,c=n(11),u=n(32);const l={LNGLAT:1,LNGLAT_EXPERIMENTAL:1,LNGLAT_DEPRECATED:5,METER_OFFSETS:2,METERS:2,LNGLAT_OFFSETS:3,IDENTITY:0},h={panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};function d(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function f(e){let t,n={};return i=>{for(const r in i)if(!d(i[r],n[r])){t=e(i),n=i;break}return t}}function g(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}const p=[0,0,0,0],v=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0,0],b=[0,0,0],y=12,x=f(function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i,wrapLongitude:r}){const a=e.zoom,{projectionCenter:s,viewProjectionMatrix:h,cameraPos:d,shaderCoordinateSystem:f,shaderCoordinateOrigin:m}=function({viewport:e,coordinateSystem:t,coordinateOrigin:n,coordinateZoom:i}){const{viewMatrixUncentered:r}=e;let{viewMatrix:a}=e;const{projectionMatrix:s}=e;let h,{viewProjectionMatrix:d}=e,f=function(e){switch(e){case l.LNGLAT:case l.LNGLAT_EXPERIMENTAL:default:return o.LNGLAT_AUTO_OFFSET;case l.LNGLAT_DEPRECATED:return o.LNG_LAT;case l.METER_OFFSETS:case l.METERS:return o.METER_OFFSETS;case l.LNGLAT_OFFSETS:return o.LNGLAT_OFFSETS;case l.IDENTITY:return o.IDENTITY}}(t),g=n;if(f===o.LNGLAT_AUTO_OFFSET)if(i<y)f=o.LNG_LAT;else{const t=Math.fround(e.longitude),n=Math.fround(e.latitude);g=[t,n]}switch(f){case o.IDENTITY:case o.LNG_LAT:h=p;break;case o.LNGLAT_OFFSETS:case o.METER_OFFSETS:case o.LNGLAT_AUTO_OFFSET:const t=e.projectFlat(g,Math.pow(2,i));h=u.c([],[t[0],t[1],0,1],d),a=r||a,d=c.g([],s,a),d=c.g([],d,v);break;default:throw new Error("Unknown projection mode")}return{viewMatrix:a,viewProjectionMatrix:d,projectionCenter:h,cameraPos:e.cameraPosition,shaderCoordinateSystem:f,shaderCoordinateOrigin:g}}({coordinateSystem:n,coordinateOrigin:i,coordinateZoom:a,viewport:e});g(h,"Viewport missing modelViewProjectionMatrix");const b=e.getDistanceScales(),x=[e.width*t,e.height*t],E={project_uCoordinateSystem:f,project_uCenter:s,project_uWrapLongitude:r,project_uAntimeridian:(e.longitude||0)-180,project_uViewportSize:x,project_uDevicePixelRatio:t,project_uFocalDistance:e.focalDistance||1,project_uPixelsPerMeter:b.pixelsPerMeter,project_uPixelsPerDegree:b.pixelsPerDegree,project_uPixelsPerUnit:b.pixelsPerMeter,project_uPixelsPerUnit2:_,project_uScale:e.scale,project_uViewProjectionMatrix:h,project_uCameraPosition:d},w=e.getDistanceScales(m);switch(f){case o.METER_OFFSETS:E.project_uPixelsPerUnit=w.pixelsPerMeter,E.project_uPixelsPerUnit2=w.pixelsPerMeter2;break;case o.LNGLAT_AUTO_OFFSET:E.project_coordinate_origin=m;case o.LNGLAT_OFFSETS:E.project_uPixelsPerUnit=w.pixelsPerDegree,E.project_uPixelsPerUnit2=w.pixelsPerDegree2}return E});const E={};var w={name:"project",dependencies:[a.fp32],vs:s,getUniforms:function(e=E){return e.viewport?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=l.LNGLAT,coordinateOrigin:a=b,wrapLongitude:o=!1,projectionMode:s,positionOrigin:c}={}){return g(e),void 0!==s&&r.removed("projectionMode","coordinateSystem")(),void 0!==c&&r.removed("positionOrigin","coordinateOrigin")(),Object.assign({project_uModelMatrix:n||m},x({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:a,wrapLongitude:o}))}(e):{}},deprecations:[{type:"uniform vec3",old:"selectedPickingColor",new:"luma.gl's picking module"},{type:"uniform float",old:"renderPickingBuffer",new:"luma.gl's picking module"},{type:"uniform float",old:"pickingEnabled",new:"luma.gl's picking module"},{type:"uniform float",old:"projectionMode",new:"project_uCoordinateSystem"},{type:"uniform vec4",old:"projectionCenter",new:"project_uCenter"},{type:"uniform vec2",old:"projectionOrigin"},{type:"uniform mat4",old:"modelMatrix",new:"project_uModelMatrix"},{type:"uniform mat4",old:"viewMatrix"},{type:"uniform mat4",old:"projectionMatrix",new:"project_uViewProjectionMatrix"},{type:"uniform vec3",old:"projectionPixelsPerUnit",new:"project_uPixelsPerUnit"},{type:"uniform float",old:"projectionScale",new:"project_uScale"},{type:"uniform vec2",old:"viewportSize",new:"project_uViewportSize"},{type:"uniform float",old:"devicePixelRatio",new:"project_uDevicePixelRatio"},{type:"uniform vec3",old:"cameraPos",new:"project_uCameraPosition"},{type:"function",old:"scale",new:"project_scale"},{type:"function",old:"preproject",new:"project_position"},{type:"function",old:"project",new:"project_to_clipspace"}]};var O={name:"project32",dependencies:[w],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 worldPosition\n) {\n  vec3 projectedPosition = project_position(position, position64xyLow);\n  worldPosition = vec4(projectedPosition + offset, 1.0);\n  return project_to_clipspace(worldPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 worldPosition;\n  return project_position_to_clipspace(position, position64xyLow, offset, worldPosition);\n}\n"};const{fp64ify:S,fp64ifyMatrix4:P}=a.fp64;var A={name:"project64",dependencies:[w,a.fp64],vs:"\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 project64_uScale;\nuniform vec2 project_uViewProjectionMatrixFP64[16];\n\n// longitude: lnglat_fp64.xy; latitude: lnglat_fp64.zw\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sub_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], project64_uScale);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], project64_uScale);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\n  vec4 position64xy = vec4(\n    position.x, position64xyLow.x,\n    position.y, position64xyLow.y);\n\n  project_position_fp64(position64xy, out_val);\n}\n\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\n    vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 worldPosition\n) {\n  // This is the local offset to the instance position\n  vec2 offset64[4];\n  vec4_fp64(vec4(offset, 0.0), offset64);\n\n  float z = project_scale(position.z);\n\n  // Apply web mercator projection (depends on coordinate system imn use)\n  vec2 projectedPosition64xy[2];\n  project_position_fp64(position.xy, position64xyLow, projectedPosition64xy);\n\n  vec2 worldPosition64[4];\n  worldPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\n  worldPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\n  worldPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\n  worldPosition64[3] = vec2(1.0, 0.0);\n\n  worldPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\n\n  return project_to_clipspace_fp64(worldPosition64);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 worldPosition;\n  return project_position_to_clipspace(\n    position, position64xyLow, offset, worldPosition\n  );\n}\n",getUniforms:function(e=T,t={}){const{project_uViewProjectionMatrix:n,project_uScale:i}=t;if(n&&i)return C({project_uViewProjectionMatrix:n,project_uScale:i});return{}},deprecations:[{type:"uniform vec2",old:"projectionFP64[16]",new:"project_uViewProjectionMatrixFP64"},{type:"uniform vec2",old:"projectionScaleFP64",new:"project64_uScale"}]};const T={},C=f(function({project_uViewProjectionMatrix:e,project_uScale:t}){const n=P(e),i=S(t);return{project_uViewProjectionMatrixFP64:n,project64_uViewProjectionMatrix:n,project64_uScale:i}});var j=n(35),M=n(14);function R(e,t){var n=u.c([],t,e);return u.b(n,n,1/n[3]),n}function L(e,t){var n=e%t;return n<0?t+n:n}function I(e,t,n){return n*t+(1-n)*e}var F=n(26);function k(e){if(!e)throw new Error("viewport-mercator-project: assertion failed.")}var N=Math.PI,D=N/4,B=N/180,U=180/N,z=512,G=4003e4,V=1.5;function W(e){return Math.pow(2,e)}function H(e){return Math.log2(e)}function X(e,t){var n=Object(M.a)(e,2),i=n[0],r=n[1]*B;return[(t*=z)*(i*B+N)/(2*N),t*(N-Math.log(Math.tan(D+.5*r)))/(2*N)]}function Y(e,t){var n=Object(M.a)(e,2),i=n[0],r=n[1],a=i/(t*=z)*(2*N)-N,o=2*(Math.atan(Math.exp(N-r/t*(2*N)))-D);return[a*U,o*U]}function q(e){var t=e.latitude,n=e.longitude,i=e.zoom,r=e.scale,a=e.highPrecision,o=void 0!==a&&a;r=void 0!==r?r:W(i),k(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(r));var s={},c=z*r,u=Math.cos(t*B),l=c/360,h=l/u,d=c/G/u;if(s.pixelsPerMeter=[d,-d,d],s.metersPerPixel=[1/d,-1/d,1/d],s.pixelsPerDegree=[l,-h,d],s.degreesPerPixel=[1/l,-1/h,1/d],o){var f=B*Math.tan(t*B)/u,g=l*f/2,p=c/G*f,v=p/h*d;s.pixelsPerDegree2=[0,-g,p],s.pixelsPerMeter2=[v,0,v]}return s}function Z(e,t){var n=Object(M.a)(e,3),i=n[0],r=n[1],a=n[2],o=Object(M.a)(t,3),s=o[0],c=o[1],u=o[2],l=q({longitude:i,latitude:r,scale:1,highPrecision:!0}),h=l.pixelsPerMeter,d=l.pixelsPerMeter2,f=X(e,1);f[0]+=s*(h[0]+d[0]*c),f[1]+=c*(h[1]+d[1]*c);var g=Y(f,1),p=(a||0)+(u||0);return Number.isFinite(a)||Number.isFinite(u)?[g[0],g[1],p]:g}function K(e){var t=e.height,n=e.pitch,i=e.bearing,r=e.altitude,a=e.center,o=void 0===a?null:a,s=e.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return c.o(l,l,[0,0,-r]),c.n(l,l,[1,1,1/t]),c.k(l,l,-n*B),c.m(l,l,i*B),u&&c.n(l,l,[1,-1,1]),o&&c.o(l,l,j.d([],o)),l}function $(e){var t=e.width,n=e.height,i=e.altitude,r=void 0===i?V:i,a=e.pitch,o=void 0===a?0:a,s=e.nearZMultiplier,c=void 0===s?1:s,u=e.farZMultiplier,l=void 0===u?1:u,h=o*B,d=Math.atan(.5/r),f=Math.sin(d)*r/Math.sin(Math.PI/2-h-d),g=Math.cos(Math.PI/2-h)*f+r;return{fov:2*Math.atan(n/2/r),aspect:t/n,focalDistance:r,near:c,far:g*l}}function Q(e,t){var n=Object(M.a)(e,3),i=n[0],r=n[1],a=n[2],o=void 0===a?0:a;return k(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(o)),R(t,[i,r,o,1])}function J(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Object(M.a)(e,3),r=i[0],a=i[1],o=i[2];if(k(Number.isFinite(r)&&Number.isFinite(a)),Number.isFinite(o))return R(t,[r,a,o,1]);var s=R(t,[r,a,0,1]),c=R(t,[r,a,1,1]),u=s[2],l=c[2],h=u===l?0:((n||0)-u)/(l-u);return F.d([],s,c,h)}function ee(e,t,n=!1){const[i,r,a=0]=e,[o,s]=t.projectFlat(e);return[o,s,a*(n?q({longitude:i,latitude:r,scale:t.scale}):t.getDistanceScales()).pixelsPerMeter[2]]}function te(e,{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:a}){let[o,s,c]=e;switch(n&&([o,s,c]=u.c([],[o,s,c,1],n)),i){case l.LNGLAT:case l.LNGLAT_DEPRECATED:return ee([o,s,c],t,a);case l.LNGLAT_OFFSETS:return ee([o+r[0],s+r[1],c+(r[2]||0)],t,a);case l.METER_OFFSETS:return ee(Z(r,[o,s,c]),t,a);case l.IDENTITY:default:return[o,s,c]}}function ne(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:a,fromCoordinateSystem:o,fromCoordinateOrigin:s}=function(e){const t=Object.assign({},e),{viewport:n,coordinateSystem:i,coordinateOrigin:r,fromCoordinateSystem:a,fromCoordinateOrigin:o}=e;return void 0===a&&(t.fromCoordinateSystem=i),void 0===o&&(t.fromCoordinateOrigin=r),i===l.LNGLAT&&n.zoom>=y&&(t.coordinateSystem=l.LNGLAT_OFFSETS,t.coordinateOrigin=[Math.fround(n.longitude),Math.fround(n.latitude)]),t}(t);switch(i){case l.LNGLAT_OFFSETS:case l.METER_OFFSETS:{const t=te(e,{viewport:n,modelMatrix:a,coordinateSystem:o,coordinateOrigin:s,offsetMode:!0}),i=ee(r,n,!0);return j.h(t,t,i),t}case l.LNGLAT:case l.LNGLAT_DEPRECATED:case l.IDENTITY:default:return te(e,{viewport:n,modelMatrix:a,coordinateSystem:o,coordinateOrigin:s,offsetMode:!1})}}var ie={name:"lighting",dependencies:[w],vs:"#define MAX_NUM_OF_LIGHTS 5\n\n// TODO these should be using lighting_ prefix\nuniform vec3 lighting_lightPositions[MAX_NUM_OF_LIGHTS];\nuniform vec2 lighting_lightStrengths[MAX_NUM_OF_LIGHTS];\nuniform float lighting_ambientRatio;\nuniform float lighting_diffuseRatio;\nuniform float lighting_specularRatio;\nuniform int lighting_numberOfLights;\n\nfloat lighting_getLightWeight(vec3 position_worldspace_vec3, vec3 normals_worldspace) {\n  float lightWeight = 0.0;\n\n  vec3 normals_worldspace_vec3 = normals_worldspace.xyz;\n\n  vec3 camera_pos_worldspace = project_uCameraPosition;\n  vec3 view_direction = normalize(camera_pos_worldspace - position_worldspace_vec3);\n\n  for (int i = 0; i < MAX_NUM_OF_LIGHTS; i++) {\n    if (i >= lighting_numberOfLights) {\n      break;\n    }\n    vec3 light_position_worldspace = lighting_lightPositions[i];\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace_vec3);\n\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normals_worldspace_vec3);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normals_worldspace_vec3, halfway_direction), 0.0);\n      specular = pow(specular_angle, 32.0);\n    }\n    lambertian = max(lambertian, 0.0);\n    lightWeight += (lighting_ambientRatio + lambertian * lighting_diffuseRatio + specular * lighting_specularRatio) *\n      lighting_lightStrengths[i].x;\n  }\n\n  return lightWeight;\n}\n\n// DEPRECATED - Backwards compatibility\n\nfloat getLightWeight(vec3 position_worldspace_vec3, vec3 normals_worldspace) {\n  return lighting_getLightWeight(position_worldspace_vec3, normals_worldspace);\n}\n",getUniforms:function(e=re){if(!e.lightSettings)return{};const{coordinateSystem:t,coordinateOrigin:n,lightSettings:{numberOfLights:i=1,lightsPosition:r=ae,lightsStrength:a=oe,coordinateSystem:o,coordinateOrigin:s,modelMatrix:c=null,ambientRatio:u=se,diffuseRatio:l=ce,specularRatio:h=ue}}=e;return{lighting_lightPositions:le({lightsPosition:r,numberOfLights:i,viewport:e.viewport,modelMatrix:c,coordinateSystem:t,coordinateOrigin:n,fromCoordinateSystem:o,fromCoordinateOrigin:s}),lighting_lightStrengths:a,lighting_ambientRatio:u,lighting_diffuseRatio:l,lighting_specularRatio:h,lighting_numberOfLights:i}},deprecations:[{type:"function",old:"getLightWeight",new:"lighting_getLightWeight",deprecated:!0}]};const re={},ae=[-122.45,37.75,8e3],oe=[2,0],se=.4,ce=.6,ue=.8,le=f(function({lightsPosition:e,numberOfLights:t,viewport:n,modelMatrix:i,coordinateSystem:r,coordinateOrigin:a,fromCoordinateSystem:o,fromCoordinateOrigin:s}){const c={viewport:n,modelMatrix:i,coordinateSystem:r,coordinateOrigin:a,fromCoordinateSystem:o,fromCoordinateOrigin:s},u=[];for(let n=0;n<t;n++){const t=ne(e.slice(3*n,3*n+3),c);u[3*n]=t[0],u[3*n+1]=t[1],u[3*n+2]=t[2]}return u});Object(a.registerShaderModules)([a.fp32,a.fp64,w,O,A,ie,a.picking]),Object(a.setDefaultShaderModules)([w]);var he=n(21),de=n.n(he),fe=n(7),ge=n.n(fe);const pe={isExternalBuffer:!1,needsUpdate:!0,needsRedraw:!1,allocedInstances:-1};class ve extends a._Attribute{constructor(e,t={}){super(e,t);const{transition:n=!1,noAlloc:i=!1,update:r=null,accessor:a=null,bufferLayout:o=null}=t;let{defaultValue:s=[0,0,0,0]}=t;s=Array.isArray(s)?s:[s],Object.assign(this.userData,pe,t,{transition:n,noAlloc:i,update:r,accessor:a,defaultValue:s,bufferLayout:o}),Object.seal(this.userData),this._validateAttributeUpdaters()}get bufferLayout(){return this.userData.bufferLayout}set bufferLayout(e){this.userData.bufferLayout=e}needsUpdate(){return this.userData.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.userData.needsRedraw;return this.userData.needsRedraw=this.userData.needsRedraw&&!e,t}getInstanceCount(){return null!==this.value?this.value.length/this.size:0}getUpdateTriggers(){const{accessor:e}=this.userData;return[this.id].concat(e||[])}getAccessor(){return this.userData.accessor}supportsTransition(){return this.userData.transition}getTransitionSetting(e){const{transition:t,accessor:n}=this.userData;if(!t)return null;let i=Array.isArray(n)?e[n.find(t=>e[t])]:e[n];return Number.isFinite(i)&&(i={duration:i}),i&&i.duration>0?Object.assign({},t,i):null}setNeedsUpdate(e=this.id){this.userData.needsUpdate=this.userData.needsUpdate||e}setNeedsRedraw(e=this.id){this.userData.needsRedraw=this.userData.needsRedraw||e}allocate(e){const t=this.userData;if(t.isExternalBuffer||t.noAlloc)return!1;const n=this.getInstanceCount();if((0===n||n<e)&&(t.update||t.accessor)){g(Number.isFinite(e));const n=Math.max(e,1),i=me(this.type||ge.a.FLOAT);return this.constant=!1,this.value=new i(this.size*n),t.needsUpdate=!0,t.allocedInstances=n,!0}return!1}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const r=this.userData,{update:a,accessor:o}=r;let s=!0;return a?(a.call(i,this,{data:t,props:n,numInstances:e}),this.update({value:this.value,constant:this.constant}),this._checkAttributeArray()):o?(this._updateBufferViaStandardAccessor(t,n),this._checkAttributeArray()):s=!1,r.needsUpdate=!1,r.needsRedraw=!0,s}setGenericValue(e){const t=this.userData;if(void 0===e||"function"==typeof e)return t.isExternalBuffer=!1,!1;e=this._normalizeValue(e);const n=!this.constant||!this._areValuesEqual(e,this.value);return n&&this.update({constant:!0,value:e}),t.needsRedraw=t.needsUpdate||n,t.needsUpdate=!1,t.isExternalBuffer=!0,!0}setExternalBuffer(e,t){const n=this.userData;if(e){if(n.isExternalBuffer=!0,n.needsUpdate=!1,e instanceof a.Buffer)this.externalBuffer!==e&&(this.update({constant:!1,buffer:e}),n.needsRedraw=!0);else if(this.value!==e){if(!ArrayBuffer.isView(e))throw new Error("Attribute prop must be typed array");if(n.auto&&e.length<=t*this.size)throw new Error("Attribute prop array must match length and size");const i=me(this.type||ge.a.FLOAT);e instanceof i?this.update({constant:!1,value:e}):(r.warn(`Attribute prop ${this.id} is casted to ${i.name}`)(),this.update({constant:!1,value:new i(e)})),this.value=e,n.needsRedraw=!0}return!0}return n.isExternalBuffer=!1,!1}_normalizeValue(e,t=[],n=0){const{defaultValue:i}=this.userData;if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return t[n]=Number.isFinite(e)?e:i[0],t;switch(this.size){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0]}return t}_areValuesEqual(e,t,n=this.size){for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_updateBufferViaStandardAccessor(e,t){const n=this.userData,{accessor:i}=n,{value:r,size:a}=this,o=t[i];g("function"==typeof o,`accessor "${i}" is not a function`);let s=0;for(const t of e){const e=o(t);this._normalizeValue(e,r,s),s+=a}this.update({value:r})}_validateAttributeUpdaters(){const e=this.userData;if(!(e.noAlloc||"function"==typeof e.update||"string"==typeof e.accessor))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this;if(e&&e.length>=4){if(!(Number.isFinite(e[0])&&Number.isFinite(e[1])&&Number.isFinite(e[2])&&Number.isFinite(e[3])))throw new Error(`Illegal attribute generated for ${this.id}`)}}}function me(e,{clamped:t=!0}={}){switch(e){case ge.a.FLOAT:return Float32Array;case ge.a.UNSIGNED_SHORT:case ge.a.UNSIGNED_SHORT_5_6_5:case ge.a.UNSIGNED_SHORT_4_4_4_4:case ge.a.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case ge.a.UNSIGNED_INT:return Uint32Array;case ge.a.UNSIGNED_BYTE:return t?Uint8ClampedArray:Uint8Array;case ge.a.BYTE:return Int8Array;case ge.a.SHORT:return Int16Array;case ge.a.INT:return Int32Array;default:throw new Error("Failed to deduce type from array")}}function _e({source:e,target:t,start:n=0,end:i,getData:r}){i=i||t.length;const a=e.length,o=i-n;if(a>o)return void t.set(e.subarray(0,o),n);if(t.set(e,n),!r)return;let s=a;for(;s<o;){const i=r(s,e);for(let e=0;e<i.length;e++)t[n+s]=i[e],s++}}const be={1:"float",2:"vec2",3:"vec3",4:"vec4"};function ye(e){const t={},n={};for(const i in e){const{fromState:r,toState:a,buffer:o}=e[i];t[`${i}From`]=r,t[`${i}To`]=a,n[`${i}`]=o}return{sourceBuffers:t,feedbackBuffers:n}}function xe({fromState:e,toState:t,fromLength:n,toLength:i,fromBufferLayout:r,toBufferLayout:o,getData:s=(e=>e)}){if(!(r&&o)&&n>=i||!(e instanceof a.Buffer))return;const c=new Float32Array(i),u=e.getData({}),{value:l,buffer:h,size:d,constant:f}=t,g=l||h.getData({}),p=f?(e,t)=>s(l,t):(e,t)=>s(g.subarray(e,e+d),t);!function({source:e,target:t,size:n,getData:i,sourceLayout:r,targetLayout:a}){if(!Array.isArray(a))return _e({source:e,target:t,getData:i}),t;let o=0,s=0;const c=i&&((e,t)=>i(e+s,t)),u=Math.min(r.length,a.length);for(let i=0;i<u;i++){const u=r[i]*n,l=a[i]*n;_e({source:e.subarray(o,o+u),target:t,start:s,end:s+l,getData:c}),o+=u,s+=l}s<t.length&&_e({source:[],target:t,start:s,getData:c})}({source:u,target:c,sourceLayout:r,targetLayout:o,size:t.size,getData:p}),e.setData({data:c})}const Ee={NONE:"none",PENDING:"pending",IN_PROGRESS:"in_progress",ENDED:"ended"};function we(){}class Oe{constructor(e){this._startTime=null,this._state=Ee.NONE,this.duration=1,this.easing=(e=>e),this.onStart=we,this.onUpdate=we,this.onInterrupt=we,this.onEnd=we,Object.assign(this,e)}get state(){return this._state}get inProgress(){return this._state===Ee.PENDING||this._state===Ee.IN_PROGRESS}start(e){this.inProgress&&this.onInterrupt(this),Object.assign(this,e),this._setState(Ee.PENDING)}cancel(){this.inProgress&&(this.onInterrupt(this),this._setState(Ee.NONE))}update(e){if(this.state===Ee.PENDING&&(this._startTime=e,this._setState(Ee.IN_PROGRESS)),this.state===Ee.IN_PROGRESS){let t=!1,n=(e-this._startTime)/this.duration;return n>=1&&(n=1,t=!0),this.time=this.easing(n),this.onUpdate(this),t&&this._setState(Ee.ENDED),!0}return!1}_setState(e){if(this._state!==e)switch(this._state=e,e){case Ee.PENDING:this.onStart(this);break;case Ee.ENDED:this.onEnd(this)}}}const Se=()=>{},Pe={duration:0,easing:e=>e,onStart:Se,onEnd:Se,onInterrupt:Se};class Ae{constructor(e,{id:t}){this.id=t,this.gl=e,this.attributeTransitions={},this.needsRedraw=!1,this.transform=null,this.numInstances=0,a.Transform.isSupported(e)?this.isSupported=!0:e&&r.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}finalize(){this.transform&&this.transform.delete();for(const e in this.attributeTransitions)this._removeTransition(e)}update({attributes:e,transitions:t={},numInstances:n}){if(this.opts=t,this.numInstances=n||1,!this.isSupported)return;const{attributeTransitions:i}=this,r={};for(const t in e){this._updateAttribute(t,e[t])&&(r[t]=i[t])}for(const t in i){const n=e[t];n&&n.supportsTransition()||this._removeTransition(t)}if(this.transform){if(this.transform){const{sourceBuffers:e,feedbackBuffers:t}=ye(r);this.transform.update({elementCount:this.numInstances,sourceBuffers:e,feedbackBuffers:t})}}else this._createModel()}hasAttribute(e){return e in this.attributeTransitions}getAttributes(){const e={};for(const t in this.attributeTransitions){const n=this.attributeTransitions[t];n.buffer&&(e[t]=n.attributeInTransition)}return e}setCurrentTime(e){if(!this.transform||0===this.numInstances)return!1;const t={};let n=this.needsRedraw;this.needsRedraw=!1;for(const i in this.attributeTransitions){const r=this.attributeTransitions[i];r.update(e)&&(t[`${i}Time`]=r.time,n=!0)}return n&&this.transform.run({uniforms:t}),n}_createTransition(e,t){let n=this.attributeTransitions[e];return n?null:(n=new Oe({name:e,attribute:t,attributeInTransition:new ve(this.gl,t),bufferLayout:t.bufferLayout}),this.attributeTransitions[e]=n,this._invalidateModel(),n)}_removeTransition(e){const t=this.attributeTransitions[e];t&&(t.buffer&&t.buffer.delete(),t._swapBuffer&&t._swapBuffer.delete(),delete this.attributeTransitions[e],this._invalidateModel())}_updateAttribute(e,t){const n=t.getTransitionSetting(this.opts);if(n){let i,r=this.attributeTransitions[e];if(r?i=t.needsRedraw():(r=this._createTransition(e,t),i=!0),i)return this._triggerTransition(r,n),!0}return!1}_invalidateModel(){this.transform&&(this.transform.delete(),this.transform=null)}_createModel(){0!==Object.keys(this.attributeTransitions).length&&(this.transform=new a.Transform(this.gl,Object.assign({elementCount:this.numInstances},ye(this.attributeTransitions),function(e){const t=[],n=[],i=[],r=[],a=[];for(const o in e){const s=e[o],c=be[s.attribute.size];c&&(s.bufferIndex=t.length,t.push(o),n.push(`attribute ${c} ${o}From;`),n.push(`attribute ${c} ${o}To;`),i.push(`uniform float ${o}Time;`),r.push(`varying ${c} ${o};`),a.push(`${o} = mix(${o}From, ${o}To,\n        ${o}Time);`))}return{vs:`\n#define SHADER_NAME feedback-vertex-shader\n${n.join("\n")}\n${i.join("\n")}\n${r.join("\n")}\n\nvoid main(void) {\n  ${a.join("\n")}\n  gl_Position = vec4(0.0);\n}\n`,fs:`#define SHADER_NAME feedback-fragment-shader\n\nprecision highp float;\n\n${r.join("\n")}\n\nvoid main(void) {\n  gl_FragColor = vec4(0.0);\n}\n`,varyings:t}}(this.attributeTransitions))))}_getNextTransitionStates(e,t){const{attribute:n}=e,{size:i}=n;let r;r=n.constant?{constant:!0,value:n.value,size:i}:{constant:!1,buffer:n.getBuffer(),size:i,value:n.externalBuffer?null:n.value};const o=e.buffer||r,s=this.numInstances*i,c=o instanceof a.Buffer&&o.getElementCount()||s;let u=e._swapBuffer;return e._swapBuffer=e.buffer,u?u.getElementCount()<s&&u.setData({data:new Float32Array(s)}):u=new a.Buffer(this.gl,{data:new Float32Array(s),usage:ge.a.DYNAMIC_COPY}),e.attributeInTransition.update({buffer:u}),xe({fromState:o,toState:r,fromLength:c,toLength:s,fromBufferLayout:e.bufferLayout,toBufferLayout:n.bufferLayout,getData:t.enter}),e.bufferLayout=n.bufferLayout,{fromState:o,toState:r,buffer:u}}_triggerTransition(e,t){g(t&&t.duration>0),this.needsRedraw=!0;const n=Object.assign({},Pe,t);e.start(Object.assign({},this._getNextTransitionStates(e,t),n))}}const Te=2,Ce=3;function je(){}const Me={savedMessages:null,timeStart:null,onLog:({level:e,message:t})=>{r.log(e,t)()},onUpdateStart:({level:e,numInstances:t})=>{Me.savedMessages=[],Me.timeStart=new Date},onUpdate:({level:e,message:t})=>{Me.savedMessages&&Me.savedMessages.push(t)},onUpdateEnd:({level:e,id:t,numInstances:n})=>{const i=`${Math.round(new Date-Me.timeStart)}ms`;r.group(e,`Updated attributes for ${n} instances in ${t} in ${i}`,{collapsed:!0})();for(const t of Me.savedMessages)r.log(e,t)();r.groupEnd(e,`Updated attributes for ${n} instances in ${t} in ${i}`)(),Me.savedMessages=null}};class Re{static setDefaultLogFunctions({onLog:e,onUpdateStart:t,onUpdate:n,onUpdateEnd:i}={}){void 0!==e&&(Me.onLog=e||je),void 0!==t&&(Me.onUpdateStart=t||je),void 0!==n&&(Me.onUpdate=n||je),void 0!==i&&(Me.onUpdateEnd=i||je)}constructor(e,{id:t="attribute-manager",stats:n}={}){this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Ae(e,{id:`${t}-transitions`}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw({clearRedrawFlags:e=!1}={}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e,t&&this.id}setNeedsRedraw(e=!0){return this.needsRedraw=!0,this}add(e,t){this._add(e,t)}addInstanced(e,t){this._add(e,t,{instanced:1})}remove(e){for(let t=0;t<e.length;t++){const n=e[t];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}invalidate(e){const t=this._invalidateTrigger(e);Me.onLog({level:Ce,message:`invalidated attributes ${t} (${e}) for ${this.id}`})}invalidateAll(){for(const e in this.attributes)this.attributes[e].setNeedsUpdate();Me.onLog({level:Ce,message:`invalidated all attributes for ${this.id}`})}update({data:e,numInstances:t,transitions:n,props:i={},buffers:r={},context:a={}}={}){let o=!1;Me.onUpdateStart({level:Te,id:this.id,numInstances:t}),this.stats&&this.stats.timeStart("attribute updates",this.id);for(const n in this.attributes){const s=this.attributes[n];s.setExternalBuffer(r[n],this.numInstances)||s.setGenericValue(i[s.getAccessor()])||s.needsUpdate()&&(o=!0,this._updateAttribute({attribute:s,numInstances:t,data:e,props:i,context:a})),this.needsRedraw|=s.needsRedraw()}o&&(this.stats&&this.stats.timeEnd("attribute updates",this.id),Me.onUpdateEnd({level:Te,id:this.id,numInstances:t})),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:n})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.setCurrentTime(Date.now());return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getChangedAttributes({clearChangedFlags:e=!1}){const{attributes:t,attributeTransitionManager:n}=this,i=Object.assign({},n.getAttributes());for(const e in t){const r=t[e];r.needsRedraw({clearChangedFlags:!0})&&(n.hasAttribute(e)||(i[e]=r))}return i}getAccessors(){return this.updateTriggers}_add(e,t,n={}){t&&r.warn("AttributeManager.add({updaters}) - updater map no longer supported")();const i={};for(const t in e){const r=e[t];i[t]=new ve(this.gl,Object.assign({},r,{id:t,constant:r.constant||!1,isIndexed:r.isIndexed||r.elements,size:r.elements?1:r.size,value:r.value||null,instanced:r.instanced||n.instanced}))}Object.assign(this.attributes,i),this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)})}this.updateTriggers=e}_invalidateTrigger(e){const{attributes:t,updateTriggers:n}=this,i=n[e];if(i)i.forEach(e=>{const n=t[e];n&&n.setNeedsUpdate()});else{let n=`invalidating non-existent trigger ${e} for ${this.id}\n`;n+=`Valid triggers: ${Object.keys(t).join(", ")}`,r.warn(n,i)()}return i}_updateAttribute({attribute:e,numInstances:t,data:n,props:i,context:r}){e.allocate(t)&&Me.onUpdate({level:Ce,message:`${e.id} allocated ${t}`,id:this.id});const a=Date.now();if(e.updateBuffer({numInstances:t,data:n,props:i,context:r})){this.needsRedraw=!0;const n=Math.round(Date.now()-a);Me.onUpdate({level:Ce,message:`${e.id} updated ${t} in ${n}ms`})}}}const Le=(e,t,n)=>{e&&(t.length>1?Le(e[t[0]],t.slice(1),n):e[t[0]]=n)},Ie=new Map,Fe=(e,t,n)=>{if(!de.a.isReady())return;Ie.has(e)||Ie.set(e,new Map),Ie.get(e).set(t,n)},ke=e=>{if(!de.a.isReady()||!e.id)return;const t=Ie.get(e.id);t&&t.forEach((t,n)=>{Le(e,n,t),"data"===n[0]&&(e.data=[...e.data])})},Ne=e=>{de.a.isReady()&&de.a.listenFor("deck.gl",e)},De=e=>{de.a.isReady()&&de.a.listenFor("init",e)},Be=e=>{if(!de.a.isReady()||!e)return;const t=[e.constructor.layerName];de.a.listItem("deck.gl",e.id,{badges:t,links:e.state&&e.state.model?[`luma.gl:${e.state.model.id}`]:void 0,parent:e.parent?e.parent.id:void 0})},Ue=e=>{if(!de.a.isReady()||de.a.throttle(`deck.gl:${e.id}`,1e3))return;const t=function(e){const t=[{path:"objects.props",data:e.props}],n=[e.constructor.layerName];if(e.state){if(e.getAttributeManager()){const i=e.getAttributeManager().getAttributes();t.push({path:"objects.attributes",data:i}),n.push(e.getAttributeManager().stats.getTimeString())}if(e.state.model){e.state.model.setProps({timerQueryEnabled:!0});const{lastFrameTime:t}=e.state.model.stats;t&&n.push(`${(1e3*t).toFixed(0)}μs`)}}return t.push({path:"badges",data:n}),t}(e);de.a.multiUpdate("deck.gl",e.id,t)},ze=e=>{de.a.isReady()&&e&&de.a.deleteItem("deck.gl",e)};function Ge(e,t){const n=Ve({newProps:e,oldProps:t,propTypes:He(e),ignoreProps:{data:null,updateTriggers:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";const{dataComparator:n}=e;if(n){if(!n(e.data,t.data))return"Data comparator detected a change"}else if(e.data!==t.data)return"A new data container was supplied";return null}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return"oldProps is null, initial diff";if("all"in e.updateTriggers){const n=We(e,t,"all");if(n)return{all:!0}}const n={};let i=!1;for(const r in e.updateTriggers)if("all"!==r){const a=We(e,t,r);a&&(n[r]=!0,i=n)}return i}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r}}function Ve({newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:r="props"}={}){if(g(void 0!==t&&void 0!==e,"compareProps args"),t===e)return null;if("object"!=typeof e||null===e)return`${r} changed shallowly`;if("object"!=typeof t||null===t)return`${r} changed shallowly`;for(const a in t)if(!(a in n)){if(!(a in e))return`${r}.${a} dropped`;const n=e[a],o=t[a],s=i[a];let c=s&&s.equal;if(c&&!c(n,o,s))return`${r}.${a} changed deeply`;if(!c&&(c=n&&o&&n.equals)&&!c.call(n,o))return`${r}.${a} changed deeply`;if(!c&&o!==n)return`${r}.${a} changed shallowly`}for(const i in e)if(!(i in n||i in t))return`${r}.${i} added: undefined -> ${e[i]}`;return null}function We(e,t,n){let i=e.updateTriggers[n];i=void 0===i||null===i?{}:i;let r=t.updateTriggers[n];return Ve({oldProps:r=void 0===r||null===r?{}:r,newProps:i,triggerName:n})}function He(e){const t=e._component,n=t&&t.constructor;return n?n._propTypes:{}}const Xe="count(): argument not an object",Ye="count(): argument not a container";function qe(e){if(!function(e){return null!==e&&"object"==typeof e}(e))throw new Error(Xe);if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error(Ye)}const Ze={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ke={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>et(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>$e(e,t)},accessor:{validate(e,t){const n=tt(e);return"function"===n||n===tt(t.value)},equal:(e,t,n)=>"function"==typeof t||$e(e,t)},array:{validate:(e,t)=>t.optional&&!e||et(e),equal:(e,t,n)=>n.compare?$e(e,t):e===t},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare||e===t}};function $e(e,t){if(e===t)return!0;if(!et(e)||!et(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Qe(e,t){switch(tt(t)){case"object":return Je(e,t);case"array":return Je(e,{type:"array",value:t,compare:!1});case"boolean":return Je(e,{type:"boolean",value:t});case"number":return Je(e,{type:"number",value:t});case"function":return Je(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Je(e,t){return"type"in t?Object.assign({name:e},Ke[t.type],t):"value"in t?Object.assign({name:e,type:tt(t.value)},t):{name:e,type:"object",value:t}}function et(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function tt(e){return et(e)?"array":null===e?"null":typeof e}function nt(e,t,n){if(t)for(const i in n)if(at(t,i)){const a=`${e||"Layer"}: ${i}`;for(const e of n[i])at(t,e)||(t[e]=t[i]);r.deprecated(a,n[i].join("/"))()}}function it(e){const t=ot(e,"_mergedDefaultProps");return t?{defaultProps:t,propTypes:ot(e,"_propTypes"),deprecatedProps:ot(e,"_deprecatedProps")}:function(e){const t=e.prototype;if(!t)return{defaultProps:{}};const n=Object.getPrototypeOf(e),i=t&&it(n)||null,a=function(e){const t={},n={},i={};for(const[r,a]of Object.entries(e))if(a&&a.deprecatedFor)i[r]=Array.isArray(a.deprecatedFor)?a.deprecatedFor:[a.deprecatedFor];else{const e=Qe(r,a);t[r]=e,n[r]=e.value}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(ot(e,"defaultProps")||{}),o=Object.assign({},i&&i.propTypes,a.propTypes),s=function(e,t,n,i){const a=Object.create(null);Object.assign(a,t,e);const o=function(e){const t=ot(e,"layerName")||ot(e,"componentName");t||r.once(0,`${e.name}.componentName not specified`)();return t||e.name}(i);return delete e.id,Object.defineProperties(a,{id:{configurable:!1,writable:!0,value:o}}),function(e,t){const n={},i={_asyncPropDefaultValues:{enumerable:!1,value:n},_asyncPropOriginalValues:{enumerable:!1,value:{}}};for(const e in t){const r=t[e],{name:a,value:o}=r;r.async&&(n[a]=o,i[a]=rt(a))}Object.defineProperties(e,i)}(a,n),a}(a.defaultProps,i&&i.defaultProps,o,e),c=Object.assign({},i&&i.deprecatedProps,a.deprecatedProps);return e._mergedDefaultProps=s,e._propTypes=o,e._deprecatedProps=c,{propTypes:o,defaultProps:s,deprecatedProps:c}}(e)}function rt(e){return{configurable:!1,enumerable:!0,set(t){"string"==typeof t||t instanceof Promise?this._asyncPropOriginalValues[e]=t:this._asyncPropResolvedValues[e]=t},get(){if(this._asyncPropResolvedValues){if(e in this._asyncPropResolvedValues){const t=this._asyncPropResolvedValues[e];return"data"===e?t||this._asyncPropDefaultValues[e]:t}if(e in this._asyncPropOriginalValues){const t=this._component&&this._component.internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)}}return this._asyncPropDefaultValues[e]}}}function at(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ot(e,t){return at(e,t)&&e[t]}const st=Object.freeze({});class ct{constructor(e=null){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=(()=>{}),this.oldProps=st,this.oldAsyncProps=null}getOldProps(){return this.oldAsyncProps||this.oldProps}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}freezeAsyncOldProps(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps={};for(const e in this.oldProps)this.oldAsyncProps[e]=this.oldProps[e]}}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}setAsyncProps(e){const t=e._asyncPropResolvedValues||{},n=e._asyncPropOriginalValues||e,i=e._asyncPropDefaultValues||{};for(const e in t){const n=t[e];this._createAsyncPropData(e,n,i[e]),this._updateAsyncProp(e,n)}for(const e in n){const t=n[e];this._createAsyncPropData(e,t,i[e]),this._updateAsyncProp(e,t)}}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t){const{fetch:e}=this.layer.props;t=e(t)}t instanceof Promise?this._watchPromise(e,t):this._setPropValue(e,t)}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){const n=this.asyncProps[e];n.value=t,n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&(g(void 0!==t),this.freezeAsyncOldProps(),t=this._postProcessValue(e,t),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(t=>this._setAsyncPropValue(e,t,i)).catch(e=>r.error(e)())}_postProcessValue(e,t){const{dataTransform:n}=this.component?this.component.props:{};return"data"===e&&n&&(t=n(t)),t}_createAsyncPropData(e,t,n){this.asyncProps[e]||(this.asyncProps[e]={lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0})}}let ut=0;class lt{constructor(){this.props=function(){const e=it(this.constructor),t=e.defaultProps,n=Object.create(t,{_component:{enumerable:!1,value:this},_asyncPropOriginalValues:{enumerable:!1,value:{}},_asyncPropResolvedValues:{enumerable:!1,value:{}}});for(let e=0;e<arguments.length;++e)Object.assign(n,arguments[e]);const{layerName:i}=this.constructor,{deprecatedProps:r}=e;return nt(i,n,r),nt(i,n.updateTriggers,r),nt(i,n.transitions,r),ke(n),Object.freeze(n),n}.apply(this,arguments),this.id=this.props.id,this.count=ut++,this.lifecycle=Ze.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}clone(e){const{props:t}=this,n={};for(const e in t._asyncPropDefaultValues)e in t._asyncPropResolvedValues?n[e]=t._asyncPropResolvedValues[e]:e in t._asyncPropOriginalValues&&(n[e]=t._asyncPropOriginalValues[e]);return new this.constructor(Object.assign({},t,n,e))}get stats(){return this.internalState.stats}_initState(){this.internalState=new ct({})}}lt.defaultProps={};class ht extends ct{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.model=null,this.needsRedraw=!0,this.subLayers=null}get layer(){return this.component}set layer(e){this.component=e}}const dt=1,ft=Object.freeze([]);let gt=new Uint8ClampedArray(0);const pt={data:{type:"data",value:ft,async:!0},dataComparator:null,dataTransform:{type:"function",value:e=>e,compare:!1},fetch:{type:"function",value:e=>fetch(e).then(e=>e.json()),compare:!1},updateTriggers:{},numInstances:void 0,visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:.8},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:l.LNGLAT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,parameters:{},uniforms:{},framebuffer:null,animation:null,getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"color",value:[0,0,128,128]}};class vt extends lt{toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(e=!0){this.internalState&&(this.internalState.needsRedraw=e)}setLayerNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this))}getNeedsRedraw({clearRedrawFlags:e=!1}={}){return this._getNeedsRedraw(e)}needsUpdate(){return this.shouldUpdateState(this._getUpdateParams())}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getSingleModel(){return this.state&&this.state.model}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getFirstObject(){const{data:e}=this.props;for(const t of e)return t;return null}project(e){const{viewport:t}=this.context,n=te(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,a]=Q(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,a]}unproject(e){const{viewport:t}=this.context;return g(Array.isArray(e)),t.unproject(e)}projectPosition(e){return g(Array.isArray(e)),ne(e,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}projectFlat(e){r.deprecated("layer.projectFlat","layer.projectPosition")();const{viewport:t}=this.context;return g(Array.isArray(e)),t.projectFlat(e)}unprojectFlat(e){r.deprecated("layer.unprojectFlat")();const{viewport:t}=this.context;return g(Array.isArray(e)),t.unprojectFlat(e)}use64bitProjection(){if(this.props.fp64){if(this.props.coordinateSystem===l.LNGLAT_DEPRECATED)return!0;r.once(0,"Legacy 64-bit mode only works with coordinateSystem set to\n        COORDINATE_SYSTEM.LNGLAT_DEPRECATED. Rendering in 32-bit mode instead")()}return!1}use64bitPositions(){return this.props.fp64||this.props.coordinateSystem===l.LNGLAT}screenToDevicePixels(e){return r.deprecated("screenToDevicePixels","DeckGL prop useDevicePixels for conversion")(),e*("undefined"!=typeof window?window.devicePixelRatio:1)}onHover(e){return!!this.props.onHover&&this.props.onHover(e,this.context.pickingEvent)}onClick(e){return!!this.props.onClick&&this.props.onClick(e,this.context.pickingEvent)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return g(e<16777215,"index out of picking color range"),t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){g(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}initializeState(){throw new Error(`Layer ${this} has not defined initializeState`)}shouldUpdateState({oldProps:e,props:t,context:n,changeFlags:i}){return i.propsOrDataChanged}updateState({oldProps:e,props:t,context:n,changeFlags:i}){const r=this.getAttributeManager();i.dataChanged&&r&&r.invalidateAll()}finalizeState(){for(const e of this.getModels())e.delete();const e=this.getAttributeManager();e&&e.finalize()}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t}){const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}invalidateAttribute(e="all",t=""){const n=this.getAttributeManager();n&&("all"===e?(r.log(dt,`updateTriggers invalidating all attributes: ${t}`)(),n.invalidateAll()):(r.log(dt,`updateTriggers invalidating attribute ${e}: ${t}`)(),n.invalidate(e)))}updateAttributes(e){const t=this.getAttributeManager();if(!t)return;const n=this.getNumInstances(e);t.update({data:e.data,numInstances:n,props:e,transitions:e.transitions,buffers:e,context:this,ignoreUnknownAttributes:!0});const i=this.getSingleModel();if(i){const e=t.getChangedAttributes({clearChangedFlags:!0});i.setAttributes(e)}}updateTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}calculateInstancePickingColors(e,{numInstances:t}){const{value:n,size:i}=e;if(1===n[0])return;const r=gt.length/i;if(r<t){const e=new Uint8ClampedArray(t*i);e.set(gt);const n=[];for(let a=r;a<t;a++)this.encodePickingColor(a,n),e[a*i+0]=n[0],e[a*i+1]=n[1],e[a*i+2]=n[2];gt=e}n.set(t<r?gt.subarray(0,t*i):gt)}_clearInstancePickingColor(e){const{instancePickingColors:t}=this.getAttributeManager().attributes,{value:n,size:i}=t,r=this.decodePickingColor(e);n[r*i+0]=0,n[r*i+1]=0,n[r*i+2]=0,t.update({value:n})}_clearPickingColor(e){const{pickingColors:t}=this.getAttributeManager().attributes,{value:n}=t;for(let t=0;t<n.length;t+=3)n[t+0]===e[0]&&n[t+1]===e[1]&&n[t+2]===e[2]&&(n[t+0]=0,n[t+1]=0,n[t+2]=0);t.update({value:n})}clearPickingColor(e){this.getAttributeManager().attributes.pickingColors?this._clearPickingColor(e):this._clearInstancePickingColor(e)}copyPickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes;return new Uint8ClampedArray((e||t).value)}restorePickingColors(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes;(t||n).update({value:e})}getNumInstances(e){if(void 0!==(e=e||this.props).numInstances)return e.numInstances;if(this.state&&void 0!==this.state.numInstances)return this.state.numInstances;const{data:t}=this.props;return qe(t)}_initialize(){this._initState(),this.initializeState(this.context),this.state.attributeManager=this.getAttributeManager(),this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0}),this._updateState();const e=this.getSingleModel();e&&(e.id=this.props.id,e.program.id=`${this.props.id}-program`,e.geometry.id=`${this.props.id}-geometry`)}_update(){this.needsUpdate()&&this._updateState()}_updateState(){const e=this._getUpdateParams();if(this.context.gl)this.updateState(e);else try{this.updateState(e)}catch(e){}this.isComposite?this._renderLayers(e):(this.setNeedsRedraw(),this.updateAttributes(this.props),this._updateBaseUniforms(),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.clearChangeFlags(),this.internalState.resetOldProps()}_finalize(){g(this.internalState&&this.state),this.finalizeState(this.context),ze(this.id)}drawLayer({moduleParameters:e=null,uniforms:t={},parameters:n={}}){t.picking_uActive||this.updateTransition(),e&&this.setModuleParameters(e);const{animationProps:i}=this.context;if(i)for(const e of this.getModels())e._setAnimationProps(i);const{getPolygonOffset:r}=this.props,o=r&&r(t)||[0,0];n.polygonOffset=o,Object(a.withParameters)(this.context.gl,n,()=>{this.draw({moduleParameters:e,uniforms:t,parameters:n,context:this.context})})}pickLayer(e){return this.getPickingInfo(e)}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(e){this.internalState.changeFlags=this.internalState.changeFlags||{};const t=this.internalState.changeFlags;e.dataChanged&&!t.dataChanged&&(t.dataChanged=e.dataChanged,r.log(dt+1,()=>`dataChanged: ${e.dataChanged} in ${this.id}`)()),e.updateTriggersChanged&&!t.updateTriggersChanged&&(t.updateTriggersChanged=t.updateTriggersChanged&&e.updateTriggersChanged?Object.assign({},e.updateTriggersChanged,t.updateTriggersChanged):e.updateTriggersChanged||t.updateTriggersChanged,r.log(dt+1,()=>"updateTriggersChanged: "+`${Object.keys(e.updateTriggersChanged).join(", ")} in ${this.id}`)()),e.propsChanged&&!t.propsChanged&&(t.propsChanged=e.propsChanged,r.log(dt+1,()=>`propsChanged: ${e.propsChanged} in ${this.id}`)()),e.viewportChanged&&!t.viewportChanged&&(t.viewportChanged=e.viewportChanged,r.log(dt+2,()=>`viewportChanged: ${e.viewportChanged} in ${this.id}`)()),e.stateChanged&&!t.stateChanged&&(t.stateChanged=e.stateChanged,r.log(dt+1,()=>`stateChanged: ${e.stateChanged} in ${this.id}`)());const n=e.dataChanged||e.updateTriggersChanged||e.propsChanged;t.propsOrDataChanged=t.propsOrDataChanged||n,t.somethingChanged=t.somethingChanged||n||e.viewportChanged||e.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}printChangeFlags(){this.internalState.changeFlags}diffProps(e,t){const n=Ge(e,t);if(n.updateTriggersChanged)for(const e in n.updateTriggersChanged)n.updateTriggersChanged[e]&&this._activeUpdateTrigger(e);return this.setChangeFlags(n)}validateProps(){!function(e){const t=He(e);for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e;const n=this.getAttributeManager(),i=n&&n.getNeedsRedraw({clearRedrawFlags:e});return t=t||i}_getAttributeManager(){return new Re(this.context.gl,{id:this.props.id,stats:this.context.stats})}_initState(){g(!this.internalState&&!this.state);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:ge.a.UNSIGNED_BYTE,size:3,update:this.calculateInstancePickingColors}}),this.internalState=new ht({attributeManager:e,layer:this}),this.state={},this.state.attributeManager=e,this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(e){const{state:t,internalState:n}=e;if(g(t&&n),this!==e){this.internalState=n,this.internalState.component=this,this.state=t,t.layer=this,this.internalState.setAsyncProps(this.props);for(const e of this.getModels())e.userData.layer=this;this.diffProps(this.props,this.internalState.getOldProps())}}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setLayerNeedsUpdate()}_activeUpdateTrigger(e){this.invalidateAttribute(e)}_updateBaseUniforms(){const e={opacity:"function"==typeof this.props.opacity?e=>Math.pow(this.props.opacity(e),1/2.2):Math.pow(this.props.opacity,1/2.2)};for(const t of this.getModels())t.setUniforms(e)}setUniforms(e){for(const t of this.getModels())t.setUniforms(e);this.setNeedsRedraw(),r.deprecated("layer.setUniforms","model.setUniforms")()}is64bitEnabled(){return r.deprecated("is64bitEnabled","use64bitProjection")(),this.use64bitProjection()}}vt.layerName="Layer",vt.defaultProps=pt;const mt=2;let _t=0;const bt=({useDevicePixels:e})=>(g("boolean"==typeof e,"Invalid useDevicePixels"),e&&"undefined"!=typeof window?window.devicePixelRatio:1),yt=(e,{viewport:t,pixelRatio:n})=>{const i=e.canvas?e.canvas.clientHeight||e.canvas.height:100,r=t;return[r.x*n,(i-r.y-r.height)*n,r.width*n,r.height*n]};function xt(e,{layers:t,viewports:n,views:i,onViewportActive:o,useDevicePixels:s,drawPickingColors:c=!1,deviceRect:u=null,parameters:l={},layerFilter:h=null,pass:d="draw",redrawReason:f="",stats:g,customRender:p}){p||function(e,{useDevicePixels:t}){const n=e.drawingBufferWidth,i=e.drawingBufferHeight;Object(a.withParameters)(e,{viewport:[0,0,n,i]},()=>{e.clear(ge.a.COLOR_BUFFER_BIT|ge.a.DEPTH_BUFFER_BIT)})}(e,{useDevicePixels:s}),n.forEach((n,p)=>{const v=function(e){return e.viewport?e.viewport:e}(n),m=i&&i[v.id];o(v),function(e,{layers:t,viewport:n,view:i,useDevicePixels:o,drawPickingColors:s=!1,deviceRect:c=null,parameters:u={},layerFilter:l,pass:h="draw",redrawReason:d="",stats:f}){const g=bt({useDevicePixels:o}),p=yt(e,{viewport:n,pixelRatio:g});if(i&&i.props.clear){const t=!0===i.props.clear?{color:!0,depth:!0}:i.props.clear;Object(a.withParameters)(e,{scissorTest:!0,scissor:p},()=>Object(a.clear)(e,t))}const v={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};Object(a.setParameters)(e,u||{}),t.forEach((t,i)=>{let r=!t.isComposite&&t.props.visible;s&&(r=r&&t.props.pickable),r&&l&&(r=l({layer:t,viewport:n,isPicking:s})),r&&t.props.pickable&&v.pickableCount++,t.isComposite&&v.compositeCount++,r&&(v.visibleCount++,function({gl:e,layer:t,layerIndex:n,drawPickingColors:i,pixelRatio:r,glViewport:a,parameters:o}){const s=Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:i?1:0,devicePixelRatio:r}),c=Object.assign({},t.context.uniforms,{layerIndex:n}),u=Object.assign({},t.props.parameters||{},o);Object.assign(u,{viewport:a}),i?Object.assign(u,{blendColor:[0,0,0,(n+1)/255]}):Object.assign(s,function(e){const{highlightedObjectIndex:t,highlightColor:n}=e.props,i={pickingHighlightColor:[n[0],n[1],n[2],n[3]||255]};Number.isInteger(t)&&(i.pickingSelectedColor=t>=0?e.encodePickingColor(t):null);return i}(t));t.drawLayer({moduleParameters:s,uniforms:c,parameters:u})}({gl:e,layer:t,layerIndex:i,drawPickingColors:s,pixelRatio:g,glViewport:p,parameters:u}))}),_t++,function({renderStats:e,pass:t,redrawReason:n,stats:i}){if(r.priority>=mt){const{totalCount:a,visibleCount:o,compositeCount:s,pickableCount:c}=e,u=a-s,l=u-o;let h="";h+=`RENDER #${_t} ${o} (of ${a} layers) to ${t} because ${n} `,r.priority>mt&&(h+=`(${l} hidden, ${s} composite ${c} pickable)`),r.log(mt,h)(),i&&i.increment("redraw layers",o)}}({renderStats:v,pass:h,redrawReason:d,stats:f})}(e,{layers:t,viewport:v,view:m,useDevicePixels:s,drawPickingColors:c,deviceRect:u,parameters:l,layerFilter:h,pass:d,redrawReason:f,stats:g})})}const Et={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function wt(e,{layers:t,viewports:n,x:i,y:r,radius:a,layerFilter:o,depth:s=1,mode:c,onViewportActive:u,pickingFBO:l,lastPickedInfo:h,useDevicePixels:d}){const f=bt({useDevicePixels:d}),g=Math.round(i*f),p=Math.round(e.canvas.height-r*f),v=Math.round(a*f),m=function({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:r}){if(!(e>=0&&t>=0&&e<i&&t<r))return null;const a=Math.max(0,e-n),o=Math.max(0,t-n),s=Math.min(i,e+n)-a+1,c=Math.min(r,t+n)-o+1;return{x:a,y:o,width:s,height:c}}({deviceX:g,deviceY:p,deviceRadius:v,deviceWidth:l.width,deviceHeight:l.height}),_=[],b={};for(let a=0;a<s;a++){const y=m&&St(e,{layers:t,viewports:n,onViewportActive:u,useDevicePixels:d,pickingFBO:l,deviceRect:m,layerFilter:o,redrawReason:c}),x=y&&At(e,{pickedColors:y,layers:t,deviceX:g,deviceY:p,deviceRadius:v,deviceRect:m})||Et;if(x.pickedColor&&a+1<s){const e=x.pickedColor[3]-1;b[e]||(b[e]=t[e].copyPickingColors()),t[e].clearPickingColor(x.pickedColor)}const E=Pt({pickInfo:x,lastPickedInfo:h,mode:c,layers:t,viewports:n,x:i,y:r,deviceX:g,deviceY:p,pixelRatio:f});if(E&&E.forEach(e=>_.push(e)),!x.pickedColor)break}return Object.keys(b).forEach(e=>t[e].restorePickingColors(b[e])),_}function Ot(e,{layers:t,viewports:n,x:i,y:a,width:o,height:s,mode:c,layerFilter:u,onViewportActive:l,pickingFBO:h,useDevicePixels:d}){const f=bt({useDevicePixels:d}),g=Math.round(i*f),p=Math.round(e.canvas.height-a*f),v=Math.round((i+o)*f),m=Math.round(e.canvas.height-(a+s)*f),_=function(e,{pickedColors:t,layers:n}){const i=new Map;if(t)for(let e=0;e<t.length;e+=4){const a=t[e+3]-1;if(a>=0){const o=t.slice(e,e+4),s=o.join(",");if(!i.has(s)){const e=n[a];e?i.set(s,{pickedColor:o,pickedLayer:e,pickedObjectIndex:e.decodePickingColor(o)}):r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}(0,{pickedColors:St(e,{layers:t,viewports:n,onViewportActive:l,pickingFBO:h,useDevicePixels:d,deviceRect:{x:g,y:m,width:v-g,height:p-m},layerFilter:u,redrawReason:c}),layers:t}),b=new Map;return _.forEach(e=>{let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:a,width:o,height:s,pixelRatio:f};t=Tt({layer:e.pickedLayer,info:t,mode:c}),b.has(t.object)||b.set(t.object,t)}),Array.from(b.values())}function St(e,{layers:t,viewports:n,onViewportActive:i,useDevicePixels:r,pickingFBO:o,deviceRect:s,layerFilter:c,redrawReason:u}){if(g(s),g(Number.isFinite(s.width)&&s.width>0,"`width` must be > 0"),g(Number.isFinite(s.height)&&s.height>0,"`height` must be > 0"),t.filter(e=>e.isPickable()).length<1)return null;!function(e,{layers:t,viewports:n,onViewportActive:i,useDevicePixels:r,pickingFBO:o,deviceRect:{x:s,y:c,width:u,height:l},layerFilter:h=null,redrawReason:d=""}){Object(a.withParameters)(e,{framebuffer:o,scissorTest:!0,scissor:[s,c,u,l],clearColor:[0,0,0,0]},()=>{xt(e,{layers:t,viewports:n,onViewportActive:i,useDevicePixels:r,drawPickingColors:!0,layerFilter:h,pass:"picking",redrawReason:d,parameters:{blend:!0,blendFunc:[e.ONE,e.ZERO,e.CONSTANT_ALPHA,e.ZERO],blendEquation:e.FUNC_ADD,blendColor:[0,0,0,0]}})})}(e,{layers:t,viewports:n,onViewportActive:i,useDevicePixels:r,pickingFBO:o,deviceRect:s,layerFilter:c,redrawReason:u});const{x:l,y:h,width:d,height:f}=s,p=new Uint8Array(d*f*4);return o.readPixels({x:l,y:h,width:d,height:f,pixelArray:p}),p}function Pt({pickInfo:e,lastPickedInfo:t,mode:n,layers:i,viewports:r,x:a,y:o,deviceX:s,deviceY:c,pixelRatio:u}){const{pickedColor:l,pickedLayer:h,pickedObjectIndex:d}=e,f=h?[h]:[];if("hover"===n){const e=t.index,n=t.layerId,r=h&&h.props.id;if(r!==n||d!==e){if(r!==n){const e=i.find(e=>e.props.id===n);e&&f.unshift(e)}t.layerId=r,t.index=d,t.info=null}}const g=function({viewports:e}){return e[0]}({viewports:r}),p=g&&g.unproject([a,o]),v={color:null,layer:null,index:-1,picked:!1,x:a,y:o,pixel:[a,o],coordinate:p,lngLat:p,devicePixel:[s,c],pixelRatio:u},m=new Map;return f.forEach(e=>{let i=Object.assign({},v);if(e===h&&(i.color=l,i.index=d,i.picked=!0),i=Tt({layer:e,info:i,mode:n}),e===h&&"hover"===n&&(t.info=i),"hover"===n){const t=e.props.autoHighlight&&h===e?l:null;e.setModuleParameters({pickingSelectedColor:t}),e.setNeedsRedraw()}i&&m.set(i.layer.id,i)}),function(e,t){const n=[];return e.forEach(e=>{let i=!1;switch(t){case"click":i=e.layer.onClick(e);break;case"hover":i=e.layer.onHover(e);break;case"query":break;default:throw new Error("unknown pick type")}i||n.push(e)}),n}(m,n)}function At(e,{pickedColors:t,layers:n,deviceX:i,deviceY:a,deviceRadius:o,deviceRect:s}){g(t);const{x:c,y:u,width:l,height:h}=s;let d=o*o,f=-1,p=0;for(let e=0;e<h;e++){const n=e+u-a,r=n*n;if(r>d)p+=4*l;else for(let e=0;e<l;e++){if(t[p+3]-1>=0){const t=e+c-i,n=t*t+r;n<=d&&(d=n,f=p)}p+=4}}if(f>=0){const e=t[f+3]-1,i=t.slice(f,f+4),a=n[e];if(a){return{pickedColor:i,pickedLayer:a,pickedObjectIndex:a.decodePickingColor(i)}}r.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Et}function Tt({layer:e,info:t,mode:n}){for(;e&&t;){const i=t.layer||e;t.layer=e,t=e.pickLayer({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}function Ct(e,{filter:t=(()=>!0),map:n=(e=>e),result:i=[]}={}){return Array.isArray(e)?function e(t,n,i,r){let a=-1;for(;++a<t.length;){const o=t[a];Array.isArray(o)?e(o,n,i,r):n(o)&&r.push(i(o))}return r}(e,t,n,i):t(e)?[n(e)]:[]}function jt({target:e,source:t,start:n=0,count:i=1}){const r=t.length,a=i*r;let o=0;for(let i=n;o<r;o++)e[i++]=t[o];for(;o<a;)o<a-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+a-o),o=a);return e}var Mt=n(1),Rt=n(2),Lt=n(33),It=n(42),Ft=function(){function e(t){var n=t.id;Object(Mt.a)(this,e),this.id=n,this.time=Object(Lt.a)(),this.counters={},Object.seal(this)}return Object(Rt.a)(e,[{key:"addCounter",value:function(e){return this._getCounter(e),this}},{key:"bump",value:function(e){var t=this._getCounter(e);return t.call++,t.count++,this}},{key:"increment",value:function(e,t){var n=this._getCounter(e);return n.call++,n.count+=t,this}},{key:"addTimer",value:function(e){return this._getCounter(e).time=0,this}},{key:"addTime",value:function(e,t){var n=this._getCounter(e);return n.time+=t,n.count++,this}},{key:"timeStart",value:function(e,t){this._getCounter(e)._startTime=Object(Lt.a)()}},{key:"timeEnd",value:function(e,t){var n=this._getCounter(e);this.addTime(e,Object(Lt.a)()-n._startTime)}},{key:"reset",value:function(){for(var e in this.time=Object(Lt.a)(),this.counters){var t=this.counters[e];t.count=0,t.time=0}return this}},{key:"hasTimeElapsed",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(Lt.a)()-this.time>1e3}},{key:"getStats",value:function(){var e=(Object(Lt.a)()-this.time)/1e3,t={};for(var n in this.counters){var i=this.counters[n];t[i.title]={total:i.count,fps:Math.round(i.count/e)},i.time&&(t[i.title].totalTime=Object(It.b)(i.time),t[i.title].avgTime=Object(It.b)(i.time/i.count))}return t}},{key:"getStatsTable",value:function(){var e=this.getStats();for(var t in e)0===e[t].total&&delete e[t];return e}},{key:"getStatNames",value:function(){return Object.keys(this.counters)}},{key:"get",value:function(e){return this._getCounter(e).count}},{key:"getCount",value:function(e){return this._getCounter(e).count}},{key:"getFPS",value:function(e){var t=this._getCounter(e),n=(Object(Lt.a)()-this.time)/1e3;return Math.round(t.count/n)}},{key:"getTimeString",value:function(){return"".concat(this.id,":").concat(Object(It.b)(this.time),"(").concat(this.count,")")}},{key:"oneSecondPassed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.hasTimeElapsed(e)}},{key:"_getCounter",value:function(e){var t=this.counters[e];return t||(t={title:e,unit:"",timer:!1,count:0,time:0,totalTime:0,averageTime:0},this.counters[e]=t),t}},{key:"_incrementTimer",value:function(e,t,n){e.count+=n,e.totalTime+=t,e.averageTime=e.totalTime/n}}]),e}();function kt(e,t){if(!e)return null;const n=u.c([0,0,0,0],t,e),i=1/n[3];return u.a(n,n,[i,i,i,i]),n}var Nt=n(31),Dt=n(91),Bt=n(62);const Ut=Math.PI/180,zt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Gt=[0,0,0],Vt={pixelsPerMeter:[1,1,1],metersPerPixel:[1,1,1],pixelsPerDegree:[1,1,1],degreesPerPixel:[1,1,1]},Wt=0,Ht="Illegal argument to Viewport";class Xt{constructor(e={}){const{id:t=null,x:n=0,y:i=0,width:r=1,height:a=1}=e;this.id=t||this.constructor.displayName||"viewport",this.x=n,this.y=i,this.width=r||1,this.height=a||1,this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this),this.getMatrices=this.getMatrices.bind(this)}equals(e){return e instanceof Xt&&(e.width===this.width&&e.height===this.height&&Object(Nt.e)(e.projectionMatrix,this.projectionMatrix)&&Object(Nt.e)(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=Q(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,a=t?r:this.height-r;return 2===e.length?[i,a]:[i,a,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,a]=e,o=t?r:this.height-r,s=n&&n*this.distanceScales.pixelsPerMeter[2],c=J([i,o,a],this.pixelUnprojectionMatrix,s),[u,l,h]=this.unprojectPosition(c);return Number.isFinite(a)?[u,l,h]:Number.isFinite(n)?[u,l,n]:[u,l]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.pixelsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerPixel[2]]}projectFlat(e,t=this.scale){return this.isGeospatial?X(e,t):e}unprojectFlat(e,t=this.scale){return this.isGeospatial?Y(e,t):e}getDistanceScales(e=null){return e?q({longitude:e[0],latitude:e[1],scale:this.scale,highPrecision:!0}):this.distanceScales}getMatrices({modelMatrix:e=null}={}){let t=this.viewProjectionMatrix,n=this.pixelProjectionMatrix,i=this.pixelUnprojectionMatrix;return e&&(t=c.g([],this.viewProjectionMatrix,e),n=c.g([],this.pixelProjectionMatrix,e),i=c.e([],n)),Object.assign({modelViewProjectionMatrix:t,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:n,pixelUnprojectionMatrix:i,width:this.width,height:this.height,scale:this.scale})}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_addMetersToLngLat(e,t){const[n,i,r=0]=e,[a,o,s=0]=this._metersToLngLatDelta(t);return 2===e.length?[n+a,i+o]:[n+a,i+o,r+s]}_metersToLngLatDelta(e){const[t,n,i=0]=e;g(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i),Ht);const{pixelsPerMeter:r,degreesPerPixel:a}=this.distanceScales,o=t*r[0]*a[0],s=n*r[1]*a[1];return 2===e.length?[o,s]:[o,s,i]}_createProjectionMatrix({orthographic:e,fovyRadians:t,aspect:n,focalDistance:i,near:r,far:a}){return g(Number.isFinite(t)),e?(new Dt.a).orthographic({fovy:t,aspect:n,focalDistance:i,near:r,far:a}):(new Dt.a).perspective({fovy:t,aspect:n,near:r,far:a})}_initViewMatrix(e){const{viewMatrix:t=zt,longitude:n=null,latitude:i=null,zoom:r=null,position:a=null,modelMatrix:o=null,focalDistance:s=1,distanceScales:u=null}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this.zoom=r,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?function(e){var t=e.latitude;k(Number.isFinite(t));var n=Math.cos(t*B);return H(G*n)-9}({latitude:i})+Math.log2(s):Wt),this.scale=Math.pow(2,this.zoom),this.distanceScales=this.isGeospatial?q({latitude:i,longitude:n,scale:this.scale}):u||Vt,this.focalDistance=s,this.distanceScales.metersPerPixel=new Bt.a(this.distanceScales.metersPerPixel),this.distanceScales.pixelsPerMeter=new Bt.a(this.distanceScales.pixelsPerMeter),this.position=Gt,this.meterOffset=Gt,a&&(this.position=a,this.modelMatrix=o,this.meterOffset=o?o.transformVector(a):a),this.isGeospatial?(this.longitude=n,this.latitude=i,this.center=this._getCenterInWorld({longitude:n,latitude:i}),this.viewMatrixUncentered=c.n([],t,[1,-1,1]),this.viewMatrix=(new Dt.a).multiplyRight(this.viewMatrixUncentered).translate(new Bt.a(this.center||Gt).negate())):(this.center=a,this.viewMatrixUncentered=t,this.viewMatrix=t)}_getCenterInWorld({longitude:e,latitude:t}){const{meterOffset:n,scale:i,distanceScales:r}=this,a=this.projectFlat([e,t],i),o=new Bt.a(a[0],a[1],0);if(n){const e=new Bt.a(n).scale(r.pixelsPerMeter);o.add(e)}return o}_initProjectionMatrix(e){const{projectionMatrix:t=null,orthographic:n=!1,fovyRadians:i,fovyDegrees:r,fovy:a,near:o=.1,far:s=1e3,focalDistance:c=1,orthographicFocalDistance:u}=e,l=i||(r||a||75)*Ut;this.projectionMatrix=t||this._createProjectionMatrix({orthographic:n,fovyRadians:l,aspect:this.width/this.height,focalDistance:u||c,near:o,far:s})}_initPixelMatrices(){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.g(e,e,this.projectionMatrix),c.g(e,e,this.viewMatrix),this.viewProjectionMatrix=e,this.viewMatrixInverse=c.e([],this.viewMatrix)||this.viewMatrix;const{eye:t,direction:n,up:i}=function({viewMatrix:e,viewMatrixInverse:t}){return{eye:[t[12],t[13],t[14]],direction:[e[2],e[6],e[10]],up:[e[1],e[5],e[9]]}}({viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse});this.cameraPosition=t,this.cameraDirection=n,this.cameraUp=i;const a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.n(a,a,[this.width/2,-this.height/2,1]),c.o(a,a,[1,-1,0]),c.g(o,a,this.viewProjectionMatrix),this.pixelProjectionMatrix=o,this.viewportMatrix=a,this.pixelUnprojectionMatrix=c.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||r.warn("Pixel project matrix not invertible")()}}Xt.displayName="Viewport";const Yt=2,qt=4,Zt=Object.seal({layerManager:null,gl:null,useDevicePixels:!0,stats:null,shaderCache:null,pickingFBO:null,pickingEvent:null,lastPickedInfo:null,animationProps:null,userData:{}}),Kt=e=>e instanceof vt?`${e}`:e?"invalid":"null";class $t{constructor(e,{stats:t,viewport:n=null}={}){this.lastRenderedLayers=[],this.layers=[],this.context=Object.assign({},Zt,{layerManager:this,gl:e,shaderCache:e&&new a._ShaderCache({gl:e,_cachePrograms:!0}),stats:t||new Ft({id:"deck.gl"}),lastPickedInfo:{index:-1,layerId:null,info:null},viewport:n||new Xt({id:"DEFAULT-INITIAL-VIEWPORT"})}),this.layerFilter=null,this.drawPickingColors=!1,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this._activateViewport=this._activateViewport.bind(this),this._initSeer=this._initSeer.bind(this),this._editSeer=this._editSeer.bind(this),Object.seal(this),De(this._initSeer),Ne(this._editSeer)}finalize(){de.a.removeListener(this._initSeer),de.a.removeListener(this._editSeer)}needsRedraw({clearRedrawFlags:e=!0}={}){return this._checkIfNeedsRedraw(e)}needsUpdate(){return this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e=null}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"useDevicePixels"in e&&(this.context.useDevicePixels=e.useDevicePixels),"layers"in e&&this.setLayers(e.layers),"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this.setNeedsRedraw("layerFilter changed")),"drawPickingColors"in e&&e.drawPickingColors!==this.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this.setNeedsRedraw("drawPickingColors changed"))}setLayers(e){if(e===this.lastRenderedLayers)return r.log(3,"Ignoring layer update due to layer array not changed")(),this;this.lastRenderedLayers=e,e=Ct(e,{filter:Boolean});for(const t of e)t.context=this.context;const{error:t,generatedLayers:n}=this._updateLayers({oldLayers:this.layers,newLayers:e});if(this.layers=n,t)throw t;return this}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers([...this.lastRenderedLayers]))}drawLayers({pass:e="render to screen",viewports:t,views:n,redrawReason:i="unknown reason",customRender:r=!1}){const{drawPickingColors:a}=this,{gl:o,useDevicePixels:s}=this.context;xt(o,{layers:this.layers,viewports:t,views:n,onViewportActive:this._activateViewport,useDevicePixels:s,drawPickingColors:a,pass:e,layerFilter:this.layerFilter,redrawReason:i,customRender:r})}getLastPickedObject({x:e,y:t,viewports:n}){const i=this.context.lastPickedInfo.info,r=i&&i.layer&&i.layer.id,a=r?this.layers.find(e=>e.id===r):null,o=n[0]&&n[0].unproject([e,t]),s={x:e,y:t,coordinate:o,lngLat:o,layer:a};return a?Object.assign({},i,s):Object.assign(s,{color:null,object:null,index:-1})}pickObject({x:e,y:t,mode:n,radius:i=0,layerIds:r,viewports:a,depth:o=1,event:s=null}){const{gl:c,useDevicePixels:u}=this.context;this.context.pickingEvent=s;const l=wt(c,{x:e,y:t,radius:i,layers:this.getLayers({layerIds:r}),mode:n,layerFilter:this.layerFilter,depth:o,viewports:a,onViewportActive:this._activateViewport,pickingFBO:this._getPickingBuffer(),lastPickedInfo:this.context.lastPickedInfo,useDevicePixels:u});return this.context.pickingEvent=null,l}pickObjects({x:e,y:t,width:n,height:i,layerIds:r,viewports:a}){const{gl:o,useDevicePixels:s}=this.context;return Ot(o,{x:e,y:t,width:n,height:i,layers:this.getLayers({layerIds:r}),layerFilter:this.layerFilter,mode:"pickObjects",viewports:a,onViewportActive:this._activateViewport,pickingFBO:this._getPickingBuffer(),useDevicePixels:s})}_checkIfNeedsRedraw(e){let t=this._needsRedraw;e&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw({clearRedrawFlags:e});t=t||i}return t}_activateViewport(e){const t=this.context.viewport;if(!t||!e.equals(t)){r.log(4,"Viewport changed",e)(),this.context.viewport=e;for(const e of this.layers)e.setChangeFlags({viewportChanged:"Viewport changed"}),this._updateLayer(e)}return g(this.context.viewport,"LayerManager: viewport not set"),this}_getPickingBuffer(){const{gl:e}=this.context;return this.context.pickingFBO=this.context.pickingFBO||new a.Framebuffer(e),this.context.pickingFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.context.pickingFBO}_updateLayers({oldLayers:e,newLayers:t}){const n={};for(const t of e)n[t.id]?r.warn(`Multiple old layers with same id ${Kt(t)}`)():n[t.id]=t;const i=[],a=this._updateSublayersRecursively({newLayers:t,oldLayerMap:n,generatedLayers:i}),o=this._finalizeOldLayers(n);return this._needsUpdate=!1,{error:a||o,generatedLayers:i}}_updateSublayersRecursively({newLayers:e,oldLayerMap:t,generatedLayers:n}){let i=null;for(const a of e){a.context=this.context;const e=t[a.id];null===e&&r.warn(`Multiple new layers with same id ${Kt(a)}`)(),t[a.id]=null;let o=null;try{this._debug&&e!==a&&a.validateProps(),e?(this._transferLayerState(e,a),this._updateLayer(a),Ue(a)):(this._initializeLayer(a),Be(a)),n.push(a),o=a.isComposite&&a.getSubLayers()}catch(e){r.warn(`error during matching of ${Kt(a)}`,e)(),i=i||e}o&&this._updateSublayersRecursively({newLayers:o,oldLayerMap:t,generatedLayers:n})}return i}_finalizeOldLayers(e){let t=null;for(const n in e){const i=e[n];i&&(t=t||this._finalizeLayer(i))}return t}_initializeLayer(e){r.log(Yt,`initializing ${Kt(e)}`)();let t=null;try{e._initialize(),e.lifecycle=Ze.INITIALIZED}catch(n){r.warn(`error while initializing ${Kt(e)}\n`,n)(),t=t||n}e.internalState.layer=e;for(const t of e.getModels())t.userData.layer=e;return t}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Ze.MATCHED,t!==e?(r.log(qt,`matched ${Kt(t)}`,e,"->",t)(),e.lifecycle=Ze.AWAITING_GC):r.log(qt,`Matching layer is unchanged ${t.id}`)()}_updateLayer(e){r.log(qt,`updating ${e} because: ${e.printChangeFlags()}`)();let t=null;try{e._update()}catch(n){r.warn(`error during update of ${Kt(e)}`,n)(),t=n}return t}_finalizeLayer(e){g(e.lifecycle!==Ze.AWAITING_FINALIZATION),e.lifecycle=Ze.AWAITING_FINALIZATION;let t=null;this.setNeedsRedraw(`finalized ${Kt(e)}`);try{e._finalize()}catch(n){r.warn(`error during finalization of ${Kt(e)}`,n)(),t=n}return e.lifecycle=Ze.FINALIZED,r.log(Yt,`finalizing ${Kt(e)}`)(),t}_initSeer(){this.layers.forEach(e=>{Be(e),Ue(e)})}_editSeer(e){if("edit"!==e.type||"props"!==e.valuePath[0])return;Fe(e.itemKey,e.valuePath.slice(1),e.value);const t=this.layers.map(e=>new e.constructor(e.props));this.updateLayers({newLayers:t})}}function Qt(e,t){return e===t||Object.keys(e).every(n=>Array.isArray(e[n])&&Array.isArray(t[n])?Qt(e[n],t[n]):e[n]===t[n])}const Jt=/([0-9]+\.?[0-9]*)(%|px)/;function en(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=e.match(Jt);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function tn(e,t){return e.relative?Math.round(e.position*t):e.position}class nn{constructor(e={}){const{id:t=null,x:n=0,y:i=0,width:r="100%",height:a="100%",projectionMatrix:o=null,fovy:s=75,near:c=.1,far:u=1e3,modelMatrix:l=null,viewportInstance:h=null,type:d=Xt}=e;g(!h||h instanceof Xt),this.viewportInstance=h,this.id=t||this.constructor.displayName||"view",this.type=d,this.props=Object.assign({},e,{projectionMatrix:o,fovy:s,near:c,far:u,modelMatrix:l}),this._parseDimensions({x:n,y:i,width:r,height:a}),this.equals=this.equals.bind(this),Object.seal(this)}equals(e){if(this===e)return!0;if(this.viewportInstance)return e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance);return Qt(this.props,e.props)}makeViewport({width:e,height:t,viewState:n}){if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t}),r=Object.assign({viewState:n},n,this.props,i);return this._getViewport(r)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t=Object.assign({},e);for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){return{x:tn(this._x,e),y:tn(this._y,t),width:tn(this._width,e),height:tn(this._height,t)}}_getControllerProps(e){let t=this.props.controller;return t?!0===t?e:("function"==typeof t&&(t={type:t}),Object.assign({},e,t)):null}_getViewport(e){const{type:t}=this;return new t(e)}_parseDimensions({x:e,y:t,width:n,height:i}){this._x=en(e),this._y=en(t),this._width=en(n),this._height=en(i)}}class rn{constructor(e={}){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractiveStateChange:e.onInteractiveStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers)this.controllers[e]&&this.controllers[e].finalize();this.controllers={}}needsRedraw({clearRedrawFlags:e=!0}={}){const t=this._needsRedraw;return e&&(this._needsRedraw=!1),t}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return"string"==typeof e?this.views.find(t=>t.id===e):e}getViewState(e){const t=this.getView(e),n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}project(e,t={topLeft:!0}){const n=this.getViewports();for(let i=n.length-1;i>=0;--i){const r=n[i];if(r.contains(e,t))return r.project(e,t)}return null}unproject(e,t){const n=this.getViewports();for(let i=n.length-1;i>=0;--i){const r=n[i];if(r.containsPixel(e,t))return r.unproject(e)}return null}setProps(e){"views"in e&&this._setViews(e.views),"viewState"in e&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){g(Number.isFinite(e)&&Number.isFinite(t)),e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Ct(e,{filter:Boolean}).map(e=>e instanceof Xt?new nn({viewportInstance:e}):e),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!Qt(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else r.warn("setting null viewState")()}_onViewStateChange(e,t){t.viewId=e,this._eventCallbacks.onViewStateChange(t)}_createController(e){return new(0,e.type)(Object.assign({eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractiveStateChange},e))}_updateController(e,t,n,i){if(e.controller){const r=Object.assign({},e.controller,t,{id:e.id,x:n.x,y:n.y,width:n.width,height:n.height});return i?i.setProps(r):i=this._createController(r),i}return null}_rebuildViewports(){const{width:e,height:t,views:n}=this,i=this.controllers;this.controllers={},this._viewports=n.map(n=>{const r=this.getViewState(n),a=n.makeViewport({width:e,height:t,viewState:r});return this.controllers[n.id]=this._updateController(n,r,a,i[n.id]),a});for(const e in i)i[e]&&!this.controllers[e]&&i[e].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((n,i)=>!e[i].equals(t[i]))}}var an=n(9),on=n(8),sn=n(10),cn=n(15),un=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ln=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.width,r=n.height,a=n.latitude,o=void 0===a?0:a,s=n.longitude,u=void 0===s?0:s,l=n.zoom,h=void 0===l?0:l,d=n.pitch,f=void 0===d?0:d,g=n.bearing,p=void 0===g?0:g,v=n.altitude,m=void 0===v?1.5:v,_=n.nearZMultiplier,b=n.farZMultiplier;Object(Mt.a)(this,t),i=i||1,r=r||1;var y=W(h);m=Math.max(.75,m);var x=X([u,o],y);x[2]=0;var E=function(e){var t=e.width,n=e.height,i=e.pitch,r=$({width:t,height:n,altitude:e.altitude,pitch:i,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),a=r.fov,o=r.aspect,s=r.near,u=r.far;return c.i([],a,o,s,u)}({width:i,height:r,pitch:f,bearing:p,altitude:m,nearZMultiplier:_||1/r,farZMultiplier:b||1.01}),w=K({height:r,center:x,pitch:f,bearing:p,altitude:m,flipY:!0});return(e=Object(an.a)(this,Object(on.a)(t).call(this,{width:i,height:r,viewMatrix:w,projectionMatrix:E}))).latitude=o,e.longitude=u,e.zoom=h,e.pitch=f,e.bearing=p,e.altitude=m,e.scale=y,e.center=x,e.pixelsPerMeter=q(Object(cn.a)(Object(cn.a)(e))).pixelsPerMeter[2],Object.freeze(Object(cn.a)(Object(cn.a)(e))),e}return Object(sn.a)(t,e),Object(Rt.a)(t,[{key:"projectFlat",value:function(e){return X(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(e){return Y(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,n=J(e.pos,this.pixelUnprojectionMatrix),i=X(t,this.scale),r=F.a([],i,F.e([],n));return Y(F.a([],this.center,r),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,r=this.height,a=hn(Object.assign({width:i,height:r,bounds:e},n));return new t({width:i,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,i=t.height,r=t.viewMatrix,a=void 0===r?un:r,o=t.projectionMatrix,s=void 0===o?un:o;Object(Mt.a)(this,e),this.width=n||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.g(u,u,this.projectionMatrix),c.g(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.n(l,l,[this.width/2,-this.height/2,1]),c.o(l,l,[1,-1,0]),c.g(l,l,this.viewProjectionMatrix);var h=c.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!h)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=h,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(Rt.a)(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&c.b(t.projectionMatrix,this.projectionMatrix)&&c.b(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===t||t,i=Q(this.projectPosition(e),this.pixelProjectionMatrix),r=Object(M.a)(i,2),a=r[0],o=r[1],s=n?o:this.height-o;return 2===e.length?[a,s]:[a,s,i[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,i=void 0===n||n,r=t.targetZ,a=Object(M.a)(e,3),o=a[0],s=a[1],c=a[2],u=i?s:this.height-s,l=r&&r*this.pixelsPerMeter,h=J([o,u,c],this.pixelUnprojectionMatrix,l),d=this.unprojectPosition(h),f=Object(M.a)(d,3),g=f[0],p=f[1],v=f[2];return Number.isFinite(c)?[g,p,v]:Number.isFinite(r)?[g,p,r]:[g,p]}},{key:"projectPosition",value:function(e){var t=this.projectFlat(e),n=Object(M.a)(t,2);return[n[0],n[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=this.unprojectFlat(e),n=Object(M.a)(t,2);return[n[0],n[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return e}}]),e}());function hn(e){var t=e.width,n=e.height,i=e.bounds,r=e.padding,a=void 0===r?0:r,o=e.offset,s=void 0===o?[0,0]:o,c=Object(M.a)(i,2),u=Object(M.a)(c[0],2),l=u[0],h=u[1],d=Object(M.a)(c[1],2),f=d[0],g=d[1];if(Number.isFinite(a)){a={top:a,bottom:a,left:a,right:a}}else k(Number.isFinite(a.top)&&Number.isFinite(a.bottom)&&Number.isFinite(a.left)&&Number.isFinite(a.right));var p=new ln({width:t,height:n,longitude:0,latitude:0,zoom:0}),v=p.project([l,g]),m=p.project([f,h]),_=[Math.abs(m[0]-v[0]),Math.abs(m[1]-v[1])],b=[t-a.left-a.right-2*Math.abs(s[0]),n-a.top-a.bottom-2*Math.abs(s[1])];k(b[0]>0&&b[1]>0);var y=b[0]/_[0],x=b[1]/_[1],E=(a.right-a.left)/2/y,w=(a.bottom-a.top)/2/x,O=[(m[0]+v[0])/2+E,(m[1]+v[1])/2+w],S=p.unproject(O),P=p.zoom+Math.log2(Math.abs(Math.min(y,x)));return{longitude:S[0],latitude:S[1],zoom:P}}const dn="Illegal argument to WebMercatorViewport";class fn extends Xt{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=11,pitch:r=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:s=10,orthographic:c=!1}=e;let{width:u,height:l,altitude:h=1.5}=e;u=u||1,l=l||1,h=Math.max(.75,h);const{fov:d,aspect:f,focalDistance:g,near:p,far:v}=$({width:u,height:l,pitch:r,altitude:h,nearZMultiplier:o,farZMultiplier:s}),m=K({height:l,pitch:r,bearing:a,altitude:h}),_=e.position&&[e.position[0],e.position[1],0];super(Object.assign({},e,{width:u,height:l,viewMatrix:m,longitude:n,latitude:t,zoom:i,position:_,orthographic:c,fovyRadians:d,aspect:f,orthographicFocalDistance:g,near:p,far:v})),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=a,this.altitude=h,this.orthographic=c,this.metersToLngLatDelta=this.metersToLngLatDelta.bind(this),this.lngLatDeltaToMeters=this.lngLatDeltaToMeters.bind(this),this.addMetersToLngLat=this.addMetersToLngLat.bind(this),Object.freeze(this)}metersToLngLatDelta(e){const[t,n,i=0]=e;g(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i),dn);const{pixelsPerMeter:r,degreesPerPixel:a}=this.distanceScales,o=t*r[0]*a[0],s=n*r[1]*a[1];return 2===e.length?[o,s]:[o,s,i]}lngLatDeltaToMeters(e){const[t,n,i=0]=e;g(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i),dn);const{pixelsPerDegree:r,metersPerPixel:a}=this.distanceScales,o=t*r[0]*a[0],s=n*r[1]*a[1];return 2===e.length?[o,s]:[o,s,i]}addMetersToLngLat(e,t){return Z(e,t)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){const n=J(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),r=F.a([],i,F.e([],n)),a=F.a([],this.center,r);return this.unprojectFlat(a)}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:a,zoom:o}=hn(Object.assign({width:n,height:i,bounds:e},t));return new fn({width:n,height:i,longitude:r,latitude:a,zoom:o})}}fn.displayName="WebMercatorViewport";class gn{constructor(e={}){Array.isArray(e)&&(e={compare:e,extract:e,required:e});const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare||Object.keys(t))if(!Object(Nt.e)(e[n],t[n]))return!1;return!0}initializeProps(e,t){let n;if(this._propsToExtract){const i={},r={};for(const n of this._propsToExtract)i[n]=e[n],r[n]=t[n];n={start:i,end:r}}else n={start:e,end:t};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}interpolateProps(e,t,n){g(!1,"interpolateProps is not implemented")}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];g(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const pn=["longitude","latitude","zoom","bearing","pitch"];class vn extends gn{constructor(e=pn){super(e)}interpolateProps(e,t,n){const i={};for(const r in t)i[r]=Object(Nt.g)(e[r],t[r],n);return i}}const mn=()=>{},_n={BREAK:1,SNAP_TO_END:2,IGNORE:3},bn={transitionDuration:0,transitionEasing:e=>e,transitionInterpolator:new vn,transitionInterruption:_n.BREAK,onTransitionStart:mn,onTransitionInterrupt:mn,onTransitionEnd:mn};class yn{constructor(e,t={}){g(e),this.ControllerState=e,this.props=Object.assign({},bn,t),this.animation=null,this.propsInTransition=null,this.transition=new Oe,this.onViewStateChange=t.onViewStateChange,this._onTransitionFrame=this._onTransitionFrame.bind(this),this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){cancelAnimationFrame(this.animation)}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(e=Object.assign({},bn,e),this.props=e,this._shouldIgnoreViewportChange(n,e))return t;if(this._isTransitionEnabled(e)){const i=Object.assign({},n,this.transition.interruption===_n.SNAP_TO_END?this.transition.endProps:this.propsInTransition||n);this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}_isTransitionEnabled(e){return e.transitionDuration>0&&e.transitionInterpolator}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&this.transition.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.interruption===_n.IGNORE||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){g(this._isTransitionEnabled(t),"Transition is not enabled"),cancelAnimationFrame(this.animation);const n=new this.ControllerState(e),i=new this.ControllerState(t).shortestPathFrom(n),r=t.transitionInterpolator.initializeProps(e,i);this.propsInTransition={},this.transition.start({duration:t.transitionDuration,easing:t.transitionEasing,interpolator:t.transitionInterpolator,interruption:t.transitionInterruption,startProps:r.start,endProps:r.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)}),this._onTransitionFrame()}_onTransitionFrame(){this.animation=requestAnimationFrame(this._onTransitionFrame),this.transition.update(Date.now())}_onTransitionEnd(e){return t=>{cancelAnimationFrame(this.animation),this.propsInTransition=null,e(t)}}_onTransitionUpdate(e){const{interpolator:t,startProps:n,endProps:i,time:r}=e,a=t.interpolateProps(n,i,r);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,a)).getViewportProps(),this.onViewStateChange&&this.onViewStateChange({viewState:this.propsInTransition,interactionState:{inTransition:!0}})}}yn.defaultProps=bn;const xn={transitionDuration:0},En=5,wn=1.2,On=.01,Sn={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]};class Pn{constructor(e,t={}){g(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new yn(e,t),this._events=null,this._state={isDragging:!1},this.events=[],this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(t)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){const{ControllerState:t}=this;switch(this.controllerState=new t(Object.assign({},this.controllerStateProps,this._state)),e.type){case"panstart":return this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}getCenter(e){const{x:t,y:n}=this.controllerStateProps,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e){const{width:t,height:n}=this.controllerStateProps;return e[0]>=0&&e[0]<=t&&e[1]>=0&&e[1]<=n}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._state.isDragging}setProps(e){"onViewportChange"in e&&r.removed("onViewportChange")(),"onViewStateChange"in e&&(this.onViewStateChange=e.onViewStateChange),"onStateChange"in e&&(this.onStateChange=e.onStateChange),this.controllerStateProps=e,"eventManager"in e&&this.eventManager!==e.eventManager&&(this.eventManager=e.eventManager,this._events={},this.toggleEvents(this.events,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);const{scrollZoom:t=!0,dragPan:n=!0,dragRotate:i=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:s=!1,keyboard:c=!0}=e,u=Boolean(this.onViewStateChange);this.toggleEvents(Sn.WHEEL,u&&t),this.toggleEvents(Sn.PAN,u&&(n||i)),this.toggleEvents(Sn.PINCH,u&&(o||s)),this.toggleEvents(Sn.DOUBLE_TAP,u&&a),this.toggleEvents(Sn.KEYBOARD,u&&c),this.scrollZoom=t,this.dragPan=n,this.dragRotate=i,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=s,this.keyboard=c}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}setOptions(e){return this.setProps(e)}updateViewport(e,t={},n={}){const i=Object.assign({},e.getViewportProps(),t);if(this.controllerState!==e){const e=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:n,oldViewState:e})}Object.assign(this._state,Object.assign({},e.getInteractiveState(),n)),this.onStateChange&&this.onStateChange(this._state)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t))return!1;const n=this.controllerState.panStart({pos:t}).rotateStart({pos:t});return this.updateViewport(n,xn,{isDragging:!0})}_onPan(e){let t=this.isFunctionKeyPressed(e)||e.rightButton;return(t=this.invertPan?!t:t)?this._onPanMove(e):this._onPanRotate(e)}_onPanEnd(e){const t=this.controllerState.panEnd().rotateEnd();return this.updateViewport(t,null,{isDragging:!1})}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e);if(!this.isDragging())return!1;const n=this.controllerState.pan({pos:t});return this.updateViewport(n,xn,{isDragging:!0})}_onPanRotate(e){return!!this.dragRotate&&this._onPanRotateStandard(e)}_onPanRotateStandard(e){const{deltaX:t,deltaY:n}=e,{width:i,height:r}=this.controllerState.getViewportProps(),a=t/i,o=n/r,s=this.controllerState.rotate({deltaScaleX:a,deltaScaleY:o});return this.updateViewport(s,xn,{isDragging:!0})}_onPanRotateMap(e){const{deltaX:t,deltaY:n}=e,[,i]=this.getCenter(e),r=i-n,{width:a,height:o}=this.controllerState.getViewportProps(),s=t/a;let c=0;n>0?Math.abs(o-r)>En&&(c=n/(r-o)*wn):n<0&&r>En&&(c=1-i/r),c=Math.min(1,Math.max(-1,c));const u=this.controllerState.rotate({deltaScaleX:s,deltaScaleY:c});return this.updateViewport(u,xn,{isDragging:!0})}_onWheel(e){if(!this.scrollZoom)return!1;e.preventDefault();const t=this.getCenter(e);if(!this.isPointInBounds(t))return!1;const{delta:n}=e;let i=2/(1+Math.exp(-Math.abs(n*On)));n<0&&0!==i&&(i=1/i);const r=this.controllerState.zoom({pos:t,scale:i});return this.updateViewport(r,xn)}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return this._state.startPinchRotation=e.rotation,this.updateViewport(n,xn,{isDragging:!0})}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e,{startPinchRotation:i}=this._state;t=t.rotate({deltaScaleX:-(n-i)/180})}return this.updateViewport(t,xn,{isDragging:!0})}_onPinchEnd(e){const t=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(t,null,{isDragging:!1})}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps())}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{controllerState:n}=this;let i;switch(e.srcEvent.keyCode){case 189:i=t?n.zoomOut().zoomOut():n.zoomOut();break;case 187:i=t?n.zoomIn().zoomIn():n.zoomIn();break;case 37:i=t?n.rotateLeft():n.moveLeft();break;case 39:i=t?n.rotateRight():n.moveRight();break;case 38:i=t?n.rotateUp():n.moveUp();break;case 40:i=t?n.rotateDown():n.moveDown();break;default:return!1}return this.updateViewport(i,this._getTransitionProps())}_getTransitionProps(){return xn}}var An=6371e3,Tn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.phi,i=t.theta,r=t.radius,a=t.bearing,o=t.pitch,s=(t.altitude,t.radiusScale),c=void 0===s?An:s;Object(Mt.a)(this,e),0===arguments.length?(this.phi=0,this.theta=0,this.radius=1):Number.isFinite(n)||Number.isFinite(i)?(this.phi=n||0,this.theta=i||0):(Number.isFinite(a)||Number.isFinite(o))&&(this.bearing=a||0,this.pitch=o||0),this.radius=r||1,this.radiusScale=c||1,this.check()}return Object(Rt.a)(e,[{key:"toString",value:function(){return this.formatString(Nt.c)}},{key:"formatString",value:function(e){var t=e.printTypes,n=(e.printDegrees,Nt.f);return"".concat(t?"Spherical":"","[rho:").concat(n(this.radius),",theta:").concat(n(this.theta),",phi:").concat(n(this.phi),"]")}},{key:"equals",value:function(e){return Object(Nt.e)(this.radius,e.radius)&&Object(Nt.e)(this.theta,e.theta)&&Object(Nt.e)(this.phi,e.phi)}},{key:"exactEquals",value:function(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}},{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this.check()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}},{key:"fromLngLatZ",value:function(e){var t=Object(M.a)(e,3),n=t[0],i=t[1],r=t[2];this.radius=1+r/this.radiusScale,this.phi=Object(Nt.h)(i),this.theta=Object(Nt.h)(n)}},{key:"fromVector3",value:function(e){return this.radius=j.c(e),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(Object(Nt.b)(e[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new Bt.a(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-Object(Nt.d)(this.phi)},set:function(e){this.phi=Math.PI-Object(Nt.h)(e)}},{key:"pitch",get:function(){return Object(Nt.d)(this.theta)},set:function(e){this.theta=Object(Nt.h)(e)}},{key:"longitude",get:function(){return Object(Nt.d)(this.phi)}},{key:"latitude",get:function(){return Object(Nt.d)(this.theta)}},{key:"lng",get:function(){return Object(Nt.d)(this.phi)}},{key:"lat",get:function(){return Object(Nt.d)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}]),e}();const Cn={position:[0,0,0],lookAt:[0,0,0],up:[0,0,1],rotationX:0,rotationY:0,fov:50,near:1,far:100};class jn{constructor(e){const{width:t,height:n,position:i=Cn.position}=e;g(Number.isFinite(t),"`width` must be supplied"),g(Number.isFinite(n),"`height` must be supplied"),this._viewportProps=this._applyConstraints(Object.assign({},e,{position:new Bt.a(i)}))}getViewportProps(){return this._viewportProps}getDirection(){return new Tn({bearing:this._viewportProps.bearing,pitch:this._viewportProps.pitch}).toVector3().normalize()}getDirectionFromBearing(e){return new Tn({bearing:e,pitch:90}).toVector3().normalize()}shortestPathFrom(e){return this._viewportProps}_applyConstraints(e){return e}}var Mn=85.05113,Rn=-85.05113;const Ln={transitionDuration:300,transitionEasing:e=>e,transitionInterpolator:new vn,transitionInterruption:_n.BREAK},In={minZoom:0,maxZoom:20,minPitch:0,maxPitch:60},Fn={pitch:0,bearing:0,altitude:1.5};class kn extends jn{constructor({width:e,height:t,latitude:n,longitude:i,zoom:r,bearing:a=Fn.bearing,pitch:o=Fn.pitch,altitude:s=Fn.altitude,maxZoom:c=In.maxZoom,minZoom:u=In.minZoom,maxPitch:l=In.maxPitch,minPitch:h=In.minPitch,startPanLngLat:d,startZoomLngLat:f,startBearing:p,startPitch:v,startZoom:m}={}){g(Number.isFinite(i),"`longitude` must be supplied"),g(Number.isFinite(n),"`latitude` must be supplied"),g(Number.isFinite(r),"`zoom` must be supplied"),super({width:e,height:t,latitude:n,longitude:i,zoom:r,bearing:a,pitch:o,altitude:s,maxZoom:c,minZoom:u,maxPitch:l,minPitch:h}),this._interactiveState={startPanLngLat:d,startZoomLngLat:f,startBearing:p,startPitch:v,startZoom:m}}getViewportProps(){return this._viewportProps}getInteractiveState(){return this._interactiveState}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this._interactiveState.startPanLngLat||this._unproject(t);if(!n)return this;const[i,r]=this._calculateNewLngLat({startPanLngLat:n,pos:e});return this._getUpdatedState({longitude:i,latitude:r})}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate({deltaScaleX:e=0,deltaScaleY:t=0}){const{startBearing:n,startPitch:i}=this._interactiveState;if(!Number.isFinite(n)||!Number.isFinite(i))return this;const{pitch:r,bearing:a}=this._calculateNewPitchAndBearing({deltaScaleX:e,deltaScaleY:t,startBearing:n,startPitch:i});return this._getUpdatedState({bearing:a,pitch:r})}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}zoom({pos:e,startPos:t,scale:n}){g(n>0,"`scale` must be a positive number");let{startZoom:i,startZoomLngLat:r}=this._interactiveState;Number.isFinite(i)||(i=this._viewportProps.zoom,r=this._unproject(t)||this._unproject(e)),g(r,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");const a=this._calculateNewZoom({scale:n,startZoom:i}),o=new ln(Object.assign({},this._viewportProps,{zoom:a})),[s,c]=o.getLocationAtPoint({lngLat:r,pos:e});return this._getUpdatedState({zoom:a,longitude:s,latitude:c})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){return this._zoomFromCenter(2)}zoomOut(){return this._zoomFromCenter(.5)}moveLeft(){return this._panFromCenter([100,0])}moveRight(){return this._panFromCenter([-100,0])}moveUp(){return this._panFromCenter([0,100])}moveDown(){return this._panFromCenter([0,-100])}rotateLeft(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}rotateRight(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}rotateUp(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}rotateDown(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}shortestPathFrom(e){const t=e.getViewportProps(),n=Object.assign({},this._viewportProps),{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}_zoomFromCenter(e){const{width:t,height:n}=this._viewportProps;return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this._viewportProps;return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new kn(Object.assign({},this._viewportProps,this._interactiveState,e))}_applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Object(Nt.b)(i,n,t);const{maxPitch:r,minPitch:a,pitch:o}=e;return e.pitch=Object(Nt.b)(o,a,r),Object.assign(e,function(e){var t=e.width,n=e.height,i=e.longitude,r=e.latitude,a=e.zoom,o=e.pitch,s=void 0===o?0:o,c=e.bearing,u=void 0===c?0:c;(i<-180||i>180)&&(i=L(i+180,360)-180),(u<-180||u>180)&&(u=L(u+180,360)-180);var l=new ln({width:t,height:n,longitude:i,latitude:r,zoom:a}),h=l.project([i,Mn])[1],d=l.project([i,Rn])[1],f=0;return d-h<n&&(a+=Math.log2(n/(d-h)),h=(l=new ln({width:t,height:n,longitude:i,latitude:r,zoom:a})).project([i,Mn])[1],d=l.project([i,Rn])[1]),h>0?f=h:d<n&&(f=d-n),f&&(r=l.unproject([t/2,n/2+f])[1]),{width:t,height:n,longitude:i,latitude:r,zoom:a,pitch:s,bearing:u}}(e)),e}_unproject(e){const t=new ln(this._viewportProps);return e&&t.unproject(e)}_calculateNewLngLat({startPanLngLat:e,pos:t}){return new ln(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:t})}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this._viewportProps,r=t+Math.log2(e);return Object(Nt.b)(r,i,n)}_calculateNewPitchAndBearing({deltaScaleX:e,deltaScaleY:t,startBearing:n,startPitch:i}){t=Object(Nt.b)(t,-1,1);const{minPitch:r,maxPitch:a}=this._viewportProps;let o=i;return t>0?o=i+t*(a-i):t<0&&(o=i-t*(r-i)),{pitch:o,bearing:n+180*e}}}class Nn extends Pn{constructor(e){super(kn,e),this.invertPan=!0}_getTransitionProps(){return Ln}_onPanRotate(e){return!!this.dragRotate&&this._onPanRotateMap(e)}}class Dn extends nn{constructor(e){super(Object.assign({},e,{type:fn}))}get controller(){return this._getControllerProps({type:Nn})}}Dn.displayName="MapView";class Bn{constructor({gl:e,layerManager:t}){this.gl=e,this.layerManager=t,this._effects=[]}addEffect(e){this._effects.push(e),this._sortEffects(),e.initialize({gl:this.gl,layerManager:this.layerManager})}removeEffect(e){const t=this._effects.indexOf(e);return t>=0&&(e.finalize({gl:this.gl,layerManager:this.layerManager}),this._effects.splice(t,1),!0)}preDraw(){for(const e of this._effects)e.needsRedraw&&e.preDraw({gl:this.gl,layerManager:this.layerManager})}draw(){for(const e of this._effects)e.needsRedraw&&e.draw({gl:this.gl,layerManager:this.layerManager})}_sortEffects(){this._effects.sort((e,t)=>e.priority>t.priority?-1:e.priority<t.priority?1:e.count-t.count)}}let Un=0;class zn{constructor(){this.id="effect",this.count=Un++,this.visible=!0,this.priority=0,this.needsRedraw=!1}initialize({gl:e,layerManager:t}){}finalize({gl:e,layerManager:t}){}preDraw({gl:e,layerManager:t}){}draw({gl:e,layerManager:t}){}setNeedsRedraw(e=!0){this.needsRedraw=e}}var Gn=1,Vn=2,Wn=4,Hn={mousedown:Gn,mousemove:Vn,mouseup:Wn};var Xn=null;"undefined"!=typeof document&&(function(e){var t=e.prototype.handler;e.prototype.handler=function(e){var n=this.store;e.button>0&&(function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}(n,function(t){return t.pointerId===e.pointerId})||n.push(e)),t.call(this,e)}}((Xn=n(84)).PointerEventInput),function(e){e.prototype.handler=function(e){var t=Hn[e.type];t&Gn&&e.button>=0&&(this.pressed=!0),t&Vn&&0===e.which&&(t=Wn),this.pressed&&(t&Wn&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}(Xn.MouseInput));var Yn=Xn;var qn=Yn?[[Yn.Rotate,{enable:!1}],[Yn.Pinch,{enable:!1}],[Yn.Swipe,{enable:!1}],[Yn.Pan,{threshold:0,enable:!1}],[Yn.Press,{enable:!1}],[Yn.Tap,{event:"doubletap",taps:2,enable:!1}],[Yn.Tap,{enable:!1}]]:null,Zn={rotate:["pinch"]},Kn={doubletap:["tap"]},$n={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Qn=["keydown","keyup"],Jn=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],ei=["wheel","mousewheel","DOMMouseScroll"],ti={tap:"tap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ni={click:"tap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},ii=n(48),ri=-1!==ii.b.indexOf("firefox"),ai=ei,oi=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Mt.a)(this,e),this.element=t,this.callback=n,this.options=Object.assign({enable:!0},r),this.events=ai.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(e){return t.addEventListener(e,i.handleEvent,!!ii.a&&{passive:!1})})}return Object(Rt.a)(e,[{key:"destroy",value:function(){var e=this;this.events.forEach(function(t){return e.element.removeEventListener(t,e.handleEvent)})}},{key:"enableEventType",value:function(e,t){"wheel"===e&&(this.options.enable=t)}},{key:"handleEvent",value:function(e){if(this.options.enable){var t=e.deltaY;ii.c.WheelEvent&&(ri&&e.deltaMode===ii.c.WheelEvent.DOM_DELTA_PIXEL&&(t/=ii.c.devicePixelRatio),e.deltaMode===ii.c.WheelEvent.DOM_DELTA_LINE&&(t*=40));var n={x:e.clientX,y:e.clientY};0!==t&&t%4.000244140625==0&&(t=Math.floor(t/4.000244140625)),e.shiftKey&&t&&(t*=.25),this._onWheel(e,-t,n)}}},{key:"_onWheel",value:function(e,t,n){this.callback({type:"wheel",center:n,delta:t,srcEvent:e,pointerType:"mouse",target:e.target})}}]),e}(),si=Jn,ci=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Mt.a)(this,e),this.element=t,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},r),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=si.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(e){return t.addEventListener(e,i.handleEvent)})}return Object(Rt.a)(e,[{key:"destroy",value:function(){var e=this;this.events.forEach(function(t){return e.element.removeEventListener(t,e.handleEvent)})}},{key:"enableEventType",value:function(e,t){"pointermove"===e&&(this.enableMoveEvent=t),"pointerover"===e&&(this.enableOverEvent=t),"pointerout"===e&&(this.enableOutEvent=t),"pointerleave"===e&&(this.enableLeaveEvent=t)}},{key:"handleEvent",value:function(e){this.handleOverEvent(e),this.handleOutEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)}},{key:"handleOverEvent",value:function(e){this.enableOverEvent&&"mouseover"===e.type&&this.callback({type:"pointerover",srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleOutEvent",value:function(e){this.enableOutEvent&&"mouseout"===e.type&&this.callback({type:"pointerout",srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleLeaveEvent",value:function(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this.callback({type:"pointerleave",srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleMoveEvent",value:function(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:e,pointerType:"mouse",target:e.target});break;case"mouseup":this.pressed=!1}}}]),e}(),ui=Qn,li=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Mt.a)(this,e),this.element=t,this.callback=n,this.options=Object.assign({enable:!0},r),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=ui.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),t.tabIndex=1,t.style.outline="none",this.events.forEach(function(e){return t.addEventListener(e,i.handleEvent)})}return Object(Rt.a)(e,[{key:"destroy",value:function(){var e=this;this.events.forEach(function(t){return e.element.removeEventListener(t,e.handleEvent)})}},{key:"enableEventType",value:function(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}},{key:"handleEvent",value:function(e){var t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))}}]),e}(),hi=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Mt.a)(this,e),this.element=t,this.callback=n,this.options=Object.assign({enable:!0},i),this.handleEvent=this.handleEvent.bind(this),t.addEventListener("contextmenu",this.handleEvent)}return Object(Rt.a)(e,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(e,t){"contextmenu"===e&&(this.options.enable=t)}},{key:"handleEvent",value:function(e){this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}]),e}(),di=1,fi=2,gi=4,pi={pointerdown:di,pointermove:fi,pointerup:gi,mousedown:di,mousemove:fi,mouseup:gi},vi=1,mi=2,_i=3,bi=0,yi=1,xi=2,Ei=1,wi=2,Oi=4;var Si=function(){function e(t){Object(Mt.a)(this,e),this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this)}return Object(Rt.a)(e,[{key:"isEmpty",value:function(){return 0===this.handlers.length}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"root",i=this.handlers,r=this.handlersByElement;r.has(n)||r.set(n,[]);var a={type:e,handler:t,srcElement:n};i.push(a),r.get(n).push(a)}},{key:"remove",value:function(e,t){for(var n=this.handlers,i=this.handlersByElement,r=n.length-1;r>=0;r--){var a=n[r];if(a.type===e&&a.handler===t){n.splice(r,1);var o=i.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&i.delete(a.srcElement)}}}},{key:"handleEvent",value:function(e){if(!this.isEmpty()){for(var t=this._normalizeEvent(e),n=e.srcEvent.target;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")}}},{key:"_emit",value:function(e,t){var n=this.handlersByElement.get(t);if(n)for(var i=!1,r=function(){e.handled=!0},a=function(){e.handled=!0,i=!0},o=0;o<n.length;o++){var s=n[o],c=s.type;if((0,s.handler)(Object.assign({},e,{type:c,stopPropagation:r,stopImmediatePropagation:a})),i)break}}},{key:"_normalizeEvent",value:function(e){var t=this.eventManager.element;return Object.assign({},e,function(e){var t=pi[e.srcEvent.type];if(!t)return null;var n=e.srcEvent,i=n.buttons,r=n.button,a=n.which,o=!1,s=!1,c=!1;return t===gi||t===fi&&!Number.isFinite(i)?(o=a===vi,s=a===mi,c=a===_i):t===fi?(o=Boolean(i&Ei),s=Boolean(i&Oi),c=Boolean(i&wi)):t===di&&(o=r===bi,s=r===yi,c=r===xi),{leftButton:o,middleButton:s,rightButton:c}}(e),function(e,t){var n=e.srcEvent;if(!e.center&&!Number.isFinite(n.clientX))return null;var i=e.center||{x:n.clientX,y:n.clientY},r=t.getBoundingClientRect(),a=r.width/t.offsetWidth,o=r.height/t.offsetHeight;return{center:i,offsetCenter:{x:(i.x-r.left-t.clientLeft)/a,y:(i.y-r.top-t.clientTop)/o}}}(e,t),{handled:!1,rootElement:t})}}]),e}(),Pi={events:null,recognizers:null,Manager:Yn?Yn.Manager:function(e){var t={},n=function(){return t};return t.get=function(){return null},t.set=n,t.on=n,t.off=n,t.destroy=n,t.emit=n,t},touchAction:"none"},Ai=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(Mt.a)(this,e),this.options=Object.assign({},Pi,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(t);var i=n.events;i&&this.on(i)}return Object(Rt.a)(e,[{key:"setElement",value:function(e){var t=this;if(this.element&&this.destroy(),this.element=e,e){var n=this.options,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||qn}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Zn).forEach(function(e){var n=t.manager.get(e);n&&Zn[e].forEach(function(e){n.recognizeWith(e)})}),this.wheelInput=new oi(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ci(e,this._onOtherEvent,{enable:!1}),this.keyInput=new li(e,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new hi(e,this._onOtherEvent,{enable:!1});var r=!0,a=!1,o=void 0;try{for(var s,c=this.events[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=Object(M.a)(s.value,2),l=u[0],h=u[1];h.isEmpty()||(this._toggleRecognizer(h.recognizerName,!0),this.manager.on(l,h.handleEvent))}}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(e,t,n){if("string"==typeof e)this._addEventHandler(e,t,n);else for(var i in n=t,e)this._addEventHandler(i,e[i],n)}},{key:"off",value:function(e,t){if("string"==typeof e)this._removeEventHandler(e,t);else for(var n in e)this._removeEventHandler(n,e[n])}},{key:"_toggleRecognizer",value:function(e,t){var n=this.manager;if(n){var i=n.get(e);if(i&&i.options.enable!==t){i.set({enable:t});var r=Kn[e];r&&!this.options.recognizers&&r.forEach(function(r){var a=n.get(r);t?(a.requireFailure(e),i.dropRequireFailure(r)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}}},{key:"_addEventHandler",value:function(e,t,n){var i=this.manager,r=this.events,a=ni[e]||e,o=r.get(a);o||(o=new Si(this),r.set(a,o),o.recognizerName=ti[a]||a,i&&i.on(a,o.handleEvent)),this._toggleRecognizer(o.recognizerName,!0),o.add(e,t,n)}},{key:"_removeEventHandler",value:function(e,t){var n=this.events,i=ni[e]||e,r=n.get(i);if(r&&(r.remove(e,t),r.isEmpty())){var a=r.recognizerName,o=!1,s=!0,c=!1,u=void 0;try{for(var l,h=n.values()[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var d=l.value;if(d.recognizerName===a&&!d.isEmpty()){o=!0;break}}}catch(e){c=!0,u=e}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}o||this._toggleRecognizer(a,!1)}}},{key:"_onBasicInput",value:function(e){var t=e.srcEvent,n=$n[t.type];n&&this.manager.emit(n,e)}},{key:"_onOtherEvent",value:function(e){this.manager.emit(e.type,e)}}]),e}();function Ti(){}const Ci={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,_animate:!1,onWebGLInitialized:Ti,onResize:Ti,onViewStateChange:Ti,onBeforeRender:Ti,onAfterRender:Ti,onLayerClick:null,onLayerHover:null,onLoad:Ti,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",debug:!1,drawPickingColors:!1};class ji{constructor(e){e=Object.assign({},Ci,e),this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.stats=new Ft({id:"deck.gl"}),this._needsRedraw=!0,this.viewState=e.initialViewState||null,this.interactiveState={isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerLeave=this._onPointerLeave.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.setProps(e),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null),this.viewManager&&(this.viewManager.finalize(),this.viewManager=null),this.eventManager&&this.eventManager.destroy()}setProps(e){this.stats.timeStart("deck.setProps"),e=Object.assign({},this.props,e),this.props=e,this._setCanvasSize(e);const t=Object.assign({},e,{views:this._getViews(e),width:this.width,height:this.height}),n=this._getViewState(e);n&&(t.viewState=n),this.viewManager&&this.viewManager.setProps(t),this.layerManager&&this.layerManager.setProps(t),this.animationLoop&&this.animationLoop.setProps(t),this.stats.timeEnd("deck.setProps")}needsRedraw({clearRedrawFlags:e=!0}={}){if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw({clearRedrawFlags:e}),i=this.layerManager.needsRedraw({clearRedrawFlags:e});return t=t||n||i}getViews(){return this.viewManager.views}getViewports(e){return this.viewManager.getViewports(e)}pickObject({x:e,y:t,radius:n=0,layerIds:i=null}){this.stats.timeStart("deck.pickObject");const r=this.layerManager.pickObject({x:e,y:t,radius:n,layerIds:i,viewports:this.getViewports({x:e,y:t}),mode:"query",depth:1});return this.stats.timeEnd("deck.pickObject"),r.length?r[0]:null}pickMultipleObjects({x:e,y:t,radius:n=0,layerIds:i=null,depth:r=10}){this.stats.timeStart("deck.pickMultipleObjects");const a=this.layerManager.pickObject({x:e,y:t,radius:n,layerIds:i,viewports:this.getViewports({x:e,y:t}),mode:"query",depth:r});return this.stats.timeEnd("deck.pickMultipleObjects"),a}pickObjects({x:e,y:t,width:n=1,height:i=1,layerIds:r=null}){this.stats.timeStart("deck.pickObjects");const a=this.layerManager.pickObjects({x:e,y:t,width:n,height:i,layerIds:r,viewports:this.getViewports({x:e,y:t,width:n,height:i})});return this.stats.timeEnd("deck.pickObjects"),a}_createCanvas(e){let t=e.canvas;if("string"==typeof t&&g(t=document.getElementById(t)),!t){t=document.createElement("canvas"),(e.parent||document.body).appendChild(t)}const{id:n,style:i}=e;return t.id=n,Object.assign(t.style,i),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:n}=e;(t||0===t)&&(t=Number.isFinite(t)?`${t}px`:t,this.canvas.style.width=t),(n||0===n)&&(n=Number.isFinite(n)?`${n}px`:n,this.canvas.style.position="absolute",this.canvas.style.height=n)}_updateCanvasSize(){if(this._checkForCanvasSizeChange()){const{width:e,height:t}=this;this.viewManager.setProps({width:e,height:t}),this.props.onResize({width:this.width,height:this.height})}}_checkForCanvasSizeChange(){const{canvas:e}=this;if(!e)return!1;const t=e.clientWidth||e.width,n=e.clientHeight||e.height;return(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,!0)}_createAnimationLoop(e){const{width:t,height:n,gl:i,glOptions:r,debug:o,useDevicePixels:s,autoResizeDrawingBuffer:c}=e;return new a.AnimationLoop({width:t,height:n,useDevicePixels:s,autoResizeDrawingBuffer:c,onCreateContext:e=>i||Object(a.createGLContext)(Object.assign({},r,e,{canvas:this.canvas,debug:o})),onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:e.onBeforeRender,onAfterRender:e.onAfterRender})}_getViewState(e){return e.viewState||this.viewState}_getViews(e){let t=e.views||[new Dn({id:"default-view"})];return(t=Array.isArray(t)?t:[t]).length&&e.controller&&(t[0].props.controller=e.controller),t}_pickAndCallback(e){const t=e.event.offsetCenter;if(!t)return;const n=this.props.pickingRadius,i=this.layerManager.pickObject({x:t.x,y:t.y,radius:n,viewports:this.getViewports(t),mode:e.mode,depth:1,event:e.event});if(e.callback&&i){const t=i.find(e=>e.index>=0)||null;e.callback(t,i,e.event.srcEvent)}}_updateCursor(){this.canvas&&(this.canvas.style.cursor=this.props.getCursor(this.interactiveState))}_updateAnimationProps(e){this.layerManager.context.animationProps=e}_setGLContext(e){if(this.layerManager)return;if(this.canvas||(this.canvas=e.canvas,Object(a.trackContextState)(e,{enable:!0,copyState:!0})),Object(a.setParameters)(e,{blend:!0,blendFunc:[ge.a.SRC_ALPHA,ge.a.ONE_MINUS_SRC_ALPHA,ge.a.ONE,ge.a.ONE_MINUS_SRC_ALPHA],polygonOffsetFill:!0,depthTest:!0,depthFunc:ge.a.LEQUAL}),this.props.onWebGLInitialized(e),!this.props._customRender){this.eventManager=new Ai(e.canvas,{events:{click:this._onClick,pointermove:this._onPointerMove,pointerleave:this._onPointerLeave}});for(const e in h)this.eventManager.on(e,this._onEvent)}this.viewManager=new rn({eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractiveStateChange:this._onInteractiveStateChange,views:this._getViews(this.props),viewState:this._getViewState(this.props),width:this.width,height:this.height}),g(this.viewManager);const t=this.viewManager.getViewports()[0];this.layerManager=new $t(e,{stats:this.stats,viewport:t}),this.effectManager=new Bn({gl:e,layerManager:this.layerManager});for(const e of this.props.effects)this.effectManager.addEffect(e);this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e){const{gl:t}=this.layerManager.context;Object(a.setParameters)(t,this.props.parameters),this.props.onBeforeRender({gl:t}),this.layerManager.drawLayers({pass:"screen",viewports:this.viewManager.getViewports(),views:this.viewManager.getViews(),redrawReason:e,drawPickingColors:this.props.drawPickingColors,customRender:Boolean(this.props._customRender)}),this.props.onAfterRender({gl:t})}_onRendererInitialized({gl:e}){this._setGLContext(e)}_onRenderFrame(e){if(this.stats.oneSecondPassed()){const e=this.stats.getStatsTable();if(this.stats.reset(),r.table(3,e)(),this.props._onMetrics){for(const t in e)e[t]=e[t].total;this.props._onMetrics(e)}}this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.stats.bump("fps"),this._updateAnimationProps(e);const t=this.needsRedraw({clearRedrawFlags:!0});t&&(this.stats.bump("redraw"),this.props._customRender?this.props._customRender():this._drawLayers(t))}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState[e.viewId]=t,this.viewManager.setProps({viewState:t}))}_onInteractiveStateChange({isDragging:e=!1}){e!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=e)}_onClick(e){this._pickAndCallback({callback:this.props.onLayerClick,event:e,mode:"click"})}_onEvent(e){const t=h[e.type],n=e.offsetCenter;if(!t||!n)return;const i=this.layerManager.getLastPickedObject({x:n.x,y:n.y,viewports:this.getViewports(n)}),{layer:r}=i,a=r&&(r[t.handler]||r.props[t.handler]),o=this.props[t.handler];let s=!1;a&&(s=a.call(r,i,e)),!s&&o&&o(i,e)}_onPointerMove(e){e.leftButton||e.rightButton||this._pickAndCallback({callback:this.props.onLayerHover,event:e,mode:"hover"})}_onPointerLeave(e){this.layerManager.pickObject({x:-1,y:-1,viewports:[],radius:1,mode:"hover"}),this.props.onLayerHover&&this.props.onLayerHover(null,[],e.srcEvent)}}ji.getPropTypes=function(e){return{id:e.string,width:e.oneOfType([e.number,e.string]),height:e.oneOfType([e.number,e.string]),layers:e.oneOfType([e.object,e.array]),layerFilter:e.func,views:e.oneOfType([e.object,e.array]),viewState:e.object,effects:e.arrayOf(e.instanceOf(zn)),controller:e.oneOfType([e.func,e.bool,e.object]),gl:e.object,glOptions:e.object,parameters:e.object,pickingRadius:e.number,useDevicePixels:e.bool,onWebGLInitialized:e.func,onResize:e.func,onViewStateChange:e.func,onBeforeRender:e.func,onAfterRender:e.func,onLayerClick:e.func,onLayerHover:e.func,onLoad:e.func,debug:e.bool,drawPickingColors:e.bool,_animate:e.bool}},ji.defaultProps=Ci;class Mi extends vt{get isComposite(){return!0}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setLayerNeedsUpdate()}getPickingInfo({info:e}){return e}renderLayers(){return null}shouldRenderSubLayer(e,t){const{_subLayerProps:n}=this.props;return t&&t.length||n&&n[e]}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerProps(e){const{opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:s,highlightColor:c,coordinateSystem:u,coordinateOrigin:l,wrapLongitude:h,positionFormat:d,modelMatrix:f,_subLayerProps:g}=this.props,p={opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:s,highlightColor:c,coordinateSystem:u,coordinateOrigin:l,wrapLongitude:h,positionFormat:d,modelMatrix:f};return e&&Object.assign(p,e,g&&g[e.id],{id:`${this.props.id}-${e.id}`,updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers)}),p}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;e&&!this.needsUpdate()?r.log(3,`Composite layer reused subLayers ${this}`,this.internalState.subLayers)():(e=Ct(e=this.renderLayers(),{filter:Boolean}),this.internalState.subLayers=e,r.log(2,`Composite layer rendered new subLayers ${this}`,e)());for(const t of e)t.parent=this}}Mi.layerName="CompositeLayer";const Ri=1,Li=2;function Ii(e,t){return Number.isFinite(e)?e:t}class Fi extends jn{constructor({width:e,height:t,position:n,bearing:i,pitch:r,longitude:a,latitude:o,zoom:s,syncBearing:c=!0,bounds:u,startPanEventPosition:l,startPanPosition:h,startRotateCenter:d,startRotateViewport:f,startZoomPos:g,startZoom:p}){super({width:e,height:t,position:n,bearing:i,pitch:r,longitude:a,latitude:o,zoom:s}),this._interactiveState={startPanEventPosition:l,startPanPosition:h,startRotateCenter:d,startRotateViewport:f,startZoomPos:g,startZoom:p}}getInteractiveState(){return this._interactiveState}panStart({pos:e}){const{translationX:t,translationY:n}=this._viewportProps;return this._getUpdatedState({startPanPosition:[t,n],startPanEventPosition:e})}pan({pos:e,startPos:t}){const n=this._interactiveState.startPanEventPosition||t;if(!n)return this;let[i,r]=this._interactiveState.startPanPosition||[];i=Ii(i,this._viewportProps.translationX),r=Ii(r,this._viewportProps.translationY);const a=e[0]-n[0],o=e[1]-n[1];return this._getUpdatedState({translationX:i+a,translationY:r-o})}panEnd(){return this._getUpdatedState({startPanPosition:null,startPanPos:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotateCenter:this._viewportProps.position,startRotateViewport:this._viewportProps})}rotate({deltaScaleX:e,deltaScaleY:t}){if(!this._interactiveState.startRotateCenter)return this;const{bearing:n,pitch:i}=this._viewportProps;return this._getUpdatedState({bearing:n+10*e,pitch:i-10*t})}rotateEnd(){return this._getUpdatedState({startRotateCenter:null,startRotateViewport:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomPos:e,startZoom:this._viewportProps.zoom})}zoom({pos:e,startPos:t,scale:n}){const{zoom:i,minZoom:r,maxZoom:a,width:o,height:s,translationX:c,translationY:u}=this._viewportProps,l=this._interactiveState.startZoomPos||t||e,h=Object(Nt.b)(i*n,r,a);e[0],l[0],e[1],l[1],l[0],l[1];return h/i<1?this.moveBackward():this.moveForward()}zoomEnd(){return this._getUpdatedState({startZoomPos:null,startZoom:null})}moveLeft(){const{bearing:e}=this._viewportProps,t=e-Li;return this._getUpdatedState({bearing:t})}moveRight(){const{bearing:e}=this._viewportProps,t=e+Li;return this._getUpdatedState({bearing:t})}moveForward(){const{position:e}=this._viewportProps,t=this.getDirection(),n=new Bt.a(t).normalize().scale(Ri);return this._getUpdatedState({position:new Bt.a(e).add(n)})}moveBackward(){const{position:e}=this._viewportProps,t=this.getDirection(),n=new Bt.a(t).normalize().scale(-Ri);return this._getUpdatedState({position:new Bt.a(e).add(n)})}moveUp(){const{position:e}=this._viewportProps;return this._getUpdatedState({position:new Bt.a(e).add([0,0,1])})}moveDown(){const{position:e}=this._viewportProps,t=e[2]>=1?[0,0,-1]:[0,0,0];return this._getUpdatedState({position:new Bt.a(e).add(t)})}zoomIn(){return this._getUpdatedState({zoom:this._viewportProps.zoom+.2})}zoomOut(){return this._getUpdatedState({zoom:this._viewportProps.zoom-.2})}_getUpdatedState(e){return new Fi(Object.assign({},this._viewportProps,this._interactiveState,e))}}class ki extends Pn{constructor(e){super(Fi,e)}}class Ni extends nn{get controller(){return this._getControllerProps({type:ki})}_getViewport(e){const{modelMatrix:t=null,bearing:n,up:i=[0,0,1]}=e.viewState,r=function({bearing:e,pitch:t}){return new Tn({bearing:e,pitch:t}).toVector3().normalize()}({bearing:n,pitch:89}),a=t?t.transformDirection(r):r,o=(new Dt.a).lookAt({eye:[0,0,0],center:a,up:i});return new Xt(Object.assign({},e,{zoom:null,viewMatrix:o}))}}Ni.displayName="FirstPersonView";class Di extends nn{_getViewport(e){const{bearing:t,pitch:n,position:i,up:r,zoom:a}=e.viewState,o=50*a,s=function({bearing:e,pitch:t}){return new Tn({bearing:e,pitch:t}).toVector3().normalize()}({bearing:t,pitch:n}).scale(-o).multiply(new Bt.a(1,1,-1)),c=(new Dt.a).multiplyRight((new Dt.a).lookAt({eye:s,center:i,up:r}));return new Xt(Object.assign({},e,{id:this.id,zoom:null,viewMatrix:c}))}}Di.displayName="ThirdPersonView";const Bi=Math.PI/180;class Ui extends Xt{constructor({id:e="orbit-viewport",width:t,height:n,distance:i,rotationX:r=0,rotationOrbit:a=0,orbitAxis:o="Z",lookAt:s=[0,0,0],up:u=[0,1,0],fov:l=75,near:h=1,far:d=100,zoom:f=1}){const g=c.k([],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],-r/180*Math.PI);"Z"===o?c.m(g,g,-a/180*Math.PI):c.l(g,g,-a/180*Math.PI);const p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.n(p,p,[f,f,f]),c.o(p,p,[-s[0],-s[1],-s[2]]);const v=c.f([],[0,0,i],[0,0,0],u),m=l*Bi,_=t/n,b=c.i([],m,_,h,d);super({id:e,viewMatrix:c.g(v,v,c.g(g,g,p)),projectionMatrix:b,width:t,height:n}),this.width=t,this.height=n,this.distance=i,this.rotationX=r,this.rotationOrbit=a,this.orbitAxis=o,this.lookAt=s,this.up=u,this.fov=l,this.near=h,this.far=d,this.zoom=f}project(e,{topLeft:t=!1}={}){const n=kt(this.pixelProjectionMatrix,[...e,1]),[i,r,a]=n;return[i,t?this.height-r:r,a]}unproject(e,{topLeft:t=!1}={}){const[n,i,r]=e,a=t?this.height-i:i;return kt(this.pixelUnprojectionMatrix,[n,a,r,1])}getDistance({boundingBox:e,fov:t}){return Math.max(e[0],e[1],e[2])/2/Math.tan(t/180*Math.PI/2)}fitBounds(e){const{width:t,height:n,rotationX:i,rotationOrbit:r,orbitAxis:a,lookAt:o,up:s,fov:c,near:u,far:l,zoom:h}=this;return new Ui({width:t,height:n,rotationX:i,rotationOrbit:r,orbitAxis:a,up:s,fov:c,near:u,far:l,zoom:h,lookAt:o,distance:this.getDistance({boundingBox:e,fov:c})})}}Ui.displayName="OrbitViewport";const zi={transitionDuration:300,transitionEasing:e=>e,transitionInterpolator:new vn(["zoom"]),transitionInterruption:_n.BREAK},Gi={lookAt:[0,0,0],rotationX:0,rotationOrbit:0,fov:50,near:1,far:100,translationX:0,translationY:0,zoom:1},Vi={minZoom:0,maxZoom:1/0};function Wi(e,t){return Number.isFinite(e)?e:t}class Hi{constructor({width:e,height:t,distance:n,rotationX:i,rotationOrbit:r,orbitAxis:a,bounds:o,lookAt:s,fov:c,near:u,far:l,translationX:h,translationY:d,zoom:f,minZoom:p,maxZoom:v,startPanViewport:m,startPanPos:_,isPanning:b,startRotateViewport:y,isRotating:x,startZoomViewport:E,startZoomPos:w}){g(Number.isFinite(e),"`width` must be supplied"),g(Number.isFinite(t),"`height` must be supplied"),g(Number.isFinite(n),"`distance` must be supplied"),this._viewportProps=this._applyConstraints({width:e,height:t,distance:n,rotationX:Wi(i,Gi.rotationX),rotationOrbit:Wi(r,Gi.rotationOrbit),orbitAxis:a,bounds:o,lookAt:s||Gi.lookAt,fov:Wi(c,Gi.fov),near:Wi(u,Gi.near),far:Wi(l,Gi.far),translationX:Wi(h,Gi.translationX),translationY:Wi(d,Gi.translationY),zoom:Wi(f,Gi.zoom),minZoom:Wi(p,Vi.minZoom),maxZoom:Wi(v,Vi.maxZoom)}),this._interactiveState={startPanViewport:m,startPanPos:_,isPanning:b,startRotateViewport:y,isRotating:x,startZoomViewport:E,startZoomPos:w}}getViewportProps(){return this._viewportProps}getInteractiveState(){return this._interactiveState}panStart({pos:e}){const t=new Ui(this._viewportProps);return this._getUpdatedOrbitState({startPanPos:e,startPanViewport:t})}pan({pos:e,startPos:t}){if(this._interactiveState.isRotating)return this._getUpdatedOrbitState();const n=this._interactiveState.startPanPos||t;g(n,"`startPanPos` props is required");const i=this._interactiveState.startPanViewport||new Ui(this._viewportProps),r=e[0]-n[0],a=e[1]-n[1],o=i.project(i.lookAt),s=i.unproject([o[0]-r,o[1]-a,o[2]]);return this._getUpdatedOrbitState({lookAt:s,isPanning:!0})}panEnd(){return this._getUpdatedOrbitState({startPanViewport:null,startPanPos:null,isPanning:null})}rotateStart({pos:e}){const t=new Ui(this._viewportProps);return this._getUpdatedOrbitState({startRotateViewport:t})}rotate({deltaScaleX:e,deltaScaleY:t}){if(this._interactiveState.isPanning)return this._getUpdatedOrbitState();const{startRotateViewport:n}=this._interactiveState;let{rotationX:i,rotationOrbit:r}=n||{};i=Wi(i,this._viewportProps.rotationX),r=Wi(r,this._viewportProps.rotationOrbit);const a=Object(Nt.b)(i-180*t,-89.999,89.999),o=(r-180*e)%360;return this._getUpdatedOrbitState({rotationX:a,rotationOrbit:o,isRotating:!0})}rotateEnd(){return this._getUpdatedOrbitState({startRotateViewport:null,isRotating:null})}shortestPathFrom(e){return Object.assign({},this._viewportProps)}zoomStart({pos:e}){const t=new Ui(this._viewportProps);return this._getUpdatedOrbitState({startZoomViewport:t,startZoomPos:e})}zoom({pos:e,startPos:t,scale:n}){const{zoom:i,minZoom:r,maxZoom:a,width:o,height:s}=this._viewportProps,c=this._interactiveState.startZoomPos||t||e,u=this._interactiveState.startZoomViewport||new Ui(this._viewportProps),l=Object(Nt.b)(i*n,r,a),h=e[0]-c[0],d=e[1]-c[1],f=c[0]-o/2,g=s/2-c[1],p=u.project(u.lookAt),v=p[0]-f+f*l/i+h,m=p[1]+g-g*l/i-d,_=u.unproject([v,m,p[2]]);return this._getUpdatedOrbitState({lookAt:_,zoom:l})}zoomEnd(){return this._getUpdatedOrbitState({startZoomPos:null})}_getUpdatedOrbitState(e){return new Hi(Object.assign({},this._viewportProps,this._interactiveState,e))}_applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;return e.zoom=i>t?t:i,e.zoom=i<n?n:i,e}}class Xi extends Pn{constructor(e){super(Hi,e)}_getTransitionProps(){return zi}}const Yi=Math.PI/180;class qi extends Xt{project(e,{topLeft:t=!1}={}){const n=kt(this.pixelProjectionMatrix,[...e,1]),[i,r,a]=n;return[i,t?this.height-r:r,a]}unproject(e,{topLeft:t=!1}={}){const[n,i,r]=e,a=t?this.height-i:i;return kt(this.pixelUnprojectionMatrix,[n,a,r,1])}}class Zi extends nn{static getDistance({boundingBox:e,fov:t}){return Math.max(e[0],e[1],e[2])/2/Math.tan(t/180*Math.PI/2)}get controller(){return this._getControllerProps({type:Xi})}_getViewport(e){const{viewState:t}=e,n=e.width||1,i=e.height||1,r=e.fov||e.fovy||t.fovy||75,a=e.near||t.near||1,o=e.far||t.far||100,s=Number.isFinite(t.aspect)?t.aspect:n/i,u=r*Yi;return new qi({id:this.id,viewMatrix:this._getViewMatrix(e.viewState),projectionMatrix:c.i([],u,s,a,o),x:e.x,y:e.y,width:n,height:i})}_getViewMatrix(e){const{distance:t,rotationX:n=0,rotationOrbit:i=0,orbitAxis:r="Z",lookAt:a=[0,0,0],up:o=[0,1,0],zoom:s=1}=e,u=c.k([],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],-n/180*Math.PI);"Z"===r?c.m(u,u,-i/180*Math.PI):c.l(u,u,-i/180*Math.PI);const l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.n(l,l,[s,s,s]),c.o(l,l,[-a[0],-a[1],-a[2]]);const h=c.f([],[0,0,t],[0,0,0],o);return c.g(h,h,c.g(u,u,l)),h}fitBounds(e,t){const{width:n,height:i,fov:r,near:a,far:o}=this;return this._getViewport({width:n,height:i,fov:r,near:a,far:o})}}Zi.displayName="OrbitView";const Ki=Math.PI/180;class $i extends nn{_getViewport(e){const{x:t,y:n,width:i,height:r,viewState:a}=e,{eye:o,lookAt:s=[0,0,0],up:u=[0,1,0]}=a,l=e.fovy||a.fovy||75,h=e.near||a.near||1,d=e.far||a.far||100,f=Number.isFinite(a.aspect)?a.aspect:i/r,g=l*Ki;return new Xt({id:this.id,x:t,y:n,width:i,height:r,viewMatrix:c.f([],o,s,u),projectionMatrix:c.i([],g,f,h,d)})}}$i.displayName="PerspectiveView";var Qi=n(76);const Ji=10,er={zoom:0,offset:[0,0],minZoom:-10,maxZoom:10},tr=e=>Math.pow(2,e);class nr extends jn{constructor({width:e,height:t,offset:n=er.offset,zoom:i=er.zoom,minZoom:r=er.minZoom,maxZoom:a=er.maxZoom,startPanPosition:o,startPanOffset:s,startZoomPosition:c,startZoom:u}){super({width:e,height:t,offset:n,zoom:i,minZoom:r,maxZoom:a}),this._interactiveState={startPanPosition:o,startPanOffset:s,startZoomPosition:c,startZoom:u}}getInteractiveState(){return this._interactiveState}panStart({pos:e}){const{offset:t}=this._viewportProps;return this._getUpdatedState({startPanPosition:e,startPanOffset:t})}pan({pos:e}){const{startPanPosition:t,startPanOffset:n}=this._interactiveState,i=new Qi.a(e).subtract(t);return this._getUpdatedState({offset:new Qi.a(n).subtract(i)})}panEnd(){return this._getUpdatedState({startPanPosition:null,startPanOffset:null})}rotateStart({pos:e}){return this}rotate({deltaScaleX:e,deltaScaleY:t}){return this}rotateEnd(){return this}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this._viewportProps,r=t+Math.log2(e);return Object(Nt.b)(r,i,n)}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:e,startZoom:this._viewportProps.zoom})}zoom({pos:e,startPos:t,scale:n}){const{zoom:i,width:r,height:a,offset:o}=this._viewportProps;let{startZoom:s,startZoomPosition:c}=this._interactiveState;Number.isFinite(s)||(s=i,c=t||e);const u=this._calculateNewZoom({scale:n,startZoom:s}),l=tr(s),h=tr(u),d=r/2-o[0],f=a/2-o[1],g=(c[0]-d)*(h/l-1),p=(c[1]-f)*(h/l-1);return this._getUpdatedState({zoom:u,offset:[o[0]+g,o[1]+p]})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}_zoomFromCenter(e){const{width:t,height:n,offset:i}=this._viewportProps;return this.zoom({pos:[t/2-i[0],n/2-i[1]],scale:e})}zoomIn(){return this._zoomFromCenter(2)}zoomOut(){return this._zoomFromCenter(.5)}moveLeft(){const{offset:e}=this._viewportProps,t=[Ji,0];return this._getUpdatedState({offset:new Qi.a(e).add(t)})}moveRight(){const{offset:e}=this._viewportProps,t=[-Ji,0];return this._getUpdatedState({offset:new Qi.a(e).add(t)})}moveUp(){const{offset:e}=this._viewportProps,t=[0,Ji];return this._getUpdatedState({offset:new Qi.a(e).add(t)})}moveDown(){const{offset:e}=this._viewportProps,t=[0,-Ji];return this._getUpdatedState({offset:new Qi.a(e).add(t)})}_getUpdatedState(e){return new nr(Object.assign({},this._viewportProps,this._interactiveState,e))}}class ir extends Pn{constructor(e){super(nr,e),this.invertPan=!0}_onPanRotate(e){return!!this.dragRotate&&this._onPanRotateMap(e)}}class rr extends nn{get controller(){return this._getControllerProps({type:ir})}_getViewport({x:e,y:t,width:n,height:i,viewState:r}){const{offset:a=[0,0],zoom:o=0}=r;n=n||1,i=i||1;const s=Math.pow(2,o),{eye:c=[0,0,1],lookAt:u=[0,0,0],up:l=[0,1,0],left:h=(-n/2+a[0])/s,top:d=(-i/2+a[1])/s,right:f=(n/2+a[0])/s,bottom:g=(i/2+a[1])/s,near:p=1,far:v=100}=this.props;return new Xt({id:this.id,x:e,y:t,width:n,height:i,viewMatrix:(new Dt.a).lookAt({eye:c,lookAt:u,up:l}),projectionMatrix:(new Dt.a).ortho({left:h,right:f,bottom:g,top:d,near:p,far:v}),zoom:o})}}rr.displayName="OrthographicView";var ar="#define SHADER_NAME reflection-effect-vs\n\nattribute vec3 vertices;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  uv = vertices.xy;\n  gl_Position = vec4(2. * vertices.xy - vec2(1., 1.), 1., 1.);\n}\n",or='#define SHADER_NAME reflection-effect-fs\n\nprecision highp float;\n\nuniform sampler2D reflectionTexture;\nuniform int reflectionTextureWidth;\nuniform int reflectionTextureHeight;\n\nuniform float reflectivity;\nuniform float blur;\n\n\nvarying vec2 uv;\n\n#define KERNEL_SIZE 7\n\n/*\n * Samples from tex with a gaussian-shaped patch, centered at uv and\n * with standard deviation sigma.  The size of the texture in\n * pixels must be specified by dim\n */\nvec4 sample_gaussian(sampler2D tex, vec2 dim, vec2 uv, float sigma) {\n  if (sigma == 0.0) {\n    return texture2D(tex, uv);\n  }\n\n  vec2 delta = 1.0 / dim;\n  vec2 top_left = uv - delta * float(KERNEL_SIZE+1) / 2.0;\n\n  vec4 color = vec4(0);\n  float sum = 0.0;\n  for (int i = 0; i <  KERNEL_SIZE; ++i) {\n    for (int j = 0; j < KERNEL_SIZE; ++j) {\n      vec2 uv2 = top_left + vec2(i, j) * delta;\n      float d = length((uv2 - uv) * dim);\n      float f = exp(-(d*d) / (2.0*sigma * sigma));\n      color += f * texture2D(tex, uv2);\n      sum += f;\n    }\n  }\n  return color / sum;\n}\n\nvoid main(void) {\n  //map blur in [0, 1] to sigma in [0, inf]\n  //alpha will determine the "steepness" of our curve.\n  //this was picked just to make the scale feel "natural"\n  //if our image is 1000 pixels wide, a blur of 0.5 should correspond\n  //to a sigma of 1 pixels\n  float alpha = 1000.0;\n  float sigma = blur / (alpha * (1.0 - blur));\n  //let this be our standard deviation in terms of screen-widths.\n  //rewrite this in terms of pixels.\n  sigma *= float(reflectionTextureWidth);\n\n\n  gl_FragColor = sample_gaussian(reflectionTexture, vec2(reflectionTextureWidth,\n    reflectionTextureHeight), vec2(uv.x, 1. - uv.y), sigma);\n  //because our canvas expects alphas to be pre-multiplied, we multiply by whole\n  //color vector by reflectivity, not just the alpha channel\n  gl_FragColor *= reflectivity;\n}\n';class sr extends zn{constructor(e=.5,t=.5){super(),this.reflectivity=e,this.blur=t,this.framebuffer=null,this.setNeedsRedraw()}getShaders(){return{vs:ar,fs:or,modules:[],shaderCache:this.context.shaderCache}}initialize({gl:e,layerManager:t}){this.unitQuad=new a.Model(e,Object.assign({},this.getShaders(),{id:"reflection-effect",geometry:new a.Geometry({drawMode:ge.a.TRIANGLE_FAN,vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])})})),this.framebuffer=new a.Framebuffer(e,{depth:!0})}preDraw({gl:e,layerManager:t}){const{viewport:n}=t.context,i="undefined"!=typeof window&&window.devicePixelRatio||1;this.framebuffer.resize({width:i*n.width,height:i*n.height});const r=n.pitch;this.framebuffer.bind(),t.setViewport(new fn(Object.assign({},n,{pitch:-180-r}))),e.clear(ge.a.COLOR_BUFFER_BIT|ge.a.DEPTH_BUFFER_BIT),t.drawLayers({pass:"reflection"}),t.setViewport(n),this.framebuffer.unbind()}draw({gl:e,layerManager:t}){this.unitQuad.render({reflectionTexture:this.framebuffer.texture,reflectionTextureWidth:this.framebuffer.width,reflectionTextureHeight:this.framebuffer.height,reflectivity:this.reflectivity,blur:this.blur})}finalize({gl:e,layerManager:t}){}}var cr=.01,ur=["longitude","latitude","zoom"];const lr=["bearing","pitch"];class hr extends gn{constructor(){super({compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]})}interpolateProps(e,t,n){const i=function(e,t,n){var i={},r=e.zoom,a=[e.longitude,e.latitude],o=W(r),s=t.zoom,c=[t.longitude,t.latitude],u=W(s-r),l=X(a,o),h=X(c,o),d=F.g([],h,l),f=Math.max(e.width,e.height),g=f/u,p=F.c(d);if(Math.abs(p)<cr){for(var v=0;v<ur.length;v++){var m=ur[v],_=e[m],b=t[m];i[m]=I(_,b,n)}return i}var y=1.414*1.414,x=(g*g-f*f+y*y*p*p)/(2*f*y*p),E=(g*g-f*f-y*y*p*p)/(2*g*y*p),w=Math.log(Math.sqrt(x*x+1)-x),O=n*((Math.log(Math.sqrt(E*E+1)-E)-w)/1.414),S=Math.cosh(w)/Math.cosh(w+1.414*O),P=f*((Math.cosh(w)*Math.tanh(w+1.414*O)-Math.sinh(w))/y)/p,A=1/S,T=r+H(A),C=F.f([],d,P);F.a(C,C,l),F.f(C,C,A);var j=Y(C,W(T));return i.longitude=j[0],i.latitude=j[1],i.zoom=T,i}(e,t,n);for(const r of lr)i[r]=Object(Nt.g)(e[r]||0,t[r]||0,n);return i}}const dr=e=>e.length;class fr{constructor({overAlloc:e=1}={}){this.overAlloc=e}allocate(e,t,{size:n,type:i,copy:r=!1}){const a=t*n;if(e&&a<=e.length)return e;const o=Math.max(Math.ceil(a*this.overAlloc),1),s=this._allocate(i,o);return e&&r&&s.set(e),this._release(e),s}_allocate(e=Float32Array,t){if(e===Uint16Array&&t>65535)throw new Error("Vertex count exceeds browser index limit");return new e(t)}_release(e){}}function gr(e,t,n){const i=e[1]-e[0];if(i<=0)return r.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];const a=i/t.length,o=Math.floor((n-e[0])/a);return t[Math.max(Math.min(o,t.length-1),0)]}const pr={SUM:1,MEAN:2,MIN:3,MAX:4},vr={dataChanged:!0,viewportChanged:!0,cellSizeChanged:!0},mr={changeFlags:vr,projectPoints:!1,useGPU:!0,fp64:!1,viewport:null,gridTransformMatrix:null,createBufferObjects:!0},_r=3.402823466e38,br=[ge.a.MIN,ge.a.FUNC_ADD],yr=[ge.a.MAX,ge.a.FUNC_ADD],xr=[ge.a.MAX,ge.a.MIN],Er={[pr.SUM]:ge.a.FUNC_ADD,[pr.MEAN]:ge.a.FUNC_ADD,[pr.MIN]:br,[pr.MAX]:yr},wr=4,Or={size:1,operation:pr.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},Sr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Pr=4,Ar=3;var Tr="#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec2 positions;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform mat4 uProjectionMatrix;\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result =  uProjectionMatrix * pos;\n  return result.xy/result.w;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 0, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(vec3(positions, 0), vec2(0, 0), vec3(0, 0, 0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n\n  // Transform (0,0):windowSize -> (0, 0): gridSize\n  pos = floor(pos / cellSize);\n\n  // Transform (0,0):gridSize -> (-1, -1):(1,1)\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n\n  // Move to pixel center, pixel-size in screen sapce (2/gridSize) * 0.5 => 1/gridSize\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",Cr="#define SHADER_NAME gpu-aggregation-to-grid-vs-64\n\nattribute vec2 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform vec2 uProjectionMatrixFP64[16];\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvoid project_to_pixel(vec2 pos, vec2 pos64xyLow, out vec2 pixelXY64[2]) {\n\n  vec2 result64[4];\n  vec2 position64[4];\n  position64[0] = vec2(pos.x, pos64xyLow.x);\n  position64[1] = vec2(pos.y, pos64xyLow.y);\n  position64[2] = vec2(0., 0.);\n  position64[3] = vec2(1., 0.);\n  mat4_vec4_mul_fp64(uProjectionMatrixFP64, position64,\n  result64);\n\n  pixelXY64[0] = div_fp64(result64[0], result64[3]);\n  pixelXY64[1] = div_fp64(result64[1], result64[3]);\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec2 windowPos = positions;\n  vec2 windowPos64xyLow = positions64xyLow;\n  if (projectPoints) {\n    vec2 projectedXY[2];\n    project_position_fp64(windowPos, windowPos64xyLow, projectedXY);\n    windowPos.x = projectedXY[0].x;\n    windowPos.y = projectedXY[1].x;\n    windowPos64xyLow.x = projectedXY[0].y;\n    windowPos64xyLow.y = projectedXY[1].y;\n  }\n\n  vec2 pixelXY64[2];\n  project_to_pixel(windowPos, windowPos64xyLow, pixelXY64);\n\n  // Transform (0,0):windowSize -> (0, 0): gridSize\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  vec2 pos = vec2(x, y);\n\n  // Transform (0,0):gridSize -> (-1, -1):(1,1)\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n\n  // Move to pixel center, pixel-size in screen sapce (2/gridSize) * 0.5 => 1/gridSize\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",jr="#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n}\n",Mr="#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform vec2 gridSize;\n\nout vec2 vTextureCoord;\nvoid main(void) {\n  // Map each position to single pixel\n  vec2 pos = vec2(-1.0, -1.0);\n\n  // Move to pixel center, pixel-size in screen sapce (2/gridSize) * 0.5 => 1/gridSize\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  float yIndex = floor(float(gl_InstanceID) / gridSize[0]);\n  float xIndex = float(gl_InstanceID) - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(yIndex, 0.);\n  vec2 xIndexFP64 = vec2(xIndex, 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n}\n",Rr="#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  // if combineMinMax is true, use Alpha channel for first weights min value.\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",Lr="#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  // TODO: Use 64-bit division ?? not needed given this is aggregation ??\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  // aggregationValues:  XYZ contain aggregated values, W contains count\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n}\n";function Ir(e,t){const{width:n=1,height:i=1}=t;return new a.Texture2D(e,{data:null,format:ge.a.RGBA32F,type:ge.a.FLOAT,border:0,mipmaps:!1,parameters:{[ge.a.TEXTURE_MAG_FILTER]:ge.a.NEAREST,[ge.a.TEXTURE_MIN_FILTER]:ge.a.NEAREST},dataFormat:ge.a.RGBA,width:n,height:i})}function Fr(e,t){const{id:n,width:i=1,height:r=1}=t,o=t.texture||Ir(e,t);return new a.Framebuffer(e,{id:n,width:i,height:r,attachments:{[ge.a.COLOR_ATTACHMENT0]:o}})}function kr(e,t,n=0){return!e||e.length<t?new Float32Array(t).fill(n):e}function Nr({gl:e,bufferName:t,data:n,result:i}){i[t]?i[t].subData({data:n}):i[t]=new a.Buffer(e,n)}const{fp64ifyMatrix4:Dr}=a.fp64;class Br{static getAggregationData({aggregationData:e,maxData:t,pixelIndex:n}){g(e.length>=(n+1)*Pr),g(t.length===Pr);const i=n*Pr;return{cellCount:e[i+3],cellWeight:e[i],totalCount:t[3],maxCellWieght:t[0]}}static getCellData({countsData:e,size:t=1}){const n=e.length/4,i=new Float32Array(n*t),r=new Uint32Array(n);for(let a=0;a<n;a++){for(let n=0;n<t;n++)i[a*t+n]=e[4*a+n];r[a]=e[4*a+3]}return{cellCounts:r,cellWeights:i}}constructor(e,t={}){this.id=t.id||"gpu-grid-aggregator",this.shaderCache=t.shaderCache||null,this.gl=e,this.state={weights:null,gridPositions:null,positionsBuffer:null,positions64xyLowBuffer:null,vertexCount:0,fp64:null,useGPU:null,numCol:0,numRow:0,windowSize:null,cellSize:null,weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{}},this._hasGPUSupport=Object(a.isWebGL2)(e)&&Object(a.hasFeatures)(this.gl,a.FEATURES.BLEND_EQUATION_MINMAX,a.FEATURES.COLOR_ATTACHMENT_RGBA32F,a.FEATURES.TEXTURE_FLOAT)}delete(){const{gridAggregationModel:e,allAggregationModel:t,meanTransform:n}=this,{positionsBuffer:i,position64Buffer:r,framebuffers:a,maxMinFramebuffers:o,minFramebuffers:s,maxFramebuffers:c,meanTextures:u}=this.state;e&&e.delete(),t&&t.delete(),n&&n.delete(),i&&i.delete(),r&&r.delete(),this.deleteResources(a),this.deleteResources(o),this.deleteResources(s),this.deleteResources(c),this.deleteResources(u)}run(e={}){const t=this.getAggregationParams(e);this.updateGridSize(t);const{useGPU:n}=t;return this._hasGPUSupport&&n?this.runAggregationOnGPU(t):(n&&r.warn("ScreenGridAggregator: GPU Aggregation not supported, falling back to CPU")(),this.runAggregationOnCPU(t))}deleteResources(e){for(const t in e)e[t].delete()}getAggregationParams(e){const t=Object.assign({},mr,e),{useGPU:n,gridTransformMatrix:i,viewport:r,weights:a,projectPoints:o,cellSize:s}=t;return this.state.useGPU!==n&&(t.changeFlags=Object.assign({},t.changeFlags,vr)),!s||this.state.cellSize&&this.state.cellSize[0]===s[0]&&this.state.cellSize[1]===s[1]||(t.changeFlags.cellSizeChanged=!0,this.setState({cellSize:s})),this.validateProps(t,e),this.setState({useGPU:n}),t.gridTransformMatrix=(o?r.viewportMatrix:i)||Sr,a&&(t.weights=this.normalizeWeightParams(a),this.setState({weights:t.weights})),t}normalizeWeightParams(e){const t={};for(const n in e)t[n]=Object.assign({},Or,e[n]);return t}setState(e){Object.assign(this.state,e)}shouldTransformToGrid(e){const{projectPoints:t,changeFlags:n}=e;return!!(!this.state.gridPositions||n.dataChanged||t&&n.viewportChanged)}updateGridSize(e){const{viewport:t,cellSize:n}=e,i=e.width||t.width,r=e.height||t.height,a=Math.ceil(i/n[0]),o=Math.ceil(r/n[1]);this.setState({numCol:a,numRow:o,windowSize:[i,r]})}validateProps(e,t){const{changeFlags:n,projectPoints:i,gridTransformMatrix:a}=e;g(n.dataChanged||n.viewportChanged||n.cellSizeChanged),g(!n.dataChanged||t.positions&&t.weights&&(!t.projectPositions||t.viewport)&&t.cellSize),g(!n.cellSizeChanged||t.cellSize),g(!(n.viewportChanged&&i)||t.viewport),i&&a&&r.warn("projectPoints is true, gridTransformMatrix is ignored")()}calculateAggregationData(e){const{weights:t,results:n,cellIndex:i,posIndex:r}=e;for(const e in t){const{values:a,size:o,operation:s}=t[e],{aggregationData:c}=n[e];for(let e=0;e<o;e++){const t=i+e,n=a[r*Ar+e];if(0===c[i+3])c[t]=n;else switch(s){case pr.SUM:case pr.MEAN:c[t]+=n;break;case pr.MIN:c[t]=Math.min(c[t],n);break;case pr.MAX:c[t]=Math.max(c[t],n);break;default:g(!1)}}c[i+3]++}}calculateMeanMaxMinData(e){const{validCellIndices:t,results:n,weights:i}=e;t.forEach(e=>{for(const t in n){const{size:r,needMin:a,needMax:o,operation:s}=i[t],{aggregationData:c,minData:u,maxData:l,maxMinData:h}=n[t],d=a||o,f=s===pr.MEAN,g=a&&o&&i[t].combineMaxMin,p=c[e+wr-1];for(let t=0;t<r&&(d||f);t++){const n=e+t;let i=c[n];f&&(c[n]/=p,i=c[n]),g?h[t]=Math.max(h[t],i):(a&&(u[t]=Math.min(u[t],i)),o&&(l[t]=Math.max(l[t],i)))}g?h[wr-1]=Math.min(h[wr-1],c[e+0]):(a&&(u[wr-1]+=p),o&&(l[wr-1]+=p))}})}initCPUResults(e){const t=e.weights||this.state.weights,{numCol:n,numRow:i}=this.state,r={};for(const e in t){let{aggregationData:a,minData:o,maxData:s,maxMinData:c}=t[e];const{needMin:u,needMax:l}=t[e],h=u&&l&&t[e].combineMaxMin;a=kr(a,n*i*wr),h?((c=kr(c,wr)).fill(-1/0,0,wr-1),c[wr-1]=1/0):(u&&((o=kr(o,wr,1/0))[wr-1]=0),l&&((s=kr(s,wr,-1/0))[wr-1]=0)),r[e]=Object.assign({},t[e],{aggregationData:a,minData:o,maxData:s,maxMinData:c})}return r}runAggregationOnCPU(e){const{positions:t,cellSize:n,gridTransformMatrix:i,viewport:r,projectPoints:a}=e;let{weights:o}=e;const{numCol:s,numRow:c}=this.state,u=this.initCPUResults(e),l=this.shouldTransformToGrid(e);let h;const d=[0,0,0];let f;g(l||e.changeFlags.cellSizeChanged),l?(f=t.length/2,h=new Float64Array(t.length),this.setState({gridPositions:h})):(h=this.state.gridPositions,o=this.state.weights,f=h.length/2);const p=new Set;for(let e=0;e<f;e++){let f,g;l?(d[0]=t[2*e],d[1]=t[2*e+1],[f,g]=a?r.project(d):Q(d,i),h[2*e]=f,h[2*e+1]=g):(f=h[2*e],g=h[2*e+1]);const v=Math.floor(f/n[0]),m=Math.floor(g/n[1]);if(v>=0&&v<s&&m>=0&&m<c){const t=(v+m*s)*wr;p.add(t),this.calculateAggregationData({weights:o,results:u,cellIndex:t,posIndex:e})}}return this.calculateMeanMaxMinData({validCellIndices:p,results:u,weights:o}),this.updateAggregationBuffers(e,u),u}updateAggregationBuffers(e,t){if(!e.createBufferObjects)return;const n=e.weights||this.state.weights;for(const e in t){const{aggregationData:i,minData:r,maxData:a,maxMinData:o}=t[e],{needMin:s,needMax:c}=n[e],u=s&&c&&n[e].combineMaxMin;Nr({gl:this.gl,bufferName:"aggregationBuffer",data:i,result:t[e]}),u?Nr({gl:this.gl,bufferName:"maxMinBuffer",data:o,result:t[e]}):(s&&Nr({gl:this.gl,bufferName:"minBuffer",data:r,result:t[e]}),c&&Nr({gl:this.gl,bufferName:"maxBuffer",data:a,result:t[e]}))}}getAggregateData(e){const t={},{textures:n,framebuffers:i,maxMinFramebuffers:r,minFramebuffers:a,maxFramebuffers:o,weights:s}=this.state;for(const e in s){t[e]={};const{needMin:c,needMax:u,combineMaxMin:l}=s[e];t[e].aggregationTexture=n[e],t[e].aggregationBuffer=i[e].readPixelsToBuffer({buffer:s[e].aggregationBuffer,type:ge.a.FLOAT}),c&&u&&l?t[e].maxMinBuffer=r[e].readPixelsToBuffer({buffer:s[e].maxMinBuffer,type:ge.a.FLOAT}):(c&&(t[e].minBuffer=a[e].readPixelsToBuffer({buffer:s[e].minBuffer,type:ge.a.FLOAT})),u&&(t[e].maxBuffer=o[e].readPixelsToBuffer({buffer:s[e].maxBuffer,type:ge.a.FLOAT})))}return t}getAggregationModel(e=!1){const{gl:t,shaderCache:n}=this;return new a.Model(t,{id:"Gird-Aggregation-Model",vs:e?Cr:Tr,fs:jr,modules:e?["fp64","project64"]:["project32"],shaderCache:n,vertexCount:0,drawMode:ge.a.POINTS})}getAllAggregationModel(e=!1){const{gl:t,shaderCache:n}=this;return new a.Model(t,{id:"All-Aggregation-Model",vs:Mr,fs:Rr,modules:["fp64"],shaderCache:n,vertexCount:1,drawMode:ge.a.POINTS,isInstanced:!0,instanceCount:0,attributes:{position:new a.Buffer(t,{size:2,data:new Float32Array([0,0])})}})}getMeanTransform(e){return this.meanTransform?this.meanTransform.update(e):this.meanTransform=new a.Transform(this.gl,Object.assign({},{vs:Lr,_targetTextureVarying:"meanValues"},e)),this.meanTransform}renderAggregateData(e){const{cellSize:t,viewport:n,gridTransformMatrix:i,projectPoints:r}=e,{numCol:a,numRow:o,windowSize:s,maxMinFramebuffers:c,minFramebuffers:u,maxFramebuffers:l,weights:h}=this.state,d=Dr(i),f=[a,o],g={blend:!0,depthTest:!1,blendFunc:[ge.a.ONE,ge.a.ONE]},p={viewport:n},v={windowSize:s,cellSize:t,gridSize:f,uProjectionMatrix:i,uProjectionMatrixFP64:d,projectPoints:r};for(const e in h){const{needMin:t,needMax:n}=h[e],i=t&&n&&h[e].combineMaxMin;this.renderToWeightsTexture({id:e,parameters:g,moduleSettings:p,uniforms:v,gridSize:f}),i?this.renderToMaxMinTexture({id:e,parameters:Object.assign({},g,{blendEquation:xr}),gridSize:f,minOrMaxFb:c[e],clearParams:{clearColor:[0,0,0,_r]},combineMaxMin:i}):(t&&this.renderToMaxMinTexture({id:e,parameters:Object.assign({},g,{blendEquation:br}),gridSize:f,minOrMaxFb:u[e],clearParams:{clearColor:[_r,_r,_r,0]},combineMaxMin:i}),n&&this.renderToMaxMinTexture({id:e,parameters:Object.assign({},g,{blendEquation:yr}),gridSize:f,minOrMaxFb:l[e],combineMaxMin:i}))}}renderToMaxMinTexture(e){const{id:t,parameters:n,gridSize:i,minOrMaxFb:r,combineMaxMin:o,clearParams:s={}}=e,{framebuffers:c}=this.state,{gl:u,allAggregationModel:l}=this;r.bind(),u.viewport(0,0,i[0],i[1]),Object(a.withParameters)(u,s,()=>{u.clear(u.COLOR_BUFFER_BIT)}),l.draw({parameters:n,uniforms:{uSampler:c[t].texture,gridSize:i,combineMaxMin:o}}),r.unbind()}renderToWeightsTexture(e){const{id:t,parameters:n,moduleSettings:i,uniforms:r,gridSize:o}=e,{framebuffers:s,equations:c,weightAttributes:u,weights:l}=this.state,{gl:h,gridAggregationModel:d}=this,{operation:f}=l[t];s[t].bind(),h.viewport(0,0,o[0],o[1]);const g=f===pr.MIN?[_r,_r,_r,0]:[0,0,0,0];Object(a.withParameters)(h,{clearColor:g},()=>{h.clear(h.COLOR_BUFFER_BIT)});const p={weights:u[t]};if(d.draw({parameters:Object.assign({},n,{blendEquation:c[t]}),moduleSettings:i,uniforms:r,attributes:p}),s[t].unbind(),f===pr.MEAN){const{meanTextures:e,textures:n}=this.state,i={_sourceTextures:{aggregationValues:e[t]},_targetTexture:n[t],elementCount:n[t].width*n[t].height};this.getMeanTransform(i).run({parameters:{blend:!1,depthTest:!1}}),s[t].attach({[ge.a.COLOR_ATTACHMENT0]:n[t]})}}runAggregationOnGPU(e){return this.updateModels(e),this.setupFramebuffers(e),this.renderAggregateData(e),this.getAggregateData(e)}setupFramebuffers(e){const{numCol:t,numRow:n,textures:i,framebuffers:r,maxMinFramebuffers:a,minFramebuffers:o,maxFramebuffers:s,meanTextures:c,equations:u,weights:l}=this.state,h={width:t,height:n};for(const e in l){const{needMin:d,needMax:f,combineMaxMin:g,operation:p}=l[e];i[e]=l[e].aggregationTexture||i[e]||Ir(this.gl,{id:`${e}-texture`,width:t,height:n}),i[e].resize(h);let v=i[e];p===pr.MEAN&&(c[e]=c[e]||Ir(this.gl,{id:`${e}-mean-texture`,width:t,height:n}),c[e].resize(h),v=c[e]),r[e]?r[e].attach({[ge.a.COLOR_ATTACHMENT0]:v}):r[e]=Fr(this.gl,{id:`${e}-fb`,width:t,height:n,texture:v}),r[e].resize(h),u[e]=Er[p],(d||f)&&(d&&f&&g?a[e]=a[e]||Fr(this.gl,{id:`${e}-maxMinFb`}):(d&&(o[e]=o[e]||Fr(this.gl,{id:`${e}-minFb`})),f&&(s[e]=s[e]||Fr(this.gl,{id:`${e}-maxFb`}))))}}setupModels(e=!1){this.gridAggregationModel&&this.gridAggregationModel.delete(),this.gridAggregationModel=this.getAggregationModel(e),this.allAggregationModel&&this.allAggregationModel.delete(),this.allAggregationModel=this.getAllAggregationModel(e)}setupWeightAttributes(e){const{weightAttributes:t,vertexCount:n,weights:i}=this.state;for(const e in i){const{values:r}=i[e];if(Array.isArray(r)||r.constructor===Float32Array){g(r.length/3===n);const i=Array.isArray(r)?new Float32Array(r):r;t[e]instanceof a.Buffer?t[e].setData(i):t[e]=new a.Buffer(this.gl,i)}else g(r instanceof a.Buffer),t[e]=r}}updateModels(e){const{gl:t}=this,{positions:n,positions64xyLow:i,changeFlags:r}=e,{numCol:o,numRow:s}=this.state;let{positionsBuffer:c,positions64xyLowBuffer:u}=this.state;const l={};let h=!1;if(e.fp64!==this.state.fp64&&(this.setupModels(e.fp64),this.setState({fp64:e.fp64}),e.fp64&&(h=!0)),r.dataChanged||!c){c&&c.delete();const i=n.length/2;c=new a.Buffer(t,new Float32Array(n)),h=e.fp64,Object.assign(l,{positions:c}),this.setState({positionsBuffer:c,vertexCount:i}),this.setupWeightAttributes(e),this.gridAggregationModel.setVertexCount(i)}h&&(g(i),u&&u.delete(),u=new a.Buffer(t,{size:2,data:new Float32Array(i)}),Object.assign(l,{positions64xyLow:u}),this.setState({positions64xyLowBuffer:u})),this.gridAggregationModel.setAttributes(l),(r.cellSizeChanged||r.viewportChanged)&&this.allAggregationModel.setInstanceCount(o*s)}}const Ur=[],zr=[];function Gr(e){let t=Ur;const n={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?t=e:e.length>0&&(zr.length=e.length,t=zr):t=Ur,{iterable:t,objectInfo:n}}const{fp64LowPart:Vr}=a.fp64,Wr=6378e3,Hr=[1,0,0];function Xr({data:e,getPosition:t,cellSizeMeters:n,gpuGridAggregator:i,gpuAggregation:r,aggregationFlags:a,getWeight:o,fp64:s=!1,coordinateSystem:c=l.LNGLAT,viewport:u=null,boundingBox:h=null}){let d={};g(a.dataChanged||a.cellSizeChanged||a.viewportChanged),a.dataChanged&&(h=(d=function(e,t,n=null){const i=qe(e),r=new Float32Array(2*i),a=new Float32Array(2*i),o=new Float32Array(3*i);let s,c,u=1/0,l=-1/0,h=1/0,d=-1/0;const{iterable:f,objectInfo:g}=Gr(e);for(const e of f){g.index++;const i=t(e,g),{index:f}=g;c=i[0],s=i[1],r[2*f]=c,r[2*f+1]=s,a[2*f]=Vr(c),a[2*f+1]=Vr(s);const p=n?n(e,g):Hr;Array.isArray(p)?(o[3*f]=p[0],o[3*f+1]=p[1],o[3*f+2]=p[2]):o[3*f]=p,Number.isFinite(s)&&Number.isFinite(c)&&(u=s<u?s:u,l=s>l?s:l,h=c<h?c:h,d=c>d?c:d)}const p={weight1:{size:1,operation:pr.SUM,needMax:!0,values:o}};return{positions:r,positions64xyLow:a,weights:p,boundingBox:{xMin:h,xMax:d,yMin:u,yMax:l}}}(e,t,o)).boundingBox);let f=[n,n],p=[0,0];switch(g(c===l.LNGLAT||c===l.IDENTITY),c){case l.LNGLAT:case l.LNGLAT_DEPRECATED:const e=function(e,t){const{yMin:n,yMax:i}=e;return function(e,t){const n=function(e){return e/Wr*(180/Math.PI)}(e),i=function(e,t){return t/Wr*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);return{yOffset:n,xOffset:i}}(t,(n+i)/2)}(h,n);f=[e.xOffset,e.yOffset],p=[-180,-90];break;case l.IDENTITY:const{width:t,height:i}=u;p=[-t/2,-i/2];break;default:g(!1)}const v=function({boundingBox:e,cellSize:t,worldOrigin:n}){const{yMin:i,yMax:r,xMin:a,xMax:o}=e,s=Yr(a-n[0],t[0])+n[0],c=Yr(i-n[1],t[1])+n[1],u=(new Dt.a).translate([-1*s,-1*c,0]),l=[s,c],h=o-a+t[0],d=r-i+t[1],f=[Math.ceil(h/t[0]),Math.ceil(d/t[1])];return{gridOrigin:l,gridSize:f,width:h,height:d,gridTransformMatrix:u}}({boundingBox:h,cellSize:f,worldOrigin:p}),m=i.run({positions:d.positions,positions64xyLow:d.positions64xyLow,weights:d.weights,cellSize:f,width:v.width,height:v.height,gridTransformMatrix:v.gridTransformMatrix,useGPU:r,changeFlags:a,fp64:s});return{countsBuffer:m.weight1.aggregationBuffer,maxCountBuffer:m.weight1.maxBuffer,countsData:m.weight1.aggregationData,maxCountData:m.weight1.maxData,gridSize:v.gridSize,gridOrigin:v.gridOrigin,cellSize:f,boundingBox:h}}function Yr(e,t){const n=e<0?-1:1;let i=n<0?Math.abs(e)+t:Math.abs(e);return(i=Math.floor(i/t)*t)*n}n.d(t,"experimental",function(){return qr}),n.d(t,"COORDINATE_SYSTEM",function(){return l}),n.d(t,"Deck",function(){return ji}),n.d(t,"LayerManager",function(){return $t}),n.d(t,"AttributeManager",function(){return Re}),n.d(t,"Layer",function(){return vt}),n.d(t,"CompositeLayer",function(){return Mi}),n.d(t,"Viewport",function(){return Xt}),n.d(t,"WebMercatorViewport",function(){return fn}),n.d(t,"project",function(){return w}),n.d(t,"project64",function(){return A}),n.d(t,"lighting",function(){return ie}),n.d(t,"View",function(){return nn}),n.d(t,"MapView",function(){return Dn}),n.d(t,"FirstPersonView",function(){return Ni}),n.d(t,"ThirdPersonView",function(){return Di}),n.d(t,"OrbitView",function(){return Zi}),n.d(t,"PerspectiveView",function(){return $i}),n.d(t,"OrthographicView",function(){return rr}),n.d(t,"Controller",function(){return Pn}),n.d(t,"MapController",function(){return Nn}),n.d(t,"_FirstPersonController",function(){return ki}),n.d(t,"_OrbitController",function(){return Xi}),n.d(t,"_OrthographicController",function(){return ir}),n.d(t,"_EffectManager",function(){return Bn}),n.d(t,"_Effect",function(){return zn}),n.d(t,"_ReflectionEffect",function(){return sr}),n.d(t,"TRANSITION_EVENTS",function(){return _n}),n.d(t,"LinearInterpolator",function(){return vn}),n.d(t,"FlyToInterpolator",function(){return hr}),n.d(t,"log",function(){return r}),n.d(t,"_GPUGridAggregator",function(){return Br}),n.d(t,"AGGREGATION_OPERATION",function(){return pr}),n.d(t,"_pointToDensityGridData",function(){return Xr}),n.d(t,"createIterable",function(){return Gr});const qr={BinSorter:class{constructor(e=[],t=dr){this.sortedBins=this.getSortedBins(e,t),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}getSortedBins(e,t){return e.reduce((e,n,i)=>{const r=t(n.points);return null!==r&&void 0!==r&&e.push({i:Number.isFinite(n.index)?n.index:i,value:r,counts:n.points.length}),e},[]).sort((e,t)=>e.value-t.value)}getValueRange([e,t]){const n=this.sortedBins.length;if(!n)return[0,0];const i=Math.ceil(e/100*(n-1)),r=Math.floor(t/100*(n-1));return[this.sortedBins[i].value,this.sortedBins[r].value]}getMaxCount(){let e=0;return this.sortedBins.forEach(t=>e=e>t.counts?e:t.counts),e}getBinMap(){return this.sortedBins.reduce((e,t)=>Object.assign(e,{[t.i]:t}),{})}},Tesselator:class{constructor(e={}){const{attributes:t={}}=e;this.typedArrayManager=new fr,this.indexLayout=null,this.bufferLayout=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=t,this.updateGeometry(e),Object.seal(this)}updateGeometry({data:e,getGeometry:t,positionFormat:n,fp64:i}){this.data=e,this.getGeometry=t,this.fp64=i,this.positionSize="XY"===n?2:3,this._rebuildGeometry()}updatePartialGeometry({start:e,count:t,objects:n}){}updateGeometryAttributes(e,t,n){throw new Error("Not implemented")}getGeometrySize(e){throw new Error("Not implemented")}_forEachGeometry(e){const{data:t,getGeometry:n}=this;let i=0;for(const r of t)e(n(r),i++)}_updateAttribute({target:e,size:t,getValue:n}){const{data:i,bufferLayout:r}=this;let a=0,o=0;for(const s of i){const i=n(s,o),c=r[o++];jt({target:e,source:i,start:a,count:c}),a+=c*t}return e}_rebuildGeometry(){if(!this.data||!this.getGeometry)return;const e=[],t=[];let n=0;this._forEachGeometry((e,i)=>{const r=this.getGeometrySize(e);n+=r,t[i]=r});const{attributes:i,_attributeDefs:r,typedArrayManager:a,fp64:o}=this;for(const e in r){const t=r[e];t.fp64Only&&!o||(i[e]=a.allocate(i[e],n,t))}this.indexLayout=e,this.bufferLayout=t,this.instanceCount=n;const s={vertexStart:0,indexStart:0};this._forEachGeometry((n,i)=>{const r=t[i];s.geometryIndex=i,s.geometrySize=r,this.updateGeometryAttributes(n,s),s.vertexStart+=r,s.indexStart+=e[i]||0}),this.vertexCount=s.indexStart}},linearScale:function(e,t,n){return(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]},getLinearScale:function(e,t){return n=>(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]},quantizeScale:gr,getQuantizeScale:function(e,t){return n=>gr(e,t,n)},defaultColorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],flattenVertices:function e(t,{result:n=[],dimensions:i=3}={}){let r=-1,a=0;for(;++r<t.length;){const o=t[r];Array.isArray(o)||ArrayBuffer.isView(o)?e(o,{result:n,dimensions:i}):a<i&&(n.push(o),a++)}return a>0&&a<i&&n.push(0),n},fillArray:jt,count:qe}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return r}),n.d(t,"c",function(){return a});var i=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array,a=Math.random;Math.PI},function(e,t,n){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var i=n(1),r=n(2),a=n(9),o=n(8),s=n(10),c=n(15),u=n(23),l=n(36),h=n(6),d=n(29),f=n(4),g=n(3),p=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,t),(n=Object(a.a)(this,Object(o.a)(t).call(this,e,r))).stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),n.target=r.target||(n.gl.webgl2?36662:34962),n._initialize(r),Object.seal(Object(c.a)(Object(c.a)(n))),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"getElementCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/l.a.getBytesPerElement(e))}},{key:"getVertexCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/l.a.getBytesPerVertex(e))}},{key:"initialize",value:function(e){return this._initialize(e)}},{key:"setProps",value:function(e){return"data"in e&&this.setData(e),this}},{key:"setAccessor",value:function(e){return this.accessor=e,this}},{key:"reallocate",value:function(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}},{key:"setData",value:function(e){return this.initialize(e)}},{key:"subData",value:function(e){ArrayBuffer.isView(e)&&(e={data:e});var t=e,n=t.data,i=t.offset,r=void 0===i?0:i,a=t.srcOffset,o=void 0===a?0:a,s=e.byteLength||e.length;Object(g.a)(n);var c=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(c,this.handle),0!==o||void 0!==s?(Object(h.d)(this.gl),this.gl.bufferSubData(this.target,r,n,o,s)):this.gl.bufferSubData(c,r,n),this.gl.bindBuffer(c,null),this.debugData=null,this.accessor.type||this.setAccessor(new l.a(this.accessor,{type:Object(d.b)(n)})),this}},{key:"copyData",value:function(e){var t=e.sourceBuffer,n=e.readOffset,i=void 0===n?0:n,r=e.writeOffset,a=void 0===r?0:r,o=e.size,s=this.gl;return Object(h.d)(s),s.bindBuffer(36662,t.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,i,a,o),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dstData,n=void 0===t?null:t,i=e.srcByteOffset,r=void 0===i?0:i,a=e.dstOffset,o=void 0===a?0:a,s=e.length,c=void 0===s?0:s;Object(h.d)(this.gl);var u,l,f=Object(d.c)(this.accessor.type||5126,{clamped:!1}),p=this._getAvailableElementCount(r),v=o;n?u=(l=n.length)-v:l=v+(u=Math.min(p,c||p));var m=Math.min(p,u);return c=c||m,Object(g.a)(c<=m),n=n||new f(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,r,n,o,c),this.gl.bindBuffer(36662,null),n}},{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,n=void 0===t?this.target:t,i=e.index,r=void 0===i?this.accessor&&this.accessor.index:i,a=e.offset,o=void 0===a?0:a,s=e.size;return 35345===n||35982===n?void 0!==s?this.gl.bindBufferRange(n,r,this.handle,o,s):(Object(g.a)(0===o),this.gl.bindBufferBase(n,r,this.handle)):this.gl.bindBuffer(n,this.handle),this}},{key:"unbind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,n=void 0===t?this.target:t,i=e.index,r=void 0===i?this.accessor&&this.accessor.index:i;return 35345===n||35982===n?this.gl.bindBufferBase(n,r,null):this.gl.bindBuffer(n,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:10}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e.bytes&&f.g.deprecated("bytes","byteLength");var t=e.byteLength||e.bytes||0;return this.usage=e.usage||35044,this.setAccessor(new l.a(e,e.accessor)),e.data?this._setData(e.data):this._setByteLength(t)}},{key:"_setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Object(g.a)(ArrayBuffer.isView(e));var n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,e,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=e.slice(0,10),this.byteLength=e.byteLength,this.bytesUsed=e.byteLength;var i=Object(d.b)(e);return Object(g.a)(i),this.setAccessor(new l.a(this.accessor,{type:i})),this}},{key:"_setByteLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Object(g.a)(e>=0);var n=e;0===e&&(n=new Float32Array(0));var i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.byteLength=e,this.bytesUsed=e,this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(e){var t=e/Object(d.c)(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle)}},{key:"_getParameter",value:function(e){this.gl.bindBuffer(this.target,this.handle);var t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}},{key:"updateAccessor",value:function(e){return f.g.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)"),this.accessor=new l.a(this.accessor,e),this}},{key:"setByteLength",value:function(e){return f.g.deprecated("setByteLength","reallocate"),this.reallocate(e)}},{key:"data",get:function(){f.g.removed("Buffer.data","N/A","v6.0")}},{key:"bytes",get:function(){return f.g.deprecated("Buffer.bytes","Buffer.byteLength","v6.1"),this.byteLength}}]),t}(u.a)},function(e,t,n){"use strict";function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";(function(e){n.d(t,"c",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s});var i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document},r=i.self||i.window||i.global,a=i.window||i.self||i.global,o=i.global||i.self||i.window,s=i.document||{}}).call(this,n(37))},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return(r="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"f",function(){return h}),n.d(t,"g",function(){return d});var i=n(14),r=n(17),a=n(46),o=n(39);n.d(t,"b",function(){return o.c}),n.d(t,"c",function(){return o.d}),n.d(t,"e",function(){return o.f}),n.d(t,"d",function(){return o.e}),n.d(t,"a",function(){return o.b});var s=n(4),c=n(3),u={framebuffer:function(e,t){var n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:function(e,t){return t?e.enable(3042):e.disable(3042)},blendColor:function(e,t){return e.blendColor.apply(e,Object(r.a)(t))},blendEquation:function(e,t){t=l(t)?t:[t,t],e.blendEquationSeparate.apply(e,Object(r.a)(t))},blendFunc:function(e,t){t=l(t)&&2===t.length?Object(r.a)(t).concat(Object(r.a)(t)):t,e.blendFuncSeparate.apply(e,Object(r.a)(t))},clearColor:function(e,t){return e.clearColor.apply(e,Object(r.a)(t))},clearDepth:function(e,t){return e.clearDepth(t)},clearStencil:function(e,t){return e.clearStencil(t)},colorMask:function(e,t){return e.colorMask.apply(e,Object(r.a)(t))},cull:function(e,t){return t?e.enable(2884):e.disable(2884)},cullFace:function(e,t){return e.cullFace(t)},depthTest:function(e,t){return t?e.enable(2929):e.disable(2929)},depthFunc:function(e,t){return e.depthFunc(t)},depthMask:function(e,t){return e.depthMask(t)},depthRange:function(e,t){return e.depthRange.apply(e,Object(r.a)(t))},dither:function(e,t){return t?e.enable(3024):e.disable(3024)},derivativeHint:function(e,t){e.hint(35723,t)},frontFace:function(e,t){return e.frontFace(t)},mipmapHint:function(e,t){return e.hint(33170,t)},lineWidth:function(e,t){return e.lineWidth(t)},polygonOffsetFill:function(e,t){return t?e.enable(32823):e.disable(32823)},polygonOffset:function(e,t){return e.polygonOffset.apply(e,Object(r.a)(t))},sampleCoverage:function(e,t){return e.sampleCoverage.apply(e,Object(r.a)(t))},scissorTest:function(e,t){return t?e.enable(3089):e.disable(3089)},scissor:function(e,t){return e.scissor.apply(e,Object(r.a)(t))},stencilTest:function(e,t){return t?e.enable(2960):e.disable(2960)},stencilMask:function(e,t){var n=t=l(t)?t:[t,t],r=Object(i.a)(n,2),a=r[0],o=r[1];e.stencilMaskSeparate(1028,a),e.stencilMaskSeparate(1029,o)},stencilFunc:function(e,t){var n=t=l(t)&&3===t.length?Object(r.a)(t).concat(Object(r.a)(t)):t,a=Object(i.a)(n,6),o=a[0],s=a[1],c=a[2],u=a[3],h=a[4],d=a[5];e.stencilFuncSeparate(1028,o,s,c),e.stencilFuncSeparate(1029,u,h,d)},stencilOp:function(e,t){var n=t=l(t)&&3===t.length?Object(r.a)(t).concat(Object(r.a)(t)):t,a=Object(i.a)(n,6),o=a[0],s=a[1],c=a[2],u=a[3],h=a[4],d=a[5];e.stencilOpSeparate(1028,o,s,c),e.stencilOpSeparate(1029,u,h,d)},viewport:function(e,t){return e.viewport.apply(e,Object(r.a)(t))}};function l(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function h(e,t){for(var n in Object(o.g)(e,t),t){var i=u[n];i&&i(e,t[n],n)}}function d(e,t,n){if(Object(s.d)(t))return n(e);var i,r=t.nocatch,o=void 0===r||r;if(Object(c.a)(!t.frameBuffer),Object(a.c)(e),h(e,t),o)i=n(e),Object(a.b)(e);else try{i=n(e)}finally{Object(a.b)(e)}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r="undefined"!=typeof window&&window.addEventListener,a=new Map,o=function(){return r&&window.__SEER_INITIALIZED__},s=function(e,t){var n=a.get(e),i=Date.now();return!!(n&&i-n<t)||(a.set(e,i),!1)},c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r&&o()){var n=new Set,a=JSON.stringify(t,function(e){return function(t,n){if(!n||"object"!==(void 0===n?"undefined":i(n))||!e.has(n))return e.add(n),Object.prototype.toString.call(n).slice(8,-1).includes("Array")?Array.prototype.slice.call(n,0,20):n}}(n));try{window.postMessage({type:e,payload:a,source:"seer-agent"},"*")}catch(e){if(s("seer-log",2e3))return;console.log(e)}}},u=new Map,l=function(e){if(e&&e.data&&"seer-core"===e.data.source){var t=e.data,n=t.type,i=t.payload,r=u.get(n);r&&r.forEach(function(e){return e(i)})}},h=function(){r&&!window.__SEER_LISTENER__&&(window.addEventListener("message",l),window.__SEER_LISTENER__=!0)};t.default={send:c,throttle:s,isReady:o,list:function(e,t){return c("LIST",{key:e,data:t})},listItem:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c("LIST_ITEM",{key:e,itemKey:t,data:n})},updateItem:function(e,t,n,i){return c("UPDATE_ITEM",{key:e,itemKey:t,path:n,data:i})},multiUpdate:function(e,t,n){return c("MULTI_UPDATE_ITEM",{key:e,itemKey:t,array:n})},deleteItem:function(e,t){return c("DELETE_ITEM",{key:e,itemKey:t})},addLog:function(e,t,n){return c("ADD_LOG",{key:e,itemKey:t,msg:n})},listeners:u,listenFor:function(e,t){if(r){if(!e||!t)throw new Error("Please provide a type and callback");u.has(e)||u.set(e,[]),window.__SEER_LISTENER__||h(),u.get(e).push(t)}},removeListener:function(e){u.forEach(function(t,n){u.set(n,t.filter(function(t){return t!==e}))})},init:h,clean:function(){r&&window.__SEER_LISTENER__&&(window.removeEventListener("message",l),delete window.__SEER_LISTENER__)}}},function(e,t,n){e.exports=n(86)()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(1),r=n(2),a=n(63),o=n(6),s=n(4),c=n(3),u="Resource subclass must define virtual methods",l=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,e),Object(o.e)(t);var r=n.id,a=n.userData,c=void 0===a?{}:a;this.gl=t,this.id=r||Object(s.i)(this.constructor.name),this.userData=c,this._bound=!1,this._handle=n.handle,void 0===this._handle&&(this._handle=this._createHandle()),this._addStats()}return Object(r.a)(e,[{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.id,")")}},{key:"delete",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).deleteChildren,t=void 0!==e&&e,n=this._handle&&this._deleteHandle(this._handle);return this._handle=null,this._removeStats(),n&&t&&n.filter(Boolean).forEach(function(e){e.delete()}),this}},{key:"bind",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof t?(this._bindHandle(t),this):(this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e)}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=Object(o.j)(this.gl,e),Object(c.a)(e);var n=(this.constructor.PARAMETERS||{})[e];if(n){var i=Object(o.n)(this.gl);if(!((!("webgl2"in n)||i)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){var r=n.webgl1,a="webgl2"in n?n.webgl2:n.webgl1;return i?a:r}}return this._getParameter(e,t)}},{key:"getParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=t.parameters,i=t.keys,r=this.constructor.PARAMETERS||{},a=Object(o.n)(this.gl),s={},c=n||Object.keys(r),u=!0,l=!1,h=void 0;try{for(var d,f=c[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var g=d.value,p=r[g];if(p&&(!("webgl2"in p)||a)&&(!("extension"in p)||this.gl.getExtension(p.extension))){var v=i?Object(o.i)(this.gl,g):g;s[v]=this.getParameter(g,e),i&&"GLenum"===p.type&&(s[v]=Object(o.i)(this.gl,s[v]))}}}catch(e){l=!0,h=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw h}}return s}},{key:"setParameter",value:function(e,t){e=Object(o.j)(this.gl,e),Object(c.a)(e);var n=(this.constructor.PARAMETERS||{})[e];if(n){var i=Object(o.n)(this.gl);if(!((!("webgl2"in n)||i)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(t=Object(o.j)(t))}return this._setParameter(e,t),this}},{key:"setParameters",value:function(e){for(var t in e)this.setParameter(t,e[t]);return this}},{key:"stubRemovedMethods",value:function(e,t,n){return Object(s.h)(this,e,t,n)}},{key:"initialize",value:function(e){}},{key:"_createHandle",value:function(){throw new Error(u)}},{key:"_deleteHandle",value:function(){throw new Error(u)}},{key:"_bindHandle",value:function(){throw new Error(u)}},{key:"_getOptsFromHandle",value:function(){throw new Error(u)}},{key:"_getParameter",value:function(e,t){throw new Error(u)}},{key:"_setParameter",value:function(e,t){throw new Error(u)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var e=this.constructor.name,t=a.default.stats;t.resourceCount=t.resourceCount||0,t.resourceMap=t.resourceMap||{},t.resourceCount++,t.resourceMap[e]=t.resourceMap[e]||{created:0,active:0},t.resourceMap[e].created++,t.resourceMap[e].active++}},{key:"_removeStats",value:function(){var e=this.constructor.name;a.default.stats.resourceMap[e].active--}},{key:"handle",get:function(){return this._handle}}]),e}()},function(e,t,n){"use strict";n.d(t,"d",function(){return o}),n.d(t,"c",function(){return l}),n.d(t,"b",function(){return d}),n.d(t,"a",function(){return f});var i=n(1),r=n(18),a=null,o=function(){throw new Error("luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL contexts can not be created. This may not be an error. For example, this is a typical configuration for isorender applications running on the server.")};if(!n(45).a)try{o=n(71),a=n(72)}catch(e){}var s=function e(){Object(i.a)(this,e)},c=a||r.b,u=c.WebGLRenderingContext,l=void 0===u?s:u,h=(c.WebGLProgram,c.WebGLShader,c.WebGLBuffer),d=void 0===h?s:h;c.WebGLFramebuffer,c.WebGLRenderbuffer,c.WebGLTexture,c.WebGLUniformLocation,c.WebGLActiveInfo,c.WebGLShaderPrecisionFormat;var f=r.b.WebGL2RenderingContext||function e(){Object(i.a)(this,e)};r.b.Image},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"d",function(){return c}),n.d(t,"e",function(){return u});var i=n(3),r=n(28);function a(e,t){if("string"!=typeof t)return t;var n=Number(t);if(!isNaN(n))return n;var r=e[t=t.replace(/^.*\./,"")];return Object(i.a)(void 0!==r,"Accessing undefined constant GL.".concat(t)),r}function o(e,t){for(var n in t=Number(t),e)if(e[n]===t)return"GL.".concat(n);return String(t)}function s(e,t){return t||r.a.removed("glGet(name)","glGet(gl, name)","6.0")(),a(e,t)}function c(e,t){return void 0===t&&r.a.removed("glKey(value)","glKey(gl, value)","6.0")(),o(e,t)}function u(e,t){return void 0===t&&r.a.removed("glKeyType(value)","glKeyType(gl, value)","6.0")(),function(e,t){for(var n in Object(i.a)(void 0!==t,"undefined key"),t=Number(t),e)if(e[n]===t)return"GL.".concat(n);return String(t)}(e,t)}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"f",function(){return a}),n.d(t,"c",function(){return o}),n.d(t,"e",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"d",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"g",function(){return h});var i=n(13);function r(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function a(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function o(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function s(e,t){return e[0]=-t[0],e[1]=-t[1],e}function c(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e}function u(e,t,n,i){var r=t[0],a=t[1];return e[0]=r+i*(n[0]-r),e[1]=a+i*(n[1]-a),e}function l(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}var h=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e};!function(){var e=function(){var e=new i.a(2);return i.a!=Float32Array&&(e[0]=0,e[1]=0),e}()}()},,function(e,t,n){"use strict";var i=n(90);t.a=new i.a({id:"luma"}).enable()},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return o}),n.d(t,"d",function(){return s});var i="Failed to deduce GL constant from typed array";function r(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(i)}}function a(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,n=void 0===t||t;switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function o(e){var t=e.data,n=e.width,i=e.height,r=e.bytesPerPixel,a=void 0===r?4:r,o=e.temp,s=n*a;o=o||new Uint8Array(s);for(var c=0;c<i/2;++c){var u=c*s,l=(i-c-1)*s;o.set(t.subarray(u,u+s)),t.copyWithin(u,l,l+s),t.set(o,l)}}function s(e){for(var t=e.data,n=e.width,i=e.height,r=Math.round(n/2),a=Math.round(i/2),o=new Uint8Array(r*a*4),s=0;s<a;s++)for(var c=0;c<r;c++)for(var u=0;u<4;u++)o[4*(s*r+c)+u]=t[4*(2*s*n+2*c)+u];return{data:o,width:r,height:a}}},function(e,t,n){"use strict";(function(e,i){n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s});var r=n(19),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===i?"undefined":Object(r.a)(i))&&i},o=a.window||a.self||a.global,s=a.process||{};console}).call(this,n(37),n(43))},function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"a",function(){return r}),n.d(t,"f",function(){return o}),n.d(t,"h",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"b",function(){return h}),n.d(t,"g",function(){return d}),n.d(t,"e",function(){return f});var i={};function r(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}function a(e){return Math.round(e/i.EPSILON)*i.EPSILON}function o(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,n=void 0===t?i.precision||4:t;return e=a(e),parseFloat(e.toPrecision(n))}function s(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&void 0!==e.length}function c(e,t){if(s(e)){for(var n=function(e){return e.clone?e.clone():new Array(e)}(e),i=0;i<n.length;++i)n[i]=t(n[i],i,n);return n}return t(e)}function u(e){return c(e,function(e){return e/180*Math.PI})}function l(e){return c(e,function(e){return 180*e/Math.PI})}function h(e,t,n){return c(e,function(e){return Math.max(t,Math.min(n,e))})}function d(e,t,n){return s(e)?e.map(function(e,i){return d(e,t[i],n)}):n*t+(1-n)*e}function f(e,t){if(s(e)&&s(t)){if(e===t)return!0;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!f(e[n],t[n]))return!1;return!0}return Math.abs(e-t)<=i.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}i.EPSILON=1e-12,i.debug=!0,i.precision=4,i.printTypes=!1,i.printDegrees=!1,i.printRowMajor=!0},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return o});var i=n(13);function r(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function a(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function o(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,e}!function(){var e=function(){var e=new i.a(4);return i.a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(40),r=n(30);function a(){if(!i.b){var e=r.a.hrtime();return e[0]+e[1]/1e6}return r.b.performance?r.b.performance.now():Date.now()}a()},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var i,r=n(1),a=n(9),o=n(8),s=n(2),c=n(10),u=n(0),l=n(23),h=n(16),d=n(20),f=n(6),g=n(4),p=n(3),v=[9729,9728],m=(i={},Object(u.a)(i,6407,{dataFormat:6407,types:[5121,33635]}),Object(u.a)(i,6408,{dataFormat:6408,types:[5121,32819,32820]}),Object(u.a)(i,6406,{dataFormat:6406,types:[5121]}),Object(u.a)(i,6409,{dataFormat:6409,types:[5121]}),Object(u.a)(i,6410,{dataFormat:6410,types:[5121]}),Object(u.a)(i,33326,{dataFormat:6403,types:[5126],gl2:!0}),Object(u.a)(i,33328,{dataFormat:33319,types:[5126],gl2:!0}),Object(u.a)(i,34837,{dataFormat:6407,types:[5126],gl2:!0}),Object(u.a)(i,34836,{dataFormat:6408,types:[5126],gl2:!0}),i);var _=function(e){function t(e,n){var i;Object(r.a)(this,t);var s=n.id,c=void 0===s?Object(g.i)("texture"):s,u=n.handle,l=n.target;return(i=Object(a.a)(this,Object(o.a)(t).call(this,e,{id:c,handle:u}))).target=l,i.hasFloatTexture=e.getExtension("OES_texture_float"),i.textureUnit=void 0,i}return Object(c.a)(t,e),Object(s.a)(t,null,[{key:"isSupported",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.format,i=t.linearFiltering,r=!0;return n&&(r=(r=r&&function(e,t){var n=m[t];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;var i=Object(f.n)(e)&&n.gl2||n.gl1;return"string"==typeof i?e.getExtension(i):i}(e,n))&&(!i||function(e,t){var n=m[t];switch(n&&n.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}}(e,n))),r}}]),Object(s.a)(t,[{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=e.pixels,i=void 0===n?null:n,r=e.format,a=void 0===r?6408:r,o=e.type,s=void 0===o?5121:o,c=e.border,l=void 0===c?0:c,h=e.recreate,d=void 0!==h&&h,f=e.parameters,p=void 0===f?{}:f,v=e.pixelStore,m=void 0===v?{}:v,_=e.textureUnit,b=void 0===_?void 0:_,y=e.unpackFlipY,x=void 0===y||y,E=e.mipmaps,w=void 0===E||E;t||(t=i);var O=e.width,S=e.height,P=e.dataFormat,A=this._deduceParameters({format:a,type:s,dataFormat:P,compressed:!1,data:t,width:O,height:S});O=A.width,S=A.height,P=A.dataFormat,this.width=O,this.height=S,this.format=a,this.type=s,this.dataFormat=P,this.border=l,this.textureUnit=b,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle));var T=Object(u.a)({},37440,x),C=Object.assign({},T,m);this._isNPOT()&&w&&(g.g.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),w=!1,this._updateForNPOT(p)),this.mipmaps=w,this.setImageData({data:t,width:O,height:S,format:a,type:s,dataFormat:P,border:l,mipmaps:w,parameters:C}),w&&this.generateMipmap(),this.setParameters(p),d&&(this.data=t)}},{key:"resize",value:function(e){var t=e.width,n=e.height;return t!==this.width||n!==this.height?this.initialize({width:t,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:!1}):this}},{key:"generateMipmap",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindTexture(this.target,this.handle),Object(d.g)(this.gl,t,function(){e.gl.generateMipmap(e.target)}),this.gl.bindTexture(this.target,null),this}},{key:"setImageData",value:function(e){var t=e.target,n=void 0===t?this.target:t,i=e.pixels,r=void 0===i?null:i,a=e.data,o=void 0===a?null:a,s=e.width,c=void 0===s?this.width:s,u=e.height,l=void 0===u?this.height:u,h=e.level,g=void 0===h?0:h,v=e.format,m=void 0===v?this.format:v,_=e.type,b=void 0===_?this.type:_,y=e.dataFormat,x=void 0===y?this.dataFormat:y,E=e.offset,w=void 0===E?0:E,O=e.border,S=void 0===O?this.border:O,P=e.compressed,A=void 0!==P&&P,T=e.parameters,C=void 0===T?{}:T;o||(o=r);var j=this._deduceParameters({format:m,type:b,dataFormat:x,compressed:A,data:o,width:c,height:l});b=j.type,x=j.dataFormat,A=j.compressed,c=j.width,l=j.height;var M=this.gl;M.bindTexture(this.target,this.handle);var R,L=this._getDataType({data:o,compressed:A});o=L.data,R=L.dataType,Object(d.g)(this.gl,C,function(){switch(R){case"null":M.texImage2D(n,g,m,c,l,S,x,b,o);break;case"typed-array":M.texImage2D(n,g,m,c,l,S,x,b,o,w);break;case"buffer":Object(f.d)(M),M.bindBuffer(35052,o.handle||o),M.texImage2D(n,g,m,c,l,S,x,b,w),M.bindBuffer(35052,null);break;case"browser-object":Object(f.n)(M)?M.texImage2D(n,g,m,c,l,S,x,b,o):M.texImage2D(n,g,m,x,b,o);break;case"compressed":M.compressedTexImage2D(n,g,m,c,l,S,o);break;default:Object(p.a)(!1,"Unknown image data type")}})}},{key:"setSubImageData",value:function(e){var t=this,n=e.target,i=void 0===n?this.target:n,r=e.pixels,a=void 0===r?null:r,o=e.data,s=void 0===o?null:o,c=e.x,u=void 0===c?0:c,l=e.y,g=void 0===l?0:l,p=e.width,v=void 0===p?this.width:p,m=e.height,_=void 0===m?this.height:m,b=e.level,y=void 0===b?0:b,x=e.format,E=void 0===x?this.format:x,w=e.type,O=void 0===w?this.type:w,S=e.dataFormat,P=void 0===S?this.dataFormat:S,A=e.compressed,T=void 0!==A&&A,C=e.offset,j=void 0===C?0:C,M=e.border,R=(void 0===M&&this.border,e.parameters),L=void 0===R?{}:R,I=this._deduceParameters({format:E,type:O,dataFormat:P,compressed:T,data:s,width:v,height:_});if(O=I.type,P=I.dataFormat,T=I.compressed,v=I.width,_=I.height,s||(s=a),s&&s.data){var F=s;s=F.data,v=F.shape[0],_=F.shape[1]}s instanceof h.a&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Object(d.g)(this.gl,L,function(){T?t.gl.compressedTexSubImage2D(i,y,u,g,v,_,E,s):null===s?t.gl.texSubImage2D(i,y,u,g,v,_,P,O,null):ArrayBuffer.isView(s)?t.gl.texSubImage2D(i,y,u,g,v,_,P,O,s,j):s instanceof f.b?(Object(f.d)(t.gl),t.gl.bindBuffer(35052,s),t.gl.texSubImage2D(i,y,u,g,v,_,P,O,j),t.gl.bindBuffer(35052,null)):Object(f.n)(t.gl)?t.gl.texSubImage2D(i,y,u,g,v,_,P,O,s):t.gl.texSubImage2D(i,y,u,g,P,O,s)}),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(e){var t=e.target,n=(void 0===t&&this.target,e.framebuffer),i=e.x,r=void 0===i?0:i,a=e.y,o=void 0===a?0:a,s=e.width,c=e.height,u=e.level,l=void 0===u?0:u,h=e.internalFormat,d=void 0===h?6408:h,f=e.border,g=void 0===f?0:f;n&&n.bind(),this.bind(0),this.gl.copyTexImage2D(this.target,l,d,r,o,s,c,g),this.unbind(),n&&n.unbind()}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;if(void 0===e)throw new Error("Texture.bind: must specify texture unit");return this.textureUnit=e,this.gl.activeTexture(33984+e),this.gl.bindTexture(this.target,this.handle),e}},{key:"unbind",value:function(){if(void 0===this.textureUnit)throw new Error("Texture.unbind: texture unit not specified");return this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,null),this.textureUnit}},{key:"_getDataType",value:function(e){var t=e.data,n=e.compressed;return void 0!==n&&n?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof h.a?{data:t.handle,dataType:"buffer"}:t instanceof f.b?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}},{key:"setImage3D",value:function(e){var t=e.level,n=void 0===t?0:t,i=e.internalformat,r=void 0===i?6408:i,a=e.width,o=e.height,s=e.depth,c=void 0===s?1:s,u=e.border,l=void 0===u?0:u,d=e.format,f=e.type,g=void 0===f?5121:f,p=e.offset,v=void 0===p?0:p,m=e.pixels;return ArrayBuffer.isView(m)?(this.gl.texImage3D(this.target,n,r,a,o,c,l,d,g,m),this):(m instanceof h.a&&(this.gl.bindBuffer(35052,m.handle),this.gl.texImage3D(this.target,n,r,a,o,c,l,d,g,v)),this)}},{key:"_deduceParameters",value:function(e){var t=e.format,n=e.data,i=e.width,r=e.height,a=e.dataFormat,o=e.type,s=e.compressed,c=m[t];a=a||c&&c.dataFormat,o=o||c&&c.types[0],s=s||c&&c.compressed;var u=this._deduceImageSize(n,i,r);return{dataFormat:a,type:o,compressed:s,width:i=u.width,height:r=u.height,format:t,data:n}}},{key:"_deduceImageSize",value:function(e,t,n){var i;return i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},Object(p.a)(i,"Could not deduced texture size"),Object(p.a)(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),Object(p.a)(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle)}},{key:"_getParameter",value:function(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}},{key:"_setParameter",value:function(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Object(p.a)(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return!(Object(f.n)(this.gl)||Object(g.f)(this.width)&&Object(g.f)(this.height))}},{key:"_updateForNPOT",value:function(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(e,t){if(this._isNPOT())switch(e){case 10241:-1===v.indexOf(t)&&(t=9729);break;case 10242:case 10243:33071!==t&&(t=33071)}return t}}]),t}(l.a)},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"d",function(){return o}),n.d(t,"b",function(){return c}),n.d(t,"i",function(){return u}),n.d(t,"e",function(){return l}),n.d(t,"f",function(){return h}),n.d(t,"g",function(){return d}),n.d(t,"a",function(){return f}),n.d(t,"h",function(){return g});var i=n(13);function r(e){var t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function a(e,t,n){var r=new i.a(3);return r[0]=e,r[1]=t,r[2]=n,r}function o(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function s(e,t){var n=t[0],i=t[1],r=t[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function c(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[0],s=n[1],c=n[2];return e[0]=r*c-a*s,e[1]=a*o-i*c,e[2]=i*s-r*o,e}function u(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/o,e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,e}function l(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function h(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function d(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function f(e,t){var n=a(e[0],e[1],e[2]),i=a(t[0],t[1],t[2]);s(n,n),s(i,i);var r=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}var g=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e};!function(){var e=function(){var e=new i.a(3);return i.a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}()}()},function(e,t,n){"use strict";var i=n(59);function r(e,t,n){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&Object(i.a)(a,n.prototype),a}).apply(null,arguments)}var a=n(1),o=n(2),s=n(29),c=n(28),u=n(3);n.d(t,"a",function(){return h});var l={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},h=function(){function e(){var t=this;Object(a.a)(this,e);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];i.forEach(function(e){return t._assign(e)}),Object.freeze(this)}return Object(o.a)(e,null,[{key:"getBytesPerElement",value:function(e){return Object(s.c)(e.type||5126).BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(e){return Object(u.a)(e.size),Object(s.c)(e.type||5126).BYTES_PER_ELEMENT*e.size}},{key:"resolve",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r(e,[l].concat(n))}}]),Object(o.a)(e,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"_assign",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0!==e.type&&(this.type!==e.type&&c.a.warn("accessor type mismatch"),this.type=e.type,5124!==e.type&&5125!==e.type||(this.integer=!0)),void 0!==e.size&&(this.size!==e.size&&c.a.warn("accessor size mismatch"),this.size=e.size),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.instanced&&(c.a.deprecated("Accessor.instanced","Accessor.divisor"),this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(c.a.deprecated("Accessor.isInstanced","Accessor.divisor"),this.divisor=e.isInstanced?1:0),void 0!==e.index&&(this.index=e.index?1:0),this}},{key:"BYTES_PER_ELEMENT",get:function(){return e.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return e.getBytesPerVertex(this)}}]),e}()},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(1),r=n(9),a=n(8),o=n(2),s=n(10),c=n(15),u=n(34),l=n(6),h=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,t),Object(l.e)(e),(n=Object(r.a)(this,Object(a.a)(t).call(this,e,Object.assign({},o,{target:3553})))).initialize(o),Object.seal(Object(c.a)(Object(c.a)(n))),n}return Object(s.a)(t,e),Object(o.a)(t,null,[{key:"isSupported",value:function(e,t){return u.a.isSupported(e,t)}}]),Object(o.a)(t,[{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,t=this.gl;if(void 0===e)throw new Error("Texture.bind: must specify texture unit");return this.textureUnit=e,t.activeTexture(33984+e),t.bindTexture(this.target,this.handle),e}},{key:"unbind",value:function(){var e=this.gl;if(void 0===this.textureUnit)throw new Error("Texture.unbind: texture unit not specified");return e.activeTexture(33984+this.textureUnit),e.bindTexture(this.target,null),this.textureUnit}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}}]),t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"f",function(){return b}),n.d(t,"g",function(){return y}),n.d(t,"c",function(){return x}),n.d(t,"d",function(){return E}),n.d(t,"e",function(){return w}),n.d(t,"b",function(){return O});var i,r,a,o=n(17),s=n(0),c=n(6),u=n(3),l=(i={},Object(s.a)(i,3042,!1),Object(s.a)(i,32773,new Float32Array([0,0,0,0])),Object(s.a)(i,32777,32774),Object(s.a)(i,34877,32774),Object(s.a)(i,32969,1),Object(s.a)(i,32968,0),Object(s.a)(i,32971,1),Object(s.a)(i,32970,0),Object(s.a)(i,3106,new Float32Array([0,0,0,0])),Object(s.a)(i,3107,[!0,!0,!0,!0]),Object(s.a)(i,2884,!1),Object(s.a)(i,2885,1029),Object(s.a)(i,2929,!1),Object(s.a)(i,2931,1),Object(s.a)(i,2932,513),Object(s.a)(i,2928,new Float32Array([0,1])),Object(s.a)(i,2930,!0),Object(s.a)(i,3024,!0),Object(s.a)(i,36006,null),Object(s.a)(i,2886,2305),Object(s.a)(i,33170,4352),Object(s.a)(i,2849,1),Object(s.a)(i,32823,!1),Object(s.a)(i,32824,0),Object(s.a)(i,10752,0),Object(s.a)(i,32938,1),Object(s.a)(i,32939,!1),Object(s.a)(i,3089,!1),Object(s.a)(i,3088,new Int32Array([0,0,1024,1024])),Object(s.a)(i,2960,!1),Object(s.a)(i,2961,0),Object(s.a)(i,2968,4294967295),Object(s.a)(i,36005,4294967295),Object(s.a)(i,2962,519),Object(s.a)(i,2967,0),Object(s.a)(i,2963,4294967295),Object(s.a)(i,34816,519),Object(s.a)(i,36003,0),Object(s.a)(i,36004,4294967295),Object(s.a)(i,2964,7680),Object(s.a)(i,2965,7680),Object(s.a)(i,2966,7680),Object(s.a)(i,34817,7680),Object(s.a)(i,34818,7680),Object(s.a)(i,34819,7680),Object(s.a)(i,2978,new Int32Array([0,0,1024,1024])),Object(s.a)(i,3333,4),Object(s.a)(i,3317,4),Object(s.a)(i,37440,!1),Object(s.a)(i,37441,!1),Object(s.a)(i,37443,37444),Object(s.a)(i,35723,4352),Object(s.a)(i,36010,null),Object(s.a)(i,35977,!1),Object(s.a)(i,3330,0),Object(s.a)(i,3332,0),Object(s.a)(i,3331,0),Object(s.a)(i,3314,0),Object(s.a)(i,32878,0),Object(s.a)(i,3316,0),Object(s.a)(i,3315,0),Object(s.a)(i,32877,0),i),h=function(e,t,n){return t?e.enable(n):e.disable(n)},d=function(e,t,n){return e.hint(n,t)},f=function(e,t,n){return e.pixelStorei(n,t)},g=(r={},Object(s.a)(r,3042,h),Object(s.a)(r,32773,function(e,t){return e.blendColor.apply(e,Object(o.a)(t))}),Object(s.a)(r,32777,"blendEquation"),Object(s.a)(r,34877,"blendEquation"),Object(s.a)(r,32969,"blendFunc"),Object(s.a)(r,32968,"blendFunc"),Object(s.a)(r,32971,"blendFunc"),Object(s.a)(r,32970,"blendFunc"),Object(s.a)(r,3106,function(e,t){return e.clearColor.apply(e,Object(o.a)(t))}),Object(s.a)(r,3107,function(e,t){return e.colorMask.apply(e,Object(o.a)(t))}),Object(s.a)(r,2884,h),Object(s.a)(r,2885,function(e,t){return e.cullFace(t)}),Object(s.a)(r,2929,h),Object(s.a)(r,2931,function(e,t){return e.clearDepth(t)}),Object(s.a)(r,2932,function(e,t){return e.depthFunc(t)}),Object(s.a)(r,2928,function(e,t){return e.depthRange.apply(e,Object(o.a)(t))}),Object(s.a)(r,2930,function(e,t){return e.depthMask(t)}),Object(s.a)(r,3024,h),Object(s.a)(r,35723,d),Object(s.a)(r,36006,function(e,t){var n=Object(c.n)(e)?36009:36160;return e.bindFramebuffer(n,t)}),Object(s.a)(r,2886,function(e,t){return e.frontFace(t)}),Object(s.a)(r,33170,d),Object(s.a)(r,2849,function(e,t){return e.lineWidth(t)}),Object(s.a)(r,32823,h),Object(s.a)(r,32824,"polygonOffset"),Object(s.a)(r,10752,"polygonOffset"),Object(s.a)(r,35977,h),Object(s.a)(r,32938,"sampleCoverage"),Object(s.a)(r,32939,"sampleCoverage"),Object(s.a)(r,3089,h),Object(s.a)(r,3088,function(e,t){return e.scissor.apply(e,Object(o.a)(t))}),Object(s.a)(r,2960,h),Object(s.a)(r,2961,function(e,t){return e.clearStencil(t)}),Object(s.a)(r,2968,function(e,t){return e.stencilMaskSeparate(1028,t)}),Object(s.a)(r,36005,function(e,t){return e.stencilMaskSeparate(1029,t)}),Object(s.a)(r,2962,"stencilFuncFront"),Object(s.a)(r,2967,"stencilFuncFront"),Object(s.a)(r,2963,"stencilFuncFront"),Object(s.a)(r,34816,"stencilFuncBack"),Object(s.a)(r,36003,"stencilFuncBack"),Object(s.a)(r,36004,"stencilFuncBack"),Object(s.a)(r,2964,"stencilOpFront"),Object(s.a)(r,2965,"stencilOpFront"),Object(s.a)(r,2966,"stencilOpFront"),Object(s.a)(r,34817,"stencilOpBack"),Object(s.a)(r,34818,"stencilOpBack"),Object(s.a)(r,34819,"stencilOpBack"),Object(s.a)(r,2978,function(e,t){return e.viewport.apply(e,Object(o.a)(t))}),Object(s.a)(r,3333,f),Object(s.a)(r,3317,f),Object(s.a)(r,37440,f),Object(s.a)(r,37441,f),Object(s.a)(r,37443,f),Object(s.a)(r,3330,f),Object(s.a)(r,3332,f),Object(s.a)(r,3331,f),Object(s.a)(r,36010,function(e,t){return e.bindFramebuffer(36008,t)}),Object(s.a)(r,3314,f),Object(s.a)(r,32878,f),Object(s.a)(r,3316,f),Object(s.a)(r,3315,f),Object(s.a)(r,32877,f),r),p={blendEquation:function(e,t){return e.blendEquationSeparate(t[32777],t[34877])},blendFunc:function(e,t){return e.blendFuncSeparate(t[32969],t[32968],t[32971],t[32970])},polygonOffset:function(e,t){return e.polygonOffset(t[32824],t[10752])},sampleCoverage:function(e,t){return e.sampleCoverage(t[32938],t[32939])},stencilFuncFront:function(e,t){return e.stencilFuncSeparate(1028,t[2962],t[2967],t[2963])},stencilFuncBack:function(e,t){return e.stencilFuncSeparate(1029,t[34816],t[36003],t[36004])},stencilOpFront:function(e,t){return e.stencilOpSeparate(1028,t[2964],t[2965],t[2966])},stencilOpBack:function(e,t){return e.stencilOpSeparate(1029,t[34817],t[34818],t[34819])}},v=function(e,t){return e.isEnabled(t)},m=(a={},Object(s.a)(a,3042,v),Object(s.a)(a,2884,v),Object(s.a)(a,2929,v),Object(s.a)(a,3024,v),Object(s.a)(a,32823,v),Object(s.a)(a,32926,v),Object(s.a)(a,32928,v),Object(s.a)(a,3089,v),Object(s.a)(a,2960,v),Object(s.a)(a,35977,v),a),_=function(e,t){if(e===t)return!0;var n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1};function b(e,t,n){var i=m[t],r=i?i(e,Number(t)):e.getParameter(Number(t)),a=g[t];return Object(u.a)("function"==typeof a),a(e,n,Number(t)),r}function y(e,t){var n={};for(var i in t){var r=Number(i),a=g[i];a&&("string"==typeof a?n[a]=!0:a(e,t[i],r))}var o=e.state&&e.state.cache;if(o){var s=Object.assign({},o,t);for(var c in n){(0,p[c])(e,s)}}}function x(e,t){var n=m[t];return n?n(e,Number(t)):e.getParameter(Number(t))}function E(e,t){t=t||l;var n=Array.isArray(t)?t:Object.keys(t),i={},r=!0,a=!1,o=void 0;try{for(var s,c=n[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value;i[u]=x(e,u)}}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return i}function w(e){y(e,Object.assign({},l,{}))}function O(e){var t=E(l),n={};for(var i in l)_(t[i],l[i])||(n[i]=t[i]);return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var i=n(57),r="2.0.1",a=Object(i.a)()},function(e,t,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function i(e,t){if(e===t)return 0;for(var n=e.length,i=t.length,r=0,a=Math.min(n,i);r<a;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0}function r(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=n(73),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,c="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function l(e){return!r(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var h=e.exports=m,d=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(a.isFunction(e)){if(c)return e.name;var t=e.toString().match(d);return t&&t[1]}}function g(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function p(e){if(c||!a.isFunction(e))return a.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function v(e,t,n,i,r){throw new h.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:r})}function m(e,t){e||v(e,!0,t,"==",h.ok)}function _(e,t,n,o){if(e===t)return!0;if(r(e)&&r(t))return 0===i(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(l(e)&&l(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(r(e)!==r(t))return!1;var c=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return-1!==c&&c===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,n,i){if(null===e||void 0===e||null===t||void 0===t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var r=b(e),o=b(t);if(r&&!o||!r&&o)return!1;if(r)return e=s.call(e),t=s.call(t),_(e,t,n);var c,u,l=E(e),h=E(t);if(l.length!==h.length)return!1;for(l.sort(),h.sort(),u=l.length-1;u>=0;u--)if(l[u]!==h[u])return!1;for(u=l.length-1;u>=0;u--)if(c=l[u],!_(e[c],t[c],n,i))return!1;return!0}(e,t,n,o))}return n?e===t:e==t}function b(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function y(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function x(e,t,n,i){var r;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(i=n,n=null),r=function(e){var t;try{e()}catch(e){t=e}return t}(t),i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),e&&!r&&v(r,n,"Missing expected exception"+i);var o="string"==typeof i,s=!e&&a.isError(r),c=!e&&r&&!n;if((s&&o&&y(r,n)||c)&&v(r,n,"Got unwanted exception"+i),e&&r&&n&&!y(r,n)||!e&&r)throw r}h.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return g(p(e.actual),128)+" "+e.operator+" "+g(p(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,r=f(t),a=i.indexOf("\n"+r);if(a>=0){var o=i.indexOf("\n",a+1);i=i.substring(o+1)}this.stack=i}}},a.inherits(h.AssertionError,Error),h.fail=v,h.ok=m,h.equal=function(e,t,n){e!=t&&v(e,t,n,"==",h.equal)},h.notEqual=function(e,t,n){e==t&&v(e,t,n,"!=",h.notEqual)},h.deepEqual=function(e,t,n){_(e,t,!1)||v(e,t,n,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(e,t,n){_(e,t,!0)||v(e,t,n,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(e,t,n){_(e,t,!1)&&v(e,t,n,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function e(t,n,i){_(t,n,!0)&&v(t,n,i,"notDeepStrictEqual",e)},h.strictEqual=function(e,t,n){e!==t&&v(e,t,n,"===",h.strictEqual)},h.notStrictEqual=function(e,t,n){e===t&&v(e,t,n,"!==",h.notStrictEqual)},h.throws=function(e,t,n){x(!0,e,t,n)},h.doesNotThrow=function(e,t,n){x(!1,e,t,n)},h.ifError=function(e){if(e)throw e};var E=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}}).call(this,n(37))},function(e,t,n){"use strict";function i(e){return e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s")}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}function a(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(n=Math.min(n,i/e.width));var a=e.width*n,o=e.height*n,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),s]}n.d(t,"b",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"a",function(){return a})},function(e,t){var n,i,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var c,u=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!l){var e=s(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new g(e,t)),1!==u.length||l||s(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"c",function(){return u}),n.d(t,"d",function(){return l}),n.d(t,"b",function(){return h}),n.d(t,"a",function(){return d});var i=n(24),r=n(3),a=34962,o=32874,s="Invalid WebGLRenderingContext",c="Requires WebGL2";function u(e){return Boolean(e&&(e instanceof i.c||e.ARRAY_BUFFER===a))}function l(e){return Boolean(e&&(e instanceof i.a||e.TEXTURE_BINDING_3D===o))}function h(e){Object(r.a)(u(e),s)}function d(e){Object(r.a)(l(e),c)}},function(e,t,n){"use strict";(function(e){var i=n(19),r=n(64),a=!("object"===(void 0===e?"undefined":Object(i.a)(e))&&"[object process]"===String(e)&&!e.browser)||r.a;t.a=a}).call(this,n(43))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return f}),n.d(t,"c",function(){return g}),n.d(t,"b",function(){return p});var i=n(1),r=n(2),a=n(0),o=n(39),s=n(3),c=function(e,t){var n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return e===t},u={enable:function(e,t){return e(Object(a.a)({},t,!0))},disable:function(e,t){return e(Object(a.a)({},t,!1))},pixelStorei:function(e,t,n){return e(Object(a.a)({},t,n))},hint:function(e,t,n){return e(Object(a.a)({},t,n))},bindFramebuffer:function(e,t,n){var i;switch(t){case 36160:return e((i={},Object(a.a)(i,36006,n),Object(a.a)(i,36010,n),i));case 36009:return e(Object(a.a)({},36006,n));case 36008:return e(Object(a.a)({},36010,n));default:return null}},blendColor:function(e,t,n,i,r){return e(Object(a.a)({},32773,new Float32Array([t,n,i,r])))},blendEquation:function(e,t){var n;return e((n={},Object(a.a)(n,32777,t),Object(a.a)(n,34877,t),n))},blendEquationSeparate:function(e,t,n){var i;return e((i={},Object(a.a)(i,32777,t),Object(a.a)(i,34877,n),i))},blendFunc:function(e,t,n){var i;return e((i={},Object(a.a)(i,32969,t),Object(a.a)(i,32968,n),Object(a.a)(i,32971,t),Object(a.a)(i,32970,n),i))},blendFuncSeparate:function(e,t,n,i,r){var o;return e((o={},Object(a.a)(o,32969,t),Object(a.a)(o,32968,n),Object(a.a)(o,32971,i),Object(a.a)(o,32970,r),o))},clearColor:function(e,t,n,i,r){return e(Object(a.a)({},3106,new Float32Array([t,n,i,r])))},clearDepth:function(e,t){return e(Object(a.a)({},2931,t))},clearStencil:function(e,t){return e(Object(a.a)({},2961,t))},colorMask:function(e,t,n,i,r){return e(Object(a.a)({},3107,[t,n,i,r]))},cullFace:function(e,t){return e(Object(a.a)({},2885,t))},depthFunc:function(e,t){return e(Object(a.a)({},2932,t))},depthRange:function(e,t,n){return e(Object(a.a)({},2928,new Float32Array([t,n])))},depthMask:function(e,t){return e(Object(a.a)({},2930,t))},frontFace:function(e,t){return e(Object(a.a)({},2886,t))},lineWidth:function(e,t){return e(Object(a.a)({},2849,t))},polygonOffset:function(e,t,n){var i;return e((i={},Object(a.a)(i,32824,t),Object(a.a)(i,10752,n),i))},sampleCoverage:function(e,t,n){var i;return e((i={},Object(a.a)(i,32938,t),Object(a.a)(i,32939,n),i))},scissor:function(e,t,n,i,r){return e(Object(a.a)({},3088,new Int32Array([t,n,i,r])))},stencilMask:function(e,t){var n;return e((n={},Object(a.a)(n,2968,t),Object(a.a)(n,36005,t),n))},stencilMaskSeparate:function(e,t,n){return e(Object(a.a)({},1028===t?2968:36005,n))},stencilFunc:function(e,t,n,i){var r;return e((r={},Object(a.a)(r,2962,t),Object(a.a)(r,2967,n),Object(a.a)(r,2963,i),Object(a.a)(r,34816,t),Object(a.a)(r,36003,n),Object(a.a)(r,36004,i),r))},stencilFuncSeparate:function(e,t,n,i,r){var o;return e((o={},Object(a.a)(o,1028===t?2962:34816,n),Object(a.a)(o,1028===t?2967:36003,i),Object(a.a)(o,1028===t?2963:36004,r),o))},stencilOp:function(e,t,n,i){var r;return e((r={},Object(a.a)(r,2964,t),Object(a.a)(r,2965,n),Object(a.a)(r,2966,i),Object(a.a)(r,34817,t),Object(a.a)(r,34818,n),Object(a.a)(r,34819,i),r))},stencilOpSeparate:function(e,t,n,i,r){var o;return e((o={},Object(a.a)(o,1028===t?2964:34817,n),Object(a.a)(o,1028===t?2965:34818,i),Object(a.a)(o,1028===t?2966:34819,r),o))},viewport:function(e,t,n,i,r){return e(Object(a.a)({},2978,new Int32Array([t,n,i,r])))}};function l(e,t){var n=e[t].bind(e);e[t]=function(){var t=arguments.length<=0?void 0:arguments[0];return t in e.state.cache||(e.state.cache[t]=n.apply(void 0,arguments)),e.state.enable?e.state.cache[t]:n.apply(void 0,arguments)},Object.defineProperty(e[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function h(e,t,n){var i=e[t].bind(e);e[t]=function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s,c=n.apply(void 0,[e.state._updateCache].concat(a)),u=c.valueChanged,l=c.oldValue;u&&((s=e.state).log.apply(s,["gl.".concat(t)].concat(a)),i.apply(void 0,a));return l},Object.defineProperty(e[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}var d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.copyState,a=void 0!==r&&r,s=n.log,c=void 0===s?function(){}:s;Object(i.a)(this,e),this.gl=t,this.stateStack=[],this.enable=!0,this.cache=a?Object(o.d)(t):Object.assign({},o.a),this.log=c,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return Object(r.a)(e,[{key:"push",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stateStack.push({})}},{key:"pop",value:function(){Object(s.a)(this.stateStack.length>0);var e=this.stateStack[this.stateStack.length-1];Object(o.g)(this.gl,e,this.cache),this.stateStack.pop()}},{key:"_updateCache",value:function(e){var t,n=!1,i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var r in e)Object(s.a)(void 0!==r),c(e[r],this.cache[r])||(n=!0,t=this.cache[r],!i||r in i||(i[r]=this.cache[r]),this.cache[r]=e[r]);return{valueChanged:n,oldValue:t}}}]),e}();function f(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.enable,r=void 0===i||i,a=n.copyState;if(Object(s.a)(void 0!==a),!t.state){var o=void 0!==e?e:window;for(var c in o.polyfillContext&&o.polyfillContext(t),t.state=new d(t,{copyState:a,enable:r}),u){h(t,c,u[c])}l(t,"getParameter"),l(t,"isEnabled")}return t.state.enable=r,t}function g(e){e.state||f(e,{copyState:!1}),e.state.push()}function p(e){Object(s.a)(e.state),e.state.pop()}}).call(this,n(37))},function(e,t,n){"use strict";(function(e,i){n.d(t,"a",function(){return r});"object"!=typeof e||"[object process]"!==String(e)||e.browser,"undefined"!=typeof window&&window;const r=void 0!==i?i:window;"undefined"!=typeof document&&document}).call(this,n(43),n(37))},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"a",function(){return a});var i="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",r="undefined"!=typeof window?window:e,a=(void 0!==e||window,"undefined"!=typeof document&&document,!1);try{var o={get passive(){a=!0}};r.addEventListener("test",o,o),r.removeEventListener("test",o,o)}catch(e){}}).call(this,n(37))},,function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(1),r=n(2),a=n(9),o=n(8),s=n(10),c=n(15),u=n(34),l=n(3),h=[34069,34070,34071,34072,34073,34074],d=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,t),(n=Object(a.a)(this,Object(o.a)(t).call(this,e,Object.assign({},r,{target:34067})))).initialize(r),Object.seal(Object(c.a)(Object(c.a)(n))),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.format,n=void 0===t?6408:t,i=e.mipmaps,r=void 0===i||i,a=e.width,o=void 0===a?1:a,s=e.height,c=void 0===s?1:s,u=e.type,h=void 0===u?5121:u,d=e.dataFormat,f=this._deduceParameters({format:n,type:h,dataFormat:d});h=f.type,d=f.dataFormat;var g=this._deduceImageSize({data:e[34069],width:o,height:c});o=g.width,c=g.height,Object(l.a)(o===c),this.setCubeMapImageData(e),r&&this.generateMipmap(e),this.opts=e}},{key:"subImage",value:function(e){var t=e.face,n=e.data,i=e.x,r=void 0===i?0:i,a=e.y,o=void 0===a?0:a,s=e.mipmapLevel,c=void 0===s?0:s;return this._subImage({target:t,data:n,x:r,y:o,mipmapLevel:c})}},{key:"setCubeMapImageData",value:function(e){var t=e.width,n=e.height,i=e.pixels,r=e.data,a=e.border,o=void 0===a?0:a,s=e.format,c=void 0===s?6408:s,u=e.type,l=void 0===u?5121:u,d=(e.generateMipmap,this.gl);if(i=i||r,this.bind(),this.width||this.height)for(var f=0;f<h.length;f++){var g=h[f];d.texImage2D(g,0,c,t,n,o,c,l,i[g])}else for(var p=0;p<h.length;p++){var v=h[p];d.texImage2D(v,0,c,c,l,i[v])}}},{key:"bind",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).index;return void 0!==e&&this.gl.activeTexture(33984+e),this.gl.bindTexture(34067,this.handle),e}},{key:"unbind",value:function(){return this.gl.bindTexture(34067,null),this}}]),t}(u.a);d.FACES=h},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(1),r=n(2),a=n(9),o=n(8),s=n(10),c=n(60),u=n(31),l=function(e,t){if(!e)throw new Error(t)},h=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"lengthSquared",value:function(){for(var e=0,t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSquared(e))}},{key:"distanceSquared",value:function(e){for(var t=0,n=0;n<this.ELEMENTS;++n){var i=this[n]-e[n];t+=i*i}return Object(u.a)(t)}},{key:"dot",value:function(e){for(var t=0,n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Object(u.a)(t)}},{key:"normalize",value:function(){var e=this.magnitude();if(0!==e)for(var t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<t.length;i++)for(var r=t[i],a=0;a<this.ELEMENTS;++a)this[a]+=r[a];return this.check()}},{key:"subtract",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<t.length;i++)for(var r=t[i],a=0;a<this.ELEMENTS;++a)this[a]-=r[a];return this.check()}},{key:"multiply",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<t.length;i++)for(var r=t[i],a=0;a<this.ELEMENTS;++a)this[a]*=r[a];return this.check()}},{key:"divide",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<t.length;i++)for(var r=t[i],a=0;a<this.ELEMENTS;++a)this[a]/=r[a];return this.check()}},{key:"scale",value:function(e){if(Array.isArray(e))return this.multiply(e);for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"scaleAndAdd",value:function(e,t){for(var n=0;n<this.ELEMENTS;++n)this[n]=this[n]*t+e[n];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(e){return this.distance(e)}},{key:"distanceToSquared",value:function(e){return this.distanceSquared(e)}},{key:"getComponent",value:function(e){return l(e>=0&&e<this.ELEMENTS,"index is out of range"),Object(u.a)(this[e])}},{key:"setComponent",value:function(e,t){return l(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}},{key:"addVectors",value:function(e,t){return this.copy(e).add(t)}},{key:"subVectors",value:function(e,t){return this.copy(e).subtract(t)}},{key:"multiplyVectors",value:function(e,t){return this.copy(e).multiply(t)}},{key:"addScaledVector",value:function(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}},{key:"x",get:function(){return this[0]},set:function(e){return this[0]=Object(u.a)(e)}},{key:"y",get:function(){return this[1]},set:function(e){return this[1]=Object(u.a)(e)}}]),t}(c.a)},,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(38),r=n(50),a=n(56),o=n(41),s=n.n(o);function c(e,t){s()(e instanceof i.a||e instanceof r.a||e instanceof a.a);var n=e.constructor,o=e.gl,c=e.width,u=e.height,l=e.format,h=e.type,d=e.dataFormat,f=e.border,g=e.mipmaps;return new n(o,Object.assign({width:c,height:u,format:l,type:h,dataFormat:d,border:f,mipmaps:g},t))}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(18);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=i.d.navigator||{},n=e.userAgent||t.userAgent||"",r=-1!==n.indexOf("MSIE "),a=-1!==n.indexOf("Trident/");return r||a}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(28);function r(e,t,n,r){var a="See luma.gl ".concat(n," Upgrade Guide at http://uber.github.io/luma.gl/#/documentation/overview/upgrade-guide"),o=Object.getPrototypeOf(e);r.forEach(function(e){o.methodName||(o[e]=function(){throw i.a.removed("Calling removed method ".concat(t,".").concat(e,": "),a),new Error(e)})})}},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n(1),r=n(9),a=n(8),o=n(2),s=n(10),c=n(15),u=n(6),l=n(20),h=n(34),d=n(16),f=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,t),Object(u.d)(e),(n=Object(r.a)(this,Object(a.a)(t).call(this,e,Object.assign({},o,{target:o.target||32879})))).width=null,n.height=null,n.depth=null,Object.seal(Object(c.a)(Object(c.a)(n))),n.setImageData(o),o.generateMipmap&&n.generateMipmap(),n}return Object(s.a)(t,e),Object(o.a)(t,null,[{key:"isSupported",value:function(e){return Object(u.n)(e)}}]),Object(o.a)(t,[{key:"initialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.opts=Object.assign({},this.opts,t);var n=this.opts,i=n.pixels,r=n.settings;r&&(Object(l.g)(r,function(){i&&e.setImage3D(e.opts)}),this.setParameters(t))}},{key:"setImage3D",value:function(e){var t=e.level,n=void 0===t?0:t,i=e.internalformat,r=void 0===i?6408:i,a=e.width,o=e.height,s=e.depth,c=void 0===s?1:s,u=e.border,l=void 0===u?0:u,h=e.format,f=e.type,g=void 0===f?5121:f,p=e.offset,v=void 0===p?0:p,m=e.pixels;ArrayBuffer.isView(m)?this.gl.texImage3D(this.target,n,r,a,o,c,l,h,g,m):m instanceof d.a&&(this.gl.bindBuffer(35052,m.handle),this.gl.texImage3D(this.target,n,r,a,o,c,l,h,g,v),this.gl.bindBuffer(35052,m.handle))}}]),t}(h.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return a});var i=n(19),r=n(58);function a(){return!("object"===(void 0===e?"undefined":Object(i.a)(e))&&"[object process]"===String(e)&&!e.browser)||Object(r.a)()}}).call(this,n(43))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return r});var i=n(19);function r(t){if("undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===Object(i.a)(e.versions)&&Boolean(e.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=t||n;return!!(r&&r.indexOf("Electron")>=0)}}).call(this,n(43))},function(e,t,n){"use strict";function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(1),r=n(2),a=n(9),o=n(8),s=n(10),c=n(31);var u=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"clone",value:function(){return(new this.constructor).copy(this).check()}},{key:"copy",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=e[t];return this.check()}},{key:"set",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=(e<0||arguments.length<=e?void 0:arguments[e])||0;return this.check()}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}},{key:"toString",value:function(){return this.formatString(c.c)}},{key:"formatString",value:function(e){for(var t="",n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+Object(c.f)(this[n],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"equals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(!Object(c.e)(this[t],e[t]))return!1;return!0}},{key:"exactEquals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}},{key:"negate",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}},{key:"inverse",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=1/this[e];return this.check()}},{key:"lerp",value:function(e,t,n){void 0===n&&(n=t,t=e,e=this);for(var i=0;i<this.ELEMENTS;++i){var r=e[i];this[i]=r+n*(t[i]-r)}return this.check()}},{key:"min",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}},{key:"max",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}},{key:"clamp",value:function(e,t){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}},{key:"validate",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=e&&e.length===this.ELEMENTS,n=0;n<this.ELEMENTS;++n)t=t&&Number.isFinite(e[n]);return t}},{key:"check",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;if(c.c.debug&&!this.validate(e))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"sub",value:function(e){return this.subtract(e)}},{key:"setScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}},{key:"addScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}},{key:"subScalar",value:function(e){return this.addScalar(-e)}},{key:"multiplyScalar",value:function(e){return this.scale(e)}},{key:"divideScalar",value:function(e){return this.scale(1/e)}},{key:"clampScalar",value:function(e,t){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array))},function(e,t,n){"use strict";(function(e){var t,i=n(0),r=n(65);function a(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function o(e){return e&&!0}var s=(t={},Object(i.a)(t,"OES_vertex_array_object",{meta:{suffix:"OES"},createVertexArray:function(){a(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),Object(i.a)(t,"ANGLE_instanced_arrays",{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(e,t){a(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),Object(i.a)(t,"WEBGL_draw_buffers",{meta:{suffix:"WEBGL"},drawBuffers:function(){a(!1)}}),Object(i.a)(t,"EXT_disjoint_timer_query",{meta:{suffix:"EXT"},createQuery:function(){a(!1)},deleteQuery:function(){a(!1)},beginQuery:function(){a(!1)},endQuery:function(){},getQuery:function(e,t){return this.getQueryObject(e,t)},getQueryParameter:function(e,t){return this.getQueryObject(e,t)},queryCounter:function(){},getQueryObject:function(){}}),Object(i.a)(t,"EXT_disjoint_timer_query_webgl2",{meta:{suffix:"EXT"},queryCounter:null}),Object(i.a)(t,"OVERRIDES",{readBuffer:function(e,t,n){o(e)&&t(n)},getVertexAttrib:function(e,t,n,i){var r,a=function(e,t){return{webgl2:o(e),ext:e.getExtension(t)}}(e,"ANGLE_instanced_arrays"),s=a.webgl2,c=a.ext;switch(i){case 35069:r=!!s&&void 0;break;case 35070:r=s||c?void 0:0}return void 0!==r?r:t(n,i)},getProgramParameter:function(e,t,n,i){if(!o(e))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return t(n,i)},getInternalformatParameter:function(e,t,n,i,r){if(!o(e))switch(r){case 32937:return new Int32Array([0])}return e.getInternalformatParameter(n,i,r)},getTexParameter:function(e,t,n,i){switch(i){case 34046:var r=e.luma.extensions.EXT_texture_filter_anisotropic;i=r&&r.TEXTURE_MAX_ANISOTROPY_EXT||34046}return t(n,i)},getParameter:r.a,hint:function(e,t,n,i){return t(n,i)}}),t);function c(e,t){var n=t.extension,i=t.target,r=t.target2,o=s[n];a(o);var c=o.meta,u=(void 0===c?{}:c).suffix,l=void 0===u?"":u,h=e.getExtension(n);Object.keys(o).forEach(function(t){var n="".concat(t).concat(l),a=null;"meta"===t||"function"==typeof e[t]||(h&&"function"==typeof h[n]?a=function(){return h[n].apply(h,arguments)}:"function"==typeof o[t]&&(a=o[t].bind(i))),a&&(i[t]=a,r[t]=a)})}(void 0!==e?e:window).polyfillContext=function(e){if(e.luma=e.luma||{},function(e){e.luma.extensions={};var t=e.getSupportedExtensions()||[],n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;e.luma[s]=e.getExtension(s)}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}(e),!e.luma.polyfilled){for(var t in s)"overrides"!==t&&c(e,{extension:t,target:e.luma,target2:e});!function(e,t){var n=t.target,i=t.target2,r=s.OVERRIDES;Object.keys(r).forEach(function(t){if("function"==typeof r[t]){var a=e[t]?e[t].bind(e):function(){},o=r[t].bind(null,e,a);n[t]=o,i[t]=o}})}(e,{target:e.luma,target2:e}),e.luma.polyfilled=!0}return e}}).call(this,n(37))},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(1),r=n(2),a=n(9),o=n(8),s=n(10),c=n(51),u=n(31),l=n(35),h=[0,0,0],d=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(i.a)(this,t),e=Object(a.a)(this,Object(o.a)(t).call(this)),Array.isArray(n)&&1===arguments.length?e.copy(n):e.set(n,r,s),e}return Object(s.a)(t,e),Object(r.a)(t,[{key:"angle",value:function(e){return l.a(this,e)}},{key:"cross",value:function(e){return l.b(this,this,e),this.check()}},{key:"rotateX",value:function(e){var t=e.radians,n=e.origin,i=void 0===n?h:n;return l.e(this,this,i,t),this.check()}},{key:"rotateY",value:function(e){var t=e.radians,n=e.origin,i=void 0===n?h:n;return l.f(this,this,i,t),this.check()}},{key:"rotateZ",value:function(e){var t=e.radians,n=e.origin,i=void 0===n?h:n;return l.g(this,this,i,t),this.check()}},{key:"operation",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(e){return this[2]=Object(u.a)(e)}}]),t}(c.a)},function(e,t,n){"use strict";n.r(t);var i=n(45),r=n(18),a=n(28);n(61);n.d(t,"global",function(){return r.b});if(r.b.luma&&"6.4.2"!==r.b.luma.VERSION)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(r.b.luma.VERSION," vs ").concat("6.4.2"));r.b.luma||(i.a&&a.a.log(0,"luma.gl ".concat("6.4.2"," - ").concat("set luma.log.priority=1 (or higher) to trace rendering"))(),r.b.luma=r.b.luma||{VERSION:"6.4.2",version:"6.4.2",log:a.a,stats:{},globals:{modules:{},nodeIO:{}}});t.default=r.b.luma},function(e,t,n){"use strict";(function(e){var i=n(19);t.a="undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type||!(void 0===e||"object"!==Object(i.a)(e.versions)||!Boolean(e.versions.electron))||"object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,n(43))},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i,r=n(0),a=function(e){return s(e)?void 0:0},o=(i={},Object(r.a)(i,3074,function(e){return s(e)?void 0:36064}),Object(r.a)(i,35723,function(e){return s(e)?void 0:4352}),Object(r.a)(i,35977,a),Object(r.a)(i,32937,a),Object(r.a)(i,36795,function(e,t){var n=s(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?t(n.GPU_DISJOINT_EXT):0}),Object(r.a)(i,37445,function(e,t){var n=e.getExtension("WEBGL_debug_renderer_info");return t(n&&n.UNMASKED_VENDOR_WEBGL||7936)}),Object(r.a)(i,37446,function(e,t){var n=e.getExtension("WEBGL_debug_renderer_info");return t(n&&n.UNMASKED_RENDERER_WEBGL||7937)}),Object(r.a)(i,34047,function(e,t){var n=e.luma.extensions.EXT_texture_filter_anisotropic;return n?t(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}),Object(r.a)(i,32883,a),Object(r.a)(i,35071,a),Object(r.a)(i,37447,a),Object(r.a)(i,36063,function(e,t){if(!s(e)){var n=e.getExtension("WEBGL_draw_buffers");return n?t(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}}),Object(r.a)(i,35379,a),Object(r.a)(i,35374,a),Object(r.a)(i,35377,a),Object(r.a)(i,34852,function(e){if(!s(e)){var t=e.getExtension("WEBGL_draw_buffers");return t?t.MAX_DRAW_BUFFERS_WEBGL:0}}),Object(r.a)(i,36203,function(e){return e.getExtension("OES_element_index")?2147483647:65535}),Object(r.a)(i,33001,function(e){return e.getExtension("OES_element_index")?16777216:65535}),Object(r.a)(i,33e3,function(e){return 16777216}),Object(r.a)(i,37157,a),Object(r.a)(i,35373,a),Object(r.a)(i,35657,a),Object(r.a)(i,36183,a),Object(r.a)(i,37137,a),Object(r.a)(i,34045,a),Object(r.a)(i,35978,a),Object(r.a)(i,35979,a),Object(r.a)(i,35968,a),Object(r.a)(i,35376,a),Object(r.a)(i,35375,a),Object(r.a)(i,35659,a),Object(r.a)(i,37154,a),Object(r.a)(i,35371,a),Object(r.a)(i,35658,a),Object(r.a)(i,35076,a),Object(r.a)(i,35077,a),Object(r.a)(i,35380,a),i);function s(e){return e&&!0}function c(e,t,n){var i=o[n],r="function"==typeof i?i(e,t,n):i;return void 0!==r?r:t(n)}},function(e,t,n){"use strict";function i(e,t,n){n=n||2;var i,s,c,u,l,f,p,v=t&&t.length,m=v?t[0]*n:e.length,_=r(e,0,m,n,!0),b=[];if(!_)return b;if(v&&(_=function(e,t,n,i){var o,s,c,u,l,f=[];for(o=0,s=t.length;o<s;o++)c=t[o]*i,u=o<s-1?t[o+1]*i:e.length,(l=r(e,c,u,i,!1))===l.next&&(l.steiner=!0),f.push(g(l));for(f.sort(h),o=0;o<f.length;o++)d(f[o],n),n=a(n,n.next);return n}(e,t,_,n)),e.length>80*n){i=c=e[0],s=u=e[1];for(var y=n;y<m;y+=n)l=e[y],f=e[y+1],l<i&&(i=l),f<s&&(s=f),l>c&&(c=l),f>u&&(u=f);p=0!==(p=Math.max(c-i,u-s))?1/p:0}return o(_,b,n,i,s,p),b}function r(e,t,n,i,r){var a,o;if(r===S(e,t,n,i)>0)for(a=t;a<n;a+=i)o=E(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=E(a,e[a],e[a+1],o);return o&&_(o,o.next)&&(w(o),o=o.next),o}function a(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!_(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{if(w(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function o(e,t,n,i,r,h,d){if(e){!d&&h&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=f(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,c,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(c=u;s>0||c>0&&i;)0!==s&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,u*=2}while(o>1)}(r)}(e,i,r,h);for(var g,p,v=e;e.prev!==e.next;)if(g=e.prev,p=e.next,h?c(e,i,r,h):s(e))t.push(g.i/n),t.push(e.i/n),t.push(p.i/n),w(e),e=p.next,v=p.next;else if((e=p)===v){d?1===d?o(e=u(e,t,n),t,n,i,r,h,2):2===d&&l(e,t,n,i,r,h):o(a(e),t,n,i,r,h,1);break}}}function s(e){var t=e.prev,n=e,i=e.next;if(m(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(p(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&m(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function c(e,t,n,i){var r=e.prev,a=e,o=e.next;if(m(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,c=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,u=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,l=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=f(s,c,t,n,i),d=f(u,l,t,n,i),g=e.prevZ,v=e.nextZ;g&&g.z>=h&&v&&v.z<=d;){if(g!==e.prev&&g!==e.next&&p(r.x,r.y,a.x,a.y,o.x,o.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,v!==e.prev&&v!==e.next&&p(r.x,r.y,a.x,a.y,o.x,o.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;g&&g.z>=h;){if(g!==e.prev&&g!==e.next&&p(r.x,r.y,a.x,a.y,o.x,o.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;v&&v.z<=d;){if(v!==e.prev&&v!==e.next&&p(r.x,r.y,a.x,a.y,o.x,o.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function u(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!_(r,a)&&b(r,i,i.next,a)&&y(r,a)&&y(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),w(i),w(i.next),i=e=a),i=i.next}while(i!==e);return i}function l(e,t,n,i,r,s){var c=e;do{for(var u=c.next.next;u!==c.prev;){if(c.i!==u.i&&v(c,u)){var l=x(c,u);return c=a(c,c.next),l=a(l,l.next),o(c,t,n,i,r,s),void o(l,t,n,i,r,s)}u=u.next}c=c.next}while(c!==e)}function h(e,t){return e.x-t.x}function d(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n.prev;var c,u=n,l=n.x,h=n.y,d=1/0;i=n.next;for(;i!==u;)r>=i.x&&i.x>=l&&r!==i.x&&p(a<h?r:o,a,l,h,a<h?o:r,a,i.x,i.y)&&((c=Math.abs(a-i.y)/(r-i.x))<d||c===d&&i.x>n.x)&&y(i,e)&&(n=i,d=c),i=i.next;return n}(e,t)){var n=x(t,e);a(n,n.next)}}function f(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function p(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&y(e,t)&&y(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function m(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,i){return!!(_(e,t)&&_(n,i)||_(e,i)&&_(n,t))||m(e,t,n)>0!=m(e,t,i)>0&&m(n,i,e)>0!=m(n,i,t)>0}function y(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function x(e,t){var n=new O(e.i,e.x,e.y),i=new O(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function E(e,t,n,i){var r=new O(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function O(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}e.exports=i,e.exports.default=i,i.deviation=function(e,t,n,i){var r=t&&t.length,a=r?t[0]*n:e.length,o=Math.abs(S(e,0,a,n));if(r)for(var s=0,c=t.length;s<c;s++){var u=t[s]*n,l=s<c-1?t[s+1]*n:e.length;o-=Math.abs(S(e,u,l,n))}var h=0;for(s=0;s<i.length;s+=3){var d=i[s]*n,f=i[s+1]*n,g=i[s+2]*n;h+=Math.abs((e[d]-e[g])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[g+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[r][a][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},function(e,t,n){"use strict";e.exports=r;var i=1e20;function r(e,t,n,i,r,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function a(e,t,n,i,r,a,s){for(var c=0;c<t;c++){for(var u=0;u<n;u++)i[u]=e[u*t+c];for(o(i,r,a,s,n),u=0;u<n;u++)e[u*t+c]=r[u]}for(u=0;u<n;u++){for(c=0;c<t;c++)i[c]=e[u*t+c];for(o(i,r,a,s,t),c=0;c<t;c++)e[u*t+c]=Math.sqrt(r[c])}}function o(e,t,n,r,a){n[0]=0,r[0]=-i,r[1]=+i;for(var o=1,s=0;o<a;o++){for(var c=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);c<=r[s];)s--,c=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);n[++s]=o,r[s]=c,r[s+1]=+i}for(o=0,s=0;o<a;o++){for(;r[s+1]<o;)s++;t[o]=(o-n[s])*(o-n[s])+e[n[s]]}}r.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var o=t.data[4*r+3]/255;this.gridOuter[r]=1===o?0:0===o?i:Math.pow(Math.max(0,.5-o),2),this.gridInner[r]=1===o?i:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(a(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),a(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var s=this.gridOuter[r]-this.gridInner[r];n[r]=Math.max(0,Math.min(255,Math.round(255-255*(s/this.radius+this.cutoff))))}return n}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return u});var i=n(22),r=n.n(i);function a(){}const o={container:r.a.object,mapboxApiAccessToken:r.a.string,attributionControl:r.a.bool,preserveDrawingBuffer:r.a.bool,onLoad:r.a.func,onError:r.a.func,reuseMaps:r.a.bool,reuseMap:r.a.bool,transformRequest:r.a.func,mapStyle:r.a.string,visible:r.a.bool,width:r.a.number,height:r.a.number,viewState:r.a.object,longitude:r.a.number,latitude:r.a.number,zoom:r.a.number,bearing:r.a.number,pitch:r.a.number,altitude:r.a.number,mapOptions:r.a.object},s={mapboxApiAccessToken:function(){let t=null;if("undefined"!=typeof window&&window.location){const e=window.location.search.match(/access_token=([^&\/]*)/);t=e&&e[1]}t||void 0===e||(t=t||e.env.MapboxAccessToken||e.env.REACT_APP_MAPBOX_ACCESS_TOKEN);return t||null}(),preserveDrawingBuffer:!1,attributionControl:!0,preventStyleDiffing:!1,onLoad:a,onError:a,reuseMaps:!1,reuseMap:!1,transformRequest:null,mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,bearing:0,pitch:0,altitude:1.5,width:0,height:0,mapOptions:{}};function c(e,t="component"){e.debug&&r.a.checkPropTypes(o,e,"prop",t)}class u{constructor(e){if(!e.mapboxgl)throw new Error("Mapbox not available");if(!u.initialized&&console.debug){u.initialized=!0;const t="6.4.10";console.debug(`react-map-gl: ${t} using mapbox-gl v${e.mapboxgl.version}`),this._checkStyleSheet(e.mapboxgl.version)}this.props={},this._initialize(e)}finalize(){return this._destroy(),this}setProps(e){return this._update(this.props,e),this}resize(){return this._map.resize(),this}getMap(){return this._map}_create(e){if((e.reuseMaps||e.reuseMap)&&u.savedMap){this._map=this.map=u.savedMap;const t=this._map.getContainer(),n=e.container;for(n.classList.add("mapboxgl-map");t.childNodes.length>0;)n.appendChild(t.childNodes[0]);this._map._container=n,u.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle),e.onLoad()}else{const t={container:e.container||document.body,center:[0,0],zoom:8,pitch:0,bearing:0,style:e.mapStyle,interactive:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(t.transformRequest=e.transformRequest),this._map=this.map=new e.mapboxgl.Map(Object.assign({},t,e.mapOptions)),this.map.once("load",e.onLoad),this.map.on("error",e.onError)}return this}_destroy(){this._map&&(u.savedMap?this._map.remove():u.savedMap=this._map,this._map=null)}_initialize(e){c(e=Object.assign({},s,e),"Mapbox"),this.accessToken=e.mapboxApiAccessToken||s.mapboxApiAccessToken,e.mapboxgl&&(this.accessToken?e.mapboxgl.accessToken=this.accessToken:e.mapboxgl.accessToken="no-token"),this._create(e);const t=this.map.getCanvas();t&&(t.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}_update(e,t){this._map&&(c(t=Object.assign({},this.props,t),"Mapbox"),this._updateMapViewport(e,t),this._updateMapSize(e,t),this.props=t)}_updateMapSize(e,t){(e.width!==t.width||e.height!==t.height)&&this._map.resize()}_updateMapViewport(e,t){const n=this._getViewState(e),i=this._getViewState(t);(i.latitude!==n.latitude||i.longitude!==n.longitude||i.zoom!==n.zoom||i.pitch!==n.pitch||i.bearing!==n.bearing||i.altitude!==n.altitude)&&(this._map.jumpTo(this._getMapboxViewStateProps(t)),i.altitude!==n.altitude&&(this._map.transform.altitude=i.altitude))}_getViewState(e){const{longitude:t,latitude:n,zoom:i,pitch:r=0,bearing:a=0,altitude:o=1.5}=e.viewState||e;return{longitude:t,latitude:n,zoom:i,pitch:r,bearing:a,altitude:o}}_checkStyleSheet(e="0.47.0"){if("undefined"!=typeof document)try{const t=document.createElement("div");if(t.className="mapboxgl-map",t.style.display="none",document.body.append(t),!("static"!==window.getComputedStyle(t).position)){const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",`https://api.tiles.mapbox.com/mapbox-gl-js/v${e}/mapbox-gl.css`),document.head.append(t)}}catch(e){}}_getMapboxViewStateProps(e){const t=this._getViewState(e);return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch,width:e.width,height:e.height}}}u.propTypes=o,u.defaultProps=s}).call(this,n(43))},function(e,t,n){(function(t){const i=n(5),r=n(12),a=n(88),o=n(89).MapboxLayer,s=n(85).default,c="undefined"==typeof window?t:window;c.deck=Object.assign({},c.deck,r,a,{DeckGL:s,MapboxLayer:o}),c.luma=Object.assign({},c.luma,i),e.exports=c.deck}).call(this,n(37))},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){(function(e,i){var r=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,a=i.length,o=String(e).replace(r,function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),c=i[n];n<a;c=i[++n])p(c)||!y(c)?o+=" "+c:o+=" "+s(c);return o},t.deprecate=function(n,r){if(_(e.process))return function(){return t.deprecate(n,r).apply(this,arguments)};if(!0===i.noDeprecation)return n;var a=!1;return function(){if(!a){if(i.throwDeprecation)throw new Error(r);i.traceDeprecation?console.trace(r):console.error(r),a=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),g(n)?i.showHidden=n:n&&t._extend(i,n),_(i.showHidden)&&(i.showHidden=!1),_(i.depth)&&(i.depth=2),_(i.colors)&&(i.colors=!1),_(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=c),l(i,e,i.depth)}function c(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function u(e,t){return e}function l(e,n,i){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,e);return m(r)||(r=l(e,r,i)),r}var a=function(e,t){if(_(t))return e.stylize("undefined","undefined");if(m(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(v(t))return e.stylize(""+t,"number");if(g(t))return e.stylize(""+t,"boolean");if(p(t))return e.stylize("null","null")}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),E(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(n);if(0===o.length){if(w(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(x(n))return e.stylize(Date.prototype.toString.call(n),"date");if(E(n))return h(n)}var u,y="",O=!1,S=["{","}"];(f(n)&&(O=!0,S=["[","]"]),w(n))&&(y=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(y=" "+RegExp.prototype.toString.call(n)),x(n)&&(y=" "+Date.prototype.toUTCString.call(n)),E(n)&&(y=" "+h(n)),0!==o.length||O&&0!=n.length?i<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),u=O?function(e,t,n,i,r){for(var a=[],o=0,s=t.length;o<s;++o)A(t,String(o))?a.push(d(e,t,n,i,String(o),!0)):a.push("");return r.forEach(function(r){r.match(/^\d+$/)||a.push(d(e,t,n,i,r,!0))}),a}(e,n,i,s,o):o.map(function(t){return d(e,n,i,s,t,O)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,y,S)):S[0]+y+S[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,i,r,a){var o,s,c;if((c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),A(i,r)||(o="["+r+"]"),s||(e.seen.indexOf(c.value)<0?(s=p(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),_(o)){if(a&&r.match(/^\d+$/))return s;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function p(e){return null===e}function v(e){return"number"==typeof e}function m(e){return"string"==typeof e}function _(e){return void 0===e}function b(e){return y(e)&&"[object RegExp]"===O(e)}function y(e){return"object"==typeof e&&null!==e}function x(e){return y(e)&&"[object Date]"===O(e)}function E(e){return y(e)&&("[object Error]"===O(e)||e instanceof Error)}function w(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(_(a)&&(a=i.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var n=i.pid;o[e]=function(){var i=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,i)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=g,t.isNull=p,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=m,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=_,t.isRegExp=b,t.isObject=y,t.isDate=x,t.isError=E,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(74);var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",function(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),P[e.getMonth()],t].join(" ")}(),t.format.apply(t,arguments))},t.inherits=n(75),t._extend=function(e,t){if(!t||!y(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,n(37),n(43))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(1),r=n(2),a=n(9),o=n(8),s=n(10),c=n(51),u=n(26),l=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(i.a)(this,t),e=Object(a.a)(this,Object(o.a)(t).call(this)),Array.isArray(n)&&1===arguments.length?e.copy(n):e.set(n,r),e}return Object(s.a)(t,e),Object(r.a)(t,[{key:"cross",value:function(e){return u.b(this,this,e),this.check()}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"operation",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),t}(c.a)},function(e,t,n){e.exports=n(78)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){(0,i.installParameterDefinitions)(),console.log("luma.gl: WebGL debug support installed")};var i=n(79),r=n(82);(void 0!==e?e:window).WebGLDebug=r,console.log("luma.gl: WebGL debug support imported")}).call(this,n(37))},function(e,t,n){"use strict";var i=n(80);Object.defineProperty(t,"__esModule",{value:!0}),t.installParameterDefinitions=function(){},t.TEXTURE_PARAMETERS=t.SAMPLER_PARAMETERS=t.RENDERBUFFER_PARAMETERS=t.PROGRAM_PARAMETERS=t.FRAMEBUFFER_STATUS=t.FRAMEBUFFER_ATTACHMENT_PARAMETERS=t.FENCE_SYNC_PARAMETERS=t.BUFFER_PARAMETERS=t.GLboolean=t.GLuint=t.GLint=t.GLfloat=t.GLenum=void 0;var r,a,o,s,c,u,l=i(n(81));t.GLenum="GLenum";t.GLfloat="GLfloat";t.GLint="GLint";t.GLuint="GLint";t.GLboolean="GLboolean";var h=(r={},(0,l.default)(r,34660,{webgl1:0}),(0,l.default)(r,34661,{webgl1:0}),r);t.BUFFER_PARAMETERS=h;t.FENCE_SYNC_PARAMETERS=[37138,37140,37139,37141];t.FRAMEBUFFER_ATTACHMENT_PARAMETERS=[36049,36048,36051,36050,33296,36052,33298,33299,33300,33301,33302,33303,33297];var d=(a={},(0,l.default)(a,36053,"Success. Framebuffer is correctly set up"),(0,l.default)(a,36054,"Framebuffer attachment types mismatched or some attachment point not attachment complete"),(0,l.default)(a,36055,"Framebuffer has no attachment"),(0,l.default)(a,36057,"Framebuffer attachments do not have the same size"),(0,l.default)(a,36061,"Framebuffer attachment format not supported or depth and stencil attachments are not same"),(0,l.default)(a,36182,"Framebuffer attachement SAMPLES differs among renderbuffers, or are mixed with textures"),a);t.FRAMEBUFFER_STATUS=d;var f=(o={},(0,l.default)(o,35712,{webgl1:0}),(0,l.default)(o,35714,{webgl1:0}),(0,l.default)(o,35715,{webgl1:0}),(0,l.default)(o,35717,{webgl1:0}),(0,l.default)(o,35721,{webgl1:0}),(0,l.default)(o,35718,{webgl1:0}),(0,l.default)(o,35967,{webgl2:0}),(0,l.default)(o,35971,{webgl2:0}),(0,l.default)(o,35382,{webgl2:0}),o);t.PROGRAM_PARAMETERS=f;var g=(s={},(0,l.default)(s,36162,{webgl1:0}),(0,l.default)(s,36163,{webgl1:0}),(0,l.default)(s,36164,{type:"GLenum",webgl1:32854}),(0,l.default)(s,36177,{webgl1:0}),(0,l.default)(s,36178,{webgl1:0}),(0,l.default)(s,36176,{webgl1:0}),(0,l.default)(s,36179,{webgl1:0}),(0,l.default)(s,36180,{webgl1:0}),(0,l.default)(s,36181,{webgl1:0}),(0,l.default)(s,36011,{webgl2:1}),s);t.RENDERBUFFER_PARAMETERS=g;var p=(c={},(0,l.default)(c,10240,{webgl2:!0}),(0,l.default)(c,10241,{webgl2:!0}),(0,l.default)(c,10242,{webgl2:!0}),(0,l.default)(c,10243,{webgl2:!0}),(0,l.default)(c,32882,{webgl2:!0}),(0,l.default)(c,33084,{webgl2:!0}),(0,l.default)(c,33085,{webgl2:!0}),(0,l.default)(c,34893,{webgl2:!0}),(0,l.default)(c,34892,{webgl2:!0}),(0,l.default)(c,33082,{webgl2:!0}),(0,l.default)(c,33083,{webgl2:!0}),c);t.SAMPLER_PARAMETERS=p;var v=(u={},(0,l.default)(u,10240,{type:"GLenum",webgl1:9729}),(0,l.default)(u,10241,{type:"GLenum",webgl1:9986}),(0,l.default)(u,10242,{type:"GLenum",webgl1:10497}),(0,l.default)(u,10243,{type:"GLenum",webgl1:10497}),(0,l.default)(u,32882,{type:"GLenum",webgl2:10497}),(0,l.default)(u,33084,{webgl2:0}),(0,l.default)(u,33085,{webgl2:1e3}),(0,l.default)(u,34893,{type:"GLenum",webgl2:515}),(0,l.default)(u,34892,{type:"GLenum",webgl2:0}),(0,l.default)(u,33082,{webgl2:-1e3}),(0,l.default)(u,33083,{webgl2:1e3}),(0,l.default)(u,4096,{webgl1:0}),(0,l.default)(u,4097,{webgl1:0}),u);t.TEXTURE_PARAMETERS=v},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){(function(t){WebGLDebugUtils=function(){var e;void 0===e&&(e=t);var n=function(t){e.console&&e.console.error?e.console.error(t):function(t){e.console&&e.console.log&&e.console.log(t)}(t)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},r=null,a=null;function o(e){if(null==r)for(var t in r={},a={},e)"number"==typeof e[t]&&(r[e[t]]=t,a[t]=e[t])}function s(){if(null==r)throw"WebGLDebugUtils.init(ctx) not called"}function c(e){s();var t=r[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function u(e,t,n,r){var o;if(void 0!==(o=i[e])&&(void 0!==(o=o[t])&&o[n])){if("object"==typeof o[n]&&void 0!==o[n].enumBitwiseOr){for(var s=o[n].enumBitwiseOr,u=0,l=[],h=0;h<s.length;++h){var d=a[s[h]];0!=(r&d)&&(u|=d,l.push(c(d)))}return u===r?l.join(" | "):c(r)}return c(r)}return null===r?"null":void 0===r?"undefined":r.toString()}function l(e,t,n){e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){t[n]=e})}function h(e){var t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);var n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(var r=0;r<n;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0),t&&e.vertexAttribDivisor(r,0);e.deleteBuffer(i);var a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<a;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(r,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);var o=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(r=0;r<o;++r)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,null);var s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(r=0;r<s;++r)e.bindBufferBase(e.UNIFORM_BUFFER,r,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}for(;e.getError(););}return{init:o,mightBeEnum:function(e){return s(),void 0!==r[e]},glEnumToString:c,glFunctionArgToString:u,glFunctionArgsToString:function(e,t){for(var n="",i=t.length,r=0;r<i;++r)n+=(0==r?"":", ")+u(e,i,r,t[r]);return n},makeDebugContext:function e(t,i,r,a){a=a||t,o(t),i=i||function(e,t,i){for(var r="",a=i.length,o=0;o<a;++o)r+=(0==o?"":", ")+u(t,a,o,i[o]);n("WebGL error "+c(e)+" in "+t+"("+r+")")};var s={};function h(e,t){return function(){r&&r(t,arguments);var n=e[t].apply(e,arguments),o=a.getError();return 0!=o&&(s[o]=!0,i(o,t,arguments)),n}}var d={};for(var f in t)if("function"==typeof t[f])if("getExtension"!=f)d[f]=h(t,f);else{var g=h(t,f);d[f]=function(){var n=g.apply(t,arguments);return n?e(n,i,r,a):null}}else l(d,t,f);return d.getError=function(){for(var e in s)if(s.hasOwnProperty(e)&&s[e])return s[e]=!1,e;return t.NO_ERROR},d},makeLostContextSimulatingCanvas:function(t){var n,i,r=[],a=[],o={},s=1,c=!1,u=[],d=0,f=0,g=!1,p=0,v={};function m(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}t.getContext=function(r){return function(){var a=r.apply(t,arguments);if(a instanceof WebGLRenderingContext||e.WebGL2RenderingContext&&a instanceof WebGL2RenderingContext){if(a!=n){if(n)throw"got different context";i=e.WebGL2RenderingContext&&a instanceof WebGL2RenderingContext,o=function(e){for(var t in e)"function"==typeof e[t]?o[t]=x(e,t):l(o,e,t);o.getError=function(){if(y(),!c)for(;e=n.getError();)v[e]=!0;for(var e in v)if(v[e])return delete v[e],e;return o.NO_ERROR};var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];i&&r.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var a=0;a<r.length;++a){var h=r[a];o[h]=function(t){return function(){if(y(),c)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=s,u.push(n),n}}(e[h])}var d=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];i&&d.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var a=0;a<d.length;++a){var h=d[a];o[h]=function(t){return function(){return y(),c?null:t.apply(e,arguments)}}(o[h])}var f=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];i&&f.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var a=0;a<f.length;++a){var h=f[a];o[h]=function(t){return function(){return y(),!c&&t.apply(e,arguments)}}(o[h])}return o.checkFramebufferStatus=function(t){return function(){return y(),c?o.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(o.checkFramebufferStatus),o.getAttribLocation=function(t){return function(){return y(),c?-1:t.apply(e,arguments)}}(o.getAttribLocation),o.getVertexAttribOffset=function(t){return function(){return y(),c?0:t.apply(e,arguments)}}(o.getVertexAttribOffset),o.isContextLost=function(){return c},i&&(o.getFragDataLocation=function(t){return function(){return y(),c?-1:t.apply(e,arguments)}}(o.getFragDataLocation),o.clientWaitSync=function(t){return function(){return y(),c?o.WAIT_FAILED:t.apply(e,arguments)}}(o.clientWaitSync),o.getUniformBlockIndex=function(t){return function(){return y(),c?o.INVALID_INDEX:t.apply(e,arguments)}}(o.getUniformBlockIndex)),o}(n=a)}return o}return a}}(t.getContext);var _=function(e){r.push(m(e))},b=function(e){a.push(m(e))};function y(){++f,c||d==f&&t.loseContext()}function x(e,t){var n=e[t];return function(){if(y(),!c)return n.apply(e,arguments)}}function E(e){return{statusMessage:e,preventDefault:function(){g=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(n,i,r){switch(n){case"webglcontextlost":_(i);break;case"webglcontextrestored":b(i);break;default:t.apply(e,arguments)}}}(t),t.loseContext=function(){if(!c){for(c=!0,d=0,++s;n.getError(););!function(){for(var e=Object.keys(v),t=0;t<e.length;++t)delete v[e[t]]}(),v[n.CONTEXT_LOST_WEBGL]=!0;var e=E("context lost"),i=r.slice();setTimeout(function(){for(var n=0;n<i.length;++n)i[n](e);p>=0&&setTimeout(function(){t.restoreContext()},p)},0)}},t.restoreContext=function(){c&&a.length&&setTimeout(function(){if(!g)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var e=0;e<u.length;++e){var t=u[e];t instanceof WebGLBuffer?n.deleteBuffer(t):t instanceof WebGLFramebuffer?n.deleteFramebuffer(t):t instanceof WebGLProgram?n.deleteProgram(t):t instanceof WebGLRenderbuffer?n.deleteRenderbuffer(t):t instanceof WebGLShader?n.deleteShader(t):t instanceof WebGLTexture?n.deleteTexture(t):i&&(t instanceof WebGLQuery?n.deleteQuery(t):t instanceof WebGLSampler?n.deleteSampler(t):t instanceof WebGLSync?n.deleteSync(t):t instanceof WebGLTransformFeedback?n.deleteTransformFeedback(t):t instanceof WebGLVertexArrayObject&&n.deleteVertexArray(t))}}(),h(n),c=!1,f=0,g=!1;for(var e=a.slice(),t=E("context restored"),r=0;r<e.length;++r)e[r](t)},0)},t.loseContextInNCalls=function(e){if(c)throw"You can not ask a lost contet to be lost";d=f+e},t.getNumCalls=function(){return f},t.setRestoreTimeout=function(e){p=e},t},resetToInitialState:h}}(),e.exports=WebGLDebugUtils}).call(this,n(37))},function(e,t,n){"use strict";e.exports={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},function(e,t,n){var i;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(r,a,o,s){"use strict";var c,u=["","webkit","Moz","MS","ms","o"],l=a.createElement("div"),h="function",d=Math.round,f=Math.abs,g=Date.now;function p(e,t,n){return setTimeout(E(e,n),t)}function v(e,t,n){return!!Array.isArray(e)&&(m(e,n[t],n),!0)}function m(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function _(e,t,n){var i="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=r.console&&(r.console.warn||r.console.log);return a&&a.call(r.console,i,n),e.apply(this,arguments)}}c="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==s&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t}:Object.assign;var b=_(function(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;)(!n||n&&e[i[r]]===s)&&(e[i[r]]=t[i[r]]),r++;return e},"extend","Use `assign`."),y=_(function(e,t){return b(e,t,!0)},"merge","Use `assign`.");function x(e,t,n){var i,r=t.prototype;(i=e.prototype=Object.create(r)).constructor=e,i._super=r,n&&c(i,n)}function E(e,t){return function(){return e.apply(t,arguments)}}function w(e,t){return typeof e==h?e.apply(t&&t[0]||s,t):e}function O(e,t){return e===s?t:e}function S(e,t,n){m(C(t),function(t){e.addEventListener(t,n,!1)})}function P(e,t,n){m(C(t),function(t){e.removeEventListener(t,n,!1)})}function A(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function T(e,t){return e.indexOf(t)>-1}function C(e){return e.trim().split(/\s+/g)}function j(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function M(e){return Array.prototype.slice.call(e,0)}function R(e,t,n){for(var i=[],r=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];j(r,o)<0&&i.push(e[a]),r[a]=o,a++}return n&&(i=t?i.sort(function(e,n){return e[t]>n[t]}):i.sort()),i}function L(e,t){for(var n,i,r=t[0].toUpperCase()+t.slice(1),a=0;a<u.length;){if((i=(n=u[a])?n+r:t)in e)return i;a++}return s}var I=1;function F(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||r}var k="ontouchstart"in r,N=L(r,"PointerEvent")!==s,D=k&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B=25,U=1,z=2,G=4,V=8,W=1,H=2,X=4,Y=8,q=16,Z=H|X,K=Y|q,$=Z|K,Q=["x","y"],J=["clientX","clientY"];function ee(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){w(e.options.enable,[e])&&n.handler(t)},this.init()}function te(e,t,n){var i=n.pointers.length,r=n.changedPointers.length,a=t&U&&i-r==0,o=t&(G|V)&&i-r==0;n.isFirst=!!a,n.isFinal=!!o,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,i=t.pointers,r=i.length;n.firstInput||(n.firstInput=ne(t));r>1&&!n.firstMultiple?n.firstMultiple=ne(t):1===r&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,c=o?o.center:a.center,u=t.center=ie(i);t.timeStamp=g(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=se(c,u),t.distance=oe(c,u),function(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},a=e.prevInput||{};t.eventType!==U&&a.eventType!==G||(r=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y});t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}(n,t),t.offsetDirection=ae(t.deltaX,t.deltaY);var l=re(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=f(l.x)>f(l.y)?l.x:l.y,t.scale=o?function(e,t){return oe(t[0],t[1],J)/oe(e[0],e[1],J)}(o.pointers,i):1,t.rotation=o?function(e,t){return se(t[1],t[0],J)+se(e[1],e[0],J)}(o.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,i,r,a,o=e.lastInterval||t,c=t.timeStamp-o.timeStamp;if(t.eventType!=V&&(c>B||o.velocity===s)){var u=t.deltaX-o.deltaX,l=t.deltaY-o.deltaY,h=re(c,u,l);i=h.x,r=h.y,n=f(h.x)>f(h.y)?h.x:h.y,a=ae(u,l),e.lastInterval=t}else n=o.velocity,i=o.velocityX,r=o.velocityY,a=o.direction;t.velocity=n,t.velocityX=i,t.velocityY=r,t.direction=a}(n,t);var h=e.element;A(t.srcEvent.target,h)&&(h=t.srcEvent.target);t.target=h}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function ne(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:g(),pointers:t,center:ie(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ie(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:d(n/t),y:d(i/t)}}function re(e,t,n){return{x:t/e||0,y:n/e||0}}function ae(e,t){return e===t?W:f(e)>=f(t)?e<0?H:X:t<0?Y:q}function oe(e,t,n){n||(n=Q);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function se(e,t,n){n||(n=Q);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}ee.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(F(this.element),this.evWin,this.domHandler)}};var ce={mousedown:U,mousemove:z,mouseup:G},ue="mousedown",le="mousemove mouseup";function he(){this.evEl=ue,this.evWin=le,this.pressed=!1,ee.apply(this,arguments)}x(he,ee,{handler:function(e){var t=ce[e.type];t&U&&0===e.button&&(this.pressed=!0),t&z&&1!==e.which&&(t=G),this.pressed&&(t&G&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var de={pointerdown:U,pointermove:z,pointerup:G,pointercancel:V,pointerout:V},fe={2:"touch",3:"pen",4:"mouse",5:"kinect"},ge="pointerdown",pe="pointermove pointerup pointercancel";function ve(){this.evEl=ge,this.evWin=pe,ee.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(ge="MSPointerDown",pe="MSPointerMove MSPointerUp MSPointerCancel"),x(ve,ee,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=de[i],a=fe[e.pointerType]||e.pointerType,o="touch"==a,s=j(t,e.pointerId,"pointerId");r&U&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):r&(G|V)&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var me={touchstart:U,touchmove:z,touchend:G,touchcancel:V},_e="touchstart",be="touchstart touchmove touchend touchcancel";function ye(){this.evTarget=_e,this.evWin=be,this.started=!1,ee.apply(this,arguments)}x(ye,ee,{handler:function(e){var t=me[e.type];if(t===U&&(this.started=!0),this.started){var n=function(e,t){var n=M(e.touches),i=M(e.changedTouches);t&(G|V)&&(n=R(n.concat(i),"identifier",!0));return[n,i]}.call(this,e,t);t&(G|V)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var xe={touchstart:U,touchmove:z,touchend:G,touchcancel:V},Ee="touchstart touchmove touchend touchcancel";function we(){this.evTarget=Ee,this.targetIds={},ee.apply(this,arguments)}x(we,ee,{handler:function(e){var t=xe[e.type],n=function(e,t){var n=M(e.touches),i=this.targetIds;if(t&(U|z)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,a,o=M(e.changedTouches),s=[],c=this.target;if(a=n.filter(function(e){return A(e.target,c)}),t===U)for(r=0;r<a.length;)i[a[r].identifier]=!0,r++;r=0;for(;r<o.length;)i[o[r].identifier]&&s.push(o[r]),t&(G|V)&&delete i[o[r].identifier],r++;if(!s.length)return;return[R(a.concat(s),"identifier",!0),s]}.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});var Oe=2500,Se=25;function Pe(){ee.apply(this,arguments);var e=E(this.handler,this);this.touch=new we(this.manager,e),this.mouse=new he(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Ae(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout(function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)},Oe)}}x(Pe,ee,{handler:function(e,t,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)(function(e,t){e&U?(this.primaryTouch=t.changedPointers[0].identifier,Ae.call(this,t)):e&(G|V)&&Ae.call(this,t)}).call(this,t,n);else if(r&&function(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],a=Math.abs(t-r.x),o=Math.abs(n-r.y);if(a<=Se&&o<=Se)return!0}return!1}.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Te=L(l.style,"touchAction"),Ce=Te!==s,je="auto",Me="manipulation",Re="none",Le="pan-x",Ie="pan-y",Fe=function(){if(!Ce)return!1;var e={},t=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!t||r.CSS.supports("touch-action",n)}),e}();function ke(e,t){this.manager=e,this.set(t)}ke.prototype={set:function(e){"compute"==e&&(e=this.compute()),Ce&&this.manager.element.style&&Fe[e]&&(this.manager.element.style[Te]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return m(this.manager.recognizers,function(t){w(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(T(e,Re))return Re;var t=T(e,Le),n=T(e,Ie);if(t&&n)return Re;if(t||n)return t?Le:Ie;if(T(e,Me))return Me;return je}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=T(i,Re)&&!Fe[Re],a=T(i,Ie)&&!Fe[Ie],o=T(i,Le)&&!Fe[Le];if(r){var s=1===e.pointers.length,c=e.distance<2,u=e.deltaTime<250;if(s&&c&&u)return}if(!o||!a)return r||a&&n&Z||o&&n&K?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ne=1,De=2,Be=4,Ue=8,ze=Ue,Ge=16;function Ve(e){this.options=c({},this.defaults,e||{}),this.id=I++,this.manager=null,this.options.enable=O(this.options.enable,!0),this.state=Ne,this.simultaneous={},this.requireFail=[]}function We(e){return e&Ge?"cancel":e&Ue?"end":e&Be?"move":e&De?"start":""}function He(e){return e==q?"down":e==Y?"up":e==H?"left":e==X?"right":""}function Xe(e,t){var n=t.manager;return n?n.get(e):e}function Ye(){Ve.apply(this,arguments)}function qe(){Ye.apply(this,arguments),this.pX=null,this.pY=null}function Ze(){Ye.apply(this,arguments)}function Ke(){Ve.apply(this,arguments),this._timer=null,this._input=null}function $e(){Ye.apply(this,arguments)}function Qe(){Ye.apply(this,arguments)}function Je(){Ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function et(e,t){return(t=t||{}).recognizers=O(t.recognizers,et.defaults.preset),new tt(e,t)}Ve.prototype={defaults:{},set:function(e){return c(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(v(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Xe(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return v(e,"dropRecognizeWith",this)?this:(e=Xe(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(v(e,"requireFailure",this))return this;var t=this.requireFail;return-1===j(t,e=Xe(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(v(e,"dropRequireFailure",this))return this;e=Xe(e,this);var t=j(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function i(n){t.manager.emit(n,e)}n<Ue&&i(t.options.event+We(n)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),n>=Ue&&i(t.options.event+We(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|Ne)))return!1;e++}return!0},recognize:function(e){var t=c({},e);if(!w(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(ze|Ge|32)&&(this.state=Ne),this.state=this.process(t),this.state&(De|Be|Ue|Ge)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(Ye,Ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=t&(De|Be),r=this.attrTest(e);return i&&(n&V||!r)?t|Ge:i||r?n&G?t|Ue:t&De?t|Be:De:32}}),x(qe,Ye,{defaults:{event:"pan",threshold:10,pointers:1,direction:$},getTouchAction:function(){var e=this.options.direction,t=[];return e&Z&&t.push(Ie),e&K&&t.push(Le),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,r=e.direction,a=e.deltaX,o=e.deltaY;return r&t.direction||(t.direction&Z?(r=0===a?W:a<0?H:X,n=a!=this.pX,i=Math.abs(e.deltaX)):(r=0===o?W:o<0?Y:q,n=o!=this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&r&t.direction},attrTest:function(e){return Ye.prototype.attrTest.call(this,e)&&(this.state&De||!(this.state&De)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=He(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(Ze,Ye,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Re]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&De)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),x(Ke,Ve,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[je]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!i||!n||e.eventType&(G|V)&&!r)this.reset();else if(e.eventType&U)this.reset(),this._timer=p(function(){this.state=ze,this.tryEmit()},t.time,this);else if(e.eventType&G)return ze;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ze&&(e&&e.eventType&G?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=g(),this.manager.emit(this.options.event,this._input)))}}),x($e,Ye,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Re]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&De)}}),x(Qe,Ye,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Z|K,pointers:1},getTouchAction:function(){return qe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Z|K)?t=e.overallVelocity:n&Z?t=e.overallVelocityX:n&K&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&e.eventType&G},emit:function(e){var t=He(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x(Je,Ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Me]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&U&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!=G)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||oe(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=p(function(){this.state=ze,this.tryEmit()},t.interval,this),De):ze}return 32},failTimeout:function(){return this._timer=p(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ze&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),et.VERSION="2.0.7",et.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[$e,{enable:!1}],[Ze,{enable:!1},["rotate"]],[Qe,{direction:Z}],[qe,{direction:Z},["swipe"]],[Je],[Je,{event:"doubletap",taps:2},["tap"]],[Ke]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function tt(e,t){this.options=c({},et.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(N?ve:D?we:k?Pe:he))(e,te)}(this),this.touchAction=new ke(this,this.options.touchAction),nt(this,!0),m(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function nt(e,t){var n,i=e.element;i.style&&(m(e.options.cssProps,function(r,a){n=L(i.style,a),t?(e.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=e.oldCssProps[n]||""}),t||(e.oldCssProps={}))}tt.prototype={set:function(e){return c(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var i=this.recognizers,r=t.curRecognizer;(!r||r&&r.state&ze)&&(r=t.curRecognizer=null);for(var a=0;a<i.length;)n=i[a],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(De|Be|Ue)&&(r=t.curRecognizer=n),a++}},get:function(e){if(e instanceof Ve)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(v(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(v(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=j(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return m(C(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==s){var n=this.handlers;return m(C(e),function(e){t?n[e]&&n[e].splice(j(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&nt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},c(et,{INPUT_START:U,INPUT_MOVE:z,INPUT_END:G,INPUT_CANCEL:V,STATE_POSSIBLE:Ne,STATE_BEGAN:De,STATE_CHANGED:Be,STATE_ENDED:Ue,STATE_RECOGNIZED:ze,STATE_CANCELLED:Ge,STATE_FAILED:32,DIRECTION_NONE:W,DIRECTION_LEFT:H,DIRECTION_RIGHT:X,DIRECTION_UP:Y,DIRECTION_DOWN:q,DIRECTION_HORIZONTAL:Z,DIRECTION_VERTICAL:K,DIRECTION_ALL:$,Manager:tt,Input:ee,TouchAction:ke,TouchInput:we,MouseInput:he,PointerEventInput:ve,TouchMouseInput:Pe,SingleTouchInput:ye,Recognizer:Ve,AttrRecognizer:Ye,Tap:Je,Pan:qe,Swipe:Qe,Pinch:Ze,Rotate:$e,Press:Ke,on:S,off:P,each:m,merge:y,extend:b,assign:c,inherit:x,bindFn:E,prefixed:L}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=et,(i=function(){return et}.call(t,n,t,e))===s||(e.exports=i)}(window,document)},function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return o});var i=n(68),r=n(12);const a={position:"absolute",left:0,top:0,width:"100%",height:"100%"};class o extends r.Deck{constructor(e={}){if("undefined"==typeof document)throw Error("Deck can only be used in the browser");const{mapCanvas:t,deckCanvas:n}=function(e){let{container:t=document.body}=e;if("string"==typeof t&&(t=document.getElementById(t)),!t)throw Error("Deck: container not found");"static"===window.getComputedStyle(t).position&&(t.style.position="relative");const n=document.createElement("div");t.appendChild(n),Object.assign(n.style,a);const i=document.createElement("canvas");return t.appendChild(i),Object.assign(i.style,a),{container:t,mapCanvas:n,deckCanvas:i}}(e),r=e.initialViewState||function(e){if(!e.viewState&&"latitude"in e&&"longitude"in e&&"zoom"in e){const{latitude:t,longitude:n,zoom:i,pitch:r=0,bearing:a=0}=e;return{latitude:t,longitude:n,zoom:i,pitch:r,bearing:a}}return e.viewState}(e),o=Number.isFinite(r.latitude),{map:s=window.mapboxgl,controller:c=!0}=e;super(Object.assign({},e,{width:"100%",height:"100%",canvas:n,controller:c,initialViewState:r})),s&&s.Map?this._map=o&&new i.a(Object.assign({},e,{viewState:r,container:t,mapboxgl:s})):this._map=s,this._updateViewState=(e=>{this.onViewStateChange&&this.onViewStateChange(e),this._map&&this._map.setProps(e)})}getMapboxMap(){return this._map&&this._map.getMap()}finalize(){this._map&&this._map.finalize(),super.finalize()}setProps(e){"onViewStateChange"in e&&this._updateViewState&&(this.onViewStateChange=e.onViewStateChange,e.onViewStateChange=this._updateViewState),this._map&&this._map.setProps(e),super.setProps(e)}}},function(e,t,n){"use strict";var i=n(87);function r(){}e.exports=function(){function e(e,t,n,r,a,o){if(o!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=r,n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var i=n(12),r=n(7),a=n.n(r),o=n(5),s="#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * instanceWidths * widthScale / 2.0;\n  vec2 offset_clipspace = project_pixel_to_clipspace(offset_screenspace).xy;\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\n\nvoid main(void) {\n  vec2 source = project_position(vec3(instancePositions.xy, 0.0), instancePositions64Low.xy).xy;\n  vec2 target = project_position(vec3(instancePositions.zw, 0.0), instancePositions64Low.zw).xy;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_to_clipspace(vec4(nextPos, 1.0));\n\n  // extrude\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",c="#define SHADER_NAME arc-layer-vertex-shader-64\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\n\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\n\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * instanceWidths * widthScale / 2.0;\n  vec2 offset_clipspace = project_pixel_to_clipspace(offset_screenspace).xy;\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvoid get_pos_fp64(vec2 source[2], vec2 target[2], float segmentRatio, out vec2 position[4]) {\n\n  vec2 vertex_height = paraboloid_fp64(source, target, segmentRatio);\n\n  vec2 position_temp[2];\n\n  vec2_mix_fp64(source, target, segmentRatio, position_temp);\n\n  position[0] = position_temp[0];\n  position[1] = position_temp[1];\n\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) {\n    vertex_height = vec2(0.0, 0.0);\n  }\n\n  position[2] = sqrt_fp64(vertex_height);\n  position[3] = vec2(1.0, 0.0);\n}\n\nvoid main(void) {\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instancePositions.xy, instancePositions64Low.xy, projected_source_coord);\n  project_position_fp64(instancePositions.zw, instancePositions64Low.zw, projected_target_coord);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 curr_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, segmentRatio,\n    curr_pos_modelspace);\n\n  vec2 next_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, nextSegmentRatio,\n    next_pos_modelspace);\n\n  vec4 curr_pos_clipspace = project_to_clipspace_fp64(curr_pos_modelspace);\n  vec4 next_pos_clipspace = project_to_clipspace_fp64(next_pos_modelspace);\n\n  vec2 offset = getExtrusionOffset(next_pos_clipspace.xy - curr_pos_clipspace.xy, positions.y);\n\n  gl_Position = curr_pos_clipspace + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",u="#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const{fp64LowPart:l}=o.fp64,h=[0,0,0,255],d={fp64:!1,getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:h},getTargetColor:{type:"accessor",value:h},getStrokeWidth:{type:"accessor",value:1},widthScale:{type:"number",value:1,min:0},strokeWidth:{deprecatedFor:"getStrokeWidth"}};class f extends i.Layer{getShaders(){return this.use64bitProjection()?{vs:c,fs:u,modules:["project64","picking"]}:{vs:s,fs:u,modules:["picking"]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:4,transition:!0,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions},instancePositions64Low:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions64Low},instanceSourceColors:{size:4,type:a.a.UNSIGNED_BYTE,transition:!0,accessor:"getSourceColor",defaultValue:h},instanceTargetColors:{size:4,type:a.a.UNSIGNED_BYTE,transition:!0,accessor:"getTargetColor",defaultValue:h},instanceWidths:{size:1,transition:!0,accessor:"getStrokeWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),e.fp64!==t.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),this.getAttributeManager().invalidateAll()}this.state.model.setUniforms({widthScale:e.widthScale})}_getModel(e){let t=[];for(let e=0;e<50;e++)t=t.concat([e,-1,0,e,1,0]);const n=new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new o.Geometry({drawMode:a.a.TRIANGLE_STRIP,attributes:{positions:new Float32Array(t)}}),isInstanced:!0,shaderCache:this.context.shaderCache}));return n.setUniforms({numSegments:50}),n}calculateInstancePositions(e){const{data:t,getSourcePosition:n,getTargetPosition:i}=this.props,{value:r,size:a}=e;let o=0;for(const e of t){const t=n(e),s=i(e);r[o+0]=t[0],r[o+1]=t[1],r[o+2]=s[0],r[o+3]=s[1],o+=a}}calculateInstancePositions64Low(e){const t=this.use64bitPositions();if(e.constant=!t,!t)return void(e.value=new Float32Array(4));const{data:n,getSourcePosition:i,getTargetPosition:r}=this.props,{value:a,size:o}=e;let s=0;for(const e of n){const t=i(e),n=r(e);a[s+0]=l(t[0]),a[s+1]=l(t[1]),a[s+2]=l(n[0]),a[s+3]=l(n[1]),s+=o}}}f.layerName="ArcLayer",f.defaultProps=d;var g='#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : instanceSizes / iconSize.y;\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * sizeScale * instanceScale;\n  pixelOffset.y *= -1.0;\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0));\n  gl_Position += project_pixel_to_clipspace(pixelOffset);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = instanceColors / 255.;\n\n  vColorMode = instanceColorModes;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n',p="#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  // Take the global opacity and the alpha from vColor into account for the alpha component\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const v=1024,m=4,_=a.a.LINEAR_MIPMAP_LINEAR,b=a.a.LINEAR,y=()=>{};function x(e,t,n,i){const{naturalWidth:r,naturalHeight:a}=t;return n===r&&i===a?t:(e.canvas.height=i,e.canvas.width=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,r,a,0,0,n,i),e.canvas)}function E(e,t,n){for(let i=0;i<t.length;i++){const{icon:r,xOffset:a}=t[i];e[r.url]=Object.assign({},r,{x:a,y:n})}}function w({icons:e,buffer:t,maxCanvasWidth:n}){let i=0,r=0,a=0,o=[];const s={};for(let c=0;c<e.length;c++){const u=e[c];if(!s[u.url]){const{height:e,width:c}=u;i+c+t>n&&(E(s,o,r),i=0,r=a+r+t,a=0,o=[]),o.push({icon:u,xOffset:i}),i=i+c+t,a=Math.max(a,e)}}return o.length>0&&E(s,o,r),{mapping:s,canvasHeight:function(e){return Math.pow(2,Math.ceil(Math.log2(e)))}(a+r+t)}}class O{constructor(e,{onUpdate:t=y}){this.gl=e,this.onUpdate=t,this._getIcon=null,this._mapping={},this._texture=null,this._autoPacking=!1,this._canvas=null}getTexture(){return this._texture}getIconMapping(e){const t=this._getIcon(e),n=this._autoPacking?t.url:t;return this._mapping[n]||{}}setProps({autoPacking:e,iconAtlas:t,iconMapping:n,data:i,getIcon:r}){void 0!==e&&(this._autoPacking=e),r&&(this._getIcon=r),n&&(this._mapping=n),t&&this._updateIconAtlas(t),this._autoPacking&&(i||r)&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking({data:i,buffer:m,maxCanvasWidth:v}))}_updateIconAtlas(e){e instanceof o.Texture2D?(e.setParameters({[a.a.TEXTURE_MIN_FILTER]:_,[a.a.TEXTURE_MAG_FILTER]:b}),this._texture=e,this.onUpdate()):"string"==typeof e&&Object(o.loadTextures)(this.gl,{urls:[e],parameters:{[a.a.TEXTURE_MIN_FILTER]:_,[a.a.TEXTURE_MAG_FILTER]:b}}).then(([e])=>{this._texture=e,this.onUpdate()})}_updateAutoPacking({data:e,buffer:t,maxCanvasWidth:n}){const i=Object.values(function(e,t){if(!e||!t)return null;const n={};for(const i of e){const e=t(i);if(!e)throw new Error("Icon is missing.");if(!e.url)throw new Error("Icon url is missing.");n[e.url]||(n[e.url]=e)}return n}(e,this._getIcon)||{});if(i.length>0){const{mapping:e,canvasHeight:r}=w({icons:i,buffer:t,maxCanvasWidth:n});this._mapping=e,this._texture=new o.Texture2D(this.gl,{width:n,height:r}),this.onUpdate(),this._loadImages(i)}}_loadImages(e){const t=this._canvas.getContext("2d"),n=this._texture.height;for(const i of e)Object(o.loadImages)({urls:[i.url]}).then(([e])=>{const r=this._mapping[i.url],{x:o,y:s,width:c,height:u}=r,l=x(t,e,c,u);this._texture.setSubImageData({data:l,x:o,y:n-s-u,width:c,height:u,parameters:{[a.a.TEXTURE_MIN_FILTER]:_,[a.a.TEXTURE_MAG_FILTER]:b,[a.a.UNPACK_FLIP_Y_WEBGL]:!0}}),this._texture.generateMipmap(),this.onUpdate()})}}const{fp64LowPart:S}=o.fp64,P=[0,0,0,255],A={iconAtlas:null,iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},fp64:!1,getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:P},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0}};class T extends i.Layer{getShaders(){const e=this.use64bitProjection()?"project64":"project32";return{vs:g,fs:p,modules:[e,"picking"]}}initializeState(){this.state={iconManager:new O(this.context.gl,{onUpdate:()=>this._onUpdate()})},this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",update:this.calculateInstanceOffsets},instanceIconFrames:{size:4,accessor:"getIcon",update:this.calculateInstanceIconFrames},instanceColorModes:{size:1,type:a.a.UNSIGNED_BYTE,accessor:"getIcon",update:this.calculateInstanceColorMode},instanceColors:{size:4,type:a.a.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:P},instanceAngles:{size:1,transition:!0,accessor:"getAngle",defaultValue:0}})}updateState({oldProps:e,props:t,changeFlags:n}){super.updateState({props:t,oldProps:e,changeFlags:n});const i=this.getAttributeManager(),{iconManager:r}=this.state,{iconAtlas:a,iconMapping:o,data:s,getIcon:c}=t;let u=!1;if(a?(e.iconAtlas!==t.iconAtlas&&r.setProps({iconAtlas:a,autoPacking:!1}),e.iconMapping!==t.iconMapping&&(r.setProps({iconMapping:o}),u=!0)):r.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&(r.setProps({data:s,getIcon:c}),u=!0),u&&(i.invalidate("instanceOffsets"),i.invalidate("instanceIconFrames"),i.invalidate("instanceColorModes")),t.fp64!==e.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),i.invalidateAll()}}draw({uniforms:e}){const{sizeScale:t}=this.props,{iconManager:n}=this.state,i=n.getTexture();i&&this.state.model.render(Object.assign({},e,{iconsTexture:i,iconsTextureDim:[i.width,i.height],sizeScale:t}))}_getModel(e){return new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new o.Geometry({drawMode:a.a.TRIANGLE_FAN,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}_onUpdate(){this.setNeedsRedraw()}calculateInstancePositions64xyLow(e){const t=this.use64bitPositions();if(e.constant=!t,!t)return void(e.value=new Float32Array(2));const{data:n,getPosition:i}=this.props,{value:r}=e;let a=0;for(const e of n){const t=i(e);r[a++]=S(t[0]),r[a++]=S(t[1])}}calculateInstanceOffsets(e){const{data:t}=this.props,{iconManager:n}=this.state,{value:i}=e;let r=0;for(const e of t){const t=n.getIconMapping(e);i[r++]=t.width/2-t.anchorX||0,i[r++]=t.height/2-t.anchorY||0}}calculateInstanceColorMode(e){const{data:t}=this.props,{iconManager:n}=this.state,{value:i}=e;let r=0;for(const e of t){const t=n.getIconMapping(e).mask;i[r++]=t?1:0}}calculateInstanceIconFrames(e){const{data:t}=this.props,{iconManager:n}=this.state,{value:i}=e;let r=0;for(const e of t){const t=n.getIconMapping(e);i[r++]=t.x||0,i[r++]=t.y||0,i[r++]=t.width||0,i[r++]=t.height||0}}}T.layerName="IconLayer",T.defaultProps=A;var C="#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceSourceTargetPositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\n\nvarying vec4 vColor;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * instanceWidths / 2.0;\n  vec2 offset_clipspace = project_pixel_to_clipspace(offset_screenspace).xy;\n\n  return offset_clipspace;\n}\n\nvoid main(void) {\n  // Position\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourceTargetPositions64xyLow.xy, vec3(0.));\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceSourceTargetPositions64xyLow.zw, vec3(0.));\n\n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n\n  // extrude\n  vec2 offset = getExtrusionOffset(target.xy - source.xy, positions.y);\n  gl_Position = p + vec4(offset, 0.0, 0.0);\n\n  // Color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",j="#define SHADER_NAME line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const{fp64LowPart:M}=o.fp64,R={fp64:!1,getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:[0,0,0,255]},getStrokeWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getStrokeWidth"}};class L extends i.Layer{getShaders(){const e=this.use64bitProjection()?"project64":"project32";return{vs:C,fs:j,modules:[e,"picking"]}}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,transition:!0,accessor:"getTargetPosition"},instanceSourceTargetPositions64xyLow:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstanceSourceTargetPositions64xyLow},instanceColors:{size:4,type:a.a.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getStrokeWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),e.fp64!==t.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),this.getAttributeManager().invalidateAll()}}_getModel(e){return new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new o.Geometry({drawMode:a.a.TRIANGLE_STRIP,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}calculateInstanceSourceTargetPositions64xyLow(e){const t=this.use64bitPositions();if(e.constant=!t,!t)return void(e.value=new Float32Array(4));const{data:n,getSourcePosition:i,getTargetPosition:r}=this.props,{value:a,size:o}=e;let s=0;for(const e of n){const t=i(e),n=r(e);a[s+0]=M(t[0]),a[s+1]=M(t[1]),a[s+2]=M(n[0]),a[s+3]=M(n[1]),s+=o}}}L.layerName="LineLayer",L.defaultProps=R;var I="#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n\n  // Find the center of the point and add the current vertex\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.), position_worldspace);\n  gl_Position += project_pixel_to_clipspace(positions.xy * radiusPixels);\n\n  // Apply lighting\n  float lightWeight = lighting_getLightWeight(position_worldspace.xyz, // the w component is always 1.0\n    project_normal(instanceNormals));\n\n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(lightWeight * instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",F="#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const{fp64LowPart:k}=o.fp64,N=[0,0,0,255],D=[0,0,1],B={radiusPixels:{type:"number",min:0,value:10},fp64:!1,getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:D},getColor:{type:"accessor",value:N},lightSettings:{}};class U extends i.Layer{getShaders(e){const t=this.use64bitProjection()?"project64":"project32";return{vs:I,fs:F,modules:[t,"lighting","picking"]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:D},instanceColors:{size:4,type:a.a.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:N}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),e.fp64!==t.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusPixels:t}=this.props;this.state.model.render(Object.assign({},e,{radiusPixels:t}))}_getModel(e){const t=[];for(let e=0;e<3;e++){const n=e/3*Math.PI*2;t.push(2*Math.cos(n),2*Math.sin(n),0)}return new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new o.Geometry({drawMode:a.a.TRIANGLES,attributes:{positions:new Float32Array(t)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}calculateInstancePositions64xyLow(e){const t=this.use64bitPositions();if(e.constant=!t,!t)return void(e.value=new Float32Array(2));const{data:n,getPosition:i}=this.props,{value:r}=e;let a=0;for(const e of n){const t=i(e);r[a++]=k(t[0]),r[a++]=k(t[1])}}}U.layerName="PointCloudLayer",U.defaultProps=B;var z="#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  // Multiply out radius and clamp to limits\n  float outerRadiusPixels = clamp(\n    project_scale(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  \n  // Multiply out line width and clamp to limits\n  float lineWidth = clamp(\n    project_scale(lineWidthScale * instanceLineWidths), \n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += stroked * lineWidth / 2.0;\n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n\n  innerUnitRadius = 1.0 - stroked * lineWidth / outerRadiusPixels;\n  \n  vec3 offset = positions * outerRadiusPixels;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset);\n\n  // Apply opacity to instance color, or return instance picking color\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity) / 255.;\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity) / 255.;\n  \n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",G="#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  } \n  if (distToCenter > innerUnitRadius) {\n    gl_FragColor = vLineColor;\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const{fp64LowPart:V}=o.fp64,W=[0,0,0,255],H={radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,fp64:!1,filled:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:W},getLineColor:{type:"accessor",value:W},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class X extends i.Layer{getShaders(e){const t=this.use64bitProjection()?"project64":"project32";return{vs:z,fs:G,modules:[t,"picking"]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:4,transition:!0,type:a.a.UNSIGNED_BYTE,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:a.a.UNSIGNED_BYTE,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),e.fp64!==t.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusScale:t,radiusMinPixels:n,radiusMaxPixels:i,stroked:r,filled:a,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:c}=this.props;this.state.model.render(Object.assign({},e,{stroked:r?1:0,filled:a,radiusScale:t,radiusMinPixels:n,radiusMaxPixels:i,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:c}))}_getModel(e){return new o.Model(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new o.Geometry({drawMode:a.a.TRIANGLE_FAN,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}calculateInstancePositions64xyLow(e){const t=this.use64bitPositions();if(e.constant=!t,!t)return void(e.value=new Float32Array(2));const{data:n,getPosition:i}=this.props,{value:r}=e;let a=0;for(const e of n){const t=i(e);r[a++]=V(t[0]),r[a++]=V(t[1])}}}X.layerName="ScatterplotLayer",X.defaultProps=H;var Y="#version 300 es\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 vertices;\nin vec3 instancePositions;\nin vec4 instanceCounts;\nin vec3 instancePickingColors;\n\nlayout(std140) uniform;\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform AggregationData\n{\n  vec4 maxCount;\n} aggregationData;\n\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nout vec4 vColor;\nout float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r ;\n  float maxWeight = aggregationData.maxCount.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + vertices * cellScale, 1.);\n}\n",q="#define SHADER_NAME screen-grid-layer-vertex-shader-webgl1\n#define RANGE_COUNT 6\n\nattribute vec3 vertices;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float maxWeight;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + vertices * cellScale, 1.);\n}\n",Z="#version 300 es\n#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\nin float vSampleCount;\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  fragColor = vColor;\n\n  fragColor = picking_filterColor(fragColor);\n}\n",K="#define SHADER_NAME screen-grid-layer-fragment-shader-webgl1\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  gl_FragColor = picking_filterColor(gl_FragColor);\n}\n";const{count:$,defaultColorRange:Q}=i.experimental,J=[0,0,0,0],ee=[0,255,0,255],te=0,ne=["minColor","maxColor","colorRange","colorDomain"],ie={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:Q,getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:e=>[1,0,0]},gpuAggregation:!0,aggregation:"SUM"};class re extends i.Layer{getShaders(){const e=Object(o.isWebGL2)(this.context.gl)?{vs:Y,fs:Z}:{vs:q,fs:K};return e.modules=["picking"],e}initializeState(){const e=this.getAttributeManager(),{gl:t}=this.context;e.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,transition:!0,accessor:["getPosition","getWeight"],update:this.calculateInstanceCounts,noAlloc:!0}});const n={id:`${this.id}-aggregator`,shaderCache:this.context.shaderCache},r=this._getMaxCountBuffer(t),a={color:{size:1,operation:i.AGGREGATION_OPERATION.SUM,needMax:!0,maxBuffer:r}};this.setState({model:this._getModel(t),gpuGridAggregator:new i._GPUGridAggregator(t,n),maxBuffer:r,weights:a,aggregationResults:null}),this._setupUniformBuffer()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateUniforms(e),e.changeFlags.dataChanged&&this._processData();const t=this._getAggregationChangeFlags(e);t&&this._updateAggregation(t)}draw({uniforms:e}){const{gl:t}=this.context,{parameters:n={}}=this.props,i=this.props.minColor||J,r=this.props.maxColor||ee,s=this.props.colorDomain||[1,0],{model:c,maxBuffer:u,cellScale:l,shouldUseMinMax:h,colorRange:d,maxWeight:f}=this.state,g={minColor:i,maxColor:r,cellScale:l,colorRange:d,colorDomain:s,shouldUseMinMax:h};Object(o.isWebGL2)(t)?u.bind({target:a.a.UNIFORM_BUFFER}):g.maxWeight=f,e=Object.assign(g,e),c.draw({uniforms:e,parameters:Object.assign({depthTest:!1,depthMask:!1},n)}),Object(o.isWebGL2)(t)&&u.unbind()}calculateInstancePositions(e,{numInstances:t}){const{width:n,height:i}=this.context.viewport,{cellSizePixels:r}=this.props,{numCol:a}=this.state,{value:o,size:s}=e;for(let e=0;e<t;e++){const t=e%a,c=Math.floor(e/a);o[e*s+0]=t*r/n*2-1,o[e*s+1]=1-c*r/i*2,o[e*s+2]=0}}calculateInstanceCounts(e,{numInstances:t}){const{aggregationBuffer:n}=this.state;e.update({buffer:n})}getPickingInfo({info:e,mode:t}){const{index:n}=e;if(n>=0){const{aggregationResults:t}=this.state;t.aggregationData=t.aggregationData||this.state.aggregationBuffer.getData(),t.maxData=t.maxData||this.state.maxBuffer.getData();const{aggregationData:r,maxData:a}=t;e.object=i._GPUGridAggregator.getAggregationData({aggregationData:r,maxData:a,pixelIndex:n})}return e}_getAggregationChangeFlags({oldProps:e,props:t,changeFlags:n}){const i=t.cellSizePixels!==e.cellSizePixels||t.cellMarginPixels!==e.cellMarginPixels,r=n.dataChanged||t.aggregation!==e.aggregation,a=n.viewportChanged;return i||r||a?{cellSizeChanged:i,dataChanged:r,viewportChanged:a}:null}_getModel(e){return new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new o.Geometry({drawMode:a.a.TRIANGLE_FAN,attributes:{vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}_getMaxCountBuffer(e){return new o.Buffer(e,{bytes:16,size:4,index:te})}_processData(){const{data:e,getPosition:t,getWeight:n}=this.props,r=$(e),a=new Float64Array(2*r),o=new Float32Array(3*r),{weights:s}=this.state,{iterable:c,objectInfo:u}=Object(i.createIterable)(e);for(const e of c){u.index++;const i=t(e,u),r=n(e,u),{index:s}=u;a[2*s]=i[0],a[2*s+1]=i[1],Array.isArray(r)?(o[3*s]=r[0],o[3*s+1]=r[1],o[3*s+2]=r[2]):o[3*s]=r}s.color.values=o,this.setState({positions:a})}_setupUniformBuffer(){const e=this.context.gl;if(!Object(o.isWebGL2)(e))return;const t=this.state.model.program.handle,n=e.getUniformBlockIndex(t,"AggregationData");e.uniformBlockBinding(t,n,te)}_shouldUseMinMax(){const{minColor:e,maxColor:t,colorDomain:n,colorRange:r}=this.props;return e||t?(i.log.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!n&&!r}_updateAggregation(e){const t=this.getAttributeManager();(e.cellSizeChanged||e.viewportChanged)&&(this._updateGridParams(),t.invalidateAll());const{cellSizePixels:n,gpuAggregation:r}=this.props,{positions:a,weights:o}=this.state,{viewport:s}=this.context;o.color.operation=i.AGGREGATION_OPERATION[this.props.aggregation.toUpperCase()]||i.AGGREGATION_OPERATION.SUM;let c=!1,u=null;this.context.viewport instanceof i.WebMercatorViewport?c=!0:(c=!1,u=s.pixelProjectionMatrix);const l=this.state.gpuGridAggregator.run({positions:a,weights:o,cellSize:[n,n],viewport:s,changeFlags:e,useGPU:r,projectPoints:c,gridTransformMatrix:u}),h=l.color.maxData&&Number.isFinite(l.color.maxData[0])?l.color.maxData[0]:0,d={aggregationData:l.color.aggregationData,maxData:l.color.maxData};this.setState({aggregationResults:d,maxWeight:h}),t.invalidate("instanceCounts")}_updateUniforms({oldProps:e,props:t,changeFlags:n}){const i={};if(ne.some(n=>e[n]!==t[n])&&(i.shouldUseMinMax=this._shouldUseMinMax()),e.colorRange!==t.colorRange){const e=[];t.colorRange.forEach(t=>{e.push(t[0],t[1],t[2],t[3]||255)}),i.colorRange=e}if(e.cellMarginPixels!==t.cellMarginPixels||e.cellSizePixels!==t.cellSizePixels||n.viewportChanged){const{width:e,height:t}=this.context.viewport,{cellSizePixels:n,cellMarginPixels:r}=this.props,a=n>r?r:0;i.cellScale=new Float32Array([(n-a)/e*2,-(n-a)/t*2,1])}this.setState(i)}_updateGridParams(){const{width:e,height:t}=this.context.viewport,{cellSizePixels:n}=this.props,{gl:i}=this.context,r=Math.ceil(e/n),s=Math.ceil(t/n),c=r*s,u=4*c*4;let l=this.state.aggregationBuffer;l&&l.delete(),l=new o.Buffer(i,{size:4,bytes:u,type:a.a.FLOAT,instanced:1}),this.state.weights.color.aggregationBuffer=l,this.setState({numCol:r,numRow:s,numInstances:c,aggregationBuffer:l})}}re.layerName="ScreenGridLayer",re.defaultProps=ie;var ae="#define SHADER_NAME grid-cell-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceElevations;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Custom uniforms\nuniform float extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter\n#define ELEVATION_SCALE 0.8\n\n// Result\nvarying vec4 vColor;\n\nvoid main(void) {\n\n  // if ahpha == 0.0 or z < 0.0, do not render element\n  float noRender = float(instanceColors.a == 0.0 || instanceElevations < 0.0);\n  float finalCellSize = project_scale(cellSize) * mix(1.0, 0.0, noRender);\n\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = instanceElevations  * (positions.z + 1.0) *\n      ELEVATION_SCALE * elevationScale;\n  }\n\n  // cube geometry vertics are between -1 to 1, scale and transform it to between 0, 1\n  vec3 extrudedPosition = vec3(instancePositions.xy, elevation);\n  vec2 extrudedPosition64xyLow = instancePositions64xyLow;\n  vec3 offset = vec3(\n    (positions.x * coverage + 1.0) / 2.0 * finalCellSize,\n    (positions.y * coverage - 1.0) / 2.0 * finalCellSize,\n    1.0);\n\n  // extrude positions\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(extrudedPosition, extrudedPosition64xyLow, offset, position_worldspace);\n\n  float lightWeight = 1.0;\n\n  if (extruded > 0.5) {\n    lightWeight = lighting_getLightWeight(\n      position_worldspace.xyz, // the w component is always 1.0\n      normals\n    );\n  }\n\n  vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n  vec4 color = vec4(lightWeightedColor, instanceColors.a * opacity) / 255.0;\n  vColor = color;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",oe="#define SHADER_NAME grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const{fp64LowPart:se}=o.fp64,ce=[255,0,255,255],ue={cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},extruded:!0,fp64:!1,getPosition:{type:"accessor",value:e=>e.position},getElevation:{type:"accessor",value:1e3},getColor:{type:"accessor",value:ce},lightSettings:{}};class le extends i.Layer{getShaders(){const e=this.use64bitProjection()?"project64":"project32";return{vs:ae,fs:oe,modules:[e,"lighting","picking"]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceColors:{size:4,type:a.a.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:ce}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),e.fp64!==t.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),this.getAttributeManager().invalidateAll()}}_getModel(e){return new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new o.CubeGeometry,isInstanced:!0,shaderCache:this.context.shaderCache}))}draw({uniforms:e}){const{cellSize:t,extruded:n,elevationScale:i,coverage:r}=this.props;this.state.model.render(Object.assign({},e,{cellSize:t,extruded:n,elevationScale:i,coverage:r}))}calculateInstancePositions64xyLow(e){const t=this.use64bitPositions();if(e.constant=!t,!t)return void(e.value=new Float32Array(2));const{data:n,getPosition:i}=this.props,{value:r}=e;let a=0;for(const e of n){const t=i(e);r[a++]=se(t[0]),r[a++]=se(t[1])}}}le.layerName="GridCellLayer",le.defaultProps=ue;const he=6378e3;function de(e,t,n){const{gridHash:i,gridOffset:r}=function(e=[],t,n){let i,r=1/0,a=-1/0;for(const t of e)i=n(t)[1],Number.isFinite(i)&&(r=i<r?i:r,a=i>a?i:a);const o=function(e,t){const n=function(e){return e/he*(180/Math.PI)}(e),i=function(e,t){return t/he*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);return{yOffset:n,xOffset:i}}(t,(r+a)/2);if(o.xOffset<=0||o.yOffset<=0)return{gridHash:{},gridOffset:o};const s={};for(const t of e){const e=n(t)[1],i=n(t)[0];if(Number.isFinite(e)&&Number.isFinite(i)){const n=Math.floor((e+90)/o.yOffset),r=Math.floor((i+180)/o.xOffset),a=`${n}-${r}`;s[a]=s[a]||{count:0,points:[]},s[a].count+=1,s[a].points.push(t)}}return{gridHash:s,gridOffset:o}}(e,t,n);return{gridOffset:r,layerData:function(e,t){return Object.keys(e).reduce((n,i,r)=>{const a=i.split("-"),o=parseInt(a[0],10),s=parseInt(a[1],10);return n.push(Object.assign({index:r,position:[t.xOffset*s-180,t.yOffset*o-90]},e[i])),n},[])}(i,r)}}const{BinSorter:fe,defaultColorRange:ge,getQuantizeScale:pe,getLinearScale:ve}=i.experimental;function me(){}const _e={colorDomain:null,colorRange:ge,getColorValue:{type:"accessor",value:e=>e.length},lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:me,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:e=>e.length},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:me,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},extruded:!1,fp64:!1,lightSettings:{}};class be extends i.CompositeLayer{initializeState(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:me,elevationScaleFunc:me,dimensionUpdaters:this.getDimensionUpdaters()}}updateState({oldProps:e,props:t,changeFlags:n}){const i=this.needsReProjectPoints(e,t,n);if(n.dataChanged||i)this.getLayerData();else{(this.getDimensionChanges(e,t)||[]).forEach(e=>"function"==typeof e&&e.apply(this))}}needsReProjectPoints(e,t,n){return e.cellSize!==t.cellSize||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}getDimensionUpdaters(){return{getColor:[{id:"value",triggers:["getColorValue"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}getDimensionChanges(e,t){const{dimensionUpdaters:n}=this.state,i=[];for(const r in n){const a=n[r].find(n=>n.triggers.some(n=>e[n]!==t[n]));a&&i.push(a.updater)}return i.length?i:null}getPickingInfo({info:e}){const{sortedColorBins:t,sortedElevationBins:n}=this.state;let i=null;if(e.picked&&e.index>-1){const r=this.state.layerData[e.index],a=t.binMap[r.index]&&t.binMap[r.index].value,o=n.binMap[r.index]&&n.binMap[r.index].value;i=Object.assign({colorValue:a,elevationValue:o},r)}return Object.assign(e,{picked:Boolean(i),object:i})}getUpdateTriggers(){const{dimensionUpdaters:e}=this.state,t={};for(const n in e){t[n]={};for(const i of e[n])i.triggers.forEach(e=>{t[n][e]=this.props[e]})}return t}getLayerData(){const{data:e,cellSize:t,getPosition:n}=this.props,{layerData:i}=de(e,t,n);this.setState({layerData:i}),this.getSortedBins()}getValueDomain(){this.getColorValueDomain(),this.getElevationValueDomain()}getSortedBins(){this.getSortedColorBins(),this.getSortedElevationBins()}getSortedColorBins(){const{getColorValue:e}=this.props,t=new fe(this.state.layerData||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}getSortedElevationBins(){const{getElevationValue:e}=this.props,t=new fe(this.state.layerData||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}getColorValueDomain(){const{lowerPercentile:e,upperPercentile:t,onSetColorDomain:n}=this.props;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,t]),"function"==typeof n&&n(this.state.colorValueDomain),this.getColorScale()}getElevationValueDomain(){const{elevationLowerPercentile:e,elevationUpperPercentile:t,onSetElevationDomain:n}=this.props;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,t]),"function"==typeof n&&n(this.state.elevationValueDomain),this.getElevationScale()}getColorScale(){const{colorRange:e}=this.props,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=pe(t,e)}getElevationScale(){const{elevationRange:e}=this.props,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=ve(t,e)}_onGetSublayerColor(e){const{sortedColorBins:t,colorScaleFunc:n,colorValueDomain:i}=this.state,r=t.binMap[e.index]&&t.binMap[e.index].value,a=this.props.colorDomain||i,o=r>=a[0]&&r<=a[a.length-1]?n(r):[0,0,0,0];return o[3]=Number.isFinite(o[3])?o[3]:255,o}_onGetSublayerElevation(e){const{sortedElevationBins:t,elevationScaleFunc:n,elevationValueDomain:i}=this.state,r=t.binMap[e.index]&&t.binMap[e.index].value,a=this.props.elevationDomain||i;return r>=a[0]&&r<=a[a.length-1]?n(r):-1}renderLayers(){const{elevationScale:e,fp64:t,extruded:n,cellSize:i,coverage:r,lightSettings:a,transitions:o}=this.props;return new(this.getSubLayerClass("grid-cell",le))({fp64:t,cellSize:i,coverage:r,lightSettings:a,elevationScale:e,extruded:n,getColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getColor:o.getColorValue,getElevation:o.getElevationValue}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}be.layerName="GridLayer",be.defaultProps=_e;var ye="\n#define SHADER_NAME hexagon-cell-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec2 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Custom uniforms\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform float extruded;\nuniform float coverage;\nuniform float elevationScale;\n\n// Result\nvarying vec4 vColor;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter.\n#define ELEVATION_SCALE 0.8\n\nvoid main(void) {\n\n  // rotate primitive position and normal\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n\n  // calculate elevation, if 3d not enabled set to 0\n  // cylindar gemoetry height are between -0.5 to 0.5, transform it to between 0, 1\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = instanceElevations * (positions.z + 0.5) *\n      ELEVATION_SCALE * elevationScale;\n  }\n\n  // if ahpha == 0.0 or z < 0.0, do not render element\n  float noRender = float(instanceColors.a == 0.0 || instanceElevations < 0.0);\n  float dotRadius = project_scale(radius) * mix(coverage, 0.0, noRender);\n\n  // project center of hexagon\n  vec3 centroidPosition = vec3(instancePositions, elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 offset = vec3(rotationMatrix * positions.xy * dotRadius, 0.);\n\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, offset, position_worldspace);\n\n  // Light calculations\n  // Worldspace is the linear space after Mercator projection\n\n  vec3 normals_worldspace = vec3(rotationMatrix * normals.xy, normals.z);\n\n  float lightWeight = 1.0;\n\n  if (extruded > 0.5) {\n    lightWeight = lighting_getLightWeight(\n      position_worldspace.xyz, // the w component is always 1.0\n      normals_worldspace\n    );\n  }\n\n  vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n\n  // opacity-multiplied instance color\n  vColor = vec4(lightWeightedColor, opacity * instanceColors.a) / 255.0;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",xe="#define SHADER_NAME hexagon-cell-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const{fp64LowPart:Ee}=o.fp64,we=[255,0,255,255],Oe={hexagonVertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},extruded:!0,fp64:!1,getCentroid:{type:"accessor",value:e=>e.centroid},getColor:{type:"accessor",value:we},getElevation:{type:"accessor",value:1e3},lightSettings:{}};class Se extends i.Layer{getShaders(){const e=this.use64bitProjection()?"project64":"project32";return{vs:ye,fs:xe,modules:[e,"lighting","picking"]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,transition:!0,accessor:"getCentroid"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getCentroid",update:this.calculateInstancePositions64xyLow},instanceColors:{size:4,type:a.a.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:we}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),e.fp64!==t.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),this.getAttributeManager().invalidateAll()}e.hexagonVertices===t.hexagonVertices&&e.radius===t.radius&&e.angle===t.angle||this.updateRadiusAngle()}updateRadiusAngle(){let{angle:e,radius:t}=this.props;const{hexagonVertices:n}=this.props;if(Array.isArray(n)){n.length<6&&i.log.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();const r=this.props.hexagonVertices,a=r[0],o=r[3],{viewport:s}=this.context,{pixelsPerMeter:c}=s.getDistanceScales(),u=this.projectFlat(a),l=this.projectFlat(o),h=u[0]-l[0],d=u[1]-l[1],f=Math.sqrt(h*h+d*d);e=Math.acos(h/f)*-Math.sign(d)+Math.PI/2,t=f/2/c[0]}this.setState({angle:e,radius:t})}getCylinderGeometry(e){return new o.CylinderGeometry({radius:e,topRadius:e,bottomRadius:e,topCap:!0,bottomCap:!0,height:1,verticalAxis:"z",nradial:6,nvertical:1})}_getModel(e){return new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:this.getCylinderGeometry(1),isInstanced:!0,shaderCache:this.context.shaderCache}))}draw({uniforms:e}){const{elevationScale:t,extruded:n,coverage:i}=this.props,{radius:r,angle:a}=this.state;this.state.model.render(Object.assign({},e,{radius:r,angle:a,extruded:n,coverage:i,elevationScale:t}))}calculateInstancePositions64xyLow(e){const t=this.use64bitPositions();if(e.constant=!t,!t)return void(e.value=new Float32Array(2));const{data:n,getCentroid:i}=this.props,{value:r}=e;let a=0;for(const e of n){const t=i(e);r[a++]=Ee(t[0]),r[a++]=Ee(t[1])}}}Se.layerName="HexagonCellLayer",Se.defaultProps=Oe;var Pe=Math.PI/3,Ae=[0,Pe,2*Pe,3*Pe,4*Pe,5*Pe];function Te(e){return e[0]}function Ce(e){return e[1]}var je=function(){var e,t,n,i=0,r=0,a=1,o=1,s=Te,c=Ce;function u(e){var i,r={},a=[],o=e.length;for(i=0;i<o;++i)if(!isNaN(l=+s.call(null,u=e[i],i,e))&&!isNaN(h=+c.call(null,u,i,e))){var u,l,h,d=Math.round(h/=n),f=Math.round(l=l/t-(1&d)/2),g=h-d;if(3*Math.abs(g)>1){var p=l-f,v=f+(l<f?-1:1)/2,m=d+(h<d?-1:1),_=l-v,b=h-m;p*p+g*g>_*_+b*b&&(f=v+(1&d?1:-1)/2,d=m)}var y=f+"-"+d,x=r[y];x?x.push(u):(a.push(x=r[y]=[u]),x.x=(f+(1&d)/2)*t,x.y=d*n)}return a}function l(e){var t=0,n=0;return Ae.map(function(i){var r=Math.sin(i)*e,a=-Math.cos(i)*e,o=r-t,s=a-n;return t=r,n=a,[o,s]})}return u.hexagon=function(t){return"m"+l(null==t?e:+t).join("l")+"z"},u.centers=function(){for(var s=[],c=Math.round(r/n),u=Math.round(i/t),l=c*n;l<o+e;l+=n,++c)for(var h=u*t+(1&c)*t/2;h<a+t/2;h+=t)s.push([h,l]);return s},u.mesh=function(){var t=l(e).slice(0,4).join("l");return u.centers().map(function(e){return"M"+e+"m"+t}).join("")},u.x=function(e){return arguments.length?(s=e,u):s},u.y=function(e){return arguments.length?(c=e,u):c},u.radius=function(i){return arguments.length?(t=2*(e=+i)*Math.sin(Pe),n=1.5*e,u):e},u.size=function(e){return arguments.length?(i=r=0,a=+e[0],o=+e[1],u):[a-i,o-r]},u.extent=function(e){return arguments.length?(i=+e[0][0],r=+e[0][1],a=+e[1][0],o=+e[1][1],u):[[i,r],[a,o]]},u.radius(1)};const{BinSorter:Me,getQuantizeScale:Re,getLinearScale:Le,defaultColorRange:Ie}=i.experimental;function Fe(){}const ke={colorDomain:null,colorRange:Ie,getColorValue:{type:"accessor",value:e=>e.length},lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},onSetColorDomain:Fe,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:e=>e.length},elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:Fe,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function({data:e,radius:t,getPosition:n},i){const r=function(e,t){const{pixelsPerMeter:n}=t.getDistanceScales();return e*n[0]}(t,i),a=[];for(const t of e)a.push(Object.assign({screenCoord:i.projectFlat(n(t))},t));return{hexagons:je().radius(r).x(e=>e.screenCoord[0]).y(e=>e.screenCoord[1])(a).map((e,t)=>({centroid:i.unprojectFlat([e.x,e.y]),points:e,index:t}))}},getPosition:{type:"accessor",value:e=>e.position},fp64:!1,lightSettings:{}};class Ne extends i.CompositeLayer{initializeState(){this.state={hexagons:[],hexagonVertices:null,sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:Fe,elevationScaleFunc:Fe,dimensionUpdaters:this.getDimensionUpdaters()}}updateState({oldProps:e,props:t,changeFlags:n}){const i=this.getDimensionChanges(e,t);n.dataChanged||this.needsReProjectPoints(e,t)?this.getHexagons():i&&i.forEach(e=>"function"==typeof e&&e.apply(this))}needsReProjectPoints(e,t){return e.radius!==t.radius||e.hexagonAggregator!==t.hexagonAggregator}getDimensionUpdaters(){return{getColor:[{id:"value",triggers:["getColorValue"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}getDimensionChanges(e,t){const{dimensionUpdaters:n}=this.state,i=[];for(const r in n){const a=n[r].find(n=>n.triggers.some(n=>e[n]!==t[n]));a&&i.push(a.updater)}return i.length?i:null}getHexagons(){const{hexagonAggregator:e}=this.props,{viewport:t}=this.context,{hexagons:n,hexagonVertices:i}=e(this.props,t);this.setState({hexagons:n,hexagonVertices:i}),this.getSortedBins()}getPickingInfo({info:e}){const{sortedColorBins:t,sortedElevationBins:n}=this.state;let i=null;if(e.picked&&e.index>-1){const r=this.state.hexagons[e.index],a=t.binMap[r.index]&&t.binMap[r.index].value,o=n.binMap[r.index]&&n.binMap[r.index].value;i=Object.assign({colorValue:a,elevationValue:o},r)}return Object.assign(e,{picked:Boolean(i),object:i})}getUpdateTriggers(){const{dimensionUpdaters:e}=this.state,t={};for(const n in e){t[n]={};for(const i of e[n])i.triggers.forEach(e=>{t[n][e]=this.props[e]})}return t}getValueDomain(){this.getColorValueDomain(),this.getElevationValueDomain()}getSortedBins(){this.getSortedColorBins(),this.getSortedElevationBins()}getSortedColorBins(){const{getColorValue:e}=this.props,t=new Me(this.state.hexagons||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}getSortedElevationBins(){const{getElevationValue:e}=this.props,t=new Me(this.state.hexagons||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}getColorValueDomain(){const{lowerPercentile:e,upperPercentile:t,onSetColorDomain:n}=this.props;e>t&&i.log.warn("HexagonLayer: lowerPercentile is bigger than upperPercentile")(),this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,t]),"function"==typeof n&&n(this.state.colorValueDomain),this.getColorScale()}getElevationValueDomain(){const{elevationLowerPercentile:e,elevationUpperPercentile:t,onSetElevationDomain:n}=this.props;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,t]),"function"==typeof n&&n(this.state.elevationValueDomain),this.getElevationScale()}getColorScale(){const{colorRange:e}=this.props,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Re(t,e)}getElevationScale(){const{elevationRange:e}=this.props,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Le(t,e)}_onGetSublayerColor(e){const{sortedColorBins:t,colorScaleFunc:n,colorValueDomain:i}=this.state,r=t.binMap[e.index]&&t.binMap[e.index].value,a=this.props.colorDomain||i,o=r>=a[0]&&r<=a[a.length-1]?n(r):[0,0,0,0];return o[3]=Number.isFinite(o[3])?o[3]:255,o}_onGetSublayerElevation(e){const{sortedElevationBins:t,elevationScaleFunc:n,elevationValueDomain:i}=this.state,r=t.binMap[e.index]&&t.binMap[e.index].value,a=this.props.elevationDomain||i;return r>=a[0]&&r<=a[a.length-1]?n(r):-1}renderLayers(){const{radius:e,elevationScale:t,extruded:n,coverage:i,lightSettings:r,fp64:a,transitions:o}=this.props;return new(this.getSubLayerClass("hexagon-cell",Se))({fp64:a,radius:e,elevationScale:t,angle:Math.PI/2,extruded:n,coverage:i,lightSettings:r,getColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getColor:o.getColorValue,getElevation:o.getElevationValue}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.hexagons,hexagonVertices:this.state.hexagonVertices})}}Ne.layerName="HexagonLayer",Ne.defaultProps=ke;const{Tesselator:De}=i.experimental,{fp64LowPart:Be}=o.fp64,Ue=[0,0,0,255];class ze extends De{constructor({data:e,getGeometry:t,positionFormat:n,fp64:i}){super({data:e,getGeometry:t,fp64:i,positionFormat:n,attributes:{startPositions:{size:3},endPositions:{size:3},leftDeltas:{size:3},rightDeltas:{size:3},startEndPositions64XyLow:{size:4,fp64Only:!0}}})}get(e,t,n){if(this.attributes[e])return this.attributes[e];switch(e){case"strokeWidths":return this._updateAttribute({target:t,size:1,getValue:e=>[n(e)]});case"dashArrays":return this._updateAttribute({target:t,size:2,getValue:n});case"colors":return this._updateAttribute({target:t,size:4,getValue:e=>{const t=n(e);return 4===t.length?t:(Ue[0]=t[0],Ue[1]=t[1],Ue[2]=t[2],Ue)}});case"pickingColors":return this._updateAttribute({target:t,size:3,getValue:(e,t)=>n(t)});default:return null}}getGeometrySize(e){return Math.max(0,this.getPathLength(e)-1)}updateGeometryAttributes(e,t){const{attributes:{startPositions:n,endPositions:i,leftDeltas:r,rightDeltas:a,startEndPositions64XyLow:o},fp64:s}=this,c=t.geometrySize+1;if(c<2)return;const u=this.isClosed(e);let l,h=this.getPointOnPath(e,0),d=this.getPointOnPath(e,1),f=u?this.getPointOnPath(e,c-2):h;for(let g=t.vertexStart,p=1;p<c;g++,p++)l=p+1<c?this.getPointOnPath(e,p+1):u?this.getPointOnPath(e,1):d,n[3*g]=h[0],n[3*g+1]=h[1],n[3*g+2]=h[2]||0,i[3*g]=d[0],i[3*g+1]=d[1],i[3*g+2]=d[2]||0,r[3*g]=h[0]-f[0],r[3*g+1]=h[1]-f[1],r[3*g+2]=h[2]-f[2]||0,a[3*g]=l[0]-d[0],a[3*g+1]=l[1]-d[1],a[3*g+2]=l[2]-d[2]||0,s&&(o[4*g]=Be(h[0]),o[4*g+1]=Be(h[1]),o[4*g+2]=Be(d[0]),o[4*g+3]=Be(d[1])),f=h,h=d,d=l}getPathLength(e){return Number.isFinite(e[0])?e.length/this.positionSize:e.length}getPointOnPath(e,t){if(Number.isFinite(e[0])){const{positionSize:n}=this;return[e[t*n],e[t*n+1],3===n?e[t*n+2]:0]}return e[t]}isClosed(e){const t=this.getPathLength(e),n=this.getPointOnPath(e,0),i=this.getPointOnPath(e,t-1);return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]}}var Ge="#define SHADER_NAME path-layer-vertex-shader-64\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftDeltas;\nattribute vec3 instanceRightDeltas;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\n// calculate line join positions\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  float width\n) {\n  vec2 deltaA = currPoint.xy - prevPoint.xy;\n  vec2 deltaB = nextPoint.xy - currPoint.xy;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  // when two points are closer than PIXEL_EPSILON in pixels,\n  // assume they are the same point to avoid precision issue\n  lenA = lenA / width > EPSILON ? lenA : 0.0;\n  lenB = lenB / width > EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // width offset from current position\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n\n  // cap super sharp angles\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n\n  // do not bevel if line segment is too short\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n\n  // trim if inside corner extends further than the line segment\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / width / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n\n  // special treatment for start cap and end cap\n  // TODO - This has an issue. len is always positive because it is length.\n  // Step returns zero if -lenA<0, so practically this is a comparison of\n  // lenA with zero, with lots of problems because of the -lenA. Can we use EPSILON?\n  bool isStartCap = step(0.0, -lenA) > 0.5;\n  bool isEndCap = step(0.0, -lenB) > 0.5;\n  bool isCap = isStartCap || isEndCap;\n\n  // 0: center, 1: side\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n\n  // start of path: use next - curr\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n\n  // end of path: use curr - prev\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n\n  // extend out a triangle to envelope the round cap\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n\n  // Generate variables for dash calculation\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  // vec2 offsetFromStartOfPath = isEnd ? vCornerOffset + deltaA / width : vCornerOffset;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA / width;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\n\n// calculate line join positions\n// extract params from attributes and uniforms\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  float width = clamp(project_scale(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    width\n  );\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = instanceStartPositions;\n  vec2 prevPosition64xyLow = instanceStartEndPositions64xyLow.xy;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    // In auto offset mode, add delta to low part of the positions for better precision\n    prevPosition64xyLow += mix(-instanceLeftDeltas, vec3(0.0), isEnd).xy;\n  } else {\n    prevPosition += mix(-instanceLeftDeltas, vec3(0.0), isEnd);\n  }\n  prevPosition = project_position(prevPosition, prevPosition64xyLow);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  currPosition = project_position(currPosition, currPosition64xyLow);\n\n  vec3 nextPosition = instanceEndPositions;\n  vec2 nextPosition64xyLow = instanceStartEndPositions64xyLow.zw;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    // In auto offset mode, add delta to low part of the positions for better precision\n    nextPosition64xyLow += mix(vec3(0.0), instanceRightDeltas, isEnd).xy;\n  } else {\n    nextPosition += mix(vec3(0.0), instanceRightDeltas, isEnd);\n  }\n  nextPosition = project_position(nextPosition, nextPosition64xyLow);\n\n  vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n\n  gl_Position = project_to_clipspace(vec4(pos, 1.0));\n}\n",Ve="\n#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftDeltas;\nattribute vec3 instanceRightDeltas;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\nvec3 lineJoin(vec2 prevPoint64[2], vec2 currPoint64[2], vec2 nextPoint64[2]) {\n\n  float width = clamp(project_scale(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n\n  vec2 deltaA64[2];\n  vec2 deltaB64[2];\n\n  vec2_sub_fp64(currPoint64, prevPoint64, deltaA64);\n  vec2_sub_fp64(nextPoint64, currPoint64, deltaB64);\n\n  vec2 lengthA64 = vec2_length_fp64(deltaA64);\n  vec2 lengthB64 = vec2_length_fp64(deltaB64);\n\n  vec2 deltaA = vec2(deltaA64[0].x, deltaA64[1].x);\n  vec2 deltaB = vec2(deltaB64[0].x, deltaB64[1].x);\n\n  float lenA = lengthA64.x;\n  float lenB = lengthB64.x;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n\n  // when two points are closer than PIXEL_EPSILON in pixels,\n  // assume they are the same point to avoid precision issue\n  lenA = lenA / width > EPSILON ? lenA : 0.0;\n  lenB = lenB / width > EPSILON ? lenB : 0.0;\n  vec2 dirA = lenA > 0. ? deltaA / lenA : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? deltaB / lenB : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // width offset from current position\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n\n  // cap super sharp angles\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  // do not bevel if line segment is too short\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  // trim if inside corner extends further than the line segment\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n\n  // special treatment for start cap and end cap\n  // using a small number as the limit for determining if the lenA or lenB is 0\n  float isStartCap = step(lenA, 1.0e-5);\n  float isEndCap = step(lenB, 1.0e-5);\n  float isCap = max(isStartCap, isEndCap);\n\n  // 0: center, 1: side\n  cornerPosition = isCap * (1.0 - positions.z);\n\n  // start of path: use next - curr\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  // end of path: use curr - prev\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n\n  // extend out a triangle to envelope the round cap\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n\n  // Generate variables for dash calculation\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  float isEnd = positions.x;\n  vec2 offsetFromStartOfPath = mix(vCornerOffset, vCornerOffset + deltaA / width, isEnd);\n  vec2 dir = mix(dirB, dirA, isEnd);\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  // Calculate current position 64bit\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition.xy, currPosition64xyLow, projected_curr_position);\n  float projected_curr_position_z = project_scale(currPosition.z);\n\n  // Calculate previous position\n\n  vec3 prevPosition = mix(-instanceLeftDeltas, vec3(0.0), isEnd) + instanceStartPositions;\n\n  // Calculate prev position 64bit\n\n  vec2 projected_prev_position[2];\n  project_position_fp64(prevPosition.xy, instanceStartEndPositions64xyLow.xy, projected_prev_position);\n\n  // Calculate next positions\n  vec3 nextPosition = mix(vec3(0.0), instanceRightDeltas, isEnd) + instanceEndPositions;\n\n  // Calculate next position 64bit\n\n  vec2 projected_next_position[2];\n  project_position_fp64(nextPosition.xy, instanceStartEndPositions64xyLow.zw, projected_next_position);\n\n  vec3 pos = lineJoin(projected_prev_position, projected_curr_position, projected_next_position);\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",We="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\nuniform float alignMode;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\n/*\n * vPathPosition represents the relative coordinates of the current fragment on the path segment.\n * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.\n * vPathPosition.y - position along the length of the path, between [0, L / width].\n */\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\n// mod doesn't work correctly for negative numbers\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\n\n// if given position is in the gap part of the dashed line\n// dashArray.x: solid stroke length, relative to width\n// dashArray.y: gap length, relative to width\n// alignMode:\n// 0 - no adjustment\n// o----     ----     ----     ---- o----     -o----     ----     o\n// 1 - stretch to fit, draw half dash at each end for nicer joints\n// o--    ----    ----    ----    --o--      --o--     ----     --o\nbool dash_isFragInGap() {\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength == 0.0) {\n    return false;\n  }\n\n  unitLength = mix(\n    unitLength,\n    vPathLength / round(vPathLength / unitLength),\n    alignMode\n  );\n\n  float offset = alignMode * solidLength / 2.0;\n\n  return gapLength > 0.0 &&\n    vPathPosition.y >= 0.0 &&\n    vPathPosition.y <= vPathLength &&\n    mod2(vPathPosition.y + offset, unitLength) > solidLength;\n}\n\nvoid main(void) {\n  // if joint is rounded, test distance from the corner\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    // Enable to debug joints\n    // gl_FragColor = vec4(0., 1., 0., 1.);\n    // return;\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    // Enable to debug joints\n    // gl_FragColor = vec4(0., 0., 1., 1.);\n    // return;\n    discard;\n  }\n  if (vColor.a == 0.0 || dash_isFragInGap()) {\n    // Enable to debug joints\n    // gl_FragColor = vec4(0., 1., 1., 1.);\n    // return;\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const He=[0,0,0,255],Xe={widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},fp64:!1,dashJustified:!1,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:He},getWidth:{type:"accessor",value:1},getDashArray:{type:"accessor",value:[0,0]}},Ye={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class qe extends i.Layer{getShaders(){return this.use64bitProjection()?{vs:Ve,fs:We,modules:["project64","picking"]}:{vs:Ge,fs:We,modules:["picking"]}}initializeState(){this.getAttributeManager().addInstanced({instanceStartPositions:{size:3,transition:Ye,accessor:"getPath",update:this.calculateStartPositions,noAlloc:!0},instanceEndPositions:{size:3,transition:Ye,accessor:"getPath",update:this.calculateEndPositions,noAlloc:!0},instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow,noAlloc:!0},instanceLeftDeltas:{size:3,update:this.calculateLeftDeltas,noAlloc:!0},instanceRightDeltas:{size:3,update:this.calculateRightDeltas,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Ye,update:this.calculateStrokeWidths,defaultValue:1},instanceDashArrays:{size:2,accessor:"getDashArray",update:this.calculateDashArrays},instanceColors:{size:4,type:a.a.UNSIGNED_BYTE,accessor:"getColor",transition:Ye,update:this.calculateColors,defaultValue:He},instancePickingColors:{size:3,type:a.a.UNSIGNED_BYTE,update:this.calculatePickingColors}}),this.setState({pathTesselator:new ze({})})}updateState({oldProps:e,props:t,changeFlags:n}){super.updateState({props:t,oldProps:e,changeFlags:n});const i=this.getAttributeManager();if((n.dataChanged||t.fp64!==e.fp64||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath))&&(this.state.pathTesselator.updateGeometry({data:t.data,getGeometry:t.getPath,positionFormat:t.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:this.state.pathTesselator.instanceCount}),i.invalidateAll()),t.fp64!==e.fp64){const{gl:e}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(e)}),i.invalidateAll()}}draw({uniforms:e}){const{rounded:t,miterLimit:n,widthScale:i,widthMinPixels:r,widthMaxPixels:a,dashJustified:o}=this.props;this.state.model.render(Object.assign({},e,{jointType:Number(t),alignMode:Number(o),widthScale:i,miterLimit:n,widthMinPixels:r,widthMaxPixels:a}))}_getModel(e){return new o.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new o.Geometry({drawMode:a.a.TRIANGLES,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}calculateStartPositions(e){const{pathTesselator:t}=this.state;e.bufferLayout=t.bufferLayout,e.value=t.get("startPositions")}calculateEndPositions(e){const{pathTesselator:t}=this.state;e.bufferLayout=t.bufferLayout,e.value=t.get("endPositions")}calculateInstanceStartEndPositions64xyLow(e){const t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.pathTesselator.get("startEndPositions64XyLow"):new Float32Array(4)}calculateLeftDeltas(e){const{pathTesselator:t}=this.state;e.value=t.get("leftDeltas")}calculateRightDeltas(e){const{pathTesselator:t}=this.state;e.value=t.get("rightDeltas")}calculateStrokeWidths(e){const{getWidth:t}=this.props,{pathTesselator:n}=this.state;e.bufferLayout=n.bufferLayout,e.value=n.get("strokeWidths",e.value,t)}calculateDashArrays(e){const{getDashArray:t}=this.props,{pathTesselator:n}=this.state;e.value=n.get("dashArrays",e.value,t)}calculateColors(e){const{getColor:t}=this.props,{pathTesselator:n}=this.state;e.bufferLayout=n.bufferLayout,e.value=n.get("colors",e.value,t)}calculatePickingColors(e){const{pathTesselator:t}=this.state,n=[];e.value=t.get("pickingColors",e.value,e=>this.encodePickingColor(e,n))}clearPickingColor(e){const t=this.decodePickingColor(e),{bufferLayout:n}=this.state.pathTesselator,i=n[t];let r=0;for(let e=0;e<t;e++)r+=n[e];const{instancePickingColors:a}=this.getAttributeManager().attributes,{value:o}=a,s=r+i;o.fill(0,3*r,3*s),a.update({value:o})}}qe.layerName="PathLayer",qe.defaultProps=Xe;var Ze=n(66),Ke=n.n(Ze);function $e(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Qe(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function Je(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function et(e,t,n,i){for(let r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}function tt(e,t,n,i){let r=t;const a=n.length;for(let t=0;t<a;t++)for(let a=0;a<i;a++)e[r++]=n[t][a]||0;if(!Je(n))for(let t=0;t<i;t++)e[r++]=n[0][t]||0;return r}function nt(e,t,n,i,r=0,a){const o=(a=a||n.length)-r;if(o<=0)return t;let s=t;for(let t=0;t<o;t++)e[s++]=n[r+t];if(!et(n,i,r,a))for(let t=0;t<i;t++)e[s++]=n[r+t];return s}function it(e){return(Je(e)?0:1)+e.length}function rt(e,t,n=0,i){return n>=(i=i||e.length)?0:(et(e,t,n,i)?0:1)+(i-n)/t}function at(e,t){if($e(e),e.positions){const{positions:n,holeIndices:i}=e;if(i){let n=0;for(let r=0;r<=i.length;r++)n+=rt(e.positions,t,i[r-1],i[r]);return n}e=n}if(Number.isFinite(e[0]))return rt(e,t);if(!Qe(e)){let t=0;for(const n of e)t+=it(n);return t}return it(e)}function ot(e,t,n){$e(e),n=n||at(e,t);const i=new Float64Array(n*t),r=[];if(e.positions){const{positions:n,holeIndices:a}=e;if(a){let e=0;for(let o=0;o<=a.length;o++)e=nt(i,e,n,t,a[o-1],a[o]),r.push(e);return r.pop(),{positions:i,holeIndices:r}}e=n}if(Number.isFinite(e[0]))return nt(i,0,e,t),{positions:i,holeIndices:null};if(!Qe(e)){let n=0;for(const a of e)n=tt(i,n,a,t),r.push(n);return r.pop(),{positions:i,holeIndices:r}}return tt(i,0,e,t),{positions:i,holeIndices:null}}const{Tesselator:st}=i.experimental,{fp64LowPart:ct}=o.fp64,ut=[0,0,0,255];class lt extends st{constructor({data:e,getGeometry:t,fp64:n,positionFormat:i,IndexType:r=Uint32Array}){super({data:e,getGeometry:t,fp64:n,positionFormat:i,attributes:{positions:{size:3},positions64xyLow:{size:2,fp64Only:!0},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e,t,n){if("indices"===e)return this.attributes.indices.subarray(0,this.vertexCount);if(this.attributes[e])return this.attributes[e];switch(e){case"elevations":return this._updateAttribute({target:t,size:1,getValue:e=>[n(e)]});case"colors":return this._updateAttribute({target:t,size:4,getValue:e=>{const t=n(e);return 4===t.length?t:(ut[0]=t[0],ut[1]=t[1],ut[2]=t[2],ut)}});case"pickingColors":return this._updateAttribute({target:t,size:3,getValue:(e,t)=>n(t)});default:return null}}getGeometrySize(e){return at(e,this.positionSize)}updateGeometryAttributes(e,t){e=ot(e,this.positionSize,t.geometrySize),this._updateIndices(e,t),this._updatePositions(e,t)}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:r,indexLayout:a,typedArrayManager:o}=this;let s=r.indices,c=s.length,u=i;const l=function(e,t){let n=null;return e.holeIndices&&(n=e.holeIndices.map(e=>e/t)),Ke()(e.positions,n,t)}(e,this.positionSize);c<u+l.length&&(c=2*(u+l.length),s=o.allocate(s,c,{type:s.constructor,size:1,copy:!0}));for(let e=0;e<l.length;e++)s[u++]=l[e]+n;a[t]=l.length,r.indices=s}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i,positions64xyLow:r,vertexValid:a},fp64:o,positionSize:s}=this;let c=t;const{positions:u,holeIndices:l}=e;for(let e=0;e<n;e++){const t=u[e*s],n=u[e*s+1],l=s>2?u[e*s+2]:0;i[3*c]=t,i[3*c+1]=n,i[3*c+2]=l,o&&(r[2*c]=ct(t),r[2*c+1]=ct(n)),a[c]=1,c++}if(l)for(let e=0;e<l.length;e++)a[t+l[e]/s-1]=0;a[t+n-1]=0}}var ht="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec2 vertexPositions;\nattribute float vertexValid;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 nextPositions;\nattribute vec2 nextPositions64xyLow;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\nuniform bool isSideVertex;\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  vec3 pos;\n  vec2 pos64xyLow;\n  vec3 normal;\n  vec4 colors = isWireframe ? lineColors : fillColors;\n\n  if (isSideVertex) {\n    pos = mix(positions, nextPositions, vertexPositions.x);\n    pos64xyLow = mix(positions64xyLow, nextPositions64xyLow, vertexPositions.x);\n    isValid = vertexValid;\n  } else {\n    pos = positions;\n    pos64xyLow = positions64xyLow;\n    isValid = 1.0;\n  }\n  if (extruded) {\n    pos.z += elevations * vertexPositions.y;\n  }\n  pos.z *= elevationScale;\n\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(pos, pos64xyLow, vec3(0.), position_worldspace);\n\n  float lightWeight = 1.0;\n  \n  if (extruded) {\n    if (isSideVertex) {\n      normal = vec3(positions.y - nextPositions.y, nextPositions.x - positions.x, 0.0);\n      normal = project_normal(normal);\n    } else {\n      normal = vec3(0.0, 0.0, 1.0);\n    }\n\n    lightWeight = lighting_getLightWeight(position_worldspace.xyz, normal);\n  }\n\n  vec3 lightWeightedColor = lightWeight * colors.rgb;\n  vColor = vec4(lightWeightedColor, colors.a * opacity) / 255.0;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(pickingColors);\n}\n",dt="#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const ft=[0,0,0,255],gt={filled:!0,extruded:!1,wireframe:!1,fp64:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ft},getLineColor:{type:"accessor",value:ft},lightSettings:{}},pt={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class vt extends i.Layer{getShaders(){const e=this.use64bitProjection()?"project64":"project32";return{vs:ht,fs:dt,modules:[e,"lighting","picking"]}}initializeState(){const{gl:e}=this.context;this.setState({numInstances:0,polygonTesselator:new lt({IndexType:!e||Object(o.hasFeature)(e,o.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const t=this.getAttributeManager();t.remove(["instancePickingColors"]),t.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,transition:pt,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0},positions64xyLow:{size:2,update:this.calculatePositionsLow,noAlloc:!0},vertexValid:{size:1,type:a.a.UNSIGNED_BYTE,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:pt,accessor:"getElevation",update:this.calculateElevations},fillColors:{alias:"colors",size:4,type:a.a.UNSIGNED_BYTE,transition:pt,accessor:"getFillColor",update:this.calculateFillColors,defaultValue:ft},lineColors:{alias:"colors",size:4,type:a.a.UNSIGNED_BYTE,transition:pt,accessor:"getLineColor",update:this.calculateLineColors,defaultValue:ft},pickingColors:{size:3,type:a.a.UNSIGNED_BYTE,update:this.calculatePickingColors}})}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:o,sideModel:s}=this.state,c=Object.assign({},e,{extruded:Boolean(t),elevationScale:r});s&&(s.setUniforms(c),i&&(s.setDrawMode(a.a.LINE_STRIP),s.render({isWireframe:!0})),n&&(s.setDrawMode(a.a.TRIANGLE_FAN),s.render({isWireframe:!1}))),o&&o.render(c)}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n}=e,i=this.getAttributeManager();(t.fp64!==n.fp64||t.filled!==n.filled||t.extruded!==n.extruded)&&(this.state.models&&this.state.models.forEach(e=>e.delete()),this.setState(this._getModels(this.context.gl)),i.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||e.fp64!==t.fp64||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state;t.updateGeometry({data:e.data,getGeometry:e.getPolygon,positionFormat:e.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:t.instanceCount}),this.getAttributeManager().invalidateAll()}}updateAttributes(e){super.updateAttributes(e);const t=this.getAttributeManager().getChangedAttributes({clearChangedFlags:!0}),{topModel:n,sideModel:i}=this.state,r=this.getNumInstances();if(n){if(t.indices){const e=t.indices.value.length;n.setVertexCount(e)}n.setAttributes(t)}if(i){i.setInstanceCount(r-1);const e={};for(const n in t){const i=t[n];"indices"!==n&&(e[n]=Object.assign({},i,{isInstanced:!0,buffer:i.getBuffer()}))}e.positions&&(e.nextPositions=Object.assign({},e.positions,{id:"nextPositions",offset:12})),e.positions64xyLow&&(e.nextPositions64xyLow=Object.assign({},e.positions64xyLow,{id:"nextPositions64xyLow",offset:8})),i.setAttributes(e)}}_getModels(e){const{id:t,filled:n,extruded:i}=this.props;let r,s;return n&&(r=new o.Model(e,Object.assign({},this.getShaders(),{id:`${t}-top`,geometry:new o.Geometry({drawMode:a.a.TRIANGLES,attributes:{vertexPositions:{size:2,constant:!0,value:new Float32Array([0,1])},nextPositions:{size:3,constant:!0,value:new Float32Array(3)},nextPositions64xyLow:{size:2,constant:!0,value:new Float32Array(2)}}}),uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0,shaderCache:this.context.shaderCache}))),i&&(s=new o.Model(e,Object.assign({},this.getShaders(),{id:`${t}-side`,geometry:new o.Geometry({drawMode:a.a.LINES,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,1,0,1,0,0,1,0])}}}),uniforms:{isSideVertex:!0},isInstanced:1,shaderCache:this.context.shaderCache}))),{models:[s,r].filter(Boolean),topModel:r,sideModel:s}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.bufferLayout=t.indexLayout,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.bufferLayout=t.bufferLayout,e.value=t.get("positions")}calculatePositionsLow(e){const t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.polygonTesselator.get("positions64xyLow"):new Float32Array(2)}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}calculateElevations(e){const{polygonTesselator:t}=this.state;e.bufferLayout=t.bufferLayout;const{extruded:n,getElevation:i}=this.props;n?(e.constant=!1,e.value=t.get("elevations",e.value,i)):(e.constant=!0,e.value=new Float32Array(1))}calculateFillColors(e){const{polygonTesselator:t}=this.state;e.bufferLayout=t.bufferLayout,e.value=t.get("colors",e.value,this.props.getFillColor)}calculateLineColors(e){const{polygonTesselator:t}=this.state;e.bufferLayout=t.bufferLayout,e.value=t.get("colors",e.value,this.props.getLineColor)}calculatePickingColors(e){const t=[];e.value=this.state.polygonTesselator.get("pickingColors",e.value,e=>this.encodePickingColor(e,t))}clearPickingColor(e){const t=this.decodePickingColor(e),{bufferLayout:n}=this.state.polygonTesselator,i=n[t];let r=0;for(let e=0;e<t;e++)r+=n[e];const{pickingColors:a}=this.getAttributeManager().attributes,{value:o}=a,s=r+i;o.fill(0,3*r,3*s),a.update({value:o})}}vt.layerName="SolidPolygonLayer",vt.defaultProps=gt;const mt={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,lineDashJustified:!1,fp64:!1,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},lightSettings:{}};class _t extends i.CompositeLayer{initializeState(){this.state={paths:[]}}updateState({oldProps:e,props:t,changeFlags:n}){(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon))&&(this.state.paths=this._getPaths(t))}getPickingInfo({info:e}){return Object.assign(e,{object:e.object&&e.object.object||e.object})}_getPaths({data:e,getPolygon:t,positionFormat:n}){const i=[],r="XY"===n?2:3;for(const n of e){const{positions:e,holeIndices:a}=ot(t(n),r);if(a)for(let t=0;t<=a.length;t++){const r=e.subarray(a[t-1]||0,a[t]||e.length);i.push({path:r,object:n})}else i.push({path:e,object:n})}return i}_getAccessor(e){return"function"==typeof e?t=>e(t.object):e}renderLayers(){const{data:e,stroked:t,filled:n,extruded:i,wireframe:r,elevationScale:a,transitions:o}=this.props,{lineWidthScale:s,lineWidthMinPixels:c,lineWidthMaxPixels:u,lineJointRounded:l,lineMiterLimit:h,lineDashJustified:d,fp64:f}=this.props,{getFillColor:g,getLineColor:p,getLineWidth:v,getLineDashArray:m,getElevation:_,getPolygon:b,updateTriggers:y,lightSettings:x}=this.props,{paths:E}=this.state,w=this.getSubLayerClass("fill",vt),O=this.getSubLayerClass("stroke",qe),S=this.shouldRenderSubLayer("fill",E)&&new w({extruded:i,elevationScale:a,fp64:f,filled:n,wireframe:r,getElevation:_,getFillColor:g,getLineColor:p,lightSettings:x,transitions:o},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:y.getPolygon,getElevation:y.getElevation,getFillColor:y.getFillColor,getLineColor:y.getLineColor}}),{data:e,getPolygon:b}),P=!i&&t&&this.shouldRenderSubLayer("stroke",E)&&new O({fp64:f,widthScale:s,widthMinPixels:c,widthMaxPixels:u,rounded:l,miterLimit:h,dashJustified:d,transitions:o&&{getWidth:o.getLineWidth,getColor:o.getLineColor,getPath:o.getPolygon},getColor:this._getAccessor(p),getWidth:this._getAccessor(v),getDashArray:this._getAccessor(m)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:y.getLineWidth,getColor:y.getLineColor,getDashArray:y.getLineDashArray}}),{data:E,getPath:e=>e.path});return[!i&&S,P,i&&S]}}function bt(e,t){if(!e)throw new Error(`deck.gl: ${t}`)}function yt(e,t,n){const{type:i,coordinates:r}=e,{pointFeatures:a,lineFeatures:o,polygonFeatures:s,polygonOutlineFeatures:c}=t;switch(function(e,t){let n=Et[e];bt(n,`Unknown GeoJSON type ${e}`);for(;t&&--n>0;)t=t[0];bt(t&&Number.isFinite(t[0]),`${e} coordinates are malformed`)}(i,r),i){case"Point":a.push({geometry:e,sourceFeature:n});break;case"MultiPoint":r.forEach(e=>{a.push({geometry:{type:"Point",coordinates:e},sourceFeature:n})});break;case"LineString":o.push({geometry:e,sourceFeature:n});break;case"MultiLineString":r.forEach(e=>{o.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})});break;case"Polygon":s.push({geometry:e,sourceFeature:n}),r.forEach(e=>{c.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})});break;case"MultiPolygon":r.forEach(e=>{s.push({geometry:{type:"Polygon",coordinates:e},sourceFeature:n}),e.forEach(e=>{c.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})})})}}function xt(e){return e.sourceFeature.feature}_t.layerName="PolygonLayer",_t.defaultProps=mt;const Et={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};const wt={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,lineDashJustified:!1,fp64:!1,getLineColor:{type:"accessor",value:[0,0,0,255]},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},lightSettings:{}};function Ot(e){return e.geometry.coordinates}function St(e){return"function"!=typeof e?e:t=>e(xt(t))}class Pt extends i.CompositeLayer{initializeState(){this.state={features:{}}}updateState({oldProps:e,props:t,changeFlags:n}){if(n.dataChanged){const{data:e}=t,n=function(e){if(Array.isArray(e))return e;switch(bt(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return bt(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e);this.state.features=function(e){const t={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]};for(let n=0;n<e.length;n++){const i=e[n];bt(i&&i.geometry,"GeoJSON does not have geometry");const{geometry:r}=i,a={feature:i,index:n};if("GeometryCollection"===r.type){bt(Array.isArray(r.geometries),"GeoJSON does not have geometries array");const{geometries:e}=r;for(let n=0;n<e.length;n++)yt(e[n],t,a)}else yt(r,t,a)}return t}(n)}}getPickingInfo({info:e,sourceLayer:t}){return Object.assign(e,{object:e.object?xt(e.object):e.object,index:e.object?function(e){return e.sourceFeature.index}(e.object):e.index})}renderLayers(){const{features:e}=this.state,{pointFeatures:t,lineFeatures:n,polygonFeatures:i,polygonOutlineFeatures:r}=e,{stroked:a,filled:o,extruded:s,wireframe:c,lightSettings:u,transitions:l}=this.props,{lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f,lineJointRounded:g,lineMiterLimit:p,pointRadiusScale:v,pointRadiusMinPixels:m,pointRadiusMaxPixels:_,elevationScale:b,lineDashJustified:y,fp64:x}=this.props,{getLineColor:E,getFillColor:w,getRadius:O,getLineWidth:S,getLineDashArray:P,getElevation:A,updateTriggers:T}=this.props,C=this.getSubLayerClass("polygons-fill",vt),j=this.getSubLayerClass("polygons-stroke",qe),M=this.getSubLayerClass("line-strings",qe),R=this.getSubLayerClass("points",X),L=this.shouldRenderSubLayer("polygons-fill",i)&&new C({fp64:x,extruded:s,elevationScale:b,filled:o,wireframe:c,lightSettings:u,getElevation:St(A),getFillColor:St(w),getLineColor:St(E),transitions:l&&{getPolygon:l.geometry,getElevation:l.getElevation,getFillColor:l.getFillColor,getLineColor:l.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:T.getElevation,getFillColor:T.getFillColor,getLineColor:T.getLineColor}}),{data:i,getPolygon:Ot}),I=!s&&a&&this.shouldRenderSubLayer("polygons-stroke",r)&&new j({fp64:x,widthScale:h,widthMinPixels:d,widthMaxPixels:f,rounded:g,miterLimit:p,dashJustified:y,getColor:St(E),getWidth:St(S),getDashArray:St(P),transitions:l&&{getPath:l.geometry,getColor:l.getLineColor,getWidth:l.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:r,getPath:Ot}),F=this.shouldRenderSubLayer("linestrings",n)&&new M({fp64:x,widthScale:h,widthMinPixels:d,widthMaxPixels:f,rounded:g,miterLimit:p,dashJustified:y,getColor:St(E),getWidth:St(S),getDashArray:St(P),transitions:l&&{getPath:l.geometry,getColor:l.getLineColor,getWidth:l.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:n,getPath:Ot}),k=this.shouldRenderSubLayer("points",t)&&new R({fp64:x,stroked:a,filled:o,radiusScale:v,radiusMinPixels:m,radiusMaxPixels:_,lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f,getFillColor:St(w),getLineColor:St(E),getRadius:St(O),getLineWidth:St(S),transitions:l&&{getPosition:l.geometry,getFillColor:l.getFillColor,getLineColor:l.getLineColor,getRadius:l.getRadius,getLineWidth:l.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:T.getFillColor,getLineColor:T.getLineColor,getRadius:T.getRadius,getLineWidth:T.getLineWidth}}),{data:t,getPosition:Ot});return[!s&&L,I,F,k,s&&L]}}Pt.layerName="GeoJsonLayer",Pt.defaultProps=wt;var At='#define SHADER_NAME multi-icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\n// the following three attributes are for the multi-icon layer\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float gamma;\nuniform float opacity;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : instanceSizes / iconSize.y;\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * sizeScale * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0));\n  gl_Position += project_pixel_to_clipspace(pixelOffset);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  vGamma = gamma / (sizeScale * iconSize.y);\n}\n',Tt="#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform sampler2D iconsTexture;\nuniform float buffer;\nuniform bool sdf;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  \n  float alpha = texColor.a;\n  // if enable sdf (signed distance fields)\n  if (sdf) {\n    float distance = texture2D(iconsTexture, vTextureCoords).a;\n    alpha = smoothstep(buffer - vGamma, buffer + vGamma, distance);\n  }\n\n  // Take the global opacity and the alpha from vColor into account for the alpha component\n  float a = alpha * vColor.a;\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  gl_FragColor = vec4(vColor.rgb, a);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";const Ct=.2,jt=.75;class Mt extends T{getShaders(){return Object.assign({},super.getShaders(),{vs:At,fs:Tt})}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.updateTriggersChanged&&(t.updateTriggersChanged.getAnchorX||t.updateTriggersChanged.getAnchorY)&&this.getAttributeManager().invalidate("instanceOffsets")}draw({uniforms:e}){const{sdf:t}=this.props;super.draw({uniforms:Object.assign({},e,{buffer:jt,gamma:Ct,sdf:Boolean(t)})})}calculateInstanceOffsets(e){const{data:t,iconMapping:n,getIcon:i,getAnchorX:r,getAnchorY:a,getLengthOfQueue:o,getShiftInQueue:s}=this.props,{value:c}=e;let u=0;for(const e of t){const t=n[i(e)]||{},l=o(e),h=s(e);c[u++]=(r(e)-1)*l/2+t.width/2+h||0,c[u++]=t.height/2*a(e)||0}}calculateInstancePickingColors(e){const{data:t,getPickingIndex:n}=this.props,{value:i}=e;let r=0;const a=[];for(const e of t){const t=n(e);this.encodePickingColor(t,a),i[r++]=a[0],i[r++]=a[1],i[r++]=a[2]}}}Mt.layerName="MultiIconLayer",Mt.defaultProps={getShiftInQueue:{type:"accessor",value:e=>e.shift||0},getLengthOfQueue:{type:"accessor",value:e=>e.len||1},getAnchorX:{type:"accessor",value:e=>e.anchorX||0},getAnchorY:{type:"accessor",value:e=>e.anchorY||0},getPixelOffset:{type:"accessor",value:[0,0]},getPickingIndex:{type:"accessor",value:e=>e.objectIndex}};var Rt=n(67),Lt=n.n(Rt);const It=10242,Ft=10243,kt=33071,Nt=1024,Dt=.9,Bt=1.2;const Ut=function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),zt="Monaco, monospace",Gt="normal",Vt={fontSize:64,buffer:2,sdf:!1,cutoff:.25,radius:3};function Wt(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function Ht(e,t,n,i){e.font=`${i} ${n}px ${t}`,e.fillStyle="#000",e.textBaseline="baseline",e.textAlign="left"}function Xt(e,t){const n=Object.assign({fontFamily:zt,fontWeight:Gt,characterSet:Ut},Vt,t),{fontFamily:i,fontWeight:r,characterSet:a,fontSize:s,buffer:c,sdf:u,radius:l,cutoff:h}=n,d=document.createElement("canvas"),f=d.getContext("2d");Ht(f,i,s,r);const g=s*Bt,{canvasHeight:p,mapping:v}=function({ctx:e,fontHeight:t,buffer:n,characterSet:i,maxCanvasWidth:r}){const a={};let o=0,s=0;return Array.from(i).forEach(i=>{const{width:c}=e.measureText(i);s+c+2*n>r&&(s=0,o++),a[i]={x:s+n,y:o*(t+2*n)+n,width:c,height:t,mask:!0},s+=c+2*n}),{mapping:a,canvasHeight:(o+1)*(t+2*n)}}({ctx:f,fontHeight:g,buffer:c,characterSet:a,maxCanvasWidth:Nt});if(d.width=Nt,d.height=p,Ht(f,i,s,r),u){const e=new Lt.a(s,c,l,h,i,r),t=f.createImageData(e.size,e.size);for(const n of a)Wt(e.draw(n),t),f.putImageData(t,v[n].x-c,v[n].y-c)}else for(const e of a)f.fillText(e,v[e].x,v[e].y+s*Dt);return{scale:Bt,mapping:v,texture:new o.Texture2D(e,{pixels:d,parameters:{[It]:kt,[Ft]:kt}})}}const Yt={start:1,middle:0,end:-1},qt={top:1,center:0,bottom:-1},Zt=32,Kt=["fontSize","buffer","sdf","radius","cutoff"],$t={fp64:!1,sizeScale:1,characterSet:Ut,fontFamily:zt,fontWeight:Gt,fontSettings:{},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:[0,0,0,255]},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]}};class Qt extends i.CompositeLayer{updateState({props:e,oldProps:t,changeFlags:n}){const i=this.fontChanged(t,e);i&&this.updateFontAtlas(),(n.dataChanged||i||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this.transformStringToLetters()}updateFontAtlas(){const{gl:e}=this.context,{fontSettings:t,fontFamily:n,fontWeight:i,characterSet:r}=this.props,a=Object.assign({},Vt,t,{fontFamily:n,fontWeight:i,characterSet:r}),{scale:o,mapping:s,texture:c}=Xt(e,a);this.setState({scale:o,iconAtlas:c,iconMapping:s})}fontChanged(e,t){if(e.fontFamily!==t.fontFamily||e.characterSet!==t.characterSet||e.fontWeight!==t.fontWeight)return!0;if(e.fontSettings===t.fontSettings)return!1;const n=e.fontSettings||{},i=t.fontSettings||{};return Kt.some(e=>n[e]!==i[e])}getPickingInfo({info:e}){return Object.assign(e,{object:e.index>=0?this.props.data[e.index]:null})}transformStringToLetters(){const{data:e,getText:t}=this.props,{iconMapping:n}=this.state,r=[];let a=0;for(const o of e){const e=t(o);if(e){const t=[0];let s=0;Array.from(e).forEach((c,u)=>{const l={text:c,index:u,offsets:t,len:e.length,object:o,objectIndex:a},h=n[c];h?s+=h.width:(i.log.warn(`Missing character: ${c}`)(),s+=Zt),t.push(s),r.push(l)})}a++}this.setState({data:r})}getLetterOffset(e){return e.offsets[e.index]}getTextLength(e){return e.offsets[e.offsets.length-1]}_getAccessor(e){return"function"==typeof e?t=>e(t.object):e}getAnchorXFromTextAnchor(e){return t=>{const n="function"==typeof e?e(t.object):e;if(!Yt.hasOwnProperty(n))throw new Error(`Invalid text anchor parameter: ${n}`);return Yt[n]}}getAnchorYFromAlignmentBaseline(e){return t=>{const n="function"==typeof e?e(t.object):e;if(!qt.hasOwnProperty(n))throw new Error(`Invalid alignment baseline parameter: ${n}`);return qt[n]}}renderLayers(){const{data:e,scale:t,iconAtlas:n,iconMapping:i}=this.state,{getPosition:r,getColor:a,getSize:o,getAngle:s,getTextAnchor:c,getAlignmentBaseline:u,getPixelOffset:l,fp64:h,sdf:d,sizeScale:f,transitions:g,updateTriggers:p}=this.props;return new(this.getSubLayerClass("characters",Mt))({sdf:d,iconAtlas:n,iconMapping:i,getPosition:e=>r(e.object),getColor:this._getAccessor(a),getSize:this._getAccessor(o),getAngle:this._getAccessor(s),getAnchorX:this.getAnchorXFromTextAnchor(c),getAnchorY:this.getAnchorYFromAlignmentBaseline(u),getPixelOffset:this._getAccessor(l),fp64:h,sizeScale:f*t,transitions:g&&{getPosition:g.getPosition,getAngle:g.getAngle,getColor:g.getColor,getSize:g.getSize,getPixelOffset:p.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getPosition:p.getPosition,getAngle:p.getAngle,getColor:p.getColor,getSize:p.getSize,getPixelOffset:p.getPixelOffset,getAnchorX:p.getTextAnchor,getAnchorY:p.getAlignmentBaseline}}),{data:e,getIcon:e=>e.text,getShiftInQueue:e=>this.getLetterOffset(e),getLengthOfQueue:e=>this.getTextLength(e)})}}Qt.layerName="TextLayer",Qt.defaultProps=$t;var Jt=n(31);const en={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},tn=[en.W,en.SW,en.S],nn=[en.S,en.SE,en.E],rn=[en.E,en.NE,en.N],an=[en.NW,en.W,en.N],on=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5]],sn=[[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6]],cn=[[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],un=[[-.5,1/6],[-.5,-1/6],[1/6,.5],[-1/6,.5]],ln=[en.W,en.SW,en.SE,en.E],hn=[en.S,en.SE,en.NE,en.N],dn=[en.NW,en.W,en.E,en.NE],fn=[en.NW,en.SW,en.S,en.N],gn=[[-.5,1/6],[-.5,-1/6],[.5,-1/6],[.5,1/6]],pn=[[-1/6,-.5],[1/6,-.5],[1/6,.5],[-1/6,.5]],vn=[en.NW,en.SW,en.SE,en.NE],mn=[en.NW,en.SW,en.SE,en.E,en.N],_n=[en.W,en.SW,en.SE,en.NE,en.N],bn=[en.NW,en.W,en.S,en.SE,en.NE],yn=[en.NW,en.SW,en.S,en.E,en.NE],xn=[en.NW,en.W,[.5,-1/6],[.5,1/6],en.N],En=[[-1/6,-.5],[1/6,-.5],en.E,en.NE,en.N],wn=[[-.5,1/6],[-.5,-1/6],en.S,en.SE,en.E],On=[en.W,en.SW,en.S,[1/6,.5],[-1/6,.5]],Sn=[en.NW,en.W,[-1/6,-.5],[1/6,-.5],en.N],Pn=[[-.5,1/6],[-.5,-1/6],en.E,en.NE,en.N],An=[en.S,en.SE,en.E,[1/6,.5],[-1/6,.5]],Tn=[en.W,en.SW,en.S,[.5,-1/6],[.5,1/6]],Cn=[en.W,en.SW,en.SE,en.E,[1/6,.5],[-1/6,.5]],jn=[[-.5,1/6],[-.5,-1/6],en.S,en.SE,en.NE,en.N],Mn=[en.NW,en.W,[-1/6,-.5],[1/6,-.5],en.E,en.NE],Rn=[en.NW,en.SW,en.S,[.5,-1/6],[.5,1/6],en.N],Ln=[en.W,en.SW,en.S,en.E,en.NE,en.N],In=[en.NW,en.W,en.S,en.SE,en.E,en.N],Fn=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5],en.E,en.NE,en.N],kn=[en.W,en.SW,en.S,[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],Nn=[en.NW,en.W,[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6],en.N],Dn=[[-.5,1/6],[-.5,-1/6],en.S,en.SE,en.E,[1/6,.5],[-1/6,.5]],Bn=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],Un={0:[],1:[[en.W,en.S]],2:[[en.S,en.E]],3:[[en.W,en.E]],4:[[en.N,en.E]],5:{0:[[en.W,en.S],[en.N,en.E]],1:[[en.W,en.N],[en.S,en.E]]},6:[[en.N,en.S]],7:[[en.W,en.N]],8:[[en.W,en.N]],9:[[en.N,en.S]],10:{0:[[en.W,en.N],[en.S,en.E]],1:[[en.W,en.S],[en.N,en.E]]},11:[[en.N,en.E]],12:[[en.W,en.E]],13:[[en.S,en.E]],14:[[en.W,en.S]],15:[]};function zn(e){return parseInt(e,4)}const Gn={[zn("0000")]:[],[zn("2222")]:[],[zn("2221")]:[tn],[zn("2212")]:[nn],[zn("2122")]:[rn],[zn("1222")]:[an],[zn("0001")]:[tn],[zn("0010")]:[nn],[zn("0100")]:[rn],[zn("1000")]:[an],[zn("2220")]:[on],[zn("2202")]:[sn],[zn("2022")]:[cn],[zn("0222")]:[un],[zn("0002")]:[on],[zn("0020")]:[sn],[zn("0200")]:[cn],[zn("2000")]:[un],[zn("0011")]:[ln],[zn("0110")]:[hn],[zn("1100")]:[dn],[zn("1001")]:[fn],[zn("2211")]:[ln],[zn("2112")]:[hn],[zn("1122")]:[dn],[zn("1221")]:[fn],[zn("2200")]:[gn],[zn("2002")]:[pn],[zn("0022")]:[gn],[zn("0220")]:[pn],[zn("1111")]:[vn],[zn("1211")]:[mn],[zn("2111")]:[_n],[zn("1112")]:[bn],[zn("1121")]:[yn],[zn("1011")]:[mn],[zn("0111")]:[_n],[zn("1110")]:[bn],[zn("1101")]:[yn],[zn("1200")]:[xn],[zn("0120")]:[En],[zn("0012")]:[wn],[zn("2001")]:[On],[zn("1022")]:[xn],[zn("2102")]:[En],[zn("2210")]:[wn],[zn("0221")]:[On],[zn("1002")]:[Sn],[zn("2100")]:[Pn],[zn("0210")]:[An],[zn("0021")]:[Tn],[zn("1220")]:[Sn],[zn("0122")]:[Pn],[zn("2012")]:[An],[zn("2201")]:[Tn],[zn("0211")]:[Cn],[zn("2110")]:[jn],[zn("1102")]:[Mn],[zn("1021")]:[Rn],[zn("2011")]:[Cn],[zn("0112")]:[jn],[zn("1120")]:[Mn],[zn("1201")]:[Rn],[zn("2101")]:[Ln],[zn("0121")]:[Ln],[zn("1012")]:[In],[zn("1210")]:[In],[zn("0101")]:{0:[tn,rn],1:[Ln],2:[Ln]},[zn("1010")]:{0:[an,nn],1:[In],2:[In]},[zn("2121")]:{0:[Ln],1:[Ln],2:[tn,rn]},[zn("1212")]:{0:[In],1:[In],2:[an,nn]},[zn("2120")]:{0:[Fn],1:[Fn],2:[on,rn]},[zn("2021")]:{0:[kn],1:[kn],2:[tn,cn]},[zn("1202")]:{0:[Nn],1:[Nn],2:[an,sn]},[zn("0212")]:{0:[Dn],1:[Dn],2:[nn,un]},[zn("0102")]:{0:[on,rn],1:[Fn],2:[Fn]},[zn("0201")]:{0:[tn,cn],1:[kn],2:[kn]},[zn("1020")]:{0:[an,sn],1:[Nn],2:[Nn]},[zn("2010")]:{0:[nn,un],1:[Dn],2:[Dn]},[zn("2020")]:{0:[un,sn],1:[Bn],2:[on,cn]},[zn("0202")]:{0:[cn,on],1:[Bn],2:[un,sn]}},Vn={ISO_LINES:1,ISO_BANDS:2},Wn=.002,Hn={zIndex:0,zOffsetScale:1};function Xn(e,t){return Array.isArray(t)?e<t[0]?0:e<t[1]?1:2:e>=t?1:0}function Yn(e){const{cellWeights:t,x:n,y:r,width:a,height:o}=e;let s=e.threshold;e.thresholdValue&&(i.log.deprecated("thresholdValue","threshold")(),s=e.thresholdValue);const c=n<0,u=n>=a-1,l=r<0,h=r>=o-1,d=c||u||l||h,f={},g={};c||h?g.top=0:(f.top=t[(r+1)*a+n],g.top=Xn(f.top,s)),u||h?g.topRight=0:(f.topRight=t[(r+1)*a+n+1],g.topRight=Xn(f.topRight,s)),u||l?g.right=0:(f.right=t[r*a+n+1],g.right=Xn(f.right,s)),c||l?g.current=0:(f.current=t[r*a+n],g.current=Xn(f.current,s));const{top:p,topRight:v,right:m,current:_}=g;let b=-1;Number.isFinite(s)&&(b=p<<3|v<<2|m<<1|_),Array.isArray(s)&&(b=p<<6|v<<4|m<<2|_);let y=0;return d||(y=Xn((f.top+f.topRight+f.right+f.current)/4,s)),{code:b,meanCode:y}}function qn(e){const{gridOrigin:t,cellSize:n,x:i,y:r,code:a,meanCode:o,type:s=Vn.ISO_LINES}=e,c=Object.assign({},Hn,e.thresholdData);let u=s===Vn.ISO_BANDS?Gn[a]:Un[a];Array.isArray(u)||(u=u[o]);const l=c.zIndex*Wn*c.zOffsetScale,h=(i+1)*n[0],d=(r+1)*n[1],f=t[0]+h,g=t[1]+d;if(s===Vn.ISO_BANDS){const e=[];return u.forEach(t=>{const i=[];t.forEach(e=>{const t=f+e[0]*n[0],r=g+e[1]*n[1];i.push([t,r,l])}),e.push(i)}),e}const p=[];return u.forEach(e=>{e.forEach(e=>{const t=f+e[0]*n[0],i=g+e[1]*n[1];p.push([t,i,l])})}),p}const Zn=[255,255,255,255],Kn=1,$n={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:e=>1},contours:[{threshold:1}],fp64:!1,zOffsetScale:1};class Qn extends i.CompositeLayer{initializeState(){const{gl:e}=this.context,t={id:`${this.id}-gpu-aggregator`,shaderCache:this.context.shaderCache};this.state={contourData:{},gridAggregator:new i._GPUGridAggregator(e,t),colorTrigger:0,strokeWidthTrigger:0}}updateState({oldProps:e,props:t,changeFlags:n}){let i=!1,r=!1;const a=this._getAggregationFlags({oldProps:e,props:t,changeFlags:n});a&&(i=!0,this.setState({countsData:null}),this._aggregateData(a)),this._shouldRebuildContours({oldProps:e,props:t})&&(r=!0,this._updateThresholdData(t)),i||r?this._generateContours():this._updateSubLayerTriggers(e,t)}renderLayers(){const{contourSegments:e,contourPolygons:t}=this.state.contourData,n=e&&e.length>0,i=t&&t.length>0;return[n&&new L(this._getLineLayerProps()),i&&new vt(this._getSolidPolygonLayerProps())]}_aggregateData(e){const{data:t,cellSize:n,getPosition:r,getWeight:a,gpuAggregation:o,fp64:s,coordinateSystem:c}=this.props,{countsData:u,countsBuffer:l,gridSize:h,gridOrigin:d,cellSize:f,boundingBox:g}=Object(i._pointToDensityGridData)({data:t,cellSizeMeters:n,getPosition:r,getWeight:a,gpuAggregation:o,gpuGridAggregator:this.state.gridAggregator,fp64:s,coordinateSystem:c,viewport:this.context.viewport,boundingBox:this.state.boundingBox,aggregationFlags:e});this.setState({countsData:u,countsBuffer:l,gridSize:h,gridOrigin:d,cellSize:f,boundingBox:g})}_generateContours(){const{gridSize:e,gridOrigin:t,cellSize:n,thresholdData:r}=this.state;let{countsData:a}=this.state;if(!a){const{countsBuffer:e}=this.state;a=e.getData(),this.setState({countsData:a})}const{cellWeights:o}=i._GPUGridAggregator.getCellData({countsData:a}),s=function({thresholdData:e,colors:t,cellWeights:n,gridSize:i,gridOrigin:r,cellSize:a}){const o=[],s=[],c=i[0],u=i[1];return e.forEach((e,t)=>{const{threshold:i}=e;for(let t=-1;t<c;t++)for(let l=-1;l<u;l++){const{code:h,meanCode:d}=Yn({cellWeights:n,threshold:i,x:t,y:l,width:c,height:u}),f={gridOrigin:r,cellSize:a,x:t,y:l,width:c,height:u,code:h,meanCode:d,thresholdData:e};if(Array.isArray(i))f.type=Vn.ISO_BANDS,qn(f).forEach(e=>{s.push({vertices:e,threshold:i})});else{f.type=Vn.ISO_LINES;const e=qn(f);for(let t=0;t<e.length;t+=2)o.push({start:e[t],end:e[t+1],threshold:i})}}}),{contourSegments:o,contourPolygons:s}}({thresholdData:r,cellWeights:o,gridSize:e,gridOrigin:t,cellSize:n});this.setState({contourData:s})}_getAggregationFlags({oldProps:e,props:t,changeFlags:n}){let i=null;return(n.dataChanged||e.gpuAggregation!==t.gpuAggregation||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition))&&(i=Object.assign({},i,{dataChanged:!0})),e.cellSize!==t.cellSize&&(i=Object.assign({},i,{cellSizeChanged:!0})),i}_getLineLayerProps(){const{fp64:e}=this.props,{colorTrigger:t,strokeWidthTrigger:n}=this.state;return super.getSubLayerProps({id:"contour-line-layer",data:this.state.contourData.contourSegments,fp64:e,getSourcePosition:e=>e.start,getTargetPosition:e=>e.end,getColor:this._onGetSublayerColor.bind(this),getStrokeWidth:this._onGetSublayerStrokeWidth.bind(this),colorTrigger:t,strokeWidthTrigger:n,updateTriggers:{getColor:t,getStrokeWidth:n}})}_getSolidPolygonLayerProps(){const{fp64:e}=this.props,{colorTrigger:t}=this.state;return super.getSubLayerProps({id:"contour-solid-polygon-layer",data:this.state.contourData.contourPolygons,fp64:e,getPolygon:e=>e.vertices,getFillColor:this._onGetSublayerColor.bind(this),colorTrigger:t,updateTriggers:{getFillColor:t}})}_onGetSublayerColor(e){const{contours:t}=this.props;let n=Zn;return t.forEach(t=>{Object(Jt.e)(t.threshold,e.threshold)&&(n=t.color||Zn)}),n}_onGetSublayerStrokeWidth(e){const{contours:t}=this.props;let n=Kn;return t.some(t=>t.threshold===e.threshold&&(n=t.strokeWidth||Kn,!0)),n}_shouldRebuildContours({oldProps:e,props:t}){if(!e.contours||!e.zOffsetScale||e.contours.length!==t.contours.length||e.zOffsetScale!==t.zOffsetScale)return!0;const n=e.contours.map(e=>e.threshold),i=t.contours.map(e=>e.threshold);return i.some((e,t)=>!Object(Jt.e)(i[t],n[t]))}_updateSubLayerTriggers(e,t){if(e&&e.contours&&t&&t.contours){let n=[],i=[];const r=[],a=[];e.contours.forEach(e=>{n=n.concat(e.color),r.push(e.strokeWidth||Kn)}),t.contours.forEach(e=>{i=i.concat(e.color),a.push(e.strokeWidth||Kn)}),Object(Jt.e)(n,i)||this.state.colorTrigger++,Object(Jt.e)(r,a)||this.state.strokeWidthTrigger++}}_updateThresholdData(e){const t=e.contours.map((t,n)=>({threshold:t.threshold,zIndex:t.zIndex||n,zOffsetScale:e.zOffsetScale}));this.setState({thresholdData:t})}}Qn.layerName="ContourLayer",Qn.defaultProps=$n,n.d(t,"ArcLayer",function(){return f}),n.d(t,"IconLayer",function(){return T}),n.d(t,"LineLayer",function(){return L}),n.d(t,"PointCloudLayer",function(){return U}),n.d(t,"ScatterplotLayer",function(){return X}),n.d(t,"ScreenGridLayer",function(){return re}),n.d(t,"GridLayer",function(){return be}),n.d(t,"GridCellLayer",function(){return le}),n.d(t,"HexagonLayer",function(){return Ne}),n.d(t,"HexagonCellLayer",function(){return Se}),n.d(t,"PathLayer",function(){return qe}),n.d(t,"PolygonLayer",function(){return _t}),n.d(t,"GeoJsonLayer",function(){return Pt}),n.d(t,"TextLayer",function(){return Qt}),n.d(t,"ContourLayer",function(){return Qn}),n.d(t,"_SolidPolygonLayer",function(){return vt}),n.d(t,"_MultiIconLayer",function(){return Mt})},function(e,t,n){"use strict";n.r(t);var i=n(12),r=n(5);function a({map:e,gl:t,deck:n}){if(e.__deck)return e.__deck;const a={useDevicePixels:!0,_customRender:()=>e.triggerRepaint(),parameters:{depthMask:!0,depthTest:!0,blendFunc:[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],blendEquation:t.FUNC_ADD},userData:{isExternal:!1,mapboxLayers:new Set}};return n?(n.setProps(a),n.props.userData.isExternal=!0):(Object.assign(a,{gl:t,width:!1,height:!1}),n=new i.Deck(a),e.on("remove",()=>{n.finalize(),e.__deck=null})),e.__deck=n,e.on("render",()=>(function(e,t){const{mapboxLayers:n,isExternal:i}=e.props.userData;if(i){const i=o(t,{nearZMultiplier:.1,farZMultiplier:10});e.setProps({viewState:i});const r=Array.from(n,e=>e.id);e.layerManager.layerFilter=(e=>{for(const t of r)if(s(t,e.layer))return!1;return!0}),e._drawLayers("mapbox-repaint")}e.needsRedraw({clearRedrawFlags:!0})})(n,e)),function(e,t){const n=e=>(function(e,t){let n;switch(e.layerManager.layerFilter=null,t.type){case"click":n=e._onClick;break;case"mousemove":case"pointermove":n=e._onPointerMove;break;case"mouseleave":case"pointerleave":n=e._onPointerLeave;break;default:return}t.offsetCenter||(t={offsetCenter:t.point,srcEvent:t.originalEvent});const{gl:i}=e.layerManager.context;Object(r.withParameters)(i,{depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},()=>n(t))})(t,e);t.eventManager?(t.eventManager.off({click:t._onClick,pointermove:t._onPointerMove,pointerleave:t._onPointerLeave}),t.eventManager.on({click:n,pointermove:n,pointerleave:n})):(e.on("click",n),e.on("mousemove",n),e.on("mouseleave",n))}(e,n),n}function o(e,t){const{lng:n,lat:i}=e.getCenter();return Object.assign({longitude:n,latitude:i,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()},t)}function s(e,t){let n=t;for(;n;){if(n.id===e)return!0;n=n.parent}return!1}function c(e){if(e.props.userData.isExternal)return;const t=[];e.props.userData.mapboxLayers.forEach(e=>{const n=new(0,e.props.type)(e.props);t.push(n)}),e.setProps({layers:t})}class u{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=a({map:e,gl:t,deck:this.props.deck}),function(e,t){e.props.userData.mapboxLayers.add(t),c(e)}(this.deck,this)}onRemove(){!function(e,t){e.props.userData.mapboxLayers.delete(t),c(e)}(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&function(e,t){c(e)}(this.deck)}render(e,t){this.deck.setProps({viewState:this._getViewState()}),function(e,t){e.layerManager.layerFilter=(e=>s(t.id,e.layer)),e._drawLayers("mapbox-repaint")}(this.deck,this)}_getViewState(){const{map:e,deck:t}=this;return o(e,{nearZMultiplier:t.height?1/t.height:1,farZMultiplier:1})}}n.d(t,"MapboxLayer",function(){return u})},function(e,t,n){"use strict";var i=n(19),r=n(17),a=n(1),o=n(2),s=n(40);var c=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(a.a)(this,e),this.storage=function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}(i),this.id=t,this.config={},Object.assign(this.config,n),this._loadConfiguration()}return Object(o.a)(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}(),u=n(33),l=n(42),h={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function d(e){return"string"==typeof e?h[e.toUpperCase()]||h.WHITE:e}function f(e,t){if(!e)throw new Error("Assertion failed. ".concat(t))}n.d(t,"a",function(){return _});var g={debug:s.b&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},p={enabled:!1,priority:0};function v(){}var m={};var _=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;Object(a.a)(this,e),this.id=t,this.VERSION=s.a,this._startTs=Object(u.a)(),this._deltaTs=Object(u.a)(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new c("__probe-".concat(this.id,"__"),p),this.userData={},this.timeStamp("".concat(this.id," started")),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),r=!0,a=!1,o=void 0;try{for(var s,c=function(){var n=s.value;"function"==typeof e[n]&&(t.find(function(e){return n===e})||(e[n]=e[n].bind(e)))},u=i[Symbol.iterator]();!(r=(s=u.next()).done);r=!0)c()}catch(e){a=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}}(this),Object.seal(this)}return Object(o.a)(e,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getPriority",value:function(){return this._storage.config.priority}},{key:"getLevel",value:function(){return this._storage.config.priority}},{key:"getTotal",value:function(){return Number((Object(u.a)()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((Object(u.a)()-this._deltaTs).toPrecision(10))}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({priority:e}),this}},{key:"warn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this._getLogFunction({message:e,args:n,method:g.warn,once:!0})}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this._getLogFunction({message:e,args:n,method:g.error})}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:e,message:t,args:i,method:g.log,time:!0,once:!0})}},{key:"log",value:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:e,message:t,args:i,method:g.debug})}},{key:"info",value:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:e,message:t,args:i,method:console.info})}},{key:"once",value:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:e,message:t,args:i,method:g.debug||g.info,once:!0})}},{key:"table",value:function(e,t,n){if(t){var i=function(e){for(var t in e)for(var n in e[t])return n||"untitled";return"empty"}(t);return this._getLogFunction({priority:e,message:t,args:n&&[n],tag:i,method:console.table||v})}return v}},{key:"image",value:function(e){var t=e.priority,n=e.image,i=e.message,r=void 0===i?"":i,a=e.scale,o=void 0===a?1:a;return t>this.getPriority()?v:s.b?this._logImageInBrowser({image:n,message:r,scale:o}):this._logImageInNode({image:n,message:r,scale:o})}},{key:"_logImageInNode",value:function(e){var t=e.image,i=(e.message,e.scale),r=void 0===i?1:i,a=null;try{a=n(70)}catch(e){}return a?function(){return a(t,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then(function(e){return console.log(e)})}:v}},{key:"_logImageInBrowser",value:function(e){var t=e.image,n=e.message,i=void 0===n?"":n,a=e.scale,o=void 0===a?1:a;if("string"==typeof t){var s=new Image;return s.onload=function(){var e,t=Object(l.a)(s,i,o);(e=console).log.apply(e,Object(r.a)(t))},s.src=t,v}var c,u=t.nodeName||"";if("img"===u.toLowerCase())return(c=console).log.apply(c,Object(r.a)(Object(l.a)(t,i,o))),v;if("canvas"===u.toLowerCase()){var h=new Image;return h.onload=function(){var e;return(e=console).log.apply(e,Object(r.a)(Object(l.a)(h,i,o)))},h.src=t.toDataURL(),v}return v}},{key:"time",value:function(e,t){return this._getLogFunction({priority:e,message:t,method:console.time?console.time:console.info})}},{key:"timeEnd",value:function(e,t){return this._getLogFunction({priority:e,message:t,method:console.timeEnd?console.timeEnd:console.info})}},{key:"timeStamp",value:function(e,t){return this._getLogFunction({priority:e,message:t,method:console.timeStamp||v})}},{key:"group",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},i=(n=this._normalizeArguments({priority:e,message:t,opts:n})).collapsed;return this._getLogFunction({priority:e,message:t,opts:n,method:(i?console.groupCollapsed:console.group)||console.info})}},{key:"groupCollapsed",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction({priority:e,message:"",method:console.groupEnd||v})}},{key:"withGroup",value:function(e,t,n){var i=this._normalizeArguments({priority:e,message:t});this.group(i);try{n()}finally{this.groupEnd(i.message)}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return 0===(e=this._normalizePriority(e))||this.isEnabled()&&this.getPriority()>=e}},{key:"_getElapsedTime",value:function(){var e=this.getTotal(),t=this.getDelta();return this._deltaTs=Object(u.a)(),{total:e,delta:t}}},{key:"_getLogFunction",value:function(e){if(this._shouldLog(e.priority)){var t=e.method;e=this._parseArguments(e),f(t);var n=e.message,i=e.tag||e.message;if(e.once){if(m[i])return v;m[i]=Object(u.a)()}return n=this._decorateMessage(n,e),t.bind.apply(t,[console,n].concat(Object(r.a)(e.args)))}return v}},{key:"_parseArguments",value:function(e){var t=this._normalizeArguments(e),n=this._getElapsedTime(),i=n.delta,r=n.total;return Object.assign(e,t,{delta:i,total:r})}},{key:"_normalizePriority",value:function(e){var t;switch(Object(i.a)(e)){case"number":t=e;break;case"object":t=e.priority||0;break;default:t=0}return f(Number.isFinite(t)&&t>=0),t}},{key:"_normalizeArguments",value:function(e){var t=e.priority,n=e.message,r=e.args,a=void 0===r?[]:r,o=e.opts,s={priority:this._normalizePriority(t),message:n,args:a};switch(Object(i.a)(t)){case"string":case"function":void 0!==n&&a.unshift(n),Object.assign(s,{message:t});break;case"object":Object.assign(s,t)}return"function"==typeof s.message&&(s.message=this._shouldLog(s.priority)?s.message():""),f("string"==typeof s.message||"object"===Object(i.a)(s.message)),Object.assign(s,o)}},{key:"_decorateMessage",value:function(e,t){if("string"==typeof e){var n="";if(t.time){var i=this._getElapsedTime().total;n=Object(l.c)(Object(l.b)(i))}e=function(e,t,n){return s.b||"string"!=typeof e||(t&&(t=d(t),e="[".concat(t,"m").concat(e,"[39m")),n&&(t=d(n),e="[".concat(n+10,"m").concat(e,"[49m"))),e}(e=t.time?"".concat(this.id,": ").concat(n,"  ").concat(e):"".concat(this.id,": ").concat(e),t.color,t.background)}return e}},{key:"priority",set:function(e){return this._storage.updateConfiguration({priority:e}),this},get:function(){return this._storage.config.priority}}]),e}();_.VERSION=s.a},function(e,t,n){"use strict";var i=n(14),r=n(17),a=n(1),o=n(2),s=n(9),c=n(8),u=n(10),l=n(60),h=n(31),d=n(76),f=n(62),g=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(a.a)(this,t),e=Object(s.a)(this,Object(c.a)(t).call(this)),Array.isArray(n)&&1===arguments.length?e.copy(n):e.set(n,i,r,o),e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"applyMatrix4",value:function(e){return e.transformVector(this,this),this}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(e){return this[2]=Object(h.a)(e)}},{key:"w",get:function(){return this[3]},set:function(e){return this[3]=Object(h.a)(e)}}]),t}(n(51).a),p=n(11),v=n(26),m=n(35),_=n(32);n.d(t,"a",function(){return x});var b=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function y(e,t){return e.length===t&&e.every(Number.isFinite)}var x=function(e){function t(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return Object(a.a)(this,t),e=Object(s.a)(this,Object(c.a)(t).call(this)),Array.isArray(i[0])&&1===arguments.length?e.copy(i[0]):e.identity(),e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"setRowMajor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,g=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,p=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=e,this[1]=r,this[2]=c,this[3]=d,this[4]=t,this[5]=a,this[6]=u,this[7]=f,this[8]=n,this[9]=o,this[10]=l,this[11]=g,this[12]=i,this[13]=s,this[14]=h,this[15]=p,this.check()}},{key:"setColumnMajor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,g=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,p=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=a,this[6]=o,this[7]=s,this[8]=c,this[9]=u,this[10]=l,this[11]=h,this[12]=d,this[13]=f,this[14]=g,this[15]=p,this.check()}},{key:"copy",value:function(e){return this.setColumnMajor.apply(this,Object(r.a)(e))}},{key:"set",value:function(){return this.setColumnMajor.apply(this,arguments)}},{key:"getElement",value:function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this[e][t]:this[t][e]}},{key:"setElement",value:function(e,t,n){return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?this[e][t]=Object(h.a)(n):this[t][e]=Object(h.a)(n),this}},{key:"determinant",value:function(){return p.a(this)}},{key:"identity",value:function(){return this.copy(b)}},{key:"fromQuaternion",value:function(e){return p.c(this,e),this.check()}},{key:"frustum",value:function(e){var t=e.left,n=e.right,i=e.bottom,r=e.top,a=e.near,o=e.far;return p.d(this,t,n,i,r,a,o),this.check()}},{key:"lookAt",value:function(e){var t=e.eye,n=e.center,i=void 0===n?[0,0,0]:n,r=e.up,a=void 0===r?[0,1,0]:r;return p.f(this,t,i,a),this.check()}},{key:"ortho",value:function(e){var t=e.left,n=e.right,i=e.bottom,r=e.top,a=e.near,o=void 0===a?.1:a,s=e.far,c=void 0===s?500:s;return p.h(this,t,n,i,r,o,c),this.check()}},{key:"orthographic",value:function(e){var n=e.fovy,i=void 0===n?45*Math.PI/180:n,r=e.aspect,a=void 0===r?1:r,o=e.focalDistance,s=void 0===o?1:o,c=e.near,u=void 0===c?.1:c,l=e.far,h=void 0===l?500:l;if(i>2*Math.PI)throw Error("radians");var d=i/2,f=s*Math.tan(d),g=f*a;return(new t).ortho({left:-g,right:g,bottom:-f,top:f,near:u,far:h})}},{key:"perspective",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fovy,n=e.fov,i=void 0===n?45*Math.PI/180:n,r=e.aspect,a=void 0===r?1:r,o=e.near,s=void 0===o?.1:o,c=e.far,u=void 0===c?500:c;if((t=t||i)>2*Math.PI)throw Error("radians");return p.i(this,t,a,s,u),this.check()}},{key:"transpose",value:function(){return p.p(this,this),this.check()}},{key:"invert",value:function(){return p.e(this,this),this.check()}},{key:"multiplyLeft",value:function(e){return p.g(this,e,this),this.check()}},{key:"multiplyRight",value:function(e){return p.g(this,this,e),this.check()}},{key:"rotateX",value:function(e){return p.k(this,this,e),this.check()}},{key:"rotateY",value:function(e){return p.l(this,this,e),this.check()}},{key:"rotateZ",value:function(e){return p.m(this,this,e),this.check()}},{key:"rotateXYZ",value:function(e){var t=Object(i.a)(e,3),n=t[0],r=t[1],a=t[2];return this.rotateX(n).rotateY(r).rotateZ(a)}},{key:"rotateAxis",value:function(e,t){return p.j(this,this,e,t),this.check()}},{key:"scale",value:function(e){return p.n(this,this,e),this.check()}},{key:"translate",value:function(e){return p.o(this,this,e),this.check()}},{key:"transformVector2",value:function(e,t){return t=t||new d.a,v.h(t,e,this),y(t,2),t}},{key:"transformVector3",value:function(e,t){return t=t||new f.a,m.i(t,e,this),y(t,3),t}},{key:"transformVector4",value:function(e,t){return t=t||new g,_.c(t,e,this),y(t,4),t.check()}},{key:"transformVector",value:function(e,t){switch(e.length){case 2:return this.transformVector2(e,t);case 3:return this.transformVector3(e,t);case 4:return this.transformVector4(e,t);default:throw new Error("Illegal vector")}}},{key:"transformDirection",value:function(e,t){return this._transformVector(e,t,0)}},{key:"transformPoint",value:function(e,t){return this._transformVector(e,t,1)}},{key:"_transformVector",value:function(e,t,n){switch(e.length){case 2:t=t||new d.a,_.c(t,[e[0],e[1],0,n],this),t.length=2,y(t,2);break;case 3:t=t||new f.a,_.c(t,[e[0],e[1],e[2],n],this),t.length=3,y(t,3);break;case 4:if(Boolean(n)!==Boolean(e[3]))throw new Error("math.gl: Matrix4.transformPoint - invalid vector");t=t||new g,_.c(t,e,this),y(t,4);break;default:throw new Error("Illegal vector")}return t}},{key:"makeRotationX",value:function(e){return this.identity().rotateX(e)}},{key:"makeTranslation",value:function(e,t,n){return this.identity().translate([e,t,n])}},{key:"ELEMENTS",get:function(){return 16}}]),t}(l.a)}])});